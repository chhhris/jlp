define.experiment.component("wysiwyg.common.components.InfoTip.EditorRulers.New",function(e,t){var i=e;i.fields({_defaultShowTimer:100}),i.methods({_showToolTipCmd:function(e,t){this._shouldShowTooltipAfterTimout=!0,this._tipToShow=e.id?e.id:e.html,e.showTimer&&(this._showTimer=e.showTimer),clearTimeout(this._hideToolTipTimeOut),window.setTimeout(function(){var i=e.id?e.id:e.html;this._shouldShowTooltipAfterTimout&&this._tipToShow===i&&this._callTip(e,t)}.bind(this),this._showTimer)},_resetToolTip:function(){this._skinParts.content.empty(),this._showTimer=this._defaultShowTimer}})}),define.experiment.component("wysiwyg.common.components.InfoTip.LongerTooltipTimer.New",function(e,t){var i=e;i.fields({_defaultShowTimer:500,_showTimer:500})}),define.experiment.component("wysiwyg.common.components.inputs.OptionsListInput.RichTextViewer.New",function(e){var t=e;t.methods({_onDataChange:function(e,t,i){if("selected"==t){var n=this._getSelectedComponentByData(i[t]);this._changeSelectedItem(n)}this.parent(e,t,i)},_getSelectedComponentByData:function(e){var t=this.items.map(function(e){return e.$logic}),i=t.filter(function(t){return t.getDataItem()==e});return i&&i[0]},_prepareForRender:function(){return this._sequencer.addEvent("productionFinished",function(e){this._onSequencerFinished(e),this.fireEvent("optionListInputReady",e)}.bind(this)),this._sequencer.createComponents(this.getViewNode(),this.getDataItem().get("items")),!0},_onSequencerFinished:function(e){this.items=e.elements,this.items.forEach(function(e){var t=e.getLogic();t.addEvent("itemSelected",this._onItemSelected),t.getDataItem()===this.getDataItem().get("selected")&&(this._selectedItem=t,this._selectedItem.setSelected(!0))}.bind(this))},_onItemSelected:function(e){if(!this._selectedItem||this._selectedItem!==e){var t=e.getDataItem();this.setValidationState(!0),this.getDataItem().set("selected",t),this.fireEvent("selectionChanged",t)}},_changeSelectedItem:function(e){e&&(this._selectedItem&&this._selectedItem.setSelected(!1),this._selectedItem=e,this._selectedItem.setSelected(!0))}})}),define.experiment.Class("wysiwyg.common.components.traits.LinkableComponent.CursorBug4810.New",function(e){var t=e;t.methods({_linkify:function(e,t,i,n){t&&(i&&""!==i?(t.set("href",i),t.setStyle("cursor","pointer"),this._setTarget(t,n),this.hasState("noLink","linkableComponent")&&this.removeState("noLink","linkableComponent")):(t.setStyle("cursor",""),t.erase("href"),t.erase("target"),this.hasState("noLink","linkableComponent")&&this.setState("noLink","linkableComponent")),this._handleSpecialCases(e,t))}})}),define.experiment.newClass("wysiwyg.common.components.traits.SelectableButton.RichText.New",function(e){var t=e;t.inherits("wysiwyg.common.components.traits.SelectableOption"),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.addEvent("click",function(){this.fireEvent(this.ITEM_SELECTED_EVENT,this)}.bind(this))},setSelected:function(e){this._isSelected=e,e?this.setState("selected"):this.setState("up")}})}),define.experiment.newDataSchema("FacebookShareDataSchema.FacebookShare.New",function(){return{urlChoice:{type:"string","enum":["Current page Url","Site Url"],"default":"Current page Url",description:"Share: current/site Url"},label:{type:"string","default":"Share",description:""}}}),define.experiment.newDataSchema("StyledText.RichTextViewer.New",function(){return{text:"string",stylesMapId:"string"}}),define.experiment.Class("wysiwyg.common.managers.LayoutManager.LayoutFixes.New",function(e,t){var i=e;i.methods({_getAnchoredH:function(e){var t=e.fromComp.getPhysicalHeight(),i=e.fromComp.getY()+t;return e.locked?i+=e.distance:this.resources.W.Viewer.isPageComponent(e.toComp.getOriginalClassName())||(i+=this.DEFAULT_MARGIN),e.type==e.ANCHOR_BOTTOM_BOTTOM?i-=e.toComp.getY():e.type==e.ANCHOR_BOTTOM_PARENT&&e.toComp.getInlineContentContainer&&this._isInlineContentNonZeroSize(e.toComp)&&(i+=this._getContainerMarginHeight(e)),i},_enforceFromBottomTypeAnchor:function(e){var t=e.toComp,i=t.getPhysicalHeight(),n=this._getAnchoredH(e),o=n;return e.toComp.layoutMinHeight?o=e.toComp.layoutMinHeight():e.locked||t.isSiteSegment()||(o=e.originalValue),t.setHeight(n>i?n:this._getMaxAnchoredH(t,o)),i!==t.getHeight()&&(t.$layoutDirtyFlag=this.FLAG_DIRTY_BOTTOM,e.type==e.ANCHOR_BOTTOM_BOTTOM)?t.$tempIndex:Number.MAX_VALUE},_getMaxAnchoredH:function(e,t){t||(t=-Number.MAX_VALUE);var i=this._getAnchoredH,n=t;return e.getReverseAnchors().forEach(function(t){if(t.type==t.ANCHOR_BOTTOM_PARENT||t.type==t.ANCHOR_BOTTOM_BOTTOM){var o=i(t);t.locked||e.isSiteSegment()||(o=Math.max(o,t.originalValue)),n=Math.max(o,n)}}.bind(this)),n},_isPageAutoShrink:function(){}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.FixMissingSkins.New",function(e,t){var i=e,n=t;i.resources(n.merge(["W.Data"])),i.methods({setSite:n.before(function(e){this.resources.W.Data.getDataByQuery("#SKINS",function(t){var i=t.getData().components;this._fixMissingSkinsInCompNodes(e,i)}.bind(this))}),_fixMissingSkinsInCompNodes:function(e,t){var i=e.getElements("[comp]");i.forEach(function(e){var i=e.getAttribute("comp"),n=e.getAttribute("skin"),o=!n||"mobile.core.skins.InlineSkin"==n;if(o){var s=t[i];s&&(e.setAttribute("skin",s[0]),n||LOG.reportError(wixErrors.NO_SKIN,"WViewManager","_fixMissingSkinsInCompNodes",{c1:i,c2:n}))}})}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.MobileSiteWidth.New",function(e,t){var i=e,n=t;i.statics({MOBILE_SITE_WIDTH:320}),i.binds(n.merge(["_handleMobileRotation"])),i.resources(n.merge(["W.Config"])),i.methods({setSite:n.after(function(){this.resources.W.Config.mobileConfig.isMobile()&&this.getDocWidth()===this.MOBILE_SITE_WIDTH&&(this._handleMobileRotation(),window.addEventListener("orientationchange",this._handleMobileRotation,!1))}),_handleMobileRotation:function(){function e(e){if(!e)if(W.Config.mobileConfig.isAppleMobileDevice()){s=n/i;var a=i+1;this._setViewPortTag(t,a,s)}else{var r=o/i;s=n/i,s-=r}setTimeout(function(){this._setViewPortTag(t,i,s)}.bind(this),50)}var t=document.getElementById("wixMobileViewport"),i=this.MOBILE_SITE_WIDTH,n=screen.height,o=screen.width,s=1;this.resources.W.Config.mobileConfig.isPortrait(e.bind(this))},_setViewPortTag:function(e,t,i){e.setAttribute("content","width="+t+","+"initial-scale="+i+","+"minimum-scale="+i+", maximum-scale="+i)}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.MobileViewerQuickActions.New",function(e,t){var i=e,n=t;i.methods({_pageTransition:n.after(function(e){W.Commands.executeCommand("WViewerCommands.SelectedPageChanged",e)})})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.MobileZoom.New",function(e,t){var i=e;i.methods({_getZoomCompSettings:function(){var e,t;return W.Config.mobileConfig.isMobile()?(e="wysiwyg.viewer.skins.MobileMediaZoomSkin",t="wysiwyg.viewer.components.MobileMediaZoom"):(e="wysiwyg.viewer.skins.MediaZoomSkin",t="wysiwyg.viewer.components.MediaZoom"),{comp:t,skin:e}},_getZoomDisplayerCompSettings:function(){var e,t;return W.Config.mobileConfig.isMobile()?(e="wysiwyg.viewer.skins.displayers.MobileMediaZoomDisplayerSkin",t="wysiwyg.viewer.components.MobileMediaZoomDisplayer"):(e="wysiwyg.viewer.skins.displayers.MediaZoomDisplayerSkin",t="wysiwyg.viewer.components.MediaZoomDisplayer"),{comp:t,skin:e}},setViewportAttribute:function(e,t){for(var i=document.getElementById("wixMobileViewport"),n=i.getAttribute("content"),o=n.split(/ *,/),s="",a=!1,r=0;o.length>r;r++){var l=o[r];if(l.indexOf(e)>-1){if(a=!0,!t)continue;l=l.replace(/\ *=.*/,"="+t)}s+=l+","}s=s.substring(0,s.length-1),a?i.setAttribute("content",s):i.setAttribute("content",s+","+e+"="+t)}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.RichTextMigrationQA.New",function(e,t){var i=e,n=t;i.utilize(["wysiwyg.managers.appdata.AppDataHandler","wysiwyg.common.utils.TextMigrationHandler"]),i.methods({_onSiteReady:n.after(function(){var e=this.resources.W.Utils.getQueryParam("textMigration");"true"===e&&this._runMigrationOnPageTextComponents()}),_runMigrationOnPageTextComponents:function(){var e=this.getCurrentPageNode(),t=e&&e.$logic;if(t){var i=new this.imports.TextMigrationHandler,n=t.getPageComponents(),o=n.filter(function(e){return"wysiwyg.viewer.components.WRichText"===e.getOriginalClassName()});o.each(function(e){i.migrateComponent(e)})}}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.WixAppsPage.New",function(e,t){var i=e;i.methods({isPageComponent:function(e){return e.match(/Page$/)},_getPageElements:function(e){return e.getElements("[comp$=Page]")},getAppPages:function(){var e={};return Object.each(W.Viewer.getPages(),function(t){var i=t.getLogic();if(i.isInstanceOfClass("wixapps.integration.components.AppPage")){var n=i._data.get("appPageId");e[n]=i}}),e},getLinkablePagesData:function(){return Object.filter(this._pagesData,function(e){return"AppPage"!=e.getType()})},_isPageDataType:function(e){return"Page"===e||"AppPage"==e},_onPageExtraDataChange:function(e,t,i){var n=this._getPageDataFromHash(t);switch(n.get("type")){case"Page":var o=n.get("tpaApplicationId"),s=W.TPA.getComponentRegistrar().getSection(o);if(s){if(W.TPA.setPageState(t,e),i)return;s._renderIfReady()}break;case"AppPage":if(W.Apps.setPageState(t,e),i)return;var a=W.Viewer.getPages()[t],r=a.getLogic();r.updateParams(e)}},_setUrlHashToPage:function(e){var t=this._pagesData[e];if(t){var i=W.TPA.getPageState(e),n=W.Apps.getPageState(e),o=i||n;W.Utils.hash.setHash(e,t.get("pageUriSEO"),o)}}})}),define.experiment.newDataSchema("PinterestPinProperties.PinterestPinComponent.New",function(){return{"data-pin-config":{type:"string","enum":["above","beside","none"],"default":"beside",description:"the position of the pin counter around the button"}}}),define.experiment.dataSchema("SliderGalleryProperties.SliderAutoPlay.New",function(e){var t=e;return t.merge({autoplayInterval:{type:"number","default":"0",minimum:0,maximum:30,description:"Autoplay interval"},autoplay:{type:"boolean","default":!1,description:""},showAutoplay:{type:"boolean","default":!0,description:""},transDuration:{type:"number",minimum:0,maximum:5,"default":0,description:"Duration of the transition in seconds"},autoPlayDirection:{type:"string","default":"LTR"}})}),define.experiment.newDataSchema("VKShareProperties.VKShare.New",function(){return{style:{type:"string","enum":["Button","ButtonWithoutCounter","Link","LinkWithoutIcon","Icon"],"default":"Button",description:"the layout of the button"},rightAngles:{type:"boolean","default":!1,description:"Button Right angles"},text:{type:"string","default":"Share",description:"the text of the Button"}}}),define.experiment.newClass("wysiwyg.common.utils.TextMigrationDomHelper.RichText.New",function(e){var t=e;t.fields({_blockElementTags:["audio","dd","dt","li","video","address","article","aside","blockquote","details","div","dl","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","menu","nav","ol","p","pre","section","table","ul","center","dir","noframes"]}),t.methods({renameNode:function(e,t){if(e.tagName.toLowerCase()==t.toLowerCase())return e;var i=new Element(t);e.attributes;var n=this.getAllAttributes(e);return n.forEach(function(e){i.setAttribute(e.name,e.value)}),this.moveChildren(e,i),e.parentNode&&e.parentNode.replaceChild(i,e),i},getAllAttributes:function(e){var t=e.attributes,i=[];if(20>t.length)i=this.collectionToArray(t);else{var n=e.getProperties("class","style","dir","href","background","action","src","data","align","alt","color","face","label","for","link","id","name","value");Object.forEach(n,function(e,t){t&&e&&i.push({name:t,value:e})})}return i},moveChildren:function(e,t){if(e!=t)for(var i;i=e.firstChild;)t.appendChild(e.removeChild(i))},collectionToArray:function(e){for(var t=Array.slice(e,0),i=0;t.length>i;i++){var n=t[i];n&&n.nodeType&&1===n.nodeType&&(t[i]=new Element(n))}return t},isBlockElement:function(e){var t=e.tagName&&e.tagName.toLowerCase();return this._blockElementTags.contains(t)},isOnlyWhiteSpace:function(e){return e.every(function(e){return"whitespace"===typeOf(e)})},isDomElement:function(e){return"element"===typeOf(e)},isTextNode:function(e){return"textnode"===typeOf(e)},hasBlockElementChildren:function(e){return e.getChildren().some(function(e){return this.isBlockElement(e)},this)},replaceElementWithItsChildren:function(e){var t=e.parentNode,i=this.collectionToArray(e.childNodes);i.each(function(i){t.insertBefore(i,e)},this),t.removeChild(e)},isElementHasAttributes:function(e){var t=this.getAllAttributes(e);if(!t)return!1;for(var i=0;t.length>i;i++){var n=t[i].value;if(n)return!0}return!1},removeClass:function(e,t){e.removeClass(t),e.getAttribute("class")||e.removeAttribute("class")}})}),define.experiment.newClass("wysiwyg.common.utils.TextMigrationHandler.RichText.New",function(e){var t=e;t.utilize(["wysiwyg.common.utils.TextStylesMigration","wysiwyg.common.utils.TextSimpleFormatMigration"]),t.resources(["W.Data","W.Config"]),t.methods({initialize:function(){this._stylesMigration=new this.imports.TextStylesMigration,this._simpleMigration=new this.imports.TextSimpleFormatMigration;var e=this;this.resources.W.Config.isEditorMode()?this.resource.getResourceValue("W.Preview",function(t){t.getPreviewManagersAsync(e._initViewerManagers,e)}):this._initViewerManagers(this.resources.W)},_initViewerManagers:function(e){this._viewer={theme:e.Theme,data:e.Data}},migrateComponent:function(e){this._changeData(e),this._changeSkin(e);var t=e.getDataItem();return t&&t.get("text")?this.migrateText(t.get("text")):null},migrateText:function(e,t,i){if(t=t||"p",i=i||"font_8","string"!==typeOf(e))return null;if(""===e)return'<{0} class="{1}"></{0}>'.substitute([t,i]);var n=new Element("div");return n.set("html",e),this._stylesMigration.migrateElement(n,t,i),this._simpleMigration.migrateElement(n),n.get("html")},_changeData:function(e){var t=e.getDataItem().get("text"),i=this._viewer.data.addDataItemWithUniqueId("",{type:"StyledText",text:t,stylesMapId:"CK_EDITOR_PARAGRAPH_STYLES"}).dataObject;e.setDataItem(i)},_changeSkin:function(e){this._viewer.theme.getStyle("txtNew",function(t){e.setStyle(t)},"wysiwyg.viewer.skins.WRichTextNewSkin")}})}),define.experiment.newClass("wysiwyg.common.utils.TextMigrationStylesHelper.RichText.New",function(e){var t=e;t.resources(["tags"]),t.methods({initialize:function(e,t){this._theme=e,this._domHelper=t},getMostCommonStyle:function(e){var t={};return e.forEach(function(e){var i=this.getElementStyleClass(e);t[i]=t[i]||0,t[i]+=e.get("text").length},this),this._getEntryWithMaxValue(t)},_getEntryWithMaxValue:function(e){var t=0,i=null;return Object.forEach(e,function(e,n){e>t&&(t=e,i=n)}),i},flattenStyledSpans:function(e){if(this.getElementStyleClass(e)&&this._flattenStylesInSpan(e),this._isContainStyleSpans(e)){var t=this.getStyledSpansRecursive(e,[]);t.forEach(this._flattenStylesInSpan,this)}},_flattenStylesInSpan:function(e){if(this._isContainStyleSpans(e))for(var t=e.clone(!1),i=this._domHelper.collectionToArray(e.childNodes),n=0;i.length>n;n++){var o=i[n];if(this.getElementStyleClass(o)||this._isContainStyleSpans(o)){var s=o.clone(!1),a=this._getStyledSpanWithItsParents(o,s);return s.firstChild&&t.adopt(s),t.inject(e,"before"),a.inject(e,"before"),this.flattenStyledSpans(a),this._flattenStylesInSpan(e),void 0}t.adopt(o)}},_getStyledSpanWithItsParents:function(e,t){if(this.getElementStyleClass(e))return e;for(var i=e.clone(!1),n=this._domHelper.collectionToArray(e.childNodes),o=0;n.length>o;o++){var s=n[o];if(this.getElementStyleClass(s)||this._isContainStyleSpans(s)){var a=s.clone(!1),r=this._getStyledSpanWithItsParents(s,a);return i.adopt(r),a.firstChild&&t.adopt(a),i}t.adopt(s)}return i},_isContainStyleSpans:function(e){return this._domHelper.isDomElement(e)&&e.getElements('span[class*="font_"]').length},getStyledSpansRecursive:function(e,t){if(this._domHelper.isDomElement(e)){var i=this.getElementStyleClass(e);i&&"span"===e.tagName.toLowerCase()?t.push(e):e.getChildren().each(function(e){t.concat(this.getStyledSpansRecursive(e,t))},this)}return t},isBlockContainUnstyledText:function(e){if(this._domHelper.isTextNode(e))return!0;if(this.getElementStyleClass(e))return!1;for(var t=this._domHelper.collectionToArray(e.childNodes),i=0;t.length>i;i++)if(this.isBlockContainUnstyledText(t[i]))return!0;return!1},getElementStyleClass:function(e){var t=e.classList;if(!t)return null;for(var i=0;t.length>i;i++)if(t[i].indexOf("font_")>-1)return t[i];return null},getStyleDelta:function(e,t){var i=e&&this._theme.getProperty(e),n=this._theme.getProperty(t),o={},s=["font-family","font-size","font-style","font-variant","font-weight","line-height"];return s.each(function(e){var t=this._createStyleKeyGetter(e);i&&i[t]()==n[t]()||(o[e]=n[t]())},this),o},_createStyleKeyGetter:function(e){var t=e.indexOf("-")+1,i="";return i=t>0?e.split("-").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(""):e.charAt(0).toUpperCase()+e.slice(1),i.contains("Font")&&"FontFamily"!==i&&(i=i.replace("Font","")),"get"+i},getColorDelta:function(e,t){var i=e&&this._theme.getProperty(e),n=this._theme.getProperty(t);if(!n)return null;var o=n.getColorReference();if(o){if(!i||!i.getColorReference()||i.getColorReference()!==o)return{isRef:!0,value:o}}else if(!i||i.getColorReference()||i.getColor()!==n.getColor())return{isRef:!1,value:n.getColor()};return null}})}),define.experiment.newClass("wysiwyg.common.utils.TextSimpleFormatMigration.RichText.New",function(e){var t=e;t.utilize(["wysiwyg.common.utils.TextMigrationDomHelper","wysiwyg.common.utils.TextMigrationStylesHelper"]),t.statics({defaultStyleClass:"font_100"}),t.methods({initialize:function(){this._domHelper=new this.imports.TextMigrationDomHelper,this._styleHelper=new this.imports.TextMigrationStylesHelper},migrateElement:function(e){this._migrateBold(e),this._migrateItalic(e),this._migrateUnderline(e),this._migrateAlignRight(e),this._migrateAlignCenter(e),this._migrateJustify(e),this._migrateUl(e)},_migrateBold:function(e){var t=e.getElements('.bold"');this._removeClassAddTag(t,"bold","strong")},_migrateItalic:function(e){var t=e.getElements('.italic"');this._removeClassAddTag(t,"italic","em")},_migrateUnderline:function(e){var t=e.getElements('.underline"');this._removeClassAddTag(t,"underline","u")},_migrateAlignRight:function(e){var t=e.getElements('.alignRight"');this._removeClassAddInlineStyle(t,"alignRight","text-align","right")},_migrateAlignCenter:function(e){var t=e.getElements('.alignCenter"');this._removeClassAddInlineStyle(t,"alignCenter","text-align","center")},_migrateJustify:function(e){var t=e.getElements('.alignJustify"');this._removeClassAddInlineStyle(t,"alignJustify","text-align","justify")},_migrateUl:function(e){var t=e.getElements("ul, ol");t.each(function(e){this._styleHelper.getElementStyleClass(e)||e.addClass(this.defaultStyleClass)},this)},_removeClassAddTag:function(e,t,i){e.forEach(function(e){var n=new Element(i);this._domHelper.moveChildren(e,n),this._domHelper.removeClass(e,t),this._domHelper.isElementHasAttributes(e)||"span"!==e.nodeName.toLowerCase()?e.adopt(n):n.replaces(e)},this)},_removeClassAddInlineStyle:function(e,t,i,n){e.forEach(function(e){this._domHelper.removeClass(e,t),e.setStyle(i,n)},this)}})}),define.experiment.newClass("wysiwyg.common.utils.TextStylesMigration.RichText.New",function(e){var t=e;t.utilize(["wysiwyg.common.utils.TextMigrationStylesHelper","wysiwyg.common.utils.TextMigrationDomHelper"]),t.resources(["W.Utils","W.Data","W.Config","W.Theme"]),t.fields({_changeableTagList:["h1","h2","h3","h4","h5","h6","p","div"],_deprecatedStyleClass:["font_1","font_10"]}),t.methods({initialize:function(){this._domHelper=new this.imports.TextMigrationDomHelper,this._styleMap=this.resources.W.Data.getDataByQuery("#CK_EDITOR_FONT_STYLES").get("items");var e=this;this.resources.W.Config.isEditorMode()?this.resource.getResourceValue("W.Preview",function(t){t.getPreviewManagersAsync(e._initViewerManagers,e)}):this._initViewerManagers(this.resources.W)},_initViewerManagers:function(e){this._viewer={theme:e.Theme,data:e.Data},this._stylesHelper=new this.imports.TextMigrationStylesHelper(e.Theme,this._domHelper)},migrateElement:function(e,t,i){var n=[],o=this._domHelper.collectionToArray(e.childNodes);o.forEach(function(e){if(this._domHelper.isBlockElement(e)){n.length>0&&(this._applyStyleOnElements(n,t,i),n=[]);var o=!this._changeableTagList.contains(e.tagName.toLowerCase())||this._domHelper.hasBlockElementChildren(e);o?this.migrateElement(e,t,i):this._applyStyleOnBlock(e,t,i)}else n.push(e)},this),n.length>0&&this._applyStyleOnElements(n,t,i)},_applyStyleOnElements:function(e,t,i){if(!this._domHelper.isOnlyWhiteSpace(e)){var n=new Element("p");n.inject(e[0],"before"),n.adopt(e),this._applyStyleOnBlock(n,t,i)}},_applyStyleOnBlock:function(e,t,i){if(0===e.childNodes.length)return LOG.reportError(wixErrors.TEXT_MIGRATION_EMPTY_BLOCK_ELEMENT,"TextStylesMigration","_applyStyleOnBlock"),void 0;this._stylesHelper.flattenStyledSpans(e);var n=null;if(this._stylesHelper.isBlockContainUnstyledText(e)){var o=this._replaceBlockWithDefaultTag(e,t,i),s=this._stylesHelper.getStyledSpansRecursive(o,[]);this._removeStyleClassesReplaceWithInline(null,s)}else n=this._moveStyleClassToBlockParentElement(e),n&&this._moveInlineStyleFromOriginalElementToBlockParentElement(e,n);this._verifyNoStyledSpans(e,n)},_verifyNoStyledSpans:function(e,t){var i=e.getElements('span[class*="font_"]');i.length&&(LOG.reportError(wixErrors.TEXT_MIGRATION_MISSED_STYLED_SPANS,"TextStylesMigration","_applyStyleOnBlock",e.outerHTML),this._removeStyleClassesReplaceWithInline(t,i))},_replaceBlockWithDefaultTag:function(e,t,i){if(!t||!i)return LOG.reportError(wixErrors.TEXT_MIGRATION_DEFAULT_VALUES_NOT_PROVIDED,"TextStylesMigration","_replaceBlockWithDefaultTag"),void 0;if(!e||e.tagName!==t||!e.hasClass(i)){var n=this._domHelper.renameNode(e,t);return n.addClass(i),n}},_moveStyleClassToBlockParentElement:function(e){var t=this._stylesHelper.getStyledSpansRecursive(e,[]),i=this._stylesHelper.getMostCommonStyle(t),n=null;if(i){var o=this._replaceDeprecatedStyleIfNeeded(i);return o!=i&&(n=i,i=o),e.addClass(i),this._removeStyleClassesReplaceWithInline(i,t),n&&this._addFontSizeOnBlockIfNeeded(e,i,n),i}return null},_replaceDeprecatedStyleIfNeeded:function(e){return this._isStyleDeprecated(e)?this.getReplacingStyle(e):e},_addFontSizeOnBlockIfNeeded:function(e,t,i){var n=this._viewer.theme.getProperty(i).getSize(),o=this._viewer.theme.getProperty(t).getSize();o>n&&e.setStyle("font-size",n)},getReplacingStyle:function(){return"font_8"},_isStyleDeprecated:function(e){return this._deprecatedStyleClass.contains(e)},_removeStyleClassesReplaceWithInline:function(e,t){t.map(function(t){var i=this._stylesHelper.getElementStyleClass(t);i==e?0===t.childNodes.length?t.destroy():this._removeStyleFromSpan(t,e):(this._domHelper.removeClass(t,i),0===t.getProperty("class").length&&t.removeAttribute("class"),this._setStyleOverrides(e,i,t))},this)},_removeStyleFromSpan:function(e,t){e.removeClass(t),this._domHelper.isElementHasAttributes(e)||this._domHelper.replaceElementWithItsChildren(e)},_setStyleOverrides:function(e,t,i){var n=this._stylesHelper.getStyleDelta(e,t),o=i;Object.forEach(n,function(e,t){o.setStyle(t,e)});var s=this._stylesHelper.getColorDelta(e,t);s&&(s.isRef?o.addClass(s.value):o.setStyle("color",s.value))},_moveInlineStyleFromOriginalElementToBlockParentElement:function(e,t){var i,n=this._viewer.theme.getProperty(t),o="core.utils.css.Font"===n.getOriginalClassName();return o&&(i=n.getLineHeight()),i&&(e.setStyle("line-height",i),this._createWrapperSpanWithBlockLineHeight(e,i),e=this._setBlockElementTagAccordingToStyle(e,t)),e},_createWrapperSpanWithBlockLineHeight:function(e,t){var i=document.createElement("span");i.setStyle("line-height",t),this._domHelper.moveChildren(e,i),e.appendChild(i)},_setBlockElementTagAccordingToStyle:function(e,t){var i=this._styleMap[t].seoTag;return this._domHelper.renameNode(e,i)}})});