define.Class("wysiwyg.viewer.managers.PageManager",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.utilize(["core.managers.serverfacade.CorsRESTClient"]),t.binds(["_getPagesList","_createPageElements","createPage","_loadAllPages","_createMasterPage","_handleSinglePageData"]),t.methods({initialize:function(){W.Managers&&W.Managers.list&&W.Managers.list.push({target:"Pages"}),this._restClient=new this.imports.CorsRESTClient},isReady:function(){return!0},clone:function(){return new this.$class},_getPagesList:function(){if(!window.publicModel||!window.publicModel.pageList)return void 0;var e=window.publicModel.pageList;return e.pages=e.pages.map(this._handleSinglePageData),e},_handleSinglePageData:function(e){return e},getMainPage:function(){return this._getPagesList().mainPageId},getMasterPageData:function(e){this._requestPageJson(this._getPagesList().masterPage,e)},getPageData:function(e,t){if(!e||!e.urls)throw"page is not listed in the pages list or it does not have url";if("function"!=typeof t)throw"callback ["+t+"] supplied is not a function";this._requestPageJson(e.urls,t)},_requestPageJson:function(e,t){this._restClient.get(e[0],void 0,{onSuccess:t,onError:this._getErrorCallbackForUrl(e,t)})},_getErrorCallbackForUrl:function(e,t){if(1==e.length)return function(){LOG.reportError(wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED,"PageManager","_requestPageJson")};var i=e.clone();return i.splice(0,1),function(){LOG.reportError(wixErrors.SINGLE_PAGE_RETRIEVAL_ATTEMPT_FAILED,"PageManager","_requestPageJson",i[0]),this._requestPageJson(i,t)}.bind(this)},_buildComponentProperties:function(e){if(!e)return{};var t={id:e.id,comp:e.componentType,skin:"wysiwyg.viewer.components.PagesContainer"==e.componentType?"wysiwyg.viewer.skins.screenwidthcontainer.BlankScreen":e.skin,styleId:e.styleId};return e.dataQuery&&(t.dataQuery=0!=e.dataQuery.indexOf("#")?"#"+e.dataQuery:e.dataQuery),e.propertyQuery&&(t.propertyQuery=0!=e.propertyQuery.indexOf("#")?"#"+e.propertyQuery:e.propertyQuery),e.layout&&(t.width=e.layout.width,t.height=e.layout.height,t.x=e.layout.x,t.y=e.layout.y),t},_addAnchors:function(e){if(e&&e.id&&e.layout&&e.layout.anchors){var t={};t[e.id]=e.layout.anchors,W.Layout.appendSavedAnchor(t)}},_createElement:function(e){var t=new Element("div");return t.set(this._buildComponentProperties(e)),this._addAnchors(e),t},_createPageElements:function(e){var t=this._createElement(e);return e.components&&e.components.each(function(e){t.grab(this._createPageElements(e))}.bind(this)),t},createPage:function(e){var t=this._getJsonForString(e),i=t.data||t.payload.data;this._setInitData(i);var n=t.structure||t.payload.structure,o=this._createPageElements(n);this._attachPage(o),this.fireEvent("PAGE_LOADED",n.id)},_setInitData:function(e){var t=this.dataFixer.fix(e);W.Data.addDataItems(t.document_data),W.ComponentData.addDataItems(t.component_properties),W.Theme.addDataItems(t.theme_data)},_attachPage:function(e){$("SITE_PAGES").grab(e,"bottom")},_attachMasterPage:function(e){$$("body")[0].grab(e,"top")},_createSiteStructureNode:function(){var e=new Element("div");return e.set({id:"SITE_STRUCTURE",comp:"wysiwyg.viewer.components.WSiteStructure",skin:"mobile.core.skins.InlineSkin","class":"SITE_STRUCTURE"}),e},_getJsonForString:function(e){return"string"==typeof e?JSON.decode(e):e},_createMasterPage:function(e){var t=this._getJsonForString(e),i=t.data||t.payload.data;this._setInitData(i);var n=this._createSiteStructureNode(),o=t.structure||t.payload.structure;o.children.each(function(e){n.grab(this._createPageElements(e))}.bind(this)),this._attachMasterPage(n),this.fireEvent("MASTER_PAGE_WAS_LOADED")},_loadSinglePage:function(e){this.getPageData(e,this.createPage)},_loadAllPages:function(){var e=[];this.addEvent("PAGE_LOADED",function(t){e.erase(t),0===e.length&&(this._allPagesAreLoaded=!0)}.bind(this)),Object.each(this._getPagesList().pages,function(t){e.push(t.pageId),this._loadSinglePage(t)}.bind(this))},_isOldPageVersion:function(){return!this._getPagesList()},isPageLoadingCompleted:function(){return!!this._allPagesAreLoaded},loadSite:function(){this._isOldPageVersion()?W.Data.getDataByQuery("#SITE_STRUCTURE",function(e){var t="preview"!=viewMode;W.Viewer.setSite($("SITE_STRUCTURE"),e,t)}):resource.getResources(["dataFixer"],function(e){this.dataFixer=e.dataFixer,this._loadSiteNewVersion()}.bind(this))},_loadSiteNewVersion:function(){this.addEvent("MASTER_PAGE_WAS_LOADED",this._loadAllPages),this.getMasterPageData(this._createMasterPage)}})}),define.Class("wysiwyg.viewer.managers.SiteMembersManager",function(e){var t=e;t.inherits("bootstrap.managers.BaseManager"),t.resources(["W.Viewer"]),t.binds(["_initializeAPI","openSiteMembersPopup","closeSiteMembersPopup"]),t.statics({AUTH_STATES:{AUTH:"auth token and cookie exist",NO_AUTH_WITH_COOKIE:"no auth token, cookie exist",NO_AUTH_WITHOUT_COOKIE:"no auth token, cookie doesnt exist"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},API_ERRORS:{API_NOT_LOADED:"Site Members API was not loaded",TOKEN_IS_INVALID:"Authentication Token is invalid"}}),t.methods({initialize:function(){var e=this.resources.W.Viewer.getAppDataHandler().getSiteMembersData();this.setData(e)},isReady:function(){return!0},setData:function(e){this._smData=e,e&&this._loadScriptAndInitAPI()},_loadScriptAndInitAPI:function(){if(window.SiteMembers)this._initializeAPI();else{var e=window.serviceTopology.scriptsLocationMap,t=e.sitemembers;this.injects().Viewer.loadExternalScript(t+"/SiteMembers.js",function(){this._initializeAPI(),this._checkQueryStringForFormOpen(),this._preloadMemberDetails()}.bind(this))}},_initializeAPI:function(){var e=W.Config.getServiceTopologyProperty("siteMembersUrl"),t="siteMembers",i=window.SiteMembers,n=this.getCollectionId();if(n){var o=W.Config.getMetaSiteId();window[t]=new i(n,e,t,o),this._api=window[t],this._token=this.getData().smtoken,this._apiReady=!0}else LOG.reportError("Site members - collection Id is undefined? ["+n+"]",this.$className,"_initializeAPI")},_checkQueryStringForFormOpen:function(){var e=this.injects().Utils,t=e.getQueryParam("intent");if(t&&!this._queryStringHandled){if(!this.injects().Viewer.isSiteReady()||!this.isApiReady())return e.callLater(this._checkQueryStringForFormOpen,[],this,500),void 0;this.openSiteMembersPopup({intent:t}),this._queryStringHandled=!0}},_preloadMemberDetails:function(){this.getMemberDetails(function(e){this._memberDetails=e}.bind(this))},getData:function(){return this._smData||{}},getCollectionId:function(){return this.getData().smcollectionId||this.getData().id},getCollectionOwner:function(){return this.getData().owner},getCollectionType:function(){return this.getData().collectionType||this.getData().type},isServiceProvisioned:function(){return!!this._smData},isApiReady:function(){return this._apiReady},login:function(e,t,i,n,o){this._apiReady?this._api.login(e,t,i,n,o):o&&o({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},register:function(e,t,i,n){this._apiReady?this._api.register(e,t,i,n):n&&n({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},updateMemberDetails:function(e,t,i){this._apiReady?this._token?this._api.updateMemberDetails(this._token,e,t,i):i&&i({code:"TOKEN_IS_INVALID",description:this.API_ERRORS.TOKEN_IS_INVALID}):i&&i({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},getMemberDetails:function(e,t){this._memberDetails?e(this._memberDetails):this._apiReady?this._token?this._api.getMemberDetails(this._token,e,t):t&&t({code:"TOKEN_IS_INVALID",description:this.API_ERRORS.TOKEN_IS_INVALID}):t&&t({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},applyForMembership:function(e,t,i,n){this._apiReady?this._api.apply(e,t,i,n):n&&n({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},logout:function(){return this._apiReady?(delete this._token,this._api.logout()):void 0},getToken:function(){return this._token},isLoggedIn:function(){var e=this._getAuthenticationState();return e==this.AUTH_STATES.AUTH},isNotAuthenticatedWithCookie:function(){if(this.isLoggedIn())return!1;var e=this._getAuthenticationState();return e==this.AUTH_STATES.NO_AUTH_WITH_COOKIE},_getAuthenticationState:function(){var e=!!this._token,t=this._api?this._api.isSessionValid():!1;return e?this.AUTH_STATES.AUTH:!e&&t?this.AUTH_STATES.NO_AUTH_WITH_COOKIE:e||t?void 0:this.AUTH_STATES.NO_AUTH_WITHOUT_COOKIE},openSiteMembersPopup:function(e){var t=e&&e.intent,i=e&&e.authCallback;t||(t=this.isNotAuthenticatedWithCookie()?this.INTENTS.LOGIN:this.INTENTS.REGISTER);var n=[this.INTENTS.LOGIN,this.INTENTS.REGISTER];if(n.contains(t)&&this.isLoggedIn())this.injects().SiteMembers.getMemberDetails(function(e){this.reportAuthStatusChange(i,!0,e)}.bind(this));else{var o=this.injects().SiteMembers;this._siteMembersContainer&&this.closeSiteMembersPopup(),o.isApiReady()&&!this._siteMembersContainer&&W.Components.createComponent("wysiwyg.viewer.components.sm.SMContainer","wysiwyg.viewer.skins.sm.SMContainerSkin",null,e,function(){},function(e){this._siteMembersContainer=e;var t=e.getViewNode();t.setStyle("opacity","0.0");var i=this.injects().Viewer.getSiteNode();t.insertInto(i),new Fx.Tween(t,{duration:"short",link:"ignore"}).start("opacity","1.0")}.bind(this))}},closeSiteMembersPopup:function(){if(this._siteMembersContainer){var e=this._siteMembersContainer.getViewNode(),t=new Fx.Tween(e,{duration:"short",link:"chain"});t.addEvent("complete",function(){t.removeEvent("complete",arguments.callee),e.removeFromDOM()}.bind(this)),t.start("opacity","0.0"),delete this._siteMembersContainer}},reportAuthStatusChange:function(e,t,i){e&&e({authResponse:t,data:i})}})}),define.Class("wysiwyg.viewer.managers.TPAManager",function(e){var t=e;t.inherits("bootstrap.managers.BaseManager"),t.utilize(["wysiwyg.viewer.managers.tpa.URLBuilder","wysiwyg.viewer.managers.tpa.TPAComponentRegistrar","wysiwyg.viewer.managers.tpa.PixelTracker"]),t.resources(["W.Commands","W.CommandsNew","W.Utils"]),t.binds(["_onAppAvailableTimeoutExpires"]),t.statics({TPA_MESSAGE:"TPA",TPA_MESSAGE2:"TPA2",TPA_RESPONSE:"TPA_RESPONSE",APP_MARKET_MESSAGE:"APP_MARKET",APP_MARKET_URL:"http://market.apps.wix.com",PINGPONG_PREFIX:"pingpong:",LOAD_TIMEOUT:20,MessageTypes:{CHANGE_APP_SIZE:"changeAppSize",RESIZE_WINDOW:"resizeWindow",SET_WINDOW_PLACEMENT:"setWindowPlacement",GET_WINDOW_PLACEMENT:"getWindowPlacement",REFRESH_APP:"refreshApp",APP_IS_ALIVE:"appIsAlive",APP_STATE_CHANGED:"appStateChanged",CLOSE_POPUP:"closePopup",CLOSE_WINDOW:"closeWindow",OPEN_POPUP:"openPopup",OPEN_RELATIVE_POPUP:"openRelativePopup",OPEN_MODAL:"openModal",OPEN_MEDIA_DIALOG:"openMediaDialog",OPEN_BILLING_PAGE:"openBillingPage",GET_SITE_PAGES:"getSitePages",GET_SITE_COLORS:"getSiteColors",NAVIGATE_TO_PAGE:"navigateToPage",POST_MESSAGE:"postMessage",SM_REQUEST_LOGIN:"pingpong:smRequestLogin",SM_CURRENT_MEMBER:"pingpong:smCurrentMember",SITE_INFO:"pingpong:siteInfo",EVENT_LISTENER_ADDED:"pingpong:addEventListener",SM_REQUEST_LOGIN_2:"smRequestLogin",SM_CURRENT_MEMBER_2:"smCurrentMember",SITE_INFO_2:"siteInfo",HEIGHT_CHANGED:"heightChanged",APP_SETTINGS_CHANGED:"appSettingsChanged",APP_SETTINGS_CLOSE:"appSettingsClose",APP_SHOW_POPUP:"appShowPopup"}}),t.methods({initialize:function(){this._setAppMarketUrl(),this._urlBuilder=new this.imports.URLBuilder,this._componentRegistrar=new this.imports.TPAComponentRegistrar,this._addPostMessageCallback(function(e){this.handlePostMessage(e,function(e){var t=$(e);return t&&t.getLogic()})}.bind(this)),this._testAppsDefIds=this._getTestAppsDefIds(),this._registerPixelTrackerEvents()},_registerPixelTrackerEvents:function(){var e=this;resource.getResourceValue("W.Viewer",function(t){function i(e){var t,i=[],o=window.rendererModel.clientSpecMap||{};for(var s in o)t=n(o[s],e),t&&i.push(t);return i}function n(e,t){if(!e.pixelUrl)return"";var i=~e.pixelUrl.indexOf("?")?"&":"?";return"&"!==t.charAt(0)&&(t="&"+t),e.pixelUrl+i+"instance="+e.instance+t}return"site"!==t.getViewMode()?!1:(e.pixelTracker=new e.imports.PixelTracker(i),t.addEvent("SiteReady",function(){e.resources.W.Utils.hash.addEvent("change",function(t){t.isForSureAfterChange&&e.pixelTracker.sendAll("page="+window.location.href)})}),void 0)})},_setAppMarketUrl:function(){if(serviceTopology.baseDomain){var e=serviceTopology.baseDomain.indexOf("wixpress")>1;e&&serviceTopology.baseDomain.indexOf("burger")>-1&&(this.APP_MARKET_URL="http://market.burger.wixpress.com")}},isReady:function(){return!0},_addPostMessageCallback:function(e){this._callbacks=this._callbacks||[],this._callbacks.push(e),window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent&&window.attachEvent("onmessage",e)},handlePostMessage:function(e,t){if("string"==typeof e.data){var i="";try{i=JSON.parse(e.data)}catch(n){return}var o=i.type;i&&i.intent&&(i.intent===this.TPA_MESSAGE&&o?this._handleTPAMessage(i,o,t):i.intent===this.APP_MARKET_MESSAGE?this._handleAppMarketMessage(i):i.intent===this.TPA_MESSAGE2&&o&&this._handleTPAMessage2(i,o,t))}},_handleTPAMessage2:function(e,t,i){var n=e.compId,o=i(n);if(o)if(Object.contains(this.MessageTypes,t)){var s=this._getHandlerFunctionName(t),a=o[s];a?a.apply(o,[{msgData:e.data,callback:function(i){var s=o.getIFrame();s.contentWindow.postMessage(JSON.stringify({intent:this.TPA_RESPONSE,compId:n,callId:e.callId,type:t,res:i,status:!0}),"*")}.bind(this)}]):LOG.reportError("Handler function not found - "+t,"wysiwyg.viewer.managers.TPA","handlePostMessage2")}else LOG.reportError("Unknown post message type - "+t,"wysiwyg.viewer.managers.TPA","handlePostMessage")},_handleTPAMessage:function(e,t,i){var n=e.compId,o=i(n);if(o)if(Object.contains(this.MessageTypes,t)){var s=this._getHandlerFunctionName(t),a=o[s];a?this._isPingPongMessage(t)?a.apply(o,[{msgData:e.data,callback:function(e){var i=o.getIFrame();i.contentWindow.postMessage(JSON.stringify({intent:this.TPA_MESSAGE,compId:n,type:t,data:e}),"*")}.bind(this)}]):a.apply(o,[e.data]):LOG.reportError("Handler function not found - "+t,"wysiwyg.viewer.managers.TPA","handlePostMessage")}else LOG.reportError("Unknown post message type - "+t,"wysiwyg.viewer.managers.TPA","handlePostMessage")},_handleAppMarketMessage:function(e){switch(e.cmd){case"ADD_APP_TO_SITE":this.resources.W.Commands.executeCommand("WEditorCommands.AddApp",e.params,this),this.resources.W.Commands.executeCommand(Constants.EditorUI.CLOSE_PANEL);break;case"ADD_COMPONENT_TO_SITE":e.params&&"addLoginButton"===e.params.compType?this.resources.W.Commands.executeCommand("WEditorCommands.AddSMDependantComponent",{compType:"addLoginButton",styleId:""},this):this.resources.W.CommandsNew.executeCommand("WEditorCommands.AddComponent",e.params,this),this.resources.W.Commands.executeCommand(Constants.EditorUI.CLOSE_PANEL);break;case"OPEN_MARKET_POPUP":this.resources.W.Commands.executeCommand("WEditorCommands.openMarketPopup",e.params,this);break;case"CLOSE_MARKET_POPUP":this.resources.W.Commands.executeCommand("WEditorCommands.closeMarketPopup",e.params,this);break;case"GET_INSTALLED_APPS":var t=W.Preview.getPreviewManagers().Viewer.getAppDataHandler().getAppsData(),i={eventType:"ON_COMMAND_RESPONSE",callerId:e.id,params:t};this._marketPanelWindow.postMessage(JSON.stringify(i),this.APP_MARKET_URL);break;case"GET_TEST_APPS":this.getTestApps(function(t){var i={eventType:"ON_COMMAND_RESPONSE",callerId:e.id,params:t};this._marketPanelWindow.postMessage(JSON.stringify(i),this.APP_MARKET_URL)}.bind(this))}},setMarketPanelWindow:function(e){this._marketPanelWindow=e},_getHandlerFunctionName:function(e){return this._isPingPongMessage(e)&&(e=e.replace(this.PINGPONG_PREFIX,"")),"handle"+e.capitalize()},_isPingPongMessage:function(e){return 0==e.indexOf(this.PINGPONG_PREFIX)},getURLBuilder:function(){return this._urlBuilder},getComponentRegistrar:function(){return this._componentRegistrar},getSectionURL:function(e){var t=this._componentRegistrar.getPageId(e);if(null===t)return null;var i=W.Data.getDataByQuery("#"+t),n=i&&i.get("title");this.getPageState(t);var o=this.injects().Viewer.isPublicMode(),s=location.href.replace(location.hash,"");s=o?window.publicModel&&window.publicModel.externalBaseUrl||s:s;var a=s+"#!"+this.injects().Utils.hash.getHashPartsString(t,n);return a="/"==a.charAt(a.length-1)?a:a+"/"},_getTestAppsDefIds:function(){var e=[],t=W.Utils.getQueryParam("appDefinitionId");t&&e.push(t);var i=window.editorModel&&window.editorModel.runningApps||{},n="~";return Object.each(i,function(t,i){if("ON"==t.toUpperCase()){var o=i.lastIndexOf(n),s=o+1;if(i.length>s||o>0){var a=i.substr(s);e.push(a.trim())}}}.bind(this)),e},getTestApps:function(e){e(this._testAppsDefIds)},reportLoadStart:function(e){this._waitForAppAlive(e)},_waitForAppAlive:function(e){e.isAppAlive()||e.callLater(this._onAppAvailableTimeoutExpires,[e],1e3*this.LOAD_TIMEOUT)},_onAppAvailableTimeoutExpires:function(e){e.isAppAlive()||e.onError()},setPageState:function(e,t){this._stateByPage||(this._stateByPage={}),this._stateByPage[e]=t},getPageState:function(e){var t=this._stateByPage&&this._stateByPage[e];return t||""},getAppDefinitionId:function(e){var t=W.Preview.getPreviewManagers().Viewer.getAppDataHandler().getAppData(e);return t.appDefinitionId},dispose:function(){for(var e;this._callbacks&&this._callbacks.length;)e=this._callbacks.pop(),window.removeEventListener?window.removeEventListener("message",e):window.detachEvent&&window.detachEvent("onmessage",e);this.parent()},postMessageEvent:function(e,t){var i=t||this._marketPanelWindow,n=location.protocol+"//"+location.host,o={eventType:e,origin:n};i.postMessage(JSON.stringify(o),this.APP_MARKET_URL)},clone:function(e){return this.parent(e)}})}),define.Class("wysiwyg.viewer.managers.tpa.PixelTracker",function(e){"use strict";e.binds(["sendPixelRequest"]),e.utilize(["bootstrap.utils.Que"]),e.methods({initialize:function(e,t){this.getUrls=e,this.image=document.createElement("img"),this._useCacheKiller=t?!1:!0,this.que=new this.imports.Que({outputRate:100,outputChankSize:1,processContext:this,onprocess:function(e){this.sendPixelRequest(e)}})},_buildUrl:function(e,t){return e+=~e.indexOf("?")?"&":"?",e+=t||"",e+=this._calcCacheKiller(e),e.replace(/&&/g,"&").replace("?&","?").replace(/\?$/,"")},_calcCacheKiller:function(){return this._useCacheKiller?"&ck="+(+new Date).toString(36):""},_getUrls:function(e){return this.getUrls?this.getUrls(e):[]},sendAll:function(e){this.que.add.apply(this.que,this._getUrls(e))},sendPixelRequest:function(e,t){return e?this.image.src=this._buildUrl(e,t):!1}})}),define.Class("wysiwyg.viewer.managers.tpa.TPAComponentRegistrar",function(e){var t=e;t.resources(["W.Data"]),t.statics({SECTION:"section",WIDGETS:"widgets",SECTION_PAGE_ID:"pageId",APPLICATION_ID_KEY:"tpaApplicationId"}),t.methods({initialize:function(){this._componentsByType={},this._componentsByCompId={}},register:function(e,t){t=e.getApplicationId()||t;var i=this._getDataObjectByApplicationId(t);if(e&&"wysiwyg.viewer.components.tpapps.TPASection"==e.getOriginalClassName())i[this.SECTION]=e;else{var n=this._getWidgets(t);n.push(e)}this._componentsByCompId[e.getComponentId()]=e},unregister:function(e,t){t=e.getApplicationId()||t;var i=this._getDataObjectByApplicationId(t);if(e&&"wysiwyg.viewer.components.tpapps.TPASection"==e.getOriginalClassName())delete i[this.SECTION];else{var n=this._getWidgets(t),o=n.indexOfByPredicate(function(t){return t===e}.bind(this));n.splice(o,1)}delete this._componentsByCompId[e.getComponentId()]},getPageId:function(e){var t=this.resources.W.Data.getDataMap(),i=Object.filter(t,function(t){return"Page"==t.get("type")&&t.get(this.APPLICATION_ID_KEY)==e}.bind(this)),n=Object.values(i);return n.length>0?n[0].get("id")||null:null},_getDataObjectByApplicationId:function(e){return this._componentsByType[e]||(this._componentsByType[e]={}),this._componentsByType[e]},_getByApplicationId:function(e){var t=[].concat(this._getWidgets(e)),i=this.getSection(e);return i&&t.push(i),t},each:function(e,t){var i=this._getByApplicationId(e);Array.each(i,function(e){t(e)})},_getWidgets:function(e){var t=this._getDataObjectByApplicationId(e);return t[this.WIDGETS]||(t[this.WIDGETS]=[]),t[this.WIDGETS]},getSection:function(e){var t=this._getDataObjectByApplicationId(e);return t[this.SECTION]},getComponents:function(){return this._componentsByCompId}})}),define.Class("wysiwyg.viewer.managers.tpa.URLBuilder",function(e){var t=e;t.resources(["W.Utils","W.Config"]),t.methods({_initGlobalResources:function(){this._globals={},this._globals.editor=this.injects().Editor},initialize:function(){this._initGlobalResources()},buildStateLessUrl:function(e,t,i,n){return this._buildUrlInternal(e,!1,t,i,n)},buildStateFullUrl:function(e,t,i,n){return this._buildUrlInternal(e,!0,t,i,n)},_buildUrlInternal:function(e,t,i,n,o){if(!e)return null;var s=e,a=[];return t&&(s+=this._getCurrentState()),s+=String.contains(s,"?")?"&":"?",i.push("compId"),Array.each(i,function(e){var t=this._getValue(s,n,o,e);(t||0===t)&&a.push(e+"="+encodeURIComponent(t))}.bind(this)),s+a.join("&")},_getCacheKiller:function(){return""+(new Date).getTime()},_getCurrentState:function(){var e=this.resources.W.Utils.hash.getHashParts(location.hash);return"/"+(e.extData||"")},_getValue:function(e,t,i,n){switch(n){case"app-state":return this._getCurrentState();case"instance":return i.instance;case"section-url":var o=t.getSectionURL();return!o||this.injects().Viewer.isPublicMode()?o:e;case"target":var o=t.getSectionURL();return this.injects().Viewer.isPublicMode()?o?"_top":null:"_self";case"width":return t.getViewNode().getWidth();case"locale":return this.resources.W.Config.getLanguage();case"viewMode":var s="site"===window.viewMode?W:parent.W,a=s.Viewer.getViewMode()||"unknown";return a;case"origCompId":return this._globals.editor.getEditedComponent().getComponentId();case"compId":return t.getComponentId();case"cacheKiller":return this._getCacheKiller()}}})}),define.Class("wysiwyg.viewer.utils.ComponentSequencer",function(e){e.inherits("bootstrap.utils.Events"),e.resources(["W.Data"]),e.fields({_pendingElements:[],_createdElements:[],_reusedElements:[],_notifiedOnReady:[],_preExistingElements:[]}),e.methods({initialize:function(){},resolveItem:function(){},createComponents:function(e,t){this._resolveRefList(t,function(t){this._createCompsFromDataList(e,t)}.bind(this))},reset:function(){this._pendingElements.forEach(function(e){e.removeEvent(Constants.ComponentEvents.READY)}),this._pendingElements=[],this._createdElements=[],this._reusedElements=[],this._preExistingElements=[],this._notifiedOnReady=[]},_resolveRefList:function(e,t){var i="array"===typeOf(e)?e:e.get("items"),n=[],o=i.length;if(i.length)for(var s=0;i.length>s;s++)this._resolveCompData(i[s],s,function(e,i){n[i]=e,o--,0===o&&t(n)});else t([])},_resolveCompData:function(e,t,i){"string"===typeOf(e)?this.resources.W.Data.getDataByQuery(e,function(e){i(e,t)}):i(e,t)},_createCompsFromDataList:function(e,t){this._preExistingElements=e.getChildren().slice(0),this._allSetup=!1,this._pendingElements=[],this._createdElements=[],this._reusedElements=[],this._notifiedOnReady=[];for(var i=0;t.length>i;i++)this._setupComponent(e,i,t);this._preExistingElements.forEach(function(e){this._reusedElements.contains(e)||this._removeElement(e)}.bind(this)),this._createdElements.forEach(function(t){e.appendChild(t)}),this._allSetup=!0,this._checkIfAllDone()},_setupComponent:function(e,t,i){var n,o=i[t],s=this._findReusableComponent(this._preExistingElements,o);s?(n="reuse",this._reusedElements.push(s)):(n="create",s=this.createComponent(e,o,t,i)),this._createdElements.push(s),this._notifyOnComponentReadyIfNeeded(n,s,t)},createComponent:function(e,t,i,n){var o,s=this.resolveItem(t,i,n),a=typeOf(s),r=this._getCompStyle(e);return"element"===a?(o=s,o.getLogic||o.hasAttribute("comp")||this._supplyMinimalLogic(o,t),e.adopt(o)):(o=new Element("div"),o.setAttribute("comp",s.comp),o.setAttribute("skin",s.skin),"data"in s&&(t=s.data),this._pendingElements.push(o),this._listenToInnerComponentReady(o,i),e.adopt(o),o.wixify(s.args||{},t,void 0,void 0,r)),o},_notifyOnComponentReadyIfNeeded:function(e,t,i){this._notifiedOnReady.contains(t)||this._pendingElements.contains(t)||(this._notifiedOnReady.push(t),this.fireEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_COMP_SETUP,{method:e,compView:t,index:i}))},_supplyMinimalLogic:function(e,t){var i={getDataItem:function(){return t},getIsDisplayed:function(){return!0},dispose:function(){t=null}};e.getLogic=function(){return i}},_onAllComponentsReady:function(){var e=this._createdElements.slice(0);this._createdElements=[],this._reusedElements=[],this._preExistingElements=[],this.fireEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_PRODUCTION_FINISHED,{elements:e})},_removeElement:function(e){e.getLogic&&e.getLogic().dispose(),e.destroy()},_findReusableComponent:function(e,t){for(var i,n=0;e.length>n;n++)if(i=e[n],i.getLogic&&this._dataItemsIdentical(t,i.getLogic().getDataItem()))return i},_dataItemsIdentical:function(e,t){if(e===t)return!0;if(e.get&&t.get&&e.hasField("id")&&t.hasField("id")){var i=e.get("id"),n=t.get("id");return i&&n&&i===n}return!1},_getCompStyle:function(e){var t;if(!this._style){for(t=e;t&&!t.getLogic;)t=t.getParent();if(t&&t.getLogic&&t.getLogic()&&t.getLogic().getStyle)return t.getLogic().getStyle()}},_listenToInnerComponentReady:function(e,t){e.addEvent(Constants.ComponentEvents.READY,function(){this._pendingElements.erase(e),this._notifyOnComponentReadyIfNeeded("create",e,t),this._checkIfAllDone()}.bind(this))},isPending:function(){return this._pendingElements.length>0},_checkIfAllDone:function(){this._allSetup!==!0||this.isPending()||this._onAllComponentsReady()}})}),define.Class("wysiwyg.viewer.utils.GalleryUtils",function(e){e.methods({createActionQueue:function(e,t){var i=[];return function(n){for(n&&i.push(n);i.length>0&&e()===!0;){i.length>t&&i.splice(0,i.length-t);var o=i.shift();o&&o.call()}}},createMinimalGalleryDisplayer:function(e,t){var i=Number.random(0,99999).toString(36),n={getViewNode:function(){return e},getRef:function(){return i},getDataItem:function(){return t},setOwner:function(){},invalidateSize:function(){},setSize:function(t,i){var n={width:t,height:i};e.setStyles(n)},dispose:function(){e.destroy(),e=null}};e.getLogic=function(){return n}}})}),define.Class("wysiwyg.viewer.utils.MatrixTransitions",function(e){var t=e;t.utilize(["wysiwyg.viewer.utils.TransitionUtils"]),t.binds(["_matrixCrossFade","_crossFade","_shrinkFade","_vertSwipe","_horizSwipe","_transitionSequence","_transitionSequenceGenerator","_generalTransition","_destroyHolder","_rotateDiagonalTiming","_noTransition","_timingDiagonalWave"]),t.fields({_transitionUtils:null,_sequenceIndex:0,_positioningFunc:null,_itemsContainer:null}),t.methods({initialize:function(){this._transitionUtils=new this.imports.TransitionUtils},setupTransitionMap:function(e,t){this._positioningFunc=e,this._itemsContainer=t;var i={crossFadeAllAtOnce:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingAllAtOnce)),crossFadeSequential:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingSequential)),crossFadeHorizWave:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingHorizontalWave)),crossFadeVertWave:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingVerticalWave)),crossFadeDiagonal:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingDiagonalWave)),shrinkFadeAllAtOnce:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingAllAtOnce)),shrinkFadeSequential:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingSequential)),shrinkFadeHorizWave:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingHorizontalWave)),shrinkFadeVertWave:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingVerticalWave)),shrinkFadeDiagonal:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingDiagonalWave)),vertSwipeAllAtOnce:this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),vertSwipeWave:this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeWave,this._swipeSingleDirection)),vertSwipeAlternate:this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate)),horizSwipeAllAtOnce:this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),horizSwipeWave:this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeWave,this._swipeSingleDirection)),horizSwipeAlternate:this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate)),seq_crossFade_All:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingAllAtOnce)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingHorizontalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingVerticalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),seq_shrink_All:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingAllAtOnce)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingHorizontalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingVerticalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),swipe_horiz_All:this._transitionSequence([this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate))]),swipe_vert_All:this._transitionSequence([this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate))]),seq_crossFade_Horiz:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingHorizontalWave)))]),seq_crossFade_Vert:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingVerticalWave)))]),seq_crossFade_Seq:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingSequential)))]),seq_crossFade_Diagonal:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),seq_shrink_Horiz:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingHorizontalWave)))]),seq_shrink_Vert:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingVerticalWave)))]),seq_shrink_Seq:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingSequential)))]),seq_shrink_Diagonal:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),seq_swipe_alternate:this._transitionSequence([this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate))]),seq_swipe_vert_wave:this._transitionSequence([this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection))]),seq_swipe_horiz_wave:this._transitionSequence([this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection))])};
i.none=this._generalTransition(this._matrixCrossFadePrepare,this._noTransition),this._transitionMap=i,i.seq_random=this._transitionSequenceGenerator(this._transitionRandomPicker(this.getTransitionList()))},getTransition:function(e){return this._transitionMap[e]},getTransitionList:function(){var e=[];for(var t in this._transitionMap)e.push(t);return e},_generalTransition:function(e,t){return function(i,n,o,s,a,r,l){var d=e(i,n,o,s,this._itemsContainer,this._positioningFunc);t(d,o,s,a,r,l)}.bind(this)},_transitionSequence:function(e){return function(t,i,n,o,s,a,r){this._sequenceIndex=this._sequenceIndex<e.length?this._sequenceIndex:0;var l=e[this._sequenceIndex++],d="function"===typeOf(l)?l:transMap[l];d(t,i,n,o,s,a,r)}.bind(this)},_transitionSequenceGenerator:function(e){return function(t,i,n,o,s,a,r){var l=e(this._sequenceIndex);l(t,i,n,o,s,a,r)}.bind(this)},_transitionRandomPicker:function(e){return function(){var t=e[parseInt(Math.random()*e.length)];return this._transitionMap[t]}.bind(this)},_destroyHolder:function(e,t){var i=e.children[0];if(i){this._itemsContainer.adopt(i);var n=this._positioningFunc(t);i.setStyles({position:"absolute",left:n.left+"px",top:n.top+"px"})}e.destroy()},_matrixCrossFadePrepare:function(e,t,i,n,o,s){var a,r,l,d,c=[];o.empty();for(var h=i*n,p=0;h>p;p++)a=new Element("div"),o.adopt(a),r=e[p]||new Element("div"),l=t[p]||new Element("div"),a.adopt(l,r),e[p]||l.setStyles({opacity:"0.0"}),r.setStyles({left:"0px",top:"0px"}),l.setStyles({left:"0px",top:"0px"}),c.push(a),d=s(p),a.setStyles({position:"absolute",left:d.left+"px",top:d.top+"px"});return c},_noTransition:function(e,t,i,n,o,s){e.forEach(this._destroyHolder),s()},_crossFade:function(e,t){var i=this;return function(n,o,s,a,r,l){for(var d=n.length,c=0;n.length>c;c++)(function(){var a=c;setTimeout(function(){var t=n[a].children[1],o=n[a].children[0];e(t,o,0,r,function(){i._destroyHolder(n[a],a),d--,0>=d&&l()})},t(a,1e3*r,o,s))})()}},_matrixCrossFade:function(e){return this._crossFade(this._transitionUtils.getTransition(Constants.TransitionTypes.CROSS_FADE),e)},_shrinkFade:function(e){return this._crossFade(this._transitionUtils.getTransition(Constants.TransitionTypes.SHRINK_FADE),e)},_vertSwipePrepare:function(e,t,i,n,o,s){var a,r,l,d,c,h,p,m,_,u=[];o.empty(),_=s(n*i).top;for(var g=0;i>g;g++){a=new Element("div"),o.adopt(a),p=new Element("div"),a.adopt(p),m=new Element("div"),a.adopt(m),p.setStyles({position:"absolute",top:"0px",height:_+"px"}),m.setStyles({position:"absolute",top:_+"px",height:_+"px"});for(var y=0;n>y;y++)c=y*i+g,h=s(c),r=e[c]||new Element("div"),l=t[c]||new Element("div"),m.adopt(l),p.adopt(r),r.setStyles({left:"0px",top:h.top+"px"}),l.setStyles({left:"0px",top:h.top+"px"});u.push(a),d=s(g),a.setStyles({position:"absolute",left:d.left+"px"})}return u},_horizSwipePrepare:function(e,t,i,n,o,s){var a,r,l,d,c,h,p,m,_,u=[];o.empty(),h=s(i-1),_=h.left+h.width;for(var g=0;n>g;g++){a=new Element("div"),o.adopt(a),p=new Element("div"),a.adopt(p),m=new Element("div"),a.adopt(m),p.setStyles({position:"absolute",left:"0px",width:_+"px"}),m.setStyles({position:"absolute",left:_+"px",width:_+"px"});for(var y=0;i>y;y++)c=g*i+y,h=s(c),r=e[c]||new Element("div"),l=t[c]||new Element("div"),m.adopt(l),p.adopt(r),r.setStyles({top:"0px",left:h.left+"px"}),l.setStyles({top:"0px",left:h.left+"px"});u.push(a),d=s(g*i),a.setStyles({position:"absolute",top:d.top+"px"})}return u},_vertSwipe:function(e,t){var i=this._transitionUtils.getTransition(Constants.TransitionTypes.SWIPE_VERTICAL),n=this;return function(o,s,a,r,l,d){for(var c=o.length,h=0;o.length>h;h++)(function(){var a=h;setTimeout(function(){t(i,o,a,r,l,function(){for(var e=o[a].children[1].children,t=e.length-1;t>=0;t--){var i=e[t];n._itemsContainer.adopt(i);var r=n._positioningFunc(t*s+a);i.setStyles({position:"absolute",left:r.left+"px",top:r.top+"px"})}o[a].destroy(),c--,0>=c&&d()})},e(a,1e3*l,o.length))})()}},_horizSwipe:function(e,t){var i=this._transitionUtils.getTransition(Constants.TransitionTypes.SWIPE_HORIZONTAL),n=this;return function(o,s,a,r,l,d){for(var c=o.length,h=0;o.length>h;h++)(function(){var a=h;setTimeout(function(){t(i,o,a,r,l,function(){for(var e=o[a].children[1].children,t=e.length-1;t>=0;t--){var i=e[t];n._itemsContainer.adopt(i);var r=n._positioningFunc(a*s+t);i.setStyles({position:"absolute",left:r.left+"px",top:r.top+"px"})}o[a].destroy(),c--,0>=c&&d()})},e(a,1e3*l,o.length))})()}},_swipeSingleDirection:function(e,t,i,n,o,s){e(t[i].children[0],t[i].children[1],n,o,s)},_swipeAlternate:function(e,t,i,n,o,s){0===i%2?e(t[i].children[0],t[i].children[1],n,o,s):(n=0==n?1:0,e(t[i].children[0],t[i].children[1],n,o,s))},_timingAllAtOnce:function(){return 0},_timingSequential:function(e,t,i,n){return e/(i*n)*t},_timingHorizontalWave:function(e,t,i){var n=e%i;return Math.floor((e-n)/i),n/i*t},_timingVerticalWave:function(e,t,i,n){var o=e%i,s=Math.floor((e-o)/i);return s/n*t},_reverseTiming:function(e){return function(t,i){return i-e.apply(this,arguments)}},_standardDiagonalDistFunc:function(e,t){return Math.sqrt(e*e+t*t)},_timingDiagonalWave:function(e,t,i,n,o){o=o||this._standardDiagonalDistFunc;var s=e%i,a=Math.floor((e-s)/i),r=o(s,a,i,n),l=Math.sqrt(i*i+n*n);return r/l*t},_timingSwipeAllAtOnce:function(){return 0},_timingSwipeWave:function(e,t,i){return(.6+.4*e/i)*t},_rotateDiagonalTiming:function(e,t){var i,n=this;return i=0>=t||t>3?this._standardDiagonalDistFunc:1==t?function(e,t,i){return n._standardDiagonalDistFunc(i-e,t)}:2==t?function(e,t,i,o){return n._standardDiagonalDistFunc(i-e,o-t)}:function(e,t,i,o){return n._standardDiagonalDistFunc(e,o-t)},function(t,n,o,s){return e(t,n,o,s,i)}}})}),define.Class("wysiwyg.viewer.utils.MessageViewController",function(e){var t=e;t.binds(["_showMessageBox","_messageBoxClosed"]),t.inherits("bootstrap.managers.BaseManager"),t.methods({initialize:function(){this._messagesQueue=[],this.BETWEEN_MESSAGES_DELAY=700},_initIfNeededMessageView:function(e){this._messageBox?e&&e():this._messageBox=W.Components.createComponent("wysiwyg.viewer.components.MessageView","wysiwyg.viewer.skins.MessageViewSkin",null,null,function(){$$("body").adopt(this._messageBox),this._messageBox.getLogic().addEvent("complete",this._messageBoxClosed)}.bind(this),e)},showError:function(e,t){var i={};i.msgTitle=e,i.msgBody=t,this._messagesQueue.push(i),this._initIfNeededMessageView(this._showMessageBox)},showMessage:function(e,t,i){var n={};n.msgTitle=e,n.msgBody=t,n.cb=i,this._messagesQueue.push(n),this._initIfNeededMessageView(this._showMessageBox)},_showMessageBox:function(){this._messagesQueue.length>0&&!this._messageBox.getLogic().visible()&&this._messageBox.getLogic().showMessage(this._messagesQueue.shift())},_messageBoxClosed:function(){setTimeout(function(){this._showMessageBox()}.bind(this),this.BETWEEN_MESSAGES_DELAY)},kill:function(){this._messageBox&&(this._messageBox.dispose(),this._messageBox.removeFromDOM())},isReady:function(){return!0},clone:function(e){return this.parent(e)}})}),define.Class("wysiwyg.viewer.utils.TransitionHandler",function(e){e.binds(["_swipeHorizontalTransition","_swipeHorizontalTransitionFullScreen","_swipeVerticalTransition","_swipeVerticalTransitionFullScreen","_noTransition","_inOutTransition","_crossFadeTransition","_shrinkFadeTransition","_trackCallback"]),e.fields({_useCSS3:!1,_frameRateTrackingActive:!1,_frameRateCount:0,_trackStartTime:0}),e.resources(["W.Utils"]),e.methods({initialize:function(){this._Tween=this.resources.W.Utils.Tween},getTransition:function(e){switch(e){case Constants.TransitionTypes.SWIPE_HORIZONTAL:return this._swipeHorizontalTransition;case Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN:return this._swipeHorizontalTransitionFullScreen;case Constants.TransitionTypes.SWIPE_VERTICAL:return this._swipeVerticalTransition;case Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN:return this._swipeVerticalTransitionFullScreen;case Constants.TransitionTypes.CROSS_FADE:return this._crossFadeTransition;case Constants.TransitionTypes.SHRINK_FADE:return this._shrinkFadeTransition;case Constants.TransitionTypes.OUT_IN:return this._inOutTransition;case Constants.TransitionTypes.NONE:default:return this._noTransition}},_noTransition:function(e,t,i,n,o){o()},_swipeHorizontalTransition:function(e,t,i,n,o){var s=e.getWidth();this._swipeHorizontalTransitionCommon(e,t,i,n,s,o)},_swipeHorizontalTransitionFullScreen:function(e,t,i,n,o){var s=e.getContentRect(),a=Math.max($(document).getSize().x-s.left,s.right),r=a-t.getContentRect(t).left;this._swipeHorizontalTransitionCommon(e,t,i,n,r,o)},_swipeHorizontalTransitionCommon:function(e,t,i,n,o,s){var a=e.getParent(),r=this.injects().Utils.getCSSBrowserFeature("animation"),l=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),d={};e.setStyles({position:"absolute"}),t.setStyles({position:"absolute"}),0!==i&&(o=-o),t.setStyle("left",o+"px"),t.setStyle("top","0px"),this._useCSS3&&r?(d.left=o+"px",d["margin-left"]=-o+""+"px",d[r]="swipeHoriz "+n+"s",d[l]="ease-in-out",a.setStyles(d),setTimeout(function(){a.setStyle(r,""),a.setStyles({left:"0px","margin-left":"0px"}),t.setStyles({left:"0px"}),s()},1e3*n)):this._Tween.to(a,n,{left:-o+"",ease:"strong_easeInOut",onComplete:function(){t.setStyles({left:"0px"}),a.setStyles({top:"0px",left:"0px"}),s()}})},_swipeVerticalTransition:function(e,t,i,n,o){var s=e.getHeight();this._swipeVerticalTransitionCommon(e,t,i,n,s,o)},_swipeVerticalTransitionFullScreen:function(e,t,i,n,o){var s=e.getCoordinates().top+t.getHeight();this._swipeVerticalTransitionCommon(e,t,i,n,s,o)},_swipeVerticalTransitionCommon:function(e,t,i,n,o,s){var a=e.getParent(),r=this.injects().Utils.getCSSBrowserFeature("animation"),l=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),d={};e.setStyles({position:"absolute"}),t.setStyles({position:"absolute"}),0!==i&&(o=-o),t.setStyle("top",o+"px"),t.setStyle("left","0px"),this._useCSS3&&r?(d.top=o+"px",d["margin-top"]=-o+""+"px",d[r]="swipeVert "+n+"s",d[l]="ease-in-out",a.setStyles(d),setTimeout(function(){a.setStyle(r,""),a.setStyles({top:"0px","margin-top":"0px"}),t.setStyles({top:"0px"}),s()},1e3*n)):this._Tween.to(a,n,{top:-o+"",ease:"strong_easeInOut",onComplete:function(){t.setStyles({top:"0px"}),a.setStyles({top:"0px",left:"0px"}),s()}})},_crossFadeTransition:function(e,t,i,n,o){var s=this.injects().Utils.getCSSBrowserFeature("animation");e.setStyles({position:"absolute"}),t.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0"}),this._useCSS3&&s?(e.setStyle(s,"fadeOut "+n+"s"),t.setStyle(s,"fadeIn "+n+"s"),setTimeout(function(){t.setStyle(s,""),e.setStyle(s,""),t.setStyles({position:"absolute"}),o()},1e3*n)):(e.setStyles({opacity:"1.0"}),t.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(e,n,{opacity:0,ease:"swing"}),this._Tween.to(t,n,{opacity:1,ease:"swing",onComplete:function(){o()}}))},_shrinkFadeTransition:function(e,t,i,n,o){var s=e.getCoordinates(),a=e.getParent();e.setStyles({position:"absolute",top:"0px",left:"0px"}),t.setStyles({position:"absolute",top:"0px",left:"0px"});var r=new Element("div");r.setStyles({position:"absolute",width:s.width+"px",height:s.height+"px",overflow:"hidden"}),a.adopt(r),r.adopt(e),this._Tween.to(r,n,{top:parseInt(s.height/2)+"px",left:parseInt(s.width/2)+"px",width:"0px",height:"0px",ease:"swing",onComplete:function(){r.getParent().adopt(e),r.destroy(),o()}})},_inOutTransition:function(e,t,i,n,o){var s=this.injects().Utils.getCSSBrowserFeature("animation");e.setStyles({position:"absolute"}),t.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0",visibility:"visible"}),this._useCSS3&&s?(e.setStyle(s,"fadeOut "+n+"s"),t.setStyle(s,"fadeIn "+n+"s "+n+"s"),setTimeout(function(){e.setStyle(s,""),e.setStyles({opacity:"0.0"}),setTimeout(function(){t.setStyle(s,""),t.setStyles({opacity:"1.0"}),t.setStyles({position:"absolute"}),o()},1e3*n)},1e3*n)):(e.setStyles({opacity:"1.0"}),t.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(e,1.2*n,{opacity:0,ease:"strong_easeOut"}),this._Tween.to(t,n,{opacity:1,ease:"strong_easeIn",onComplete:function(){o()}}))},_startTracking:function(){this._frameRateTrackingActive=!0,this._frameRateCount=0,this._trackStartTime=(new Date).getTime(),window.requestAnimFrame(this._trackCallback)},_stopTracking:function(){this._frameRateTrackingActive=!1,((new Date).getTime()-this._trackStartTime)/1e3},_trackCallback:function(){this._frameRateCount++,this._frameRateTrackingActive&&window.requestAnimFrame(this._trackCallback)}})}),define.Class("wysiwyg.viewer.utils.TransitionUtils",function(e){var t=e;t.binds(["_swipeHorizontalTransition","_swipeHorizontalTransitionFullScreen","_swipeVerticalTransition","_swipeVerticalTransitionFullScreen","_noTransition","_inOutTransition","_crossFadeTransition","_shrinkFadeTransition","_trackCallback"]),t.fields({_useCSS3:!1,_frameRateTrackingActive:!1,_frameRateCount:0,_trackStartTime:0}),t.methods({initialize:function(){this._Tween=W.Utils.Tween},getTransition:function(e){switch(e){case Constants.TransitionTypes.SWIPE_HORIZONTAL:return this._swipeHorizontalTransition;case Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN:return this._swipeHorizontalTransitionFullScreen;case Constants.TransitionTypes.SWIPE_VERTICAL:return this._swipeVerticalTransition;case Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN:return this._swipeVerticalTransitionFullScreen;case Constants.TransitionTypes.CROSS_FADE:return this._crossFadeTransition;case Constants.TransitionTypes.SHRINK_FADE:return this._shrinkFadeTransition;case Constants.TransitionTypes.OUT_IN:return this._inOutTransition;case Constants.TransitionTypes.NONE:default:return this._noTransition}},_noTransition:function(e,t,i,n,o){o()},_swipeHorizontalTransition:function(e,t,i,n,o){var s=e.getWidth();this._swipeHorizontalTransitionCommon(e,t,i,n,s,o)},_swipeHorizontalTransitionFullScreen:function(e,t,i,n,o){var s=e.getContentRect(),a=Math.max($(document).getSize().x-s.left,s.right),r=a-t.getContentRect(t).left;this._swipeHorizontalTransitionCommon(e,t,i,n,r,o)},_swipeHorizontalTransitionCommon:function(e,t,i,n,o,s){var a=e.getParent(),r=this.injects().Utils.getCSSBrowserFeature("animation"),l=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),d={};e.setStyles({position:"absolute"}),t.setStyles({position:"absolute"}),0!==i&&(o=-o),t.setStyle("left",o+"px"),this._useCSS3&&r?(d.left=o+"px",d["margin-left"]=-o+""+"px",d[r]="swipeHoriz "+n+"s",d[l]="ease-in-out",a.setStyles(d),setTimeout(function(){a.setStyle(r,""),a.setStyles({left:"0px","margin-left":"0px"}),t.setStyles({left:"0px"}),s()},1e3*n)):this._Tween.to(a,n,{left:-o+"",ease:"strong_easeInOut",onComplete:function(){t.setStyles({left:"0px"}),a.setStyles({top:"0px",left:"0px"}),s()}})},_swipeVerticalTransition:function(e,t,i,n,o){var s=e.getHeight();this._swipeVerticalTransitionCommon(e,t,i,n,s,o)},_swipeVerticalTransitionFullScreen:function(e,t,i,n,o){var s=e.getCoordinates().top+t.getHeight();this._swipeVerticalTransitionCommon(e,t,i,n,s,o)},_swipeVerticalTransitionCommon:function(e,t,i,n,o,s){var a=e.getParent(),r=this.injects().Utils.getCSSBrowserFeature("animation"),l=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),d={};e.setStyles({position:"absolute"}),t.setStyles({position:"absolute"}),0!==i&&(o=-o),t.setStyle("top",o+"px"),this._useCSS3&&r?(d.top=o+"px",d["margin-top"]=-o+""+"px",d[r]="swipeVert "+n+"s",d[l]="ease-in-out",a.setStyles(d),setTimeout(function(){a.setStyle(r,""),a.setStyles({top:"0px","margin-top":"0px"}),t.setStyles({top:"0px"}),s()},1e3*n)):this._Tween.to(a,n,{top:-o+"",ease:"strong_easeInOut",onComplete:function(){t.setStyles({top:"0px"}),a.setStyles({top:"0px",left:"0px"}),s()}})},_crossFadeTransition:function(e,t,i,n,o){var s=this.injects().Utils.getCSSBrowserFeature("animation");e.setStyles({position:"absolute"}),t.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0"}),this._useCSS3&&s?(e.setStyle(s,"fadeOut "+n+"s"),t.setStyle(s,"fadeIn "+n+"s"),setTimeout(function(){t.setStyle(s,""),e.setStyle(s,""),t.setStyles({position:"absolute"}),o()},1e3*n)):(e.setStyles({opacity:"1.0"}),t.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(e,n,{opacity:0,ease:"swing"}),this._Tween.to(t,n,{opacity:1,ease:"swing",onComplete:function(){o()}}))},_shrinkFadeTransition:function(e,t,i,n,o){var s=e.getCoordinates(),a=e.getParent();e.setStyles({position:"absolute",top:"0px",left:"0px"}),t.setStyles({position:"absolute",top:"0px",left:"0px"});var r=new Element("div");r.setStyles({position:"absolute",width:s.width+"px",height:s.height+"px",overflow:"hidden"}),a.adopt(r),r.adopt(e),this._Tween.to(r,n,{top:parseInt(s.height/2)+"px",left:parseInt(s.width/2)+"px",width:"0px",height:"0px",ease:"swing",onComplete:function(){r.getParent().adopt(e),r.destroy(),o()}})},_inOutTransition:function(e,t,i,n,o){var s=this.injects().Utils.getCSSBrowserFeature("animation");e.setStyles({position:"absolute"}),t.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0",visibility:"visible"}),this._useCSS3&&s?(e.setStyle(s,"fadeOut "+n+"s"),t.setStyle(s,"fadeIn "+n+"s "+n+"s"),setTimeout(function(){e.setStyle(s,""),e.setStyles({opacity:"0.0"}),setTimeout(function(){t.setStyle(s,""),t.setStyles({opacity:"1.0"}),t.setStyles({position:"absolute"}),o()},1e3*n)},1e3*n)):(e.setStyles({opacity:"1.0"}),t.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(e,1.2*n,{opacity:0,ease:"strong_easeOut"}),this._Tween.to(t,n,{opacity:1,ease:"strong_easeIn",onComplete:function(){o()}}))},_startTracking:function(){this._frameRateTrackingActive=!0,this._frameRateCount=0,this._trackStartTime=(new Date).getTime(),window.requestAnimFrame(this._trackCallback)},_stopTracking:function(){this._frameRateTrackingActive=!1,((new Date).getTime()-this._trackStartTime)/1e3},_trackCallback:function(){this._frameRateCount++,this._frameRateTrackingActive&&window.requestAnimFrame(this._trackCallback)}})}),define.component("wysiwyg.viewer.components.AdminLogin",function(e){var t=e;t.inherits("wysiwyg.viewer.components.PasswordLogin"),t.binds(["centerDialog","_onSubmit","_reportError","_invalidateErrorState","_onKeyPress"]),t.skinParts({blockingLayer:{type:"htmlElement"},passwordInput:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},submitButton:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.PasswordLogin.Close"},favIcon:{type:"htmlElement"},header:{type:"htmlElement"},dialog:{type:"htmlElement"}}),t.dataTypes(["Text"]),t.states(["normal","confirm"]),t.methods({initialize:function(e,t,i){this.isVolatile=!0,this._userApi=!window.userApi&&window.UserApi?window.UserApi.getInstance().init({orgDocID:"",usersDomain:window.usersDomain||'https://users.wix.com/wix-users";',corsEnabled:!0,dontHandShake:!0,urlThatUserRedirectedFrom:""}):window.userApi,this.parent(e,t,i),this.VIEWER_STRINGS.LOGIN_HEADER="Login to edit your site",this.ERR_MAP={9975:this.VIEWER_STRINGS.LOGIN_ERR_GENERAL,9972:this.VIEWER_STRINGS.LOGIN_ERR_WRONG_PASSWORD}},_validatePassword:function(e,t,i){var n=this._validateInput(e);if(n)i(n);else{var o=window.rendererModel,s=o.metaSiteId,a=o.siteId,r=window.siteHeader.userId;this.injects().Config.getServiceTopologyProperty("serverName");var l=!1,d=this.injects().Config.getServiceTopologyProperty("htmlEditorUrl")+"/editor/web/renderer/edit/"+a+"?metaSiteId="+s;if(!this._userApi)return this._reportError(this.VIEWER_STRINGS.LOGIN_ERR_GENERAL),void 0;this._userApi.loginByGuid(r,e,l,function(){i(this.VIEWER_STRINGS.LOGIN_ERR_GENERAL)}.bind(this),function(e){var n=e.success;if(n)t(),(this.injects().Viewer.isPublicMode()||this._debugMode)&&window.open(d,"_blank");else{var o=this.ERR_MAP[e.errorCode]||this.ERR_MAP[9975];i(o)}}.bind(this))}},_onSubmit:function(){this.injects().Viewer.isPublicMode()?this.parent():this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this._skinParts.submitButton},this)},_validateInput:function(e){var t=e.length;return 4>t||t>15?this.ERR_MAP["9972"]:0==e.test(/^[a-zA-Z0-9_\-!@#$%^&*]+$/)?this.ERR_MAP["9972"]:null}})}),define.component("wysiwyg.viewer.components.AdminLoginButton",function(e){var t=e;t.inherits("wysiwyg.viewer.components.SiteButton"),t.traits(["wysiwyg.common.components.traits.LinkableComponent"]),t.skinParts({label:{type:"htmlElement"},link:{type:"htmlElement"}}),t.propertiesSchemaType("ButtonProperties"),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i)}})}),define.component("wysiwyg.viewer.components.AudioPlayer",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["_play","_pause","_stop","_setVolume","_onApiLoaded","_createAudioPlayer","_soundManagerReady"]),t.resources(["scriptLoader","W.Config"]),t.skinParts({playButton:{type:"htmlElement"},stopButton:{type:"htmlElement"},pauseButton:{type:"htmlElement"}}),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"AUDIO_REPLACE_AUDIO",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"audio"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"audio"},commandParameterDataRef:"SELF"}}}),t.states(["loading","stopped","playing"]),t.dataTypes(["AudioPlayer"]),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.setState("loading"),this._loadApi()},_onAllSkinPartsReady:function(){this.$class._audioManagerWasLoaded&&this.setState("stopped"),this._createAudioPlayer()},_createAudioPlayer:function(){return this.$class._audioManagerWasLoaded?(this._skinParts.playButton.addEvent("click",this._play),this._skinParts.stopButton.addEvent("click",this._stop),this._skinParts.pauseButton.addEvent("click",this._pause),this.injects().Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange),this.$class._audioManagerWasLoaded&&(this._audio=this._createAudioObject()),!this.injects().Viewer.getPreviewMode()&&this.getIsDisplayed()&&this._data.get("autoPlay")&&this._play(),void 0):(W.Utils.callLater(this._createAudioPlayer,null,this,10),void 0)},_onModeChange:function(e){this._isInPreviewMode(e)&&this.getIsDisplayed()&&this._data.get("autoPlay")&&this._fileWasSet()?this._play():this._stop()},_fileWasSet:function(){return this._data.get("uri").length>0},_isInPreviewMode:function(e){return e.toLowerCase()===Constants.ViewManager.VIEW_MODE_PREVIEW.toLowerCase()},_play:function(){if(this._fileWasSet()){this.setState("playing");var e={volume:this._data.get("volume")};this._data.get("loop")&&(e.onfinish=this._play),this._audio&&this._audio.play(e)}},_pause:function(){this._fileWasSet()&&(this.setState("stopped"),this._audio.pause())},_stop:function(){this._fileWasSet()&&this._audio&&(this.setState("stopped"),this._audio.stop(),this._audio.destruct(),this._audio=this._createAudioObject())},_createAudioObject:function(){return soundManager.createSound({id:this._view.getAttribute("id"),url:this._getFullUrl(this._data.get("uri"))})},_getFullUrl:function(e){if(-1===e.indexOf("http://")){var t=window.serviceTopology.staticAudioUrl;return"/"!==t[t.length-1]&&(t+="/"),t+=e}return e},_setVolume:function(e){var t=e.value||100;this._audio.volume=t/100},_onDataChange:function(e){this.parent(e),this._stop()},_getSoundManagerFolder:function(){var e=this.resources.W.Config.getServiceTopologyProperty("scriptsRoot");return"/"!==e[e.length-1]&&(e+="/"),e+="resources/wysiwyg/media/soundmanager2/"},_onApiLoaded:function(){soundManager=new SoundManager,soundManager.setup({url:this._getSoundManagerFolder(),onready:this._soundManagerReady}),soundManager.beginDelayedInit()},_soundManagerReady:function(){this.$class._audioManagerWasLoaded=!0,this.$class._soundManagerReadyCallbacks&&this.$class._soundManagerReadyCallbacks.forEach(function(e){e()})},_loadApi:function(){SM2_DEFER=!0,this.$class.audioApiLoaded||(this.$class.audioApiLoaded=!0,this.resources.scriptLoader.loadResource({url:this._getSoundManagerFolder()+"soundmanager2-nodebug-jsmin.js"},{onLoad:this._onApiLoaded,onFailed:function(){LOG.reportError("failed to load soundmanager2")}})),this.$class._soundManagerReadyCallbacks=this.$class._soundManagerReadyCallbacks||[],this.$class._soundManagerReadyCallbacks.push(this.setState.bind(this,"stopped"))},onPageVisibilityChange:function(e){"editor"!==window.viewMode&&(e||"playing"!==this.getState()?e&&this._data.get("autoPlay")&&"playing"!==this.getState()&&this._play():this._pause())}})}),define.component("wysiwyg.viewer.components.ClipArt",function(e){var t=e;t.inherits("wysiwyg.viewer.components.WPhoto"),t.traits(["wysiwyg.common.components.traits.LinkableComponent"]),t.skinParts({link:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*"}}),t.propertiesSchemaType("WPhotoProperties"),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"CLIP_ART_REPLACE_IMAGE",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"clipart"}},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"clipart"}}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.setComponentProperty("displayMode","stretch",!0)}})}),define.component("wysiwyg.viewer.components.ContactForm",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["_onButtonClick","_sendEmailCompleted"]),t.skinParts({nameLabel:{type:"htmlElement"},name:{type:"htmlElement"},emailLabel:{type:"htmlElement"},email:{type:"htmlElement"},subjectLabel:{type:"htmlElement"},subject:{type:"htmlElement"},messageLabel:{type:"htmlElement"},message:{type:"htmlElement"},notifications:{type:"htmlElement"},send:{type:"htmlElement"}}),t.dataTypes(["ContactForm"]),t.states(["editing","errors","processing"]),t.fields({Resources:{en:{CONTACT_FORM_LABEL_NAME:"Name",CONTACT_FORM_LABEL_EMAIL:"Email",CONTACT_FORM_LABEL_SUBJECT:"Subject",CONTACT_FORM_LABEL_MESSAGE:"Message",CONTACT_FORM_LABEL_SENDING:"Sending...",CONTACT_FORM_LABEL_SENT_SUCCESSFULLY:"Your email was sent successfully!",CONTACT_FORM_BUTTON_SEND:"Send",CONTACT_FORM_ERROR_NAME_MISSING:"Please add your name",CONTACT_FORM_ERROR_EMAIL_INVALID:"Please add a valid email",CONTACT_FORM_ERROR_MESSAGE_MISSING:"Please add a message",CONTACT_FORM_ERROR_OWNER_NOT_DEFINED:"Owner email address not set",CONTACT_FORM_ERROR_GENERAL:"Error sending email, please try again later",CONTACT_FORM_EMAIL_SUBJECT:"New message via your Wix website, from - ",CONTACT_FORM_EMAIL_SUBSTITUTE_NO_SUBJECT:"<no subject>",CONTACT_FORM_EMAIL_HTML_TEMPLATE:"<strong>You have a new message</strong><br/>via: WIX___THE_CURRENT_WEBSITE___<br/><br/><strong>Message details:</strong><br/>From: WIX___SENDER_NAME___<br/>Email: WIX___SENDER_EMAIL___<br/>Date: WIX___FORMATTED_DATE___<br/>Subject: WIX___MESSAGE_SUBJECT___<br/><br/><strong>Message:</strong><br/>WIX___MESSAGE_BODY___<br/><br/><br/>Thank you for using Wix.com!",CONTACT_FORM_EMAIL_TEXT_TEMPLATE:"You have a new message\nvia: WIX___THE_CURRENT_WEBSITE___\n\nMessage details:\nFrom: WIX___SENDER_NAME___\nEmail: WIX___SENDER_EMAIL___\nDate: WIX___FORMATTED_DATE___\nSubject: WIX___MESSAGE_SUBJECT___\n\nMessage:\nWIX___MESSAGE_BODY___\n\n\nThank you for using Wix.com!",PREMIUM_CONTACT_FORM_LABEL_NAME:"Name",PREMIUM_CONTACT_FORM_LABEL_EMAIL:"Email",PREMIUM_CONTACT_FORM_LABEL_SUBJECT:"Subject",PREMIUM_CONTACT_FORM_LABEL_MESSAGE:"Message",PREMIUM_CONTACT_FORM_LABEL_SENDING:"Sending...",PREMIUM_CONTACT_FORM_LABEL_SENT_SUCCESSFULLY:"Your email was sent successfully!",PREMIUM_CONTACT_FORM_BUTTON_SEND:"Send",PREMIUM_CONTACT_FORM_ERROR_NAME_MISSING:"Please add your name",PREMIUM_CONTACT_FORM_ERROR_EMAIL_INVALID:"Please add a valid email",PREMIUM_CONTACT_FORM_ERROR_MESSAGE_MISSING:"Please add a message",PREMIUM_CONTACT_FORM_ERROR_OWNER_NOT_DEFINED:"Owner email address not set",PREMIUM_CONTACT_FORM_ERROR_GENERAL:"Error sending email, please try again later",PREMIUM_CONTACT_FORM_EMAIL_SUBJECT:"New message via your website, from - ",PREMIUM_CONTACT_FORM_EMAIL_SUBSTITUTE_NO_SUBJECT:"<no subject>",PREMIUM_CONTACT_FORM_EMAIL_HTML_TEMPLATE:"<strong>You have a new message</strong><br/>via: WIX___THE_CURRENT_WEBSITE___<br/><br/><strong>Message details:</strong><br/>From: WIX___SENDER_NAME___<br/>Email: WIX___SENDER_EMAIL___<br/>Date: WIX___FORMATTED_DATE___<br/>Subject: WIX___MESSAGE_SUBJECT___<br/><br/><strong>Message:</strong><br/>WIX___MESSAGE_BODY___<br/><br/><br/>Thank you!",PREMIUM_CONTACT_FORM_EMAIL_TEXT_TEMPLATE:"You have a new message\nvia: WIX___THE_CURRENT_WEBSITE___\n\nMessage details:\nFrom: WIX___SENDER_NAME___\nEmail: WIX___SENDER_EMAIL___\nDate: WIX___FORMATTED_DATE___\nSubject: WIX___MESSAGE_SUBJECT___\n\nMessage:\nWIX___MESSAGE_BODY___\n\n\nThank you!"},get:function(e,t){return this.en[t]}}}),t.methods({initialize:function(e,t,i){i=i||{},this.parent(e,t,i),this._lists={enabled:!1,storeId:null,accessToken:null},this._metaSiteId=null,this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]},_onAllSkinPartsReady:function(){function e(e){if(this.set("placeholder",e),window.Modernizr&&!window.Modernizr.input.placeholder){var t=function(){var e=this;""==e.get("value")&&e.get("placeholder")&&(e.addClass("isPlaceholder"),e.set("value",e.get("placeholder")))}.bind(this),i=function(){var e=this;e.hasClass("isPlaceholder")&&(e.removeClass("isPlaceholder"),e.set("value",""))}.bind(this);this.hasPlaceholder||(this.hasPlaceholder=!0,this.addEvent("focus",i),this.addEvent("blur",t)),t()}}this.setHeight(this._skin._height||180),this.setState("editing"),this._skinParts.send.addEvent("click",this._onButtonClick),this._skinParts.send.enable=function(){this.removeProperty("disabled")}.bind(this._skinParts.send),this._skinParts.send.disable=function(){this.set("disabled","true")}.bind(this._skinParts.send),this._skinParts.name.setPlaceholder=e.bind(this._skinParts.name),this._skinParts.email.setPlaceholder=e.bind(this._skinParts.email),this._skinParts.subject.setPlaceholder=e.bind(this._skinParts.subject)},render:function(){this._skinParts.nameLabel.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_NAME"))),this._skinParts.emailLabel.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_EMAIL"))),this._skinParts.subjectLabel.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_SUBJECT"))),this._skinParts.messageLabel.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_MESSAGE"))),this._skin.hidePlaceholders!==!0&&(this._skinParts.name.setPlaceholder(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_NAME"))),this._skinParts.email.setPlaceholder(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_EMAIL"))),this._skinParts.subject.setPlaceholder(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_SUBJECT")))),this._skinParts.send.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_BUTTON_SEND")))},_prepareForRender:function(){try{if(this._metaSiteId=rendererModel.metaSiteId,this._metaSiteId||(this._metaSiteId="dc853130-4fb2-464f-878d-3b6667dc4f97"),this._lists.enabled){var e=rendererModel.serviceMappings;for(var t in e)if("WixLists"==e[t].applicationType){this._lists.storeId=e[t].idInApp;break}}}catch(i){}return this.parent()},_onButtonClick:function(){try{var e={name:this._skinParts.name.get("value").trim(),email:this._skinParts.email.get("value").trim(),subject:this._skinParts.subject.get("value").trim(),message:this._skinParts.message.get("value").trim()};
this._validateForm(e),this._submitForm(e,this._metaSiteId,this._getWebsiteUrl(),new Date)}catch(t){this._skinParts.send.enable(),this.setState("errors"),this._setNotificationMessage("validation-error"==t.type?t.message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_GENERAL")))}},_getWebsiteUrl:function(){var e=window.location.origin||window.location.href.substring(0,window.location.href.indexOf(window.location.pathname));return this._isPreviewMode()?e:window.publicModel&&publicModel.externalBaseUrl||e},_isPreviewMode:function(){return"site"!=this.injects().Viewer.getViewMode()},_addPremiumPrefixToIdIfNeeded:function(e){return this.injects().Viewer.isPremiumUser()&&(e="PREMIUM_"+e),e},_validateForm:function(e){if(1>e.name.length)throw{type:"validation-error",message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_NAME_MISSING"))};var t=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!t.test(e.email))throw{type:"validation-error",message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_EMAIL_INVALID"))};if(1>e.message.length)throw{type:"validation-error",message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_MESSAGE_MISSING"))};var i=this._data.get("toEmailAddress");if(!i||0==i.trim())throw{type:"validation-error",message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_OWNER_NOT_DEFINED"))}},_submitForm:function(e,t,i,n){this.setState("processing"),this._setNotificationMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_SENDING"))),this._skinParts.send.disable(),0==e.subject.length&&(e.subject=this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_EMAIL_SUBSTITUTE_NO_SUBJECT")));var o=this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_EMAIL_SUBJECT")),s=this._formatMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_EMAIL_HTML_TEMPLATE")),e,i,!0,n),a=this._formatMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_EMAIL_TEXT_TEMPLATE")),e,i,!1,n),r=this._data.get("toEmailAddress"),l=this._data.get("bccEmailAddress");o+=e.email,this.sendEmail([{address:r,personal:r}],[],l?[{address:l,personal:l}]:[],{address:e.email,personal:e.name},o,s,a,t,this._sendEmailCompleted);try{this._createListEntry(e)}catch(d){}},_sendEmailCompleted:function(e){this._skinParts.send.enable(),e?(this.setState("editing"),this._setNotificationMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_SENT_SUCCESSFULLY"))),this._cleanForm()):(this.setState("errors"),this._setNotificationMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_GENERAL"))))},_cleanForm:function(){this._skinParts.name.set("value",""),this._skinParts.email.set("value",""),this._skinParts.subject.set("value",""),this._skinParts.message.set("value","")},_formatMessage:function(e,t,i,n,o){var s=function(e){return e?(e+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e},a=function(e){return n?s(e):e},r=e;return r=r.replace(/WIX___THE_CURRENT_WEBSITE___/g,i),r=r.replace("WIX___SENDER_NAME___",a(t.name)),r=r.replace("WIX___SENDER_EMAIL___",t.email),r=r.replace("WIX___MESSAGE_SUBJECT___",a(t.subject)),r=r.replace("WIX___MESSAGE_BODY___",a(t.message)),r=r.replace("WIX___FORMATTED_DATE___",this._formatDate(o))},_formatDate:function(e){var t=["January","February","March","April","May","June","July","August","September","October","November","December"],i=e.getDate(),n=e.getMonth(),o=e.getFullYear();return(10>i?"0":"")+i+" "+t[n]+" "+o},_setNotificationMessage:function(e){this._skinParts.notifications.set("text",e),""==e.trim()?this._skinParts.notifications.collapse():this._skinParts.notifications.uncollapse()},sendEmail:function(e,t,i,n,o,s,a,r,l){var d={to:e,cc:t,bcc:i,from:n,subject:o,htmlMessage:s,plainTextMessage:a,metaSiteId:r},c=this.injects(),h=c.Config.getServiceTopologyProperty("emailServer"),p=this._isPreviewMode();p&&(h+="Secured");var m=[];m.push(h),m.push("?accept=json&contentType=json"),m.push("&appUrl="+encodeURIComponent(window.location.href)),p&&m.push("&wixSession="+c.CookiesManager.getCookie("wixSession")),this._sendJsonCORS(m.join(""),d,"POST",l)},_sendJsonCORS:function(e,t,i,n){var o=function(e,t){var i=new XMLHttpRequest;return"withCredentials"in i?(i.open(e,t,!0),i.withCredentials="true"):"undefined"!=typeof XDomainRequest&&(i=new XDomainRequest,i.open(e,t),i.setRequestHeader=function(){}),i},s=function(e){if(!r.responseText)return{success:!1,errorDescription:"Invalid ajax response, no responseText",errorCode:-9001};var t=JSON.parse?JSON.parse:eval;try{return t(e)}catch(i){return{success:!1,errorDescription:"Invalid JSON object",errorCode:-9e3}}},a=function(e){return e.errorDescription+" ("+e.errorCode+")"},r=o(i,e);r.onabort=function(){n(!1,"request aborted")},r.ontimeout=function(){n(!1,"request timeout")},r.onerror=function(){n(!1,a(s(r.responseText)))},r.onload=function(){var e=s(r.responseText);n(e.success,e.success?e:a(e))},r.setRequestHeader("Content-Type","application/json"),r.send(JSON.encode(t))},_createListEntry:function(e){if(this._lists.enabled&&this._lists.storeId){var t=window.location.origin||window.location.href.substring(0,window.location.href.indexOf(window.location.pathname)),i="/apps/lists/1/stores/"+this._lists.storeId+"/collections/ContactForms,online",n={_type:"BasicForms.ContactForm",name:e.name,email:e.email,subject:e.subject,message:e.message,createdAt:(new Date).getTime(),sourceForm:this._view.get("id")},o=function(){var e=function(){}.bind(this),o=new Request.JSON({url:t+i,urlEncoded:!1,headers:{"If-Modified-Since":"Sat, 1 Jan 2005 00:00:00 GMT","Content-Type":"application/json; charset=utf-8",Accept:"application/json",AccessToken:this._lists.accessToken},onSuccess:e,onFailure:e});o.post(JSON.encode(n))}.bind(this);this._validateListAccessToken(o)}},_validateListAccessToken:function(e){if(this._lists.enabled){if(this._lists.accessToken)return e(),void 0;var t=window.location.origin||window.location.href.substring(0,window.location.href.indexOf(window.location.pathname)),i="/apps/lists/1/auth/contact-forms?storeId="+this._lists.storeId,n=function(t){try{t.success&&(this._lists.accessToken=t.payload,e())}catch(i){}}.bind(this),o=function(){},s=new Request.JSON({url:t+i,urlEncoded:!1,headers:{"If-Modified-Since":"Sat, 1 Jan 2005 00:00:00 GMT",Accept:"application/json"},onSuccess:n,onFailure:o});s.get()}}})}),define.component("wysiwyg.viewer.components.Displayer",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({image:{type:"core.components.Image",dataRefField:"*",optional:!1},imageWrapper:{type:"htmlElement",optional:!1},title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},zoom:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!1},rolloverHitArea:{type:"htmlElement",optional:!0}}),t.binds(["_onMouseOver","_onMouseOut","_onZoomClick","_onImageStateChange","_onOwnerPropsChanged"]),t.traits(["wysiwyg.common.components.traits.LinkableComponent","wysiwyg.common.components.traits.SelectableOption"]),t.states({general:["loading","normal","rollover"],transitionPhase:["noTransition","transIn","transOut"],linkableComponent:["link","noLink"],selectState:["selected","unselected"]}),t.dataTypes(["Image"]),t.fields({_renderTriggers:[Constants.DisplayEvents.SKIN_CHANGE],_parentList:null,_owner:null,_expandEnabled:!0,_debugMode:!1,_lastSetSizeParams:null}),t.methods({initialize:function(e,t,i){this._NO_LINK_PROPAGATION=!0,t.setStyle("visibility","hidden"),this.parent(e,t,i)},render:function(){this._refreshImage(),this.parent()},setOwner:function(e){if(this._owner&&this._owner.getComponentProperties().removeEvent(Constants.DataEvents.DATA_CHANGED,this._onOwnerPropsChanged),this._owner=e,this._parentList=this._owner.getDataItem(),this._owner.getComponentProperties().addEvent(Constants.DataEvents.DATA_CHANGED,this._onOwnerPropsChanged),this._onOwnerPropsChanged(),this._debugMode){var t=this._data.get("id"),i=this._parentList.getData().items.indexOf("#"+t),n=new Element("div");this._debugMode=!1,n.set("text",i+""),n.setStyles({position:"relative",top:"-20px"}),this.getViewNode().adopt(n)}},_onOwnerPropsChanged:function(){this._isDisposed||this._owner&&this._owner._isDisposed||(this._galleryImageOnClickAction=this._owner.getComponentProperties().hasField("galleryImageOnClickAction")?this._owner.getComponentProperty("galleryImageOnClickAction"):this._owner.getComponentProperty("expandEnabled")===!0?"zoomMode":"disabled",this._skinParts.link.set("text",this._owner.getComponentProperty("goToLinkText")),this._isImageClickable()||-1==this.getState().indexOf("rollover")||this.setState("rollover","general"),this._updateParts())},setParentList:function(e){this._parentList=e},_setupParts:function(){var e=this._skinParts.rollOverHitArea||this._view,t=this._skinParts.zoom||this._skinParts.imageWrapper;this._skinParts.image.addEvent("stateChange",this._onImageStateChange),t.addEvent(Constants.CoreEvents.CLICK,this._onZoomClick),e.addEvent(Constants.CoreEvents.MOUSE_OVER,this._onMouseOver),e.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onMouseOut);var i={overflow:"hidden","text-overflow":"ellipsis"};this._skinParts.title.setStyles(i),this._skinParts.description.setStyles(i)},_updateParts:function(){if(this._skinParts){this._skinParts.image.getDataItem&&this._data&&this._data!==this._skinParts.image.getDataItem()&&this._skinParts.image.setDataItem(this._data),this._skinParts.title.set("text",this._data.get("title")),this._skinParts.description.set("text",this._data.get("description"));var e=this._skinParts.zoom||this._skinParts.imageWrapper;e.setStyle("cursor",this._isImageClickable()?"pointer":"default"),"goToLink"!==this._galleryImageOnClickAction&&this._isImageLinked()?this._skinParts.link.setStyle("display","block"):this._skinParts.link.setStyle("display","none")}},_onImageStateChange:function(e){switch(e.newState){case"loading":this.setState("loading","general");break;case"loaded":this.setState("normal","general")}},_onMouseOver:function(){this._isImageClickable()&&-1!=this.getState().indexOf("normal")&&this.setState("rollover","general")},_onMouseOut:function(){this._isImageClickable()&&-1!=this.getState().indexOf("rollover")&&this.setState("normal","general")},zoom:function(){var e=this._data.get("id"),t=this._parentList.getData().items.indexOf("#"+e);this.injects().Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:this._parentList,currentIndex:t,getDisplayerDivFunction:this.injects().Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:this.injects().Viewer.getDefaultGetHashPartsFunction("Image")})},goToLink:function(){if(this._skinParts.link.click)this._skinParts.link.click();else{var e=document.createEvent("HTMLEvents");e.initEvent("click",!0,!0),this._skinParts.link.dispatchEvent(e)}},_onZoomClick:function(e){e.rightClick===!1&&("zoomMode"==this._galleryImageOnClickAction?this.zoom():"goToLink"==this._galleryImageOnClickAction&&this.goToLink())},setSize:function(e,t,i){var n,o;if((!this._lastSetSizeParams||this._lastSetSizeParams[0]!==e||this._lastSetSizeParams[1]!==t||this._lastSetSizeParams[2]!==i)&&this._componentReady&&this._skinParts){switch(this._skinParts.image.checkVisibility(),n=this._skin.widthDiff||0,o=this._skin.heightDiff||0,i=i||"clipImage"){case"clipImage":this._clipImage(e,t,n,o);break;case"flexibleHeight":this._setFlexibleHeight(e,t,n,o);break;case"flexibleWidth":this._setFlexibleWidth(e,t,n,o,!0);break;case"flexibleWidthFixed":this._setFlexibleWidth(e,t,n,o,!1)}this._refreshImage(),this._lastSetSizeParams=[arguments[0],arguments[1],arguments[2]]}},invalidateSize:function(){this._lastSetSizeParams=null},getWidthDiff:function(){return this._skin.widthDiff||0},getHeightDiff:function(){return this._skin.heightDiff||0},_refreshImage:function(){this._componentReady&&(this._skinParts.image._invalidate("size"),this._skinParts.image._renderIfReady())},_clipImage:function(e,t,i,n){i=this._skin.widthDiff||0,n=this._skin.heightDiff||0;var o=e-i,s=t-n;this._setWrapperSize(o,s),this._setDisplayerSize(e,t)},_setFlexibleHeight:function(e,t,i,n){i=this._skin.widthDiff||0,n=this._skin.heightDiff||0;var o=e-i,s=Math.floor(o/this._getAspectRatio());this._setWrapperSize(o,s-n),this._setDisplayerSize(e,s)},_setFlexibleWidth:function(e,t,i,n,o){i=this._skin.widthDiff||0,n=this._skin.heightDiff||0;var s,a=0,r=0,l=t-n,d=l*this._getAspectRatio();!o&&d>e-i&&(s=(e-i)/d,d=e-i,l=s*l),o||(a=Math.floor((e-d-i)/2),r=Math.floor(t-l-n)/2),this._view.setStyle("width",d+i+""+"px"),this._setWrapperSize(d,l,a,r),o?this._setDisplayerSize(d,t):this._setDisplayerSize(e,t)},_getAspectRatio:function(){var e=this._skinParts.image.getDataItem(),t=parseInt(e.get("width"))/parseInt(this._data.get("height"));return t},_setWrapperSize:function(e,t,i,n){i=i||0,n=n||0;var o=0>t?0:t,s=0>e?0:e;this._skinParts.imageWrapper.setStyles({width:s+""+"px",height:o+""+"px","margin-left":i+""+"px","margin-right":i+""+"px","margin-top":n+""+"px","margin-bottom":n+""+"px"})},_setDisplayerSize:function(e,t){this._view.setStyles({width:e+""+"px",height:t+""+"px"}),this.setWidth(e),this.setHeight(t),this.fireEvent("autoSized")},_onDataChange:function(){this.parent(),this._updateParts()},_onAllSkinPartsReady:function(){this.parent(),this._view.setStyle("visibility","visible"),this._updateParts(),this._setupParts()},_onResize:function(){this.parent(),this._refreshImage()},getImageRef:function(){var e="";return this._skinParts&&(e=this._skinParts.image.getDataItem().get("id")+""),e},isImageLoading:function(){var e=!1;return this._componentReady&&(e=-1!=this._skinParts.image.getState().indexOf("loading")),e},dispose:function(){this._owner&&this._owner.getComponentProperties().removeEvent(Constants.DataEvents.DATA_CHANGED,this._onOwnerPropsChanged),this.parent()},_isImageLinked:function(){var e=this.getDataItem().get("href");return!!e},_isImageClickable:function(){return"goToLink"===this._galleryImageOnClickAction?this._isImageLinked():"disabled"!==this._galleryImageOnClickAction},setSelected:function(e){this.setState(e?"selected":"unselected","selectState")}})}),define.component("wysiwyg.viewer.components.EbayItemsBySeller",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({iFrameHolder:{type:"htmlElement"}}),t.propertiesSchemaType("EbayItemsBySellerProperties"),t.binds(["_applyThemeColors"]),t.states(["hasContent","noContent"]),t.dataTypes(["EbayItemsBySeller"]),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}},_renderTriggers:[Constants.DisplayEvents.MOVED_IN_DOM,Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED]}),t.methods({initialize:function(e,t,i){i=i||{},this.parent(e,t,i),this.addEvent("resizeEnd",this._onResizeEnd),this._iframe=null},options:{width:0,height:0,url:""},render:function(){var e=this._data.get("sellerId");if(this.setState(e?"hasContent":"noContent"),e){var t=this._createUrl(e,this._data.get("registrationSite"),this._prepareOptions()),i=this._createIFrame(t.width,t.height);this.injects().Utils.prepareIFrameForWrite(i,function(e,i){i.write('<html><body style="margin:0px;"><div><script type="text/javascript" src="'+t.url+'"></script></div></body></html>'),e.setStyles({height:t.height,width:t.width})})}},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors)},dispose:function(){this._style.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors),this.parent()},_applyThemeColors:function(e){var t=["fontColor","borderColor","headerColor","backgroundColor","linkColor"];for(var i in e.properties)if(t.indexOf(i)>-1)return this._renderIfReady(),void 0},_onResizeEnd:function(){this._renderIfReady()},_prepareOptions:function(){var e=this.injects().Skins,t=this._skin.className,i=e.getSkinParamValue(t,"fontColor",this._style).getHex(!1),n=e.getSkinParamValue(t,"borderColor",this._style).getHex(!1),o=e.getSkinParamValue(t,"headerColor",this._style).getHex(!1),s=e.getSkinParamValue(t,"backgroundColor",this._style).getHex(!1),a=e.getSkinParamValue(t,"linkColor",this._style).getHex(!1);return{width:this._view.getWidth(),height:this._view.getHeight(),headerImage:this.getComponentProperty("headerImage"),fontColor:i.replace("#",""),borderColor:n.replace("#",""),headerColor:o.replace("#",""),backgroundColor:s.replace("#",""),linkColor:a.replace("#","")}},_createUrl:function(e,t,i){var n=Math.floor((i.height-100)/70),o={Australia:"15",Austria:"16",Belgium_Dutch:"123",Belgium_French:"23",Canada:"2",CanadaFrench:"210",China:"223",eBayMotors:"100",France:"71",Germany:"77",HongKong:"201",India:"203",Ireland:"205",Italy:"101",Malaysia:"207",Netherlands:"146",Philippines:"211",Poland:"212",Singapore:"216",Spain:"186",Sweden:"218",Switzerland:"193",Taiwan:"196",UK:"3",US:"0",findId:function(e){var t=this[e];return t||(t=0),t}},s=this.urlCreator("http://lapi.ebay.com/ws/eBayISAPI.dll").addParam("EKServer").addParam("ai","aj|kvpqvqlvxwkl").addParam("bdrcolor",i.borderColor).addParam("fntcolor",i.fontColor).addParam("hdrcolor",i.headerColor).addParam("hdrimage",i.headerImage).addParam("lnkcolor",i.linkColor).addParam("tbgcolor",i.backgroundColor).addParam("si",e).addParam("sid",e).addParam("num",n).addParam("width",i.width).addParam("cid","0").addParam("eksize","1").addParam("encode","UTF-8").addParam("endcolor","FF0000").addParam("endtime","y").addParam("fbgcolor","FFFFFF").addParam("fs","0").addParam("hdrsrch","n").addParam("img","y").addParam("logo","6").addParam("numbid","n").addParam("paypal","n").addParam("popup","y").addParam("prvd","9").addParam("r0","3").addParam("shipcost","y").addParam("siteid",o.findId(t)).addParam("sort","MetaEndSort").addParam("sortby","endtime").addParam("sortdir","asc").addParam("srchdesc","n").addParam("title","").addParam("tlecolor","FFFFFF").addParam("tlefs","0").addParam("tlfcolor","000000").addParam("toolid","10004").addParam("track","5335838312");return i.url=""+s,i},_createIFrame:function(){var e=new IFrame;return e.width=this.options.width,e.height=this.options.height,this._iframe?e.replaces(this._iframe):e.insertInto(this._skinParts.iFrameHolder),this._iframe=e,e},urlCreator:function(e){return{_baseUrl:e,_params:[],addParam:function(e,t){return this._params.push({key:e,value:t}),this},toString:function(){var e=[];e.push(this._baseUrl),this._params.length>0&&e.push("?");for(var t=0;this._params.length>t;t++){var i=this._params[t];t>0&&e.push("&"),e.push(i.key),i.value&&(e.push("="),e.push(encodeURIComponent(i.value)))}return e.join("")}}}})}),define.component("wysiwyg.viewer.components.FiveGridLine",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({line:{type:"htmlElement"},lineCnt:{type:"htmlElement",optional:!0},leftKnobCnt:{type:"htmlElement",optional:!0},leftKnob:{type:"htmlElement",optional:!0},middleKnobCnt:{type:"htmlElement",optional:!0},middleKnob:{type:"htmlElement",optional:!0},rightKnobCnt:{type:"htmlElement",optional:!0},rightKnob:{type:"htmlElement",optional:!0}}),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.injects().Theme.setProperty("WEB_THEME_DIRECTORY","viewer"),this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]},render:function(){this.getHeight()},setWidth:function(e){this._getNumberOfKnobs(),this.width=e,this.parent(e)},_getNumberOfKnobs:function(){var e=0;return this._skinParts&&(this._skinParts.rightKnob&&e++,this._skinParts.leftKnob&&e++,this._skinParts.middleKnob&&e++),e}})}),define.component("wysiwyg.viewer.components.FlashComponent",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.resources(["W.Utils"]),t.binds(["_enforceDisplayMode"]),t.traits(["wysiwyg.common.components.traits.LinkableComponent"]),t.skinParts({flashContainer:{type:"htmlElement"},link:{type:"htmlElement",optional:!1},mouseEventCatcher:{type:"htmlElement"},noFlashImgContainer:{type:"htmlElement"},noFlashImg:{type:"core.components.Image",dataRefField:"placeHolderImage",argObject:{cropMode:"full"}}}),t.dataTypes(["FlashComponent"]),t.states({linkableComponent:["link","noLink"]}),t.propertiesSchemaType("FlashComponentProperties"),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"GENERAL_CHANGE",command:"WEditorCommands.OpenFlashDialog"},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenFlashDialog"}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._noFlashMode=!0,this._params={},this._attributes={},this._params.quality="high",this._params.bgcolor="#FAFAFA",this._params.allowscriptaccess="always",this._params.allowfullscreen="true",this._params.wMode="transparent",this._params.scale="exactFit",this._params.flashVars="",this._attributes.align="middle"},render:function(){this._createFlashEmbed(),this.parent()},_createFlashEmbed:function(e){var t=this._data.get("uri");if(t||this._uri||(this._mediaWidth=this._mediaWidth||this.getWidth(),this._mediaHeight=this._mediaHeight||this.getHeight()),e&&this._uri||t&&t!=this._uri){this._uri=t,this._mediaWidth=this._data.get("width"),this._mediaHeight=this._data.get("height");var i=this.injects().Config.getServiceTopologyProperty("staticMediaUrl")+"/"+this._uri;this._skinParts.flashContainer.empty(),this._embedDivID=this.resources.W.Utils.getUniqueId("ExtSWF"),this._embedDIV=new Element("DIV",{id:this._embedDivID}),this._skinParts.flashContainer.adopt(this._embedDIV),this._params.play=this.injects().Viewer.isPublicMode()||this._inPreviewMode?"true":"false",this._params.autoplay=this.injects().Viewer.isPublicMode()||this._inPreviewMode?"true":"false",this._flashObj=swfobject.embedSWF(i,this._embedDivID,"100%","100%","10.0.0","playerProductInstall.swf",null,this._params,this._attributes,function(e){e.success&&(this._noFlashMode=!1,this._skinParts.noFlashImgContainer.collapse(),this._embedCreated=!0),this._enforceDisplayMode()}.bind(this))}var n=this.getComponentProperty("displayMode");n!=this._displayMode&&(this._displayMode=n,this._enforceDisplayMode())},_editModeChanged:function(e){this._inPreviewMode="PREVIEW"==e,this._createFlashEmbed(!0)},_onResize:function(){this.isReady()&&this._embedCreated&&this._enforceDisplayMode()},_enforceDisplayMode:function(){var e=this._displayMode||this.getComponentProperty("displayMode");"fit"==e?this._width!=this.getWidth()?(this._width=this.getWidth(),this._height=this._width*(this._mediaHeight/this._mediaWidth)):(this._height=this.getHeight(),this._width=this._height*(this._mediaWidth/this._mediaHeight)):"stretch"==e?(this._width=this.getWidth(),this._height=this.getHeight()):(this._width=this._mediaWidth,this._height=this._mediaHeight),this.setWidth(this._width,!0,!1),this.setHeight(this._height,!0,!1),this.getViewNode().setStyles({width:this._width+"px",height:this._height+"px"}),this._noFlashMode&&this._skinParts.noFlashImg.setSize(this._width,this._height,"px"),this._wCheckForSizeChangeAndFireAutoSized(1)},_onDataChange:function(e){this.parent(),this.fireEvent("propertyChanged",e.getData().displayMode)}})}),define.component("wysiwyg.viewer.components.FlickrBadgeWidget",function(e){var t=e;t.utilize(["core.utils.css.Color"]),t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({iframe:{type:"htmlElement"},overlay:{type:"htmlElement"},overlayClick:{type:"htmlElement"}}),t.binds(["_applyThemeColors","_updateIframeDimensions"]),t.states([]),t.dataTypes(["FlickrBadgeWidget"]),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}},_renderTriggers:[Constants.DisplayEvents.MOVED_IN_DOM,Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED,Constants.DisplayEvents.SKIN_CHANGE],_backgroundColor:void 0,_backgroundAlpha:void 0,_borderColor:void 0,_borderAlpha:void 0,_currentDimensions:{w:-1,h:-1},_totalSizeSamplingAttempts:10,_sizeSamplingAttemptsCount:0}),t.methods({initialize:function(e,t,i){i=i||{},this.parent(e,t,i),this.addEvent("resizeEnd",this._onResizeEnd),this._minimumTimeBetweenRenders=1e3,this._disableResizeHandlers(),this._resizableSides=[],this._iframeDimensions={w:0,h:0}},_disableResizeHandlers:function(){this._resizableSides=[]},_onStyleReady:function(){this.parent(),this._applyThemeColors({propName:"borderColor"}),this._applyThemeColors({propName:"backgroundColor"}),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors)},_applyThemeColors:function(e){var t,i,n;for(var o in e.properties)t=this.injects().Skins.getSkinParamValue(this._skin.className,o,this._style),i=t.getHex(!1),n=t.getAlpha(),"borderColor"==o&&(this._borderColor=i,this._borderAlpha=n),"backgroundColor"==o&&(this._backgroundColor=i,this._backgroundAlpha=n);this._tryRender()},render:function(){this._updateFrameSize(),this._clearFrame(),this.callLater(this._fillFrame,[],100)},_onResizeEnd:function(){this._tryRender()},_clearFrame:function(){var e=this._getFrame();void 0!==e&&(e.src="about:blank")},_getFrame:function(){return this._skinParts?this._skinParts.iframe:void 0},_getOverlay:function(){return this._skinParts?this._skinParts.overlayClick:void 0},_updateFrameSize:function(e,t){var i;e=e||this._view.getWidth()-1,t=t||this._view.getHeight()-1,i=this._getFrame(),i&&i.set({width:e,height:t})},_fillFrame:function(){var e,t={};t.userID=this._data.get("userId"),t.userName=this._data.get("userName"),t.tag=this._data.get("tag"),t.imageCount=this._data.get("imageCount"),t.whichImages=this._data.get("whichImages"),t.imageSize=this._data.get("imageSize"),t.layoutOrientation=this._data.get("layoutOrientation");var i=this._getFlickrEmbedCode(t),n=this._getFrame();void 0!==n&&(this.injects().Utils.prepareIFrameForWrite(n,function(e,t){t.write(i)}.bind(this)),e="http://www.flickr.com/photos/"+t.userID+"/",this._getOverlay().set("href",e),this._sizeSamplingAttemptsCount=0,this.callLater(this._updateIframeDimensions,[],1e3))},_updateIframeDimensions:function(){this._sizeSamplingAttemptsCount++;var e=this._sampleIframeDimensions();e&&(e.w!=this._currentDimensions.w||e.h!=this._currentDimensions.h)&&(this._currentDimensions.w=e.w,this._currentDimensions.h=e.h,this.setWidth(this._currentDimensions.w+5),this.setHeight(this._currentDimensions.h+5),this._updateFrameSize(this._currentDimensions.w+5,this._currentDimensions.h+5),this._wCheckForSizeChangeAndFireAutoSized(0)),this._sizeSamplingAttemptsCount<this._totalSizeSamplingAttempts&&this.callLater(this._updateIframeDimensions,[],500)},_sampleIframeDimensions:function(){var e,t,i=this._getFrame();if(void 0!=i){if(Browser.ie){var n=this._data.get("imageSize")+this._data.get("layoutOrientation");switch(n){case"sv":e=130,t=83+75*this._data.get("imageCount");break;case"tv":e=130,t=83+67*this._data.get("imageCount");break;case"mv":e=260,t=83+160*this._data.get("imageCount");break;case"sh":e=55+75*this._data.get("imageCount"),t=130;break;case"th":e=55+100*this._data.get("imageCount"),t=122;break;case"mh":e=55+240*this._data.get("imageCount"),t=215}}else{var o=i.contentWindow.document.getElementById("flickr_badge_uber_wrapper");o&&(e=o.clientWidth,t=o.clientHeight)}0==isNaN(e)&&0==isNaN(t)&&(this._iframeDimensions.w=e,this._iframeDimensions.h=t)}return this._iframeDimensions},_rgbToHex:function(e){var t;return t=new this.imports.Color(e),t.getHex(!1)},_getFlickrEmbedCode:function(e){var t,i,n="";return void 0!==e.tag&&""!==e.tag?(i="user_tag",t="&tag="+e.tag):(i="user",t=""),Browser.ie&&(n="a:link{color:"+this._backgroundColor+"}a:visited{color:"+this._backgroundColor+"}"),'<style type="text/css">#flickr_badge_source_txt {padding:0; font: 11px Arial, Helvetica, Sans serif; color:#666666;}#flickr_badge_source_txt {padding:0; font: 11px Arial, Helvetica, Sans serif; color:#666666;}#flickr_badge_icon {display:block !important; margin:0 !important; border: 1px solid rgb(0, 0, 0) !important;}#flickr_icon_td {padding:0 5px 0 0 !important;}.flickr_badge_image {text-align:center !important;}.flickr_badge_image img {border: 1px solid black !important;}#flickr_badge_uber_wrapper {width:150px;}#flickr_www {display:block; text-align:center; padding:0 10px 0 10px !important; font: 11px Arial, Helvetica, Sans serif !important; color:#3993ff !important;}#flickr_badge_uber_wrapper a:hover,#flickr_badge_uber_wrapper a:link,#flickr_badge_uber_wrapper a:active,#flickr_badge_uber_wrapper a:visited {text-decoration:none !important; background:inherit !important;}#flickr_badge_wrapper {opacity: '+this._backgroundAlpha+";background-color: "+this._backgroundColor+";border: solid 1px "+this._borderColor+"}"+"#flickr_badge_source {padding:0 !important; font: 11px Arial, Helvetica, Sans serif !important; }"+"body {overflow: hidden;}"+n+"</style>"+'<table id="flickr_badge_uber_wrapper" cellpadding="0" cellspacing="10" border="0"><tr><td><a href="http://www.flickr.com" id="flickr_www">www.<strong style="color:#3993ff">flick<span style="color:#ff1c92">r</span></strong>.com</a><table cellpadding="0" cellspacing="10" border="0" id="flickr_badge_wrapper">'+'<script type="text/javascript" src="http://www.flickr.com/badge_code_v2.gne?show_name=1&count='+e.imageCount+"&display="+e.whichImages+"&size="+e.imageSize+"&layout="+e.layoutOrientation+"&source="+i+"&user="+e.userID+t+'"></script>'+"</table>"+"</td>"+"</tr>"+"</table>"+"</td></tr></table>"}})}),define.component("wysiwyg.viewer.components.FooterContainer",function(e){var t=e;t.inherits("wysiwyg.viewer.components.SiteSegmentContainer")}),define.component("wysiwyg.viewer.components.GoogleMap",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({mapContainer:{type:"htmlElement"}}),t.states(["normal","error"]),t.dataTypes(["GeoMap"]),t.propertiesSchemaType("GoogleMapProperties"),t.fields({_renderTriggers:[Constants.DisplayEvents.MOVED_IN_DOM,Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED],MIN_SIZE:130}),t.methods({initialize:function(e,t,i){i=i||{},this.parent(e,t,i),this.iframeCreated=!1,this.addEvent("resizeEnd",this._renderGoogleMapsIframe)},_editModeChanged:function(e,t){"PREVIEW"==t&&"CURRENT_PAGE"==e&&this.render()},render:function(){this._renderGoogleMapsIframe()},_renderGoogleMapsIframe:function(){this.isReady()&&(this.iframeCreated&&this._skinParts.mapContainer.hasChildNodes()?this._updateIframe():(this._createIframe(),this.iframeCreated=!0))},_createIframe:function(){var e=new IFrame({src:this.injects().Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/googleMap.html",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameBorder:"0",events:{load:function(){this._iframeCreated=!0,this._updateIframe()}.bind(this)}});this._iframe=e,this._skinParts.mapContainer.empty(),this._skinParts.mapContainer.grab(e)},_updateIframe:function(){var e={address:this._data.get("address"),addressInfo:this._data.get("addressInfo"),mapType:this.getComponentProperty("mapType"),mapDragging:this.getComponentProperty("mapDragging"),showZoom:this.getComponentProperty("showZoom"),showPosition:this.getComponentProperty("showPosition"),showStreetView:this.getComponentProperty("showStreetView"),showMapType:this.getComponentProperty("showMapType"),latVal:this._data.get("latitude"),longVal:this._data.get("longitude")};this._iframe.contentWindow.postMessage(JSON.stringify(e),"*")
}})}),define.component("wysiwyg.viewer.components.HeaderContainer",function(e){var t=e;t.inherits("wysiwyg.viewer.components.SiteSegmentContainer")}),define.component("wysiwyg.viewer.components.HorizontalMenu",function(e){var t=e;t.inherits("core.components.BaseRepeater"),t.utilize(["core.components.BaseList","core.components.SimpleButton"]),t.skinParts({repeaterButton:{type:"core.components.MenuButton",repeater:!0,dataRefField:"pages",container:"itemsContainer",hookMethod:"_changePagesRefData",argObject:{listSubType:"PAGES"}},moreButton:{type:"core.components.MenuButton"},itemsContainer:{type:"htmlElement"},moreContainer:{type:"htmlElement"}}),t.binds(["_onButtonDataChange","_onMoreButtonClick","_onThemeChange","_arrangeButtons","_onButtonClick","_onMoreButtonOver","_onMoreButtonOut","_onMoreContainerOver","_onMoreContainerOut","_closeMoreMenu","_onPageChanged"]),t.dataTypes(["Document"]),t.propertiesSchemaType("HorizontalMenuProperties"),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages"}],dblClick:{command:"WEditorCommands.Pages"}},_moreButtonClicked:!1,_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.injects().Theme.addEvent("propertyChange",this._onThemeChange),this._arrangeWaitID=-1,this.injects().Viewer.addEvent("pageTransitionStarted",this._onPageChanged),this._usesExternalData=!0,this._staticWidth=0,this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._hiddenButtonsContainer=new Element("div",{id:"hiddenButtonsContainer",style:"visibility:hidden"}),this._hiddenButtonsContainer.inject(this.getViewNode()),this.getViewNode().setStyle("opacity","0")},_testOverFlow:function(){var e=this._getButtonsWidth();this.injects().Utils.clearCallLater(this._overflowID),0==this._prevButtonsWidth&&(this._prevButtonsWidth=e),e!=this._prevButtonsWidth?this._arrangeButtons():(this._testOverFlowCount--,this._testOverFlowCount>0&&(this._overflowID=this.callLater(this._testOverFlow,[],100)))},_onPageChanged:function(e){var t,i;if(null!=this._skinParts&&this._allButtons)for(t=0;this._allButtons.length>t;t++)this._allButtons[t]&&this._allButtons[t].getViewNode()&&(i=this._allButtons[t],i.getID()==e?i.setState("selected"):i.removeState("selected"),this.injects().Utils.forceBrowserRepaint(i.getViewNode()))},_onThemeChange:function(){this._changeTriggeredBy="themeChange",this._arrangeButtonsDelayed()},_beforeRepeatersCreation:function(){this._allButtons=[]},_onRepeaterItemReady:function(e,t,i,n){n&&t.addEvent("click",function(){this._onButtonClick(i)}.bind(this)),this._allButtons.push(t),this.parent(e,t,i,n)},_onRepeaterReady:function(){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,this._arrangeButtons),this._addPartsListeners(),this._arrangeButtons()},_addPartsListeners:function(){this._skinParts.moreButton.addEvent("over",this._onMoreButtonOver),this._skinParts.moreButton.addEvent("out",this._onMoreButtonOut),this._skinParts.moreButton.addEvent("click",this._onMoreButtonClick),this._skinParts.moreContainer.addEvent("mouseover",this._onMoreContainerOver),this._skinParts.moreContainer.addEvent("mouseout",this._onMoreContainerOut);var e;for(e=0;this._allButtons.length>e;e++)this._allButtons[e]&&this._allButtons[e].getViewNode()&&(this._allButtons[e].getViewNode().uncollapse(),this._allButtons[e].addEvent("dataChanged",this._onButtonDataChange))},render:function(){this.parent(),"styleChange"==this._changeTriggeredBy?this._arrangeButtonsDelayed():this._arrangeButtons()},setSkin:function(e){this._staticWidth=e.staticWidth||0,this.parent(e)},_onButtonDataChange:function(){this._changeTriggeredBy="dataChange",this.render()},_onDataChange:function(e){this.getComponentProperties().removeField("spacing"),this._changeTriggeredBy="dataChange",this.parent(e)},_applySettings:function(){this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._staticWidth>0?this._preWidthModifier=this._staticWidthModifier:(this.getComponentProperty("sameWidthButtons")&&(this._preWidthModifier=this._sameWidthModifier),this.getComponentProperty("stretchButtonsToMenuWidth")&&(this._postWidthModifier=this._stretchToFillModifier))},_skinSizeChange:function(){this._changeTriggeredBy="styleChange",this.parent()},_skinParamsChange:function(e){this._changeTriggeredBy="styleChange",this.parent(e)},_arrangeButtonsDelayed:function(){-1!=this._arrangeWaitID&&this.injects().Utils.clearCallLater(this._arrangeWaitID),this._arrangeWaitID=this.callLater(this._arrangeButtonsCapture,[],100),this._changeTriggeredBy="",this._skinParts.itemsContainer.setStyle("overflow","hidden")},_arrangeButtonsCapture:function(){this._arrangeButtons(),-1!=this._arrangeWaitID&&this._arrangeButtonsDelayed()},_arrangeButtons:function(){if(void 0!=this._skinParts&&this._allButtons&&0!=this._allButtons.length&&this._isDisplayed&&this.isReady()){this.getViewNode().setStyle("opacity","1"),this.injects().Utils.clearCallLater(this._overflowID),this._prevButtonsWidth=0,this._arrangeWaitID=-1,this._applySettings();var e=this._allButtons[0]&&this._allButtons[0].getViewNode()?this._allButtons[0].getViewNode().getStyle("-webkit-transition-duration"):0;this._initItemsContainer(),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.itemsContainer.setStyle("white-space","normal"),this._initMoreContainer(),this._skinParts.moreButton.setLabel(this.getComponentProperty("moreButtonLabel")),this._skinParts.moreButton.skipMe=!0;var t=this._getDisplayedButtons();if(t.length){t.push(this._skinParts.moreButton);var i=this._getSampleButton();this._sampleButtonBorder(i),this._setMinimumDimensions(i),this._preArrangeButtons(t),this._preWidthModifier(t),this._calculateButtonsAmount(t),this.setMinW(t[0].getViewNode().offsetWidth),this._postWidthModifier(t),this._arrangeMoreContainer(),t=this._getDisplayedButtons(),t.push(this._skinParts.moreButton),this._alignButtonsText(t);var n;for(n=0;t.length>n;n++){var o=t[n];o.getViewNode().setStyle("-webkit-transition-duration",e)}this._skinParts.itemsContainer.setStyle("overflow","visible"),this._skinParts.itemsContainer.setStyle("white-space","nowrap"),this._setListPositions(),this._testOverFlow()}}},_calculateButtonsAmount:function(e){e=this._arrangementAlgorithm(e),this._skinParts.moreButton.skipMe&&(this._skinParts.moreButton.getViewNode().setStyle("visibility","hidden"),this._skinParts.moreButton.getViewNode().inject(this._skinParts.moreContainer),e[e.length-1]===this._skinParts.moreButton&&e.pop())},_getButtonsWidth:function(){var e=0;for(i=0;this._skinParts.itemsContainer.children.length>i;i++)e+=this._skinParts.itemsContainer.children[i].getLogic().getWidthOnLayout();return e},_getDisplayedButtons:function(){var e,t=[];for(e=0;this._allButtons.length>e;e++)this._allButtons[e]&&this._allButtons[e].getDataItem()&&!this._allButtons[e].getDataItem()._data.hidePage?t.push(this._allButtons[e]):this._allButtons[e]&&this._allButtons[e].getViewNode()&&(this._allButtons[e].getViewNode().setStyle("visibility","inherit"),this._allButtons[e].getViewNode().inject(this._hiddenButtonsContainer));return t},_setListPositions:function(){var e,t,i;for(e=0;this._skinParts.itemsContainer.children.length>e;e++)t=this._skinParts.itemsContainer.children[e],i=0==e&&this._setPositionForFirst()?"first":e==this._skinParts.itemsContainer.children.length-1&&this._setPositionForLast()?"last":"center",t.setProperty("listposition",i);for(e=0;this._skinParts.moreContainer.children.length>e;e++)t=this._skinParts.moreContainer.children[e],t.setProperty("listposition","more")},_setPositionForFirst:function(){var e=!1;return this._postWidthModifier==this._stretchToFillModifier?e=!0:"left"==this.getComponentProperty("alignButtons")&&(e=!0),e},_setPositionForLast:function(){var e=!1;return this._postWidthModifier==this._stretchToFillModifier?e=!0:"right"==this.getComponentProperty("alignButtons")&&(e=!0),e},_getSampleButton:function(){return this._allButtons[0]&&this._allButtons[0].getViewNode()&&"visible"==this._allButtons[0].getViewNode().getStyle("visibility")?this._allButtons[0]:this._skinParts.moreButton},_sampleButtonBorder:function(e){this._buttonsBorder=e._skinParts.borderWrapper?this._getBorder(e._skinParts.borderWrapper):this._getBorder(e.getViewNode())},_setMinimumDimensions:function(e){e._skinParts.label.setStyle("line-height","100%");var t=0;e.getSkin()&&!isNaN(e.getSkin().addToMinH)&&(t=e.getSkin().addToMinH);var i=this._getBorder(this._skinParts.itemsContainer).y+this._buttonsBorder.y;this.setMinH(t+i+parseInt(e._skinParts.label.getComputedStyle("line-height"),10))},_initItemsContainer:function(){this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignButtons"));var e=this.getHeight()-this._getBorder(this._skinParts.itemsContainer).y-this._getMargin(this._skinParts.itemsContainer).y,t=this.getWidth()-this._getBorder(this._skinParts.itemsContainer).x-this._getMargin(this._skinParts.itemsContainer).x;this._skinParts.itemsContainer.setStyle("height",e+"px"),this._skinParts.itemsContainer.setStyle("width",t+"px")},_initMoreContainer:function(){this._skinParts.moreContainer.setStyle("visibility","hidden"),this._skinParts.moreContainer.setStyle("opacity","0"),this._skinParts.moreContainer.setStyle("width","0px"),this._skinParts.moreContainer.setStyle("left","0px")},_preArrangeButtons:function(e){var t;for(t=0;e.length>t;t++){var i=e[t];i.getViewNode().setStyle("visibility","inherit"),i.getViewNode().setStyle("-webkit-transition-duration","0s"),i.getViewNode().inject(this._skinParts.moreContainer),i._skinParts.bg.setStyle("padding","0px 0px")}},_arrangeMoreContainer:function(){var e,t,i=this._skinParts.moreButton.getViewNode().offsetWidth;for(e=0;this._skinParts.moreContainer.children.length>e;e++)t=this._skinParts.moreContainer.children[e],i=Math.max(i,t.offsetWidth);for(this._skinParts.moreContainer.setStyle("width",i+"px"),e=0;this._skinParts.moreContainer.children.length>e;e++)t=this._skinParts.moreContainer.children[e],this._fillWidthByPadding(t,i);var n=this._skinParts.moreButton.getViewNode().offsetLeft;isNaN(n)||this._skinParts.moreContainer.setStyle("left",n+"px")},_alignButtonsText:function(e){var t;for(t=0;e.length>t;t++){var i=e[t].getViewNode(),n=parseInt(i.getLogic()._skinParts.bg.getComputedStyle("padding-left"),10)+parseInt(i.getLogic()._skinParts.bg.getComputedStyle("padding-right"),10);switch(this.getComponentProperty("alignText")){case"left":i.getLogic()._skinParts.bg.setStyle("padding-left","0px"),i.getLogic()._skinParts.bg.setStyle("padding-right",n+"px");break;case"right":i.getLogic()._skinParts.bg.setStyle("padding-left",n+"px"),i.getLogic()._skinParts.bg.setStyle("padding-right","0px")}}},_setPadding:function(e,t){e.getLogic()._skinParts.bg.setStyle("padding","0px "+t+"px")},_fillWidthByPadding:function(e,t){var i=parseInt(e.getLogic()._skinParts.bg.getComputedStyle("padding-left"),10),n=i+Math.floor((t-e.offsetWidth)/2);this._setPadding(e,n)},_arrangementAlgorithm:function(e){for(var t=!1;!t;)if(t=this._arrangementIteration(e),!t)if(1==e.length)t=!0;else{this._skinParts.moreButton.skipMe=!1;var i=e.splice(e.length-2,1)[0];i.getViewNode().setStyle("visibility","inherit"),i.getViewNode().inject(this._skinParts.moreContainer,"top")}return e},_stretchToFillModifier:function(e,t){function i(e,t){if(d>0){var i=Math.floor(r/d),o=parseInt(e._skinParts.bg.getStyle(t),10);n&&(l._buttonsPadding[e]||(l._buttonsPadding[e]={}),l._buttonsPadding[e][t]=o),e._skinParts.bg.setStyle(t,o+i+"px"),d--,r-=i}}t=t||0;var n=!1;0==t&&(n=!0,this._buttonsPadding={});var o,s=this._getButtonsWidth(),a=parseInt(this._skinParts.itemsContainer.getStyle("width"),10),r=a-s-t-1;Browser.ie&&(r-=1),r=Math.max(r,0);var l=this;if(e.length>0){var d=2*e.length;for(o=0;e.length/2>o;o++){var c=e[o],h=e[e.length-o-1];i(c,"padding-left"),i(h,"padding-right"),i(c,"padding-right"),i(h,"padding-left")}}if(this._skinParts.itemsContainer.scrollHeight-e[0].getViewNode().offsetHeight>=e[0].getViewNode().offsetHeight){for(o=0;e.length>o;o++){var p=e[o];p._skinParts.bg.setStyle("padding-left",this._buttonsPadding[p]["padding-left"]),p._skinParts.bg.setStyle("padding-right",this._buttonsPadding[p]["padding-left"])}if(t>20)return;this._stretchToFillModifier(e,t+1)}},_sameWidthModifier:function(e){var t,i,n=0;for(t=0;e.length>t;t++){i=e[t];var o=parseInt(i.getViewNode().offsetWidth-this._buttonsBorder.x,10);isNaN(o)||(n=Math.max(n,o))}if(n>0)for(t=0;e.length>t;t++)i=e[t],this._fillWidthByPadding(i.getViewNode(),n)},_staticWidthModifier:function(e){var t,i;for(t=0;e.length>t;t++)i=e[t],i.offsetWidth<this._staticWidth?this._fillWidthByPadding(i.getViewNode(),this._staticWidth):i.getViewNode().setStyle("width",this._staticWidth+"px")},_nullModifier:function(){},_arrangementIteration:function(e){var t,i;for(i=0;e.length>i;i++){var n=e[i];n.skipMe?n.collapse():(n.uncollapse(),n.getViewNode().setStyle("visibility","visible"),n.getViewNode().inject(this._skinParts.itemsContainer),t=parseInt(this._skinParts.itemsContainer.getStyle("height"),10)-this._buttonsBorder.y,n.getViewNode().setStyle("height",t+"px"),void 0!=n._skinParts.labelPad&&(t-=n._skinParts.labelPad.offsetHeight),n._skinParts.label.setStyle("line-height",t+"px"),n._skinParts.label.setStyle("width","auto"))}return this._skinParts.itemsContainer.scrollHeight-e[0].getViewNode().offsetHeight<e[0].getViewNode().offsetHeight},_getBorder:function(e){var t=0,i=0;return e&&(t=parseInt(e.getStyle("border-left-width"),10)+parseInt(e.getStyle("border-right-width"),10),i=parseInt(e.getStyle("border-top-width"),10)+parseInt(e.getStyle("border-bottom-width"),10)),{x:t,y:i}},_getMargin:function(e){var t=0,i=0;return e&&(t=parseInt(e.getStyle("margin-left"),10)+parseInt(e.getStyle("margin-right"),10),i=parseInt(e.getStyle("margin-top"),10)+parseInt(e.getStyle("margin-bottom"),10)),{x:t,y:i}},_onResize:function(){this._arrangeButtons()},_onButtonClick:function(e){this.injects().Viewer.goToPage(e.get("id"))},_openMoreMenu:function(){this._skinParts.moreButton.setState("selected"),this._skinParts.moreContainer.setStyle("visibility","visible"),this._skinParts.moreContainer.setStyle("opacity","1"),this._isMoreContainerOpen=!0,this._toCloseMoreMenu=!1,this.injects().Utils.forceBrowserRepaint(this._skinParts.moreButton.getViewNode()),this.injects().Utils.forceBrowserRepaint(this._skinParts.moreContainer)},_closeMoreMenuTimer:function(){this.injects().Utils.clearCallLater(this._closeMoreMenuTimerID),this._closeMoreMenuTimerID=this.injects().Utils.callLater(this._closeMoreMenu,[],this,500)},_closeMoreMenu:function(e){(e||this._toCloseMoreMenu)&&(this._skinParts.moreButton.removeState("selected"),this._skinParts.moreContainer.setStyle("visibility","hidden"),this._skinParts.moreContainer.setStyle("opacity","0"),this._toCloseMoreMenu=!1,this._isMoreContainerOpen=!1,this._moreButtonClicked=!1)},_forceCloseMoreMenu:function(){this._closeMoreMenu(!0)},_onMoreButtonOver:function(){this._toCloseMoreMenu=!1,this._moreButtonClicked||this._openMoreMenu()},_onMoreButtonOut:function(){this._toCloseMoreMenu=!0,this._closeMoreMenuTimer()},_onMoreContainerOver:function(){this._toCloseMoreMenu=!1},_onMoreButtonClick:function(){this._moreButtonClicked=!0,this._isMoreContainerOpen===!1?this._openMoreMenu():this._forceCloseMoreMenu()},_onMoreContainerOut:function(){this._toCloseMoreMenu=!0,this._closeMoreMenuTimer()},dispose:function(){this.injects().Viewer.removeEvent("pageTransitionStarted",this._onPageChanged),this.injects().Theme.removeEvent("propertyChange",this._onThemeChange),this.parent()}})}),define.component("wysiwyg.viewer.components.HtmlComponent",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize(["core.components.base.SizeLimits"]),t.resources([]),t.binds([]),t.traits([]),t.skinParts({iFrameHolder:{type:"htmlElement"}}),t.dataTypes(["HtmlComponent"]),t.states(["hasContent","noContent"]),t.propertiesSchemaType(""),t.statics({MAX_HTML_COMPONENT_HEIGHT_DEFAULT:5e3}),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.addEvent("resizeEnd",this._onResizeEnd),this._iframe=null,this._renderOnResize=!1},_onViewModeChanged:function(){"PREVIEW"!=this.resources.W.Viewer.getEditorMode()&&(this._iframe.set("src","about:blank"),this._setFrameWithSrc(this._iframe))},_onResizeEnd:function(){this._iframe&&(this._iframe.width=this._view.getWidth(),this._iframe.height=this._view.getHeight()),this._renderOnResize&&this._renderIfReady()},render:function(){this._createIFrame(this._view.getWidth(),this._view.getHeight()),this.setState(this.hasContent()?"hasContent":"noContent"),this.hasContent()&&this._setFrameWithSrc(this._iframe)},getSizeLimits:function(){return void 0===this._sizeLimits&&(this._sizeLimits=new this.imports.SizeLimits,this._sizeLimits.minW=this._sizeLimits.minW||this.MINIMUM_WIDTH_DEFAULT,this._sizeLimits.minH=this._sizeLimits.minH||this.MINIMUM_HEIGHT_DEFAULT,this._sizeLimits.maxW=this._sizeLimits.maxW||this.MAXIMUM_WIDTH_DEFAULT,this._sizeLimits.maxH=this._sizeLimits.maxH||this.MAX_HTML_COMPONENT_HEIGHT_DEFAULT,this._originalSizeLimits=this._sizeLimits.clone()),this._sizeLimits},getIFrameSrc:function(){var e=this._data.get("url"),t=/^(ftps|ftp|http|https).*$/;return t.test(e)||(e="http://"+e),e},hasContent:function(){return!!this._data.get("url")},_createIFrame:function(e,t){var i=new IFrame;i.width=e,i.height=t,navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&this._view.setStyles({overflow:"scroll","-webkit-overflow-scrolling":"touch"}),this._iframe?i.replaces(this._iframe):i.insertInto(this._skinParts.iFrameHolder),this._iframe=i},_setFrameWithSrc:function(e){e.set("src",this.getIFrameSrc())}})}),define.component("wysiwyg.viewer.components.IFrameComponent",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.methods({initialize:function(e,t,i){i=i||{},this.parent(e,t,i),this._iframe=null},render:function(){this._renderIframe()},_onResize:function(){this.parent(),this._skinParts&&this._renderIframe()},_renderIframe:function(e){this._iframe?this._updateIframe(e):this._createIframe()},_createIframe:function(){this._iframe=new IFrame({src:"about:blank",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameborder:"0",scrolling:"no"}),this._setBasicIframeParams(),this._setIframeParams(),this._iframe.insertInto(this._getIframeContainer())},_getIframeContainer:function(){return this._view},_changeSize:function(e,t){var i=this.getWidth(),n=this.getHeight(),o=e.x||e.w||e.width,s=e.y||e.h||e.height;o&&o!=i&&(this.setWidth(o,!1,!s&&t),this._iframe.setStyle("width",o+"px")),s&&s!=n&&(this.setHeight(s,!1,t),this._iframe.setStyle("height",s+"px")),this._wCheckForSizeChangeAndFireAutoSized(1)},_updateIframe:function(e){this._setBasicIframeParams(e),this._setIframeParams()},_setBasicIframeParams:function(e){e=e||!1;var t=this._getUrl(e);(e||this._iframe.src!==t)&&this.setIFrameSrc(t),this._iframe.width=this.getWidth(),this._iframe.height=this.getHeight()},setIFrameSrc:function(e){this._iframe.src=e},_setIframeParams:function(){},_getUrl:function(){throw Error("IFrameComponent::_getUrl() must be overridden.")},getIFrame:function(){return this._iframe}})}),define.component("wysiwyg.viewer.components.ImageLite",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize(["core.components.image.ImageUrl"]),t.dataTypes(["Image"]),t.fields({_currentUri:""}),t.methods({initialize:function(e,t,i){this.parent(e,t,i)},_onAllSkinPartsReady:function(){this._img||(this._img=new Element("img"),this._view.adopt(this._img))},render:function(){var e=this._view.getSize();this.setSize(e.x,e.y)},setOwner:function(){},invalidateSize:function(){},setSize:function(e,t){this._imgWidth=parseInt(this._data.get("width")),this._imgHeight=parseInt(this._data.get("height"));var i={width:parseInt(e),height:parseInt(t),overflow:"hidden"};this._view.setStyles(i);var n=e,o=e*(this._imgHeight/this._imgWidth);t>o&&(o=t,n=t*(this._imgWidth/this._imgHeight));var s=(t-o)/2;s=0>s?s:0;var a=(e-n)/2;a=0>a?a:0;var r=(new this.imports.ImageUrl).getImageUrlFromPyramid({x:parseInt(n),y:parseInt(o)},this._data.get("uri")).url;this._currentUri!==r&&(this._currentUri=r,this._img.setAttribute("src",r));var l={position:"static",width:Math.round(n)+1,height:parseInt(o),"margin-top":parseInt(s),"margin-left":parseInt(a),"box-shadow":"#000 0 0 0","image-rendering":"optimizequality"};this._img.setStyles(l)}})}),define.component("wysiwyg.viewer.components.LazySocialPanel",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["onHover"]),t.skinParts({placeHolder:{type:"htmlElement"},fbLike:{type:"htmlElement"},twitterShare:{type:"htmlElement"},googlePlus:{type:"htmlElement"}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i);var n="";this.injects().Viewer.getCurrentPageNode()&&(n=this.injects().Viewer.getCurrentPageNode().getLogic().getDataItem().getData().title),location.href,this._buttons={fbLike:{type:"wysiwyg.viewer.components.WFacebookLike",skin:"skins.core.FacebookLikeSkin",data:null,args:{propObj:{layout:"button_count"}}},twitterShare:{type:"wysiwyg.viewer.components.WTwitterTweet",skin:"mobile.core.skins.TwitterTweetSkin",data:this.injects().Data.createDataItem({defaultText:n+" ~ ",accountToFollow:"",type:"TwitterTweet"},"TwitterTweet"),args:null},googlePlus:{type:"wysiwyg.viewer.components.WGooglePlusOne",skin:"mobile.core.skins.GooglePlusOneSkin",data:null,args:{annotation:"small_bubble",size:"medium",width:{w:50,h:15}}}}},render:function(){this._skinParts.placeHolder.addEvent("mouseover",this.onHover)},onHover:function(){this._skinParts.placeHolder.removeEvent("mouseover",this.onHover),this._skinParts.placeHolder.dispose(),this._addService(this._buttons.twitterShare,this._skinParts.twitterShare),this._addService(this._buttons.fbLike,this._skinParts.fbLike)},_addService:function(e,t){this.injects().Components.createComponent({type:e.type,skin:e.skin,data:e.data,args:e.args}).insertInto(t)}})}),define.component("wysiwyg.viewer.components.LinkBar",function(e){var t=e;t.inherits("core.components.BaseRepeater"),t.binds(["_setComponentSize"]),t.skinParts({imageItem:{type:"wysiwyg.viewer.components.LinkBarItem",repeater:!0,container:"itemsContainer",dataRefField:"items",argObject:{unit:"px"}},itemsContainer:{type:"htmlElement"}}),t.propertiesSchemaType("LinkBarProperties"),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"SOCIAL_BAR_MNG_ICONS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"social_icons"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"social_icons"},commandParameterDataRef:"SELF"}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._resizableSides=[],this.setMaxH(9999),this.setMaxW(9999)},_onDataChange:function(){this.parent()},getAcceptableDataTypes:function(){return["ImageList"]},render:function(){this._iconSize=this.getComponentProperty("iconSize")||30,this._orientation=this.getComponentProperty("orientation"),this._spacing=this.getComponentProperty("spacing"),this._bgScale=this.getComponentProperty("bgScale"),this._setComponentSize()},_processDataRefs:function(e){return e},_onRepeaterReady:function(e){this._itemsAmount=e.itemsAmount,this._items=e.readyItemsLogic},_setComponentSize:function(){for(var e=0,t=0,i="HORIZ"==this._orientation,n=0;this._items.length>n;n++){var o=this._items[n],s=o.getViewNode(),a=this._spacing;n==this._items.length-1&&(a=0),o.setSize(this._iconSize,a,this._bgScale,i);var r=s.offsetWidth,l=s.offsetHeight;i?(s.setStyle("display","inline-block"),t=Math.max(t,l),e+=r):(s.setStyle("display","block"),t+=l,e=Math.max(e,r))}this.setWidth(e+5,!0),this.setHeight(t,!0),this._wCheckForSizeChangeAndFireAutoSized(3)}})}),define.component("wysiwyg.viewer.components.LinkBarItem",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["_onMouseOver","_onMouseOut","_onLinkMouseDown","_onImageStateChange"]),t.traits(["wysiwyg.common.components.traits.LinkableComponent"]),t.skinParts({image:{type:"core.components.Image",dataRefField:"*",optional:!1},imageBG:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!1}}),t.dataTypes(["Image"]),t.states(["loading","normal","rollover"]),t.fields({_parentList:null}),t.methods({initialize:function(e,t,i){this.parent(e,t,i)},setParentList:function(e){this._parentList=e},_onImageStateChange:function(){switch(this._skinParts.image.getState()){case"loading":this.setState("loading");break;case"loaded":this.setState("normal")}},_onMouseOver:function(){"normal"==this.getState()&&this.setState("rollover")},_onMouseOut:function(){"rollover"==this.getState()&&this.setState("normal")},_onLinkMouseDown:function(){var e=this._data.get("link"),t=this._data.get("target")||"_blank";e&&window.open(e,t)},setSize:function(e,t,i,n){var o,s;n?(o=t,s=0):(o=0,s=t);var a,r={};this._skinParts.image.setSize(e,e,"px"),a=e,r.x=r.y=a/2,this._skinParts.image.getViewNode().setStyles({left:r.x-e/2,top:r.y-e/2}),this.getViewNode().setStyles({width:a+o+""+"px",height:a+s+""+"px"})},_onDataChange:function(){this.parent()},_onAllSkinPartsReady:function(){this.parent()},_onResize:function(){this.parent(),this._skinParts.image&&(this._skinParts.image._invalidate("size"),this._skinParts.image._renderIfReady())},getAcceptableDataTypes:function(){return[]},getImageRef:function(){var e="";return this._skinParts&&(e=this._skinParts.image.getDataItem().get("id")+""),e}})}),define.component("wysiwyg.viewer.components.LoginButton",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["_onStyleChange"]),t.skinParts({container:{type:"htmlElement"},actionTitle:{type:"htmlElement"},memberTitle:{type:"htmlElement"}}),t.states(["auth","no_auth"]),t.statics({SIGN_IN:"Login/Sign up",SIGN_OUT:"Log out",HELLO:"Hello"}),t.methods({initialize:function(e,t,i){this.parent(e,t,i)},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChange)},_onStyleChange:function(){this._centerButton(),this._wCheckForSizeChangeAndFireAutoSized(10)},render:function(){this.parent(),this._updateTextsAndEvents(),this._centerButton()},_updateTextsAndEvents:function(){var e=this._skinParts,t=this.injects().SiteMembers,i=e.actionTitle,n=e.memberTitle,o=this;this.injects().SiteMembers.isLoggedIn()?(i.set("text",this.SIGN_OUT),i.addEvent("click",function(){t.logout(),i.removeEvent("click",arguments.callee),setTimeout(function(){location.reload()},500)}),this.injects().SiteMembers.getMemberDetails(function(e){var t=e.attributes&&e.attributes.name||e.email;n.set("text",this.HELLO+" "+t)}.bind(this)),this.setState("auth")):(i.set("text",this.SIGN_IN),i.addEvent("click",function(){t.openSiteMembersPopup({authCallback:function(e){1==e.authResponse&&o._renderIfReady()}}),i.removeEvent("click",arguments.callee)}.bind(this)),n.set("text",""),this.setState("no_auth"))},_centerButton:function(){var e=this._skinParts.container,t=e.getSize(),i=t.x,n=t.y,o=this.getHeight()-n;this.getWidth()-i,e.setStyle("margin-top",o/2),this._skinParts.actionTitle.setStyle("width",this.getWidth()),this._skinParts.memberTitle.setStyle("width",this.getWidth()),this.setMinH(n)},_onResize:function(){this._centerButton(),this.parent()}})}),define.component("wysiwyg.viewer.components.MatrixGallery",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),t.binds(["_increaseTotalMaxRows","_sequencingHook"]),t.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"itemsContainer",dataRefField:"items",argObject:{unit:"px"}},itemsContainer:{type:"htmlElement"},showMore:{type:"htmlElement"}}),t.states(["fullView","hiddenChildren"]),t.propertiesSchemaType("MatrixGalleryProperties"),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery"},commandParameterDataRef:"SELF"}},_itemsRef:[],_galleryItems:[],_totalMaxRows:0,_numCols:0,_numRows:0,_gap:0,_itemWidth:-1,_itemHeight:-1,_transitionProp:"",_numItems:0,_imageMode:"",_transitionsOn:!0,_Tween:null,_widthDiff:0,_heightDiff:0,_minDisplayerWidth:5,_minDisplayerHeight:5,_renderingPhase:"normal"}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._transitionProp=this.injects().Utils.getCSSBrowserFeature("transition"),this._Tween=this.injects().Utils.Tween,this.setMaxW(1e4),this.setMaxH(1e4),this._sequencer=new this.imports.ComponentSequencer,this._sequencer.resolveItem=i&&i.sequencingHook?i.sequencingHook:this._sequencingHook},_sequencingHook:function(){return{comp:"wysiwyg.viewer.components.Displayer",skin:this._skin.compParts.imageItem.skin}},_onDataChange:function(){var e,t;this._numItems=this._data.get("items").length,this._numCols=parseInt(this.getComponentProperty("numCols")),this._numRows=this._getRowNumber(),this._gap=parseInt(this.getComponentProperty("margin")),this._imageMode=this.getComponentProperty("imageMode")+"",this._updateState(),-1==this._itemWidth?this._calculateItemSize():this._numItems>0&&(e=Math.round(this._numCols*this._itemWidth+(this._numCols-1)*this._gap),t=Math.round(this._numRows*this._itemHeight+(this._numRows-1)*this._gap),this._setContainerWidth(e),this._setContainerHeight(t),this._positionAllItems(),this.fireEvent("autoSized")),this._updateSizeLimits(),this.parent()},_getRowNumber:function(){var e=parseInt(this.getComponentProperty("numCols")),t=parseInt(this.getComponentProperty("maxRows"));return this._numItems&&t*e>this._numItems?this._normalizeRows(t):t},_updateSizeLimits:function(){this.setMinW(this._numCols*(this._minDisplayerWidth+this._gap)+this._widthDiff-this._gap),this.setMinH(this._numRows*(this._minDisplayerHeight+this._gap)+this._heightDiff-this._gap)},_editModeChanged:function(e,t){this.parent(e),"PREVIEW"==t&&this._setTotalMaxRows(this._getRowNumber())},_setContainerWidth:function(e){var t=e+this._widthDiff;this._skinParts.itemsContainer.setStyle("width",e+""+"px"),this._view.setStyle("width",t+""+"px"),this.setWidth(t,!1,!1)},_setContainerHeight:function(e){var t=e+this._heightDiff;this._skinParts.itemsContainer.setStyle("height",e+""+"px"),this.setHeight(t,!1,!1),this._view.setStyle("height",t+""+"px")},_updateContainerSize:function(){var e=this._view.getSize();(0==e.x||0==e.y)&&(e.x=this.getWidth(),e.y=this.getHeight());var t=e.x-this._widthDiff,i=e.y-this._heightDiff;this._skinParts.itemsContainer.setStyles({width:t+"px",height:i+"px"})},_calculateItemSize:function(){if(this._skinParts&&this._data.get("items").length>0){var e=this._view.getSize();(0==e.x||0==e.y)&&(e.x=this.getWidth(),e.y=this.getHeight());var t=e.x-this._widthDiff,i=e.y-this._heightDiff;this._itemWidth=Math.max(Math.floor((t-(this._numCols-1)*this._gap)/this._numCols),0),this._itemHeight=Math.max(Math.floor((i-(this._numRows-1)*this._gap)/this._numRows),0)}},_onAllSkinPartsReady:function(){var e=this.getComponentProperty("galleryImageOnClickAction"),t=this.getComponentProperty("expandEnabled");"unset"===e&&(t===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._sequencer.addEvent("componentSetup",function(e){this._onDisplayerCreation(e.compView.getLogic(),e.method,e.index)}.bind(this)),this._sequencer.addEvent("productionFinished",function(e){this._onSequencerFinished(e)
}.bind(this)),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.showMore&&(this._skinParts.showMore.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._increaseTotalMaxRows),this._skinParts.showMore.setStyles({"white-space":"nowrap"})),this._widthDiff=this._skin.widthDiff||0,this._heightDiff=this._skin.heightDiff||0,this._calculateItemSize(),this._updateSizeLimits(),this._setCorrectedComponentSize(),this._updateContainerSize()},getAcceptableDataTypes:function(){return["ImageList"]},render:function(){this._newItems=[],this._sequencer.createComponents(this._skinParts.itemsContainer,this._data.get("items").slice(0,this._numCols*this._numRows))},_onSequencerFinished:function(e){this._renderingPhase="normal",this._galleryItems=e.elements,this._totalMaxRows=this.getComponentProperty("maxRows"),this._positionAllItems(),this._setupAllItems()},_setupItem:function(e){if(e.getLogic){var t=e.getLogic();t.setOwner(this),t.invalidateSize(),t.setSize(this._itemWidth,this._itemHeight,this._imageMode),this._transitionsOn&&1>parseFloat(e.getStyle("opacity"))&&(this._transitionProp?(e.setStyle(this._transitionProp,"opacity 1s"),setTimeout(function(){e.setStyle("opacity","1.0")},150)):this._Tween.to(e,1,{opacity:1}))}},_onDisplayerCreation:function(e,t){"create"==t&&"showMore"==this._renderingPhase&&e.getViewNode().setStyle("opacity","0.0")},_normalizeRows:function(e){var t=Math.floor(this._numItems/this._numCols)+(this._numItems%this._numCols>0?1:0);return Math.min(e,t)},_updateState:function(){this._numItems<=this._numRows*this._numCols?this.setState("fullView"):this.setState("hiddenChildren")},_positionAllItems:function(e){e=e||this._galleryItems;for(var t=0;e.length>t;t++){var i=this._calcItemPosition(t);e[t].setStyles({position:"absolute",left:i.left+"px",top:i.top+"px"})}},_calcItemPosition:function(e){var t=e%this._numCols,i=Math.floor((e-t)/this._numCols);return{left:t*(this._itemWidth+this._gap),top:i*(this._itemHeight+this._gap),width:this._itemWidth+this._gap,height:this._itemHeight+this._gap}},_setupAllItems:function(e){e=e||this._galleryItems;for(var t=0;e.length>t;t++)this._setupItem(e[t])},_setCorrectedComponentSize:function(){var e=this.getWidth()-(this.getWidth()-this._widthDiff-this._gap*(this._numCols-1))%this._numCols,t=this.getHeight()-(this.getHeight()-this._heightDiff-this._gap*(this._numRows-1))%this._numRows;this._view.setStyles({width:e,height:t}),this.setWidth(e,!1,!1),this.setHeight(t,!1,!1)},_onResize:function(){this.parent(),this._skinParts&&(this._calculateItemSize(),this._setCorrectedComponentSize(),this._updateContainerSize(),this._positionAllItems(),this._setupAllItems())},_checkExtremeValues:function(){if(this._itemWidth<this._minDisplayerWidth){var e=this.getWidth()-this._widthDiff;this._itemWidth=this._minDisplayerWidth,this._gap=Math.floor((e-this._numCols*this._itemWidth)/(this._numCols-1)),this.setComponentProperty("margin",this._gap)}else if(this._itemHeight<this._minDisplayerHeight){var t=this.getHeight()-this._heightDiff;this._itemHeight=this._minDisplayerHeight,this._gap=Math.floor((t-this._numRows*this._itemHeight)/(this._numRows-1)),this.setComponentProperty("margin",this._gap)}},_increaseTotalMaxRows:function(){this._setTotalMaxRows(this._normalizeRows(this._numRows+parseInt(this.getComponentProperty("incRows"))))},_setTotalMaxRows:function(e){this._numRows=e;var t=Math.floor(this._numRows*this._itemHeight+(this._numRows-1)*this._gap);this._updateState(),this._setContainerHeight(t),this._calculateItemSize(),this.fireEvent("autoSized"),this._renderingPhase="showMore",this.render()},getSequencer:function(){return this._sequencer}})}),define.component("wysiwyg.viewer.components.MediaZoom",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["_handleCurrentItemChange","_transitionToCurrentDisplayer"]),t.traits(["wysiwyg.viewer.components.traits.ListIterator"]),t.skinParts({blockingLayer:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Close"},dialogBox:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Close"},virtualContainer:{type:"htmlElement"},itemsContainer:{type:"htmlElement"},counter:{type:"htmlElement"},buttonPrev:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Prev"},buttonNext:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Next"}}),t.fields({transitionTime:"normal",_inTransition:!1,_lastCurrentItem:null}),t.methods({initialize:function(e,t,i){this.isVolatile=!0,this.parent(e,t,i);var n=this.injects().Commands;n.registerCommandAndListener("WViewerCommands.MediaZoom.Close",this,this._closeZoom,null,!0),n.registerCommandAndListener("WViewerCommands.MediaZoom.Next",this,this.gotoNext,null,!0),n.registerCommandAndListener("WViewerCommands.MediaZoom.Prev",this,this.gotoPrev,null,!0),n.registerCommandAndListener("WPreviewCommands.WEditModeChanged",this,this._editModeChanged,null,!0),this.addEvent("currentItemChanged",this._handleCurrentItemChange),this.collapse()},_onAllSkinPartsReady:function(){var e=function(e){e.stopPropagation()};this._skinParts.dialogBox.addEvent("click",e),this._skinParts.buttonNext.addEvent("click",e),this._skinParts.buttonPrev.addEvent("click",e),this._skinParts.xButton.addEvent("click",e)},setGallery:function(e,t,i,n,o){this._validateArgs(e,t)&&(this._opened=!0,this._getDisplayerDivFunction=i,this._getHashPartsFunction=n,this._extraParams=o||{},this.setDataItem(e),this.setListAndCurrentIndex(e,t),this._setNextPrevVisibility())},setImage:function(e,t,i){var n=this.injects().Data.createDataItem({type:"list",items:[e]});this.setGallery(n,0,t,i)},showZoomImage:function(){if(this._currentItem&&this._currentItem!=this._lastCurrentItem){var e=this.injects().Utils.getWindowSize(),t=this.getSkin().getParams().first(function(e){return"$marginIncludingArrow"===e.id});this._imageMaxWidth=e.width-2*t.defaultValue,this._imageMaxHeight=e.height-60,this._lastCurrentItem=this._currentItem,this._renderCurrentDisplayer(this._transitionToCurrentDisplayer),this._skinParts.counter.set("text",this._currentItemIndex+1+""+"/"+(this._numItems+"")),this.injects().Viewer.enterFullScreenMode(),this.uncollapse()}},_editModeChanged:function(){this._isDisposed||(this._closeZoom(),this.injects().Viewer.removeZoomElement(),this.dispose())},_closeZoom:function(){this.collapse(),this.injects().Viewer.exitFullScreenMode(),this.setDataItem(null),this.resetIterator(),this._skinParts.virtualContainer.empty(),this._skinParts.itemsContainer.empty(),this._skinParts.dialogBox.setStyles({width:"100px"}),this._opened=!1,this.unlock(),this._lastCurrentItem=null},_handleCurrentItemChange:function(){this.lock();var e=function(e){var t=this.injects().Utils.hash.getHashParts();t.id===e.id&&t.extData===e.extData?this.showZoomImage():this.injects().Utils.hash.setHash(e.id,e.title,e.extData,!0)}.bind(this);this._getHashPartsFunction?this._getHashPartsFunction(this._currentItem,e):this.showZoomImage()},_renderCurrentDisplayer:function(){for(var e=this._skinParts.virtualContainer,t=0;e.childNodes.length>t;t++)e.childNodes[t].destroy();var i=this;this._getDisplayerDivFunction(this._currentItem,{container:i._skinParts.virtualContainer,x:this._imageMaxWidth,y:this._imageMaxHeight},function(e){e.getParent('[skinpart="virtualContainer"]')||e.insertInto(i._skinParts.virtualContainer),i._transitionToCurrentDisplayer(e)})},_transitionToCurrentDisplayer:function(e){if(!this._inTransition){this._inTransition=!0,e.setStyle("opacity","0.0");var t=this._skinParts.itemsContainer,i=this,n=function(){for(var n=0;t.childNodes.length>n;n++)t.childNodes[n].destroy();t.empty();var s=e.getStyles("width","height"),a=i._getTopGap(s.height.replace("px",""));t.adopt(e),i._skinParts.virtualContainer.empty();var r=new Fx.Morph(i._skinParts.dialogBox,{duration:i.transitionTime,link:"chain"});r.addEvent("complete",function(){var t=new Fx.Tween(e,{duration:i.transitionTime,link:"chain"});t.addEvent("complete",function(){i.unlock(),i._inTransition=!1,t.removeEvent("complete",arguments.callee)}),t.start("opacity","1.0"),r.removeEvent("complete",arguments.callee)}),r.start({width:s.width,"min-height":s.height,"margin-top":a+"px"}),o&&o.removeEvent("complete",arguments.callee)};if(t.hasChildNodes()){var o=new Fx.Tween(t.firstChild,{duration:i.transitionTime,link:"chain",property:"opacity"});o.addEvent("complete",n),o.start("0.0")}else n()}},_changeImageNoTransition:function(e){for(var t=this._skinParts.itemsContainer,i=this,n=0;t.childNodes.length>n;n++)t.childNodes[n].destroy();t.empty();var o=e.getStyles("width","height"),s=i._getTopGap(o.height.replace("px",""));t.adopt(e),i._skinParts.virtualContainer.empty(),i._skinParts.dialogBox.setStyles({width:o.width,"min-height":o.height,"margin-top":s+"px"}),i.unlock()},_getTopGap:function(e){var t=this.injects().Utils.getWindowSize(),i=(t.height-e)/2;return i>0?i:0},_validateArgs:function(e,t){if(!e)return!1;var i=e.length;return 1>e.length?!1:0>t||t>=i?(LOG.reportError(wixErrors.EDITOR_INDEX_OUT_OF_RANGE,"wysiwyg.viewer.components.MediaZoom","setGallery",t),!1):!0},_setNextPrevVisibility:function(){this._skinParts.buttonNext.uncollapse(),this._skinParts.buttonPrev.uncollapse(),(1>=this.getDataItem().get("items").length||this._extraParams.hideNextPrevBtns)&&(this._skinParts.buttonNext.collapse(),this._skinParts.buttonPrev.collapse())},_getItemId:function(e){var t="string"==typeof e?e:e.get("id");return 0==t.indexOf("#")?t.substr(1):t},_opened:!1,isZoomOpened:function(){return this._opened},validateArgs:function(e,t){if(!e)return!1;var i=e.length;return 1>e.length?!1:0>t||t>=i?(LOG.reportError(wixErrors.EDITOR_INDEX_OUT_OF_RANGE,"wysiwyg.viewer.components.MediaZoom","setGallery",t),!1):!0}})}),define.component("wysiwyg.viewer.components.MediaZoomDisplayer",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["_setCorrectImageSize"]),t.traits(["wysiwyg.common.components.traits.LinkableComponent"]),t.skinParts({title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},link:{type:"htmlElement",optional:!0},imageWrapper:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Next"},image:{type:"core.components.Image",dataRefField:"*",optional:!1,hookMethod:"_addImageArgs"}}),t.states({link:["showLink","hideLink"]}),t.fields({_minWidth:600,_maxWidth:-1,_maxHeight:-1,_imgActualSize:{x:0,y:0}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._maxWidth=i.maxWidth,this._maxHeight=i.maxHeight},_tweetHookMethod:function(e){return e.dataItem=this.injects().Data.createDataItem({defaultText:"",accountToFollow:"",type:"TwitterTweet"},"TwitterTweet"),e},_addImageArgs:function(e){this._imageDimensionsClass=this.injects().Classes.get("core.components.image.ImageDimensions"),this._imageDimensions=new this._imageDimensionsClass,this._imageDimensions.setCropMode(this._imageDimensionsClass.settingOptions.crop.FULL);var t=this.getSkin().getParams().first(function(e){return"imgPadding"===e.id});this._maxWidth=this._maxWidth-2*t.defaultValue;var i=this._imageDimensions.getDimensionsForContainerSize({x:this.getDataItem().get("width"),y:this.getDataItem().get("height")},{x:this._getImageWidth(),y:this._getImageHeight()});return this._imgActualSize=i.imageVisibleSize,e.argObject={unit:"px",cropMode:"full",width:this._imgActualSize.x,height:this._imgActualSize.y},e},_onAllSkinPartsReady:function(){this.parent(),this._skinParts.comments&&(this._minWidth=600),this._setCorrectImageSize(this._imgActualSize),this._updateParts()},getAcceptableDataTypes:function(){return["Image"]},_updateParts:function(){this._skinParts&&(this._skinParts.title.set("text",this._data.get("title")),this._skinParts.description.set("text",this._data.get("description")),""==this.getDataItem().get("href")?this.setState("hideLink","link"):this.setState("showLink","link"))},_setCorrectImageSize:function(e){var t=e.y,i=this._getDisplayerWidth(e.x);this._skinParts.imageWrapper.setStyles({width:i+"px",height:t+"px","min-width":"600px"}),this._skinParts.title.setStyles({"max-width":i+"px","word-wrap":"break-word"}),this._skinParts.description.setStyles({"max-width":i+"px","word-wrap":"break-word"})},_getDisplayerWidth:function(e){return this._minWidth>e?this._minWidth:e},_getImageWidth:function(){var e=this._data.get("width");return 0>this._maxWidth||this._maxWidth>=e?e:this._maxWidth},_getImageHeight:function(){var e=this._data.get("height");return 0>this._maxHeight||this._maxHeight>=e?e:this._maxHeight}})}),define.component("wysiwyg.viewer.components.MessageView",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({blockingLayer:{type:"htmlElement"},okButton:{type:"core.editor.components.EditorButton"},title:{type:"htmlElement"},description:{type:"htmlElement"},dialog:{type:"htmlElement"}}),t.binds(["_closeView"]),t.methods({initialize:function(e,t,i){this.parent(e,t,i)},_onAllSkinPartsReady:function(e){e.okButton.setLabel("OK"),e.okButton.addEvent("buttonClick",this._closeView)},_editModeChanged:function(){this._closeView()},showMessage:function(e){this.uncollapse(),this._skinParts.title.set("html",e.msgTitle||""),this._skinParts.description.set("html",e.msgBody||""),this._visible=!0},visible:function(){return this._visible},_closeView:function(){this.collapse(),this._visible=!1,this.fireEvent("complete")}})}),define.component("wysiwyg.viewer.components.Modal",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["_onCloseClick","_onBlockingLayerClick","_editModeChanged","_onViewportResize"]),t.skinParts({blockingLayer:{type:"htmlElement"},close:{type:"htmlElement"},innerComponent:{hookMethod:"_innerComponentDefinition"}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),i=i||{},this.disableBlockLayer=i.disableBlockLayer,this._origin=i.innerComponentArgs.argObject.origin,this._viewportSize=window.getSize(),this._innerComponentArgs=i.innerComponentArgs,this._innerComponentsize=null},render:function(){this.setSize();var e=0,t=0;"50%"==this._skinParts.innerComponent.getTop()&&(e=this._skinParts.innerComponent.getHeight()/2),"50%"==this._skinParts.innerComponent.getLeft()&&(t=this._skinParts.innerComponent.getWidth()/2),this._setInnerCompPosition(e,t),this._setClosePosition(e,t)},_onAllSkinPartsReady:function(e){this.parent(),window.addEvent(Constants.CoreEvents.RESIZE,this._onViewportResize),e.close.addEvent(Constants.CoreEvents.CLICK,this._onCloseClick),this.disableBlockLayer?e.blockingLayer.hide():e.blockingLayer.addEvent(Constants.CoreEvents.CLICK,this._onBlockingLayerClick)},_innerComponentDefinition:function(e){return e.type=this._innerComponentArgs.type,e.skin=this._innerComponentArgs.skin,e.dataItem=this._innerComponentArgs.dataItem||this._data,e.argObject=this._innerComponentArgs.argObject,e.argObject.containingComponent=this,e},_onViewportResize:function(){this._viewportSize=window.getSize(),this._renderIfReady()},_onCloseClick:function(){this.dispose()},_onBlockingLayerClick:function(){this.dispose()},_editModeChanged:function(){this.dispose()},_setClosePosition:function(e,t){var i=this._skinParts.close,n=i.getSize().x/2,o=this._skinParts.innerComponent.getWidth(),s=this._skinParts.innerComponent.getHeight(),a=this._skinParts.innerComponent.getX(),r="auto"!==this._skinParts.innerComponent.getLeft(),l="auto"!==this._skinParts.innerComponent.getTop(),d=r?t?"50%":a+o-n:"auto",c=r?"auto":0,h=l?e?"50%":0:"auto",p=l?"auto":s-n;i.setStyles({left:d,right:c,top:h,bottom:p,"margin-left":t?t-n:0,"margin-top":e?-e-n:0})},_centerModal:function(){var e=this._skinParts.close,t=e.getSize(),i=this._skinParts.innerComponent.getWidth()/2,n=this._skinParts.innerComponent.getHeight()/2;this._skinParts.innerComponent.getViewNode().setStyles({"margin-left":-i,"margin-top":-n}),e.setStyles({left:"50%",top:"50%","margin-left":i-t.x/2,"margin-top":-n-t.y/2})},setSize:function(){var e,t,i,n;this._innerComponentsize=this._innerComponentsize||{width:this._skinParts.innerComponent.getWidth(),height:this._skinParts.innerComponent.getHeight()},i=this._innerComponentsize,n=this._viewportSize,e=Math.min(i.width,n.x),t=Math.min(i.height,n.y),(this._skinParts.innerComponent.getWidth()!=e||this._skinParts.innerComponent.getHeight()!=t)&&(this._skinParts.innerComponent.setWidth(e),this._skinParts.innerComponent.setHeight(t,!1,!0)),this._setClosePosition()},dispose:function(){window.removeEvent(Constants.CoreEvents.RESIZE,this._onViewportResize),this._skinParts.innerComponent&&this._skinParts.innerComponent.dispose(),this.collapse(),this.parent()},_setInnerCompPosition:function(e,t){this._skinParts.innerComponent.getViewNode().setStyles({"margin-left":-t,"margin-top":-e})}})}),define.component("wysiwyg.viewer.components.PageGroup",function(e){var t=e;t.inherits("core.components.Container"),t.utilize(["wysiwyg.viewer.utils.TransitionUtils","core.components.Page"]),t.resources(["W.Utils","W.Viewer","W.Layout"]),t.propertiesSchemaType("PageGroupProperties"),t.binds(["onCurrentPageResize","_setHorizontalGrid","_setVerticalGrid","toggleGrid","refreshGrid","_resizePage","_onTransitionFinished"]),t.skinParts({grid:{type:"htmlElement"}}),t.states(["showGridLines"]),t.fields({_transitionQueue:[]}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.setMaxH(this.imports.Page.MAX_HEIGHT),this._runAnimations=!1,this._transitionDurationMap={},this._transitionDurationMap[Constants.TransitionTypes.NONE]=0,this._transitionDurationMap[Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN]=1.1,this._transitionDurationMap[Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN]=1.1,this._transitionDurationMap[Constants.TransitionTypes.CROSS_FADE]=1.2,this._transitionDurationMap[Constants.TransitionTypes.OUT_IN]=1.5},render:function(){this.parent();var e=this.resources.W.Viewer.getDocWidth();this.setWidth(e)},getInlineContentContainer:function(){return this._skinParts.inlineContent},editModeChange:function(e){"MASTER_PAGE"==e||this._skinParts.overlay.collapse()},_onDataChanged:function(){var e=this.getComponentProperty("transition");"slide"==e&&this.setComponentProperty("transition",Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN,!0)},_onAllSkinPartsReady:function(){this._transitionUtils=new this.imports.TransitionUtils,this._Tween=this.resources.W.Utils.Tween,this._skinParts.overlay.collapse(),this.parent()},gotoPage:function(e){var t=document.getElementById(e);t.getLogic().setWidth(this.getWidth()),this._setVisiblePageCallId=this.resources.W.Utils.callLater(function(){t.getLogic().wixifyContent(function(){this.actualGotoPage(t)}.bind(this))}.bind(this))},actualGotoPage:function(e){this._transitionQueue.push(e),1==this._transitionQueue.length&&this._executeTransition(this._transitionQueue[0])},_onTransitionFinished:function(){if(this._currentPage.getLogic().addEvent("resize",this.onCurrentPageResize),this._transitionQueue.shift(),this._transitionQueue.length>0){var e=this._transitionQueue.pop();this._transitionQueue=[e],this._executeTransition(this._transitionQueue[0])}else{var t=this._currentPage.getLogic().getDataItem().get("id");window.scrollTo(0,0),this._view.fireEvent("pageTransitionEnded",t),this._resizePage()}},_executeTransition:function(e){var t=e.getLogic()._data.get("id");if(this._view.fireEvent("pageTransitionStarted",t),this.resources.W.Viewer.fireEvent("pageTransitionStarted",t),e.setStyle("opacity","0.0"),e.getLogic().uncollapse(),e.getLogic().isContentReady()===!0)this._executeTransitionPageReady(e);else{var i=this;e.getLogic().addEvent("pageContentReady",function(){e.getLogic().removeEvent("pageContentReady",arguments.callee),i._executeTransitionPageReady(e)})}},_executeTransitionPageReady:function(e){var t=this.getComponentProperty("transition"),i=this._transitionDurationMap[t]||0,n=t==Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN?1:0,o=e.getLogic().getHeight();if(e.setStyles({opacity:"1.0"}),this._currentPage&&!this._currentPage.getLogic().getIsDisposed()){this._currentPage.getLogic().removeEvent("resize",this.onCurrentPageResize);var s=this._currentPage.getLogic().getHeight();i>0?(this._Tween.execute(s,o,i,{onUpdate:this._resizePage,ease:"strong_easeInOut"}),this._Tween.execute(window.scrollY,0,i,{onUpdate:function(e){window.scrollTo(0,e)},ease:"strong_easeInOut"})):this._resizePage(o);var a=this._transitionUtils.getTransition(t);a(this._currentPage,e,n,i,function(){this._currentPage.getLogic().collapse(),this._currentPage=e,this._onTransitionFinished()}.bind(this))}else this._currentPage=e,this._resizePage(o),this._onTransitionFinished()},onCurrentPageResize:function(){this._resizePage()},_resizePage:function(e){e||(e=this._currentPage.getLogic().getHeight()),this.setHeight(e),this.resources.W.Layout.enforceAnchors([this]),this.refreshGrid()},useLayoutOnDrag:function(){return!0},isSelectable:function(){return!1},isContainer:function(){return!1},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS}}},isDeleteable:function(){return!1},toggleGrid:function(){this._setVerticalGrid(),this._setHorizontalGrid();var e="showGridLines",t=this.getState()==e;t?this.removeState(e):this.setState(e)},refreshGrid:function(){"showGridLines"==this.getState()&&(this._setVerticalGrid(),this._setHorizontalGrid())},_setHorizontalGrid:function(){var e=window.getSize().x,t=this._view.getSize().x,i=e-t,n=-1*(i/2);this._skinParts.gridHeader.setStyle("width",e),this._skinParts.gridFooter.setStyle("width",e),this._skinParts.gridHeader.setStyle("left",n),this._skinParts.gridFooter.setStyle("left",n)},_setVerticalGrid:function(){var e=this._view.getPosition().y;window.getSize().y;var t=-1*e,i=parseInt(document.id("SITE_STRUCTURE").getStyle("height"));this._skinParts.gridBodyRight.setStyle("height",i),this._skinParts.gridBodyLeft.setStyle("height",i),this._skinParts.gridBodyRight.setStyle("top",t),this._skinParts.gridBodyLeft.setStyle("top",t)},getMinPhysicalHeight:function(){return this._currentPage.getLogic().getHeight()}})}),define.component("wysiwyg.viewer.components.PagesContainer",function(e){var t=e;t.inherits("wysiwyg.viewer.components.SiteSegmentContainer"),t.utilize(["core.components.Page"]),t.resources(["W.Viewer"]),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.setMaxH(this.imports.Page.MAX_HEIGHT),this._resizableSides=[]},isAnchorable:function(){return{to:{allow:!0,allowBottomBottom:!1,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS}}},isContainer:function(){return!1},layoutMinHeight:function(){return this.resources.W.Viewer.getCurrentPageNode().getLogic().getHeight()}})}),define.component("wysiwyg.viewer.components.PaginatedGridGallery",function(e){var t=e;t.inherits("wysiwyg.viewer.components.MatrixGallery"),t.traits(["wysiwyg.viewer.components.traits.GalleryAutoplay"]),t.utilize(["wysiwyg.viewer.utils.MatrixTransitions","wysiwyg.viewer.utils.GalleryUtils","bootstrap.utils.LinkUtils"]),t.resources(["W.Utils","W.Commands","W.Viewer"]),t.propertiesSchemaType("PaginatedGridGalleryProperties"),t.binds(["next","prev","_onTransitionComplete","_onRollOut","_onMouseMove","_onClick"]),t.skinParts({itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement",optional:!0},rolloverHolder:{type:"htmlElement",optional:!0},title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},zoom:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!1}}),t.states({rendering:["pending","ready"],itemSelection:["rollover","idle"],linkableComponent:["link","noLink"],slideshow:["autoplayOn","autoplayOff"]}),t.fields({_rolloverSequencer:null,_fixedRowNumber:!1,_pageItemsCount:0,_currentItemIndex:0,_displayerDict:{},_transitionPending:!1,_transitionUtils:null,_linkUtils:null,_NO_LINK_PROPAGATION:!0,_hasRollOver:!0}),t.methods({initialize:function(e,t,i){i=i||{},this.parent(e,t,i),this._transitionUtils=new this.imports.MatrixTransitions,this._linkUtils=new this.imports.LinkUtils,this._view.addEvent(Constants.CoreEvents.MOUSE_MOVE,this._onMouseMove),this._view.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onRollOut),"fixedRowNumber"in i&&(this._fixedRowNumber=i.fixedRowNumber===!0),void 0===i.sequencingHook&&(this._sequencer.resolveItem=function(){return{comp:"wysiwyg.viewer.components.ImageLite",skin:"mobile.core.skins.InlineSkin"}}),i.rolloverHook&&(this._rolloverSequencer=new this.imports.ComponentSequencer,this._rolloverSequencer.resolveItem=i.rolloverHook,this._rolloverSequencer.addEvent("componentSetup",this._onRollOverViewCreated))},_onRollOverViewCreated:function(e){this._setupItem(e.compView)},getSequencer:function(){return this._sequencer},_onAllSkinPartsReady:function(){var e=this.getComponentProperty("galleryImageOnClickAction"),t=this.getComponentProperty("expandEnabled");"unset"===e&&(t===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0),this._updateGalleryImageOnClickAction()),this.parent(),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.itemsContainer.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder&&(this._skinParts.rolloverHolder.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder.setStyles({overflow:"hidden"}));var i=this.resources.W.Utils.getCSSBrowserFeature("user-select"),n={cursor:"pointer"};i&&(n[i]="none"),this._skinParts.buttonPrev.setStyles(n),this._skinParts.buttonNext.setStyles(n),this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.CLICK,function(e){e.stopPropagation(),this.prev()}.bind(this)),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.CLICK,function(e){e.stopPropagation(),this.next()}.bind(this)),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._transitionUtils.setupTransitionMap(this._calcItemPosition.bind(this),this._skinParts.itemsContainer),this._checkSkinPartsVisibility()},_onResize:function(){this.parent(),this._skinParts&&this._resetRollOver()},_onDataChange:function(e,t){this._updateGalleryImageOnClickAction(),this._currentItemIndex=0,this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber()),this._componentReady&&e===this._data&&this._skinParts.itemsContainer.empty(),this._checkSkinPartsVisibility(),this.parent(e,t)},render:function(){var e=this._data.get("items");this._displayerDict={},this._skinParts.counter&&this._skinParts.counter.set("text",this._getCounterText(this._currentItemIndex,e.length)),this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber()),this._displayedItems=this._getPageItems(e,this._currentItemIndex);var t=this._displayedItems;e.length>this._pageItemsCount?(this._nextPageItems=this._getPageItems(e,this._getNextPageItemIndex()),this._prevPageItems=this._getPageItems(e,this._getPrevPageItemIndex()),t=t.concat(this._nextPageItems).concat(this._prevPageItems),this._skinParts.buttonNext.setStyles({display:"block"}),this._skinParts.buttonPrev.setStyles({display:"block"})):(this._skinParts.buttonNext.setStyles({display:"none"}),this._skinParts.buttonPrev.setStyles({display:"none"})),this._sequencer.createComponents(this._skinParts.itemsContainer,t)},_getRowNumber:function(){return this._fixedRowNumber===!0?parseInt(this.getComponentProperty("maxRows")):this.parent()},_getPageItems:function(e,t){for(var i=[],n=Math.min(this._numItems-1,t+this._pageItemsCount-1),o=t;n>=o;o++)i.push(e[o]);return i},_getCounterText:function(e){var t=Math.floor(e/this._pageItemsCount),i=this._getTotalPageCount();return i||(i=1),t+1+""+"/"+(i+"")},_translateRefList:function(e){var t,i,n,o=[],s=this._skinParts.itemsContainer.children,a=typeOf(e[0]);e=e.slice(0);for(var r=0;s.length>r;r++)t=s[r],i=t.getLogic().getDataItem(),n="string"===a?"#"+i.get("id"):i,e.contains(n)&&(o.push(t),e.splice(e.indexOf(n),1));return o},_checkSkinPartsVisibility:function(){this._skinParts&&(this._resetRollOver(),this._skinParts.buttonPrev.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.buttonNext.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden"),this._skinParts.rolloverHolder&&this._skinParts.rolloverHolder.setStyle("cursor",this._isImageClickable()?"pointer":"default"),this._skinParts.link.set("text",this.getComponentProperty("goToLinkText")))},_updateState:function(){},_onDisplayerCreation:function(e,t,i){var n=e.getViewNode();this._setupItem(n);var o;o=e.getRef?e.getRef():"#"+e.getDataItem().get("id"),n.addClass("galleryDisplayer"),this._displayerDict[o]=e,i>=this._displayedItems.length&&n.setStyles({top:1.5*-this._itemHeight,position:"absolute"})},_onSequencerFinished:function(e){e.elements=e.elements.slice(0,this._displayedItems.length),this.parent(e),this._transitionPending=!1,this.fireEvent("transitionFinished")},gotoNext:function(){this.next()},next:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&this._nextPageItems&&(this._currentItemIndex=this._getNextPageItemIndex(),this._goto(this._nextPageItems,0))},prev:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&this._prevPageItems&&(this._currentItemIndex=this._getPrevPageItemIndex(),this._goto(this._prevPageItems,1))},_getNextPageItemIndex:function(){var e=this._currentItemIndex+this._pageItemsCount;return e>=this._numItems&&(e=0),e},_getPrevPageItemIndex:function(){var e=this._currentItemIndex-this._pageItemsCount;return 0>e&&(e=(this._getTotalPageCount()-1)*this._pageItemsCount),e},_goto:function(e,t){this._transitionPending=!0,this._resetRollOver();var i=this._translateRefList(this._displayedItems),n=this._translateRefList(e),o=this._transitionUtils.getTransition(this.getComponentProperty("transition"));this._setupAllItems(n),o(i,n,this._numCols,this._numRows,t,parseFloat(this.getComponentProperty("transDuration")),function(){this._onTransitionComplete(n)}.bind(this))},_onTransitionComplete:function(){this.render()},_onMouseMove:function(e){if(this._transitionPending!==!0){var t=this._findDisplayerFromPosition(e.page);if(t&&this._skinParts.rolloverHolder&&this._hasRollOver){if(this._highlightedDisplayer!==t){this._highlightedDisplayer=t;var i=t.getCoordinates(this._skinParts.rolloverHolder.getParent());this._skinParts.rolloverHolder.setStyles({visibility:"visible",position:"absolute",padding:0,left:i.left,top:i.top,width:i.width,height:i.height}),this.setState("idle"),window.requestAnimFrame(function(){if(this._highlightedDisplayer){this._updateDisplayerInfo(t.getLogic().getDataItem());var e=this._getHighlightedDisplayerData();if(e.getType&&"Image"===e.getType()){var i=this.getSkinPart("link");this._linkUtils.linkifyElement(this,i,e,!0)}this._skinParts.rolloverHolder.setStyle("cursor",this._isImageClickable()?"pointer":"default"),"goToLink"==this._galleryImageOnClickAction?this._skinParts.link.setStyle("display","none"):this._skinParts.link.setStyle("display",this._isImageLinked()?"block":"none"),this.setState("rollover")}}.bind(this))}}else this._resetRollOver()}},_onRollOut:function(e){e.relatedTarget&&!e.relatedTarget.getParents().contains(this._view)&&this._resetRollOver()},_findDisplayerFromPosition:function(e){var t,i=this._skinParts.itemsContainer.getPosition(),n={x:e.x-i.x,y:e.y-i.y},o=Math.floor(n.x/(this._itemWidth+this._gap)),s=Math.floor(n.y/(this._itemHeight+this._gap));if(o>=0&&s>=0){var a=s*this._numCols+o;this._galleryItems.length>a&&(t=this._galleryItems[a])}return t},_findDisplayer:function(e){for(;e;){if(e===this._skinParts.itemsContainer)return null;if(this._galleryItems.contains(e))return e;e=e.getParent()}return null},_updateDisplayerInfo:function(e){this._skinParts.rolloverHolder&&this._rolloverSequencer?this._rolloverSequencer.createComponents(this._skinParts.rolloverHolder,[e]):e&&e.getData&&"title"in e.getData()&&"description"in e.getData()&&(this._skinParts.title.set("text",e.get("title")),this._skinParts.description.set("text",e.get("description")))
},_hideRollOverHolder:function(){this.setState("idle"),this._skinParts.rolloverHolder.setStyles({visibility:"hidden"})},_resetRollOver:function(){this._hideRollOverHolder(),this._highlightedDisplayer=null},_onClick:function(e){if(e.rightClick===!1){var t;if("zoomMode"==this._galleryImageOnClickAction){var i=this._highlightedDisplayer||this._findDisplayer(e.target);if(i){t=i.getLogic().getDataItem();var n=t.get("id"),o=this._data.get("items"),s=o.indexOf("#"+n);this.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:this._data,currentIndex:s,getDisplayerDivFunction:this.resources.W.Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:this.resources.W.Viewer.getDefaultGetHashPartsFunction("Image")})}}else"goToLink"==this._galleryImageOnClickAction&&this._isImageLinked()&&this._skinParts.link.click()}},_getTotalPageCount:function(){var e=Math.floor(this._numItems/this._pageItemsCount);return this._numItems%this._pageItemsCount>0&&e++,e},_isImageLinked:function(){var e=this._getHighlightedDisplayerData();if(e){var t=e.get("href");return!!t}return!1},_getHighlightedDisplayerData:function(){return this._highlightedDisplayer&&this._highlightedDisplayer.getLogic?this._highlightedDisplayer.getLogic().getDataItem():null},_isImageClickable:function(){return"goToLink"===this._galleryImageOnClickAction?this._isImageLinked():"disabled"!==this._galleryImageOnClickAction},_updateGalleryImageOnClickAction:function(){this._galleryImageOnClickAction=this.getComponentProperties().hasField("galleryImageOnClickAction")?this.getComponentProperty("galleryImageOnClickAction"):this.getComponentProperty("expandEnabled")?"zoomMode":"disabled"}})}),define.component("wysiwyg.viewer.components.PasswordLogin",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.resources(["W.Utils","W.Data","W.Config","W.Viewer","W.Commands"]),t.skinParts({blockingLayer:{type:"htmlElement"},passwordInput:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},submitButton:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.PasswordLogin.Close"},cancel:{type:"htmlElement"},favIcon:{type:"htmlElement"},faveIconAhref:{type:"htmlElement"},header:{type:"htmlElement"},title:{type:"htmlElement"},dialog:{type:"htmlElement"}}),t.binds(["centerDialog","_onSubmit","_reportError","_invalidateErrorState","_onKeyPress","_handleCancel","_onPasswordSuccess"]),t.methods({initialize:function(e,t,i){this.isVolatile=!0,this.parent(e,t,i),this.VIEWER_STRINGS={LOGIN_HEADER:"Enter password to view this page",LOGIN_ERR_GENERAL:"Server error - Unable to log in",LOGIN_ERR_WRONG_PASSWORD:"Please enter the correct password",PASSWORD_LABEL:"Password"},this._digestedPassword=i&&i.digestedPassword,this._authCallback=i&&i.authCallback,this._disableCancel=i&&i.disableCancel},centerDialog:function(){var e=this.resources.W.Utils.getWindowSize(),t=this._skinParts.dialog;t.setPosition({x:e.width/2-t.getSize().x/2,y:e.height/2-t.getSize().y/2})},_onAllSkinPartsReady:function(e){if(this._disableCancel?(e.xButton.hide(),e.cancel.setStyle("visibility","hidden")):(e.cancel.addEvent("click",this._handleCancel),e.xButton.addEvent("click",this._handleCancel),e.blockingLayer.addEvent("click",function(t){t.target==e.blockingLayer&&this._handleCancel()}.bind(this))),e.submitButton.addEvent("click",this._onSubmit),e.title.set("text",this.VIEWER_STRINGS.LOGIN_HEADER),this.resources.W.Viewer.isPremiumUser()){e.faveIconAhref.removeAttribute("href");var t=window.publicModel&&window.publicModel.favicon;e.favIcon.src=t?this.resources.W.Config.getMediaStaticUrl(t)+t:this.resources.W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/viewer/blank-favicon.png"}e.passwordInput.addEvent(Constants.CoreEvents.KEY_UP,this._onKeyPress)},_handleCancel:function(){this.resources.W.Commands.executeCommand("WViewerCommands.PasswordLogin.Close",null,null),this._reportAuthStatusChange(!1,{cancel:!0})},_reportAuthStatusChange:function(e,t){this._authCallback&&this._authCallback({authResponse:e,data:t})},_editModeChanged:function(){this._handleCancel()},_onKeyPress:function(e){13==e.code&&this._onSubmit(),this._invalidateErrorState()},_onSubmit:function(){this._invalidateErrorState();var e=this._skinParts.passwordInput._data.get("text");this._validatePassword(e,function(){this._invalidateErrorState(),this._onPasswordSuccess()}.bind(this),function(e){this._reportError(e)}.bind(this))},_onPasswordSuccess:function(){this.resources.W.Commands.executeCommand("WViewerCommands.PasswordLogin.Close",null,null),this._reportAuthStatusChange(!0)},_validatePassword:function(e,t,i){if(this._digestedPassword){var n=W.Utils.hashing.SHA256.b64_sha256(e);n==this._digestedPassword?t():i(this.VIEWER_STRINGS.LOGIN_ERR_WRONG_PASSWORD)}},_reportError:function(e){this._skinParts.passwordInput.setError(e)},_invalidateErrorState:function(){this._skinParts.passwordInput.setValidationState(!0)},_bindPasswordField:function(e){return e.argObject={label:this.VIEWER_STRINGS.PASSWORD_LABEL,passwordField:!0},e.dataItem=this.resources.W.Data.createDataItem({text:"",type:"Text"},"Text"),e}})}),define.component("wysiwyg.viewer.components.PayPalButton",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.resources(["W.Commands"]),t.dataTypes(["PayPalButton"]),t.propertiesSchemaType("PayPalButtonProperties"),t.skinParts({buttonContainer:{type:"htmlElement"}}),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._resizableSides=[]},render:function(){this._createPayPalForm()},_createPayPalForm:function(){this._buttonType=this.getComponentProperty("buttonType");var e=this.getComponentProperty("amount"),t=!e||0==Number(e),i=this.getComponentProperty("target"),n="buy"==this._buttonType?"_xclick":"_donations";if(this._form=new Element("form",{action:"https://www.paypal.com/cgi-bin/webscr",method:"POST"}),this._skinParts.buttonContainer.empty(),this._skinParts.buttonContainer.adopt(this._form),this._form.set("target",i),this._addHiddenInput("cmd",n),this._addHiddenInput("business",this._data.get("merchantID")),this._addHiddenInput("item_name","buy"==this._buttonType?this.getComponentProperty("itemName"):this.getComponentProperty("organizationName")),this._addHiddenInput("item_number","buy"==this._buttonType?this.getComponentProperty("itemID"):this.getComponentProperty("organizationID")),this._addHiddenInput("notify_url","https://inventory.wix.com/ecommerce/ipn/paypal"),"_blank"==i){var o=document.location.href;this._addHiddenInput("return",o),this._addHiddenInput("cancel_return",o)}t||this._addHiddenInput("amount",this.getComponentProperty("amount")),this._addHiddenInput("currency_code",this.getComponentProperty("currencyCode")),"buy"==this._buttonType?this._addHiddenInput("bn","Wix_BuyNow_WPS_IL"):this._addHiddenInput("bn","Wix_Donate_WPS_IL"),this._addSubmitImage(),this._addPixelImage(),this._alignSize(),this._form.addEvent("click",function(){if("_self"==i){var e={component:this};this.resources.W.Commands.executeCommand("linkableComponent.navigateSameWindow",e,this)}}.bind(this))},_alignSize:function(){var e,t,i=this.getComponentProperty("showCreditCards"),n=this.getComponentProperty("smallButton");n?(e=21,t="buy"==this._buttonType?86:74):i?(e=47,t=170):(e=26,t="buy"==this._buttonType?107:92),this.setWidth(t),this.setHeight(e),this._view.setStyle("height",e+"px")},_addSubmitImage:function(){var e=new Element("input",{type:"image",name:"submit",border:0,src:function(){var e=this.getComponentProperty("showCreditCards"),t=this.getComponentProperty("smallButton"),i="en_US",n="https://www.paypalobjects.com/"+i+"/i/btn/btn_";return n+="buy"==this._buttonType?"buynow":"donate",n+=e&&!t?"CC":"",n+=t?"_SM":"_LG",n+=".gif"}.bind(this)()});this._form.adopt(e)},_addHiddenInput:function(e,t){var i=new Element("input",{type:"hidden",name:e,value:t});this._form.adopt(i)},_addPixelImage:function(){this._form.adopt(new Element("img",{src:"https://www.paypalobjects.com/en_US/i/scr/pixel.gif",width:"1",height:"1"}))}})}),define.component("wysiwyg.viewer.components.ScreenWidthArea",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({inlineContent:{type:"htmlElement"},background:{type:"htmlElement"}}),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),t.methods({getInlineContentContainer:function(){return this._skinParts.inlineContent?this._skinParts.inlineContent:this._view},getLayoutMode:function(){return"BACKGROUND_STRIP"}})}),define.component("wysiwyg.viewer.components.ScreenWidthContainer",function(e){var t=e;t.inherits("core.components.Container"),t.resources(["W.Viewer"]),t.binds(["_onScreenResize","_stretchBackgroundAndCenterContent"]),t.skinParts({inlineContent:{type:"htmlElement"},screenWidthBackground:{type:"htmlElement"},bg:{type:"htmlElement"},centeredContent:{type:"htmlElement"}}),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),t.methods({initialize:function(e,t,i){this._pendingSizeUpdates={},this.parent(e,t,i),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM],this._moveDirections=[Constants.BaseComponent.MoveDirections.VERTICAL]},_onScreenResize:function(){this.getIsDisplayed()&&this._stretchBackgroundAndCenterContent()},_onResize:function(){},_stretchBackgroundAndCenterContent:function(){var e=this._view,t=$(document).getSize(),i=e.getSize(),n=this.resources.W.Viewer.getDocWidth(),o=-Math.round((t.x-n)/2);o>0&&(o=0),this._skinParts.screenWidthBackground.setStyles({position:"absolute",width:t.x+"px",height:i.y+"px",left:o})},render:function(){this.resources.W.Viewer.addEvent(this.resources.W.Viewer.SCREEN_RESIZE_EVENT,this._onScreenResize),this._stretchBackgroundAndCenterContent();var e=this.resources.W.Viewer.getDocWidth();this.setWidth(e),this._onAutoSized()},dispose:function(){this.parent(),this.resources.W.Viewer.removeEvent(this.resources.W.Viewer.SCREEN_RESIZE_EVENT,this._onScreenResize)},_onAllSkinPartsReady:function(){this._applyPendingSizeUpdates(!0)},_applyPendingSizeUpdates:function(e){null!=this._pendingSizeUpdates.width?(this.setWidth(this._pendingSizeUpdates.width),this._pendingSizeUpdates.width=null):e&&this.setWidth(this.getWidth(),!0),null!=this._pendingSizeUpdates.height?(this.setHeight(this._pendingSizeUpdates.height),this._pendingSizeUpdates.height=null):e&&this.setHeight(this.getHeight(),!0)},setX:function(){},getX:function(){return 0},setHeight:function(e,t,i){this.parent(e,t,i),this._skinParts?(this._view.setStyle("min-height",e+"px"),this._stretchBackgroundAndCenterContent(),this.flushPhysicalHeightCache(),this._onResize()):this._pendingSizeUpdates.height=e},setWidth:function(e,t,i){if(this.parent(e,t,i),this._skinParts){var n=this.resources.W.Viewer.getDocWidth(),o=e+"px",s=(n-e)/2+"px";this._skinParts.centeredContent.setStyles({width:o,"margin-left":s})}else this._pendingSizeUpdates.width=e},getSelectableX:function(){var e=$(document).getSize().x;return this.getX()-(e-this.getWidth())/2},getSelectableWidth:function(){var e=$(document).getSize().x;return e},isContainable:function(e){return instanceOf(e,this.constructor)},isDuplicatable:function(){return!0},saveCurrentDimensions:function(){this._lastDimensions={w:this.resources.W.Viewer.getDocWidth(),h:this.getHeight()}},_getEditBoxReferenceNode:function(){return this._skinParts.inlineContent}})}),define.component("wysiwyg.viewer.components.SelectableSliderGallery",function(e){var t=e;t.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"itemsContainer",dataRefField:"items"},itemsContainer:{type:"htmlElement"},swipeLeftHitArea:{type:"htmlElement"},swipeRightHitArea:{type:"htmlElement"}}),t.inherits("wysiwyg.viewer.components.SliderGallery"),t.fields({_selectedItem:null}),t.methods({initialize:function(e,t,i){this._expandEnabled=!1,this._initialSelectedIndex=0,i.selectedIndex&&(this._initialSelectedIndex=i.selectedIndex),this.parent(e,t,i)},_setupDisplayer:function(e,t){this.parent(e),t===this._initialSelectedIndex&&this.setSelectedState(e),e.addEvent("itemSelected",function(){this.setSelectedState(e),this.fireEvent("imageSelected",e.getDataItem())}.bind(this))},setSelectedState:function(e){if(this._selectedItem){if(this._selectedItem===e)return;this._selectedItem.setSelected(!1)}this._selectedItem=e,this._selectedItem.setSelected(!0)}})}),define.component("wysiwyg.viewer.components.SiteButton",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.resources(["W.Utils"]),t.traits(["wysiwyg.common.components.traits.LinkableComponent"]),t.propertiesSchemaType("ButtonProperties"),t.skinParts({label:{type:"htmlElement"},link:{type:"htmlElement"}}),t.dataTypes(["SiteButton"]),t.binds(["_onClick","_onOver","_onOut","_onMouseDown","_onMouseUp"]),t.states(["up","over","selected","pressed"]),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}]},_canFocus:!0,_triggers:["click"]}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._userSelectedWidth=0,this._resizeTriggeredByData=!1},_onClick:function(e){if(LOG.reportEvent(wixEvents.VIEWER_BUTTON_COMPONENT_CLICK,{c1:this._compId,i1:this.isEnabled()?1:0}),!this.isEnabled())return this._cancelEvent(e);if(e.target=this.getViewNode(),this.fireEvent(Constants.CoreEvents.CLICK,e),this._toggleMode){var t="selected"!=this.getState()?"selected":"over";this.setState(t)}},_onOver:function(e){this.isEnabled()&&"selected"!=this.getState()&&(this.fireEvent("over",e),this.setState("over"))},_onOut:function(e){this.isEnabled()&&"selected"!=this.getState()&&(this.fireEvent("up",e),this.setState("up"))},_onMouseDown:function(e){if(this.isEnabled()&&"selected"!=this.getState())this.setState("pressed"),this.fireEvent(Constants.CoreEvents.MOUSE_DOWN,e);else if(!this.isEnabled())return this._cancelEvent(e)},_cancelEvent:function(e){return e.stopPropagation(),e.preventDefault(),!1},_onMouseUp:function(){this.removeState("pressed")},_onEnabled:function(){var e=this._skinParts.view;e.addEvent(Constants.CoreEvents.CLICK,this._onClick),e.addEvent(Constants.CoreEvents.MOUSE_OVER,this._onOver),e.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onOut),e.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),e.addEvent(Constants.CoreEvents.MOUSE_UP,this._onMouseUp)},_onDisabled:function(){var e=this._skinParts.view;e.removeEvent(Constants.CoreEvents.MOUSE_OVER,this._onOver),e.removeEvent(Constants.CoreEvents.MOUSE_OUT,this._onOut),e.removeEvent(Constants.CoreEvents.MOUSE_UP,this._onMouseUp)},render:function(){var e=this._data.get("label");this._skinParts.label.set("text",e),this._userSelectedWidth||e||(this._userSelectedWidth=parseInt(this._view.getStyle("width"),10)),this._updateMinimumWidth(),this._updateWidthFromText(),this._updateMinimumHeight(),this._setLineHeight(),this._setTextAlignment(),this._wCheckForSizeChangeAndFireAutoSized(0)},_skinParamsChange:function(){this.resources.W.Utils.callLater(function(){this._renderIfReady()}.bind(this),[],this,0),this.parent()},setHeight:function(e,t,i){this.parent(e,t,i),this._setLineHeight()},_setLineHeight:function(){if(this.isReady()){var e=parseInt(this._view.getStyle("padding-top")),t=parseInt(this._view.getStyle("padding-bottom")),i=this.getHeight()-e-t;this._skinParts.label.setStyle("line-height",i+"px")}},_setTextAlignment:function(){var e=this.getComponentProperty("align");this._skinParts.link.setStyle("text-align",e),this._setTextMargin()},_setTextMargin:function(){var e=this.getComponentProperty("margin"),t=this.getComponentProperty("align"),i=parseInt(this._skinParts.label.offsetWidth),n=this.getWidth();i+e>n&&(e=n-i),"left"==t?(this._skinParts.label.setStyle("margin-right",""),this._skinParts.label.setStyle("margin-left",e+"px")):"right"==t?(this._skinParts.label.setStyle("margin-left",""),this._skinParts.label.setStyle("margin-right",e+"px")):(this._skinParts.label.setStyle("margin-left",""),this._skinParts.label.setStyle("margin-right",""))},_setMinimumWidthAccordingToText:function(){var e=parseInt(this._skinParts.label.offsetWidth),t=parseInt(this._view.getStyle("padding-left")),i=parseInt(this._view.getStyle("padding-right"));this.setMinW(e+t+i)},_setMinimumHeightAccordingToText:function(){var e=parseInt(this._view.getStyle("padding-top")),t=parseInt(this._view.getStyle("padding-bottom"));this._skinParts.label.setStyle("line-height",""),this.setMinH(this._skinParts.label.offsetHeight+e+t)},_updateMinimumHeight:function(){this._setMinimumHeightAccordingToText(),this.setHeight(this.getHeight(),!1,!1)},_updateMinimumWidth:function(){this._setMinimumWidthAccordingToText(),this.setWidth(this.getWidth(),!1,!1)},_updateWidthFromText:function(){this._userSelectedWidth=0==this._userSelectedWidth?this.getWidth():this._userSelectedWidth;var e=Math.max(this.getSizeLimits().minW,this._userSelectedWidth);this.setWidth(e,!1,!1)},_onResize:function(){return this.parent(),0==this._resizeTriggeredByData?this._userSelectedWidth=parseInt(this._view.getStyle("width")):this._resizeTriggeredByData=!1,this.isReady()?(this._setTextMargin(),void 0):0},_onDataChange:function(e,t,i){this._resizeTriggeredByData=!0,this.parent(e,t,i)}})}),define.component("wysiwyg.viewer.components.SiteSegmentContainer",function(e){var t=e;t.inherits("wysiwyg.viewer.components.ScreenWidthContainer"),t.skinParts({inlineContent:{type:"htmlElement"},screenWidthBackground:{type:"htmlElement"},bg:{type:"htmlElement"},centeredContent:{type:"htmlElement"}}),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM]},useLayoutOnDrag:function(){return!0},useLayoutOnResize:function(){return!0},isDeleteable:function(){return!1},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS}}},canMoveToOtherScope:function(){return!1},isMultiSelectable:function(){return!1},isDraggable:function(){return!1},isDuplicatable:function(){return!1}})}),define.component("wysiwyg.viewer.components.SlideShowGallery",function(e){var t=e;t.inherits("core.components.BaseRepeater"),t.utilize(["wysiwyg.viewer.utils.TransitionUtils"]),t.traits(["core.components.traits.TouchRollOverSupport","wysiwyg.viewer.components.traits.GalleryAutoplay"]),t.dataTypes(["ImageList"]),t.resources(["W.Utils","W.Viewer","W.Theme"]),t.states({editMode:["showButtons"],slideshow:["autoplayOn","autoplayOff"]}),t.propertiesSchemaType("SlideShowGalleryProperties"),t.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"virtualContainer",moveOldItemsToContainer:!1,dataRefField:"items",argObject:{unit:"px"}},virtualContainer:{type:"htmlElement",optional:!0},itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement"},autoplay:{type:"htmlElement"}}),t.binds(["gotoNext","gotoPrev"]),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SlideShowGallery"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SlideShowGallery"},commandParameterDataRef:"SELF"}},_currentItemIndex:0,_currentItemRef:"",_prevItemIndex:-1,_numItems:-1,_itemHolder:null,_currentDisplayer:null,_locked:!1,_lastCommand:"",_transitionUtils:null,_displayedImages:[],_imageMode:"",_widthDiff:0,_heightDiff:0,_galleryItems:[],_expandEnabled:!0}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._Tween=this.resources.W.Utils.Tween,this._hideIndicatorElement=i&&i.hideIndicatorElement||!1},_onDataChange:function(){this._numItems=this._data.get("items").length,this._imageMode=this.getComponentProperty("imageMode")+"",this._expandEnabled=this.getComponentProperty("expandEnabled")===!0,this._resizableSides="flexibleHeight"==this._imageMode?[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]:[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.BOTTOM,Constants.BaseComponent.ResizeSides.RIGHT],this._checkSkinPartsVisibility(),this.parent()},_checkSkinPartsVisibility:function(){this._skinParts&&(this._skinParts.buttonPrev.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.buttonNext.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden"))},_processDataRefs:function(e){var t=[];if(e.length>0){t=[e[this._currentItemIndex]];var i;this._currentItemRef=e[this._currentItemIndex],e.length>1&&(i=this._normalizeIndex(this._currentItemIndex+1),t.push(e[i]),e.length>2&&(i=this._normalizeIndex(this._currentItemIndex-1),t.push(e[i])))}else this._itemHolder.empty();return t},_onAllSkinPartsReady:function(){var e=this.getComponentProperty("galleryImageOnClickAction"),t=this.getComponentProperty("expandEnabled");"unset"===e&&(t===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._view.setStyle("overflow","hidden"),this._itemHolder=new Element("div"),this._itemHolder.setStyles({position:"absolute",width:"100%",height:"100%"}),this._skinParts.itemsContainer.appendChild(this._itemHolder),this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.MOUSE_DOWN,this.gotoPrev),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.MOUSE_DOWN,this.gotoNext),this._transitionUtils=new this.imports.TransitionUtils,this._skinParts.virtualContainer||(this._skinParts.virtualContainer=new Element("div"),this._view.grab(this._skinParts.virtualContainer,"top"),this._skinParts.virtualContainer.setStyles({visibility:"hidden",display:"block",width:"1px",height:"1px",overflow:"hidden"})),this._widthDiff=this._skin.widthDiff||0,this._heightDiff=this._skin.heightDiff||0;var i={cursor:"pointer"},n=this.resources.W.Utils.getCSSBrowserFeature("user-select");n&&(i[n]="none"),this._skinParts.buttonPrev.setStyles(i),this._skinParts.buttonNext.setStyles(i),this._checkSkinPartsVisibility(),this._editModeChanged(this._editorMode)},_editModeChanged:function(e){this.resources.W.Viewer.isPublicMode()||this._hideIndicatorElement||(this._createSlideShowIndicatorElement(),"PREVIEW"===e?this._hideEditModeSlideShowIndicator():this._showEditModeSlideShowIndicator())},_createSlideShowIndicatorElement:function(){if(!this._editorIndicatorElement){var e=this.resources.W.Theme.getProperty("WEB_THEME_DIRECTORY")+"ico_slide.png";this._editorIndicatorElement=new Element("div",{styles:{position:"absolute",top:"50%",width:"100%",marginTop:"-18px",textAlign:"center"}});var t=new Element("b",{styles:{display:"inline-block",borderRadius:"3px",background:"#222 url("+e+") no-repeat 8px 50%",opacity:"0.6",color:"#ffffff",padding:"0 14px 0 66px",whiteSpace:"nowrap",height:"38px",lineHeight:"39px",fontSize:"12px"}});t.set("text","Slide Show"),t.insertInto(this._editorIndicatorElement)}this._editorIndicatorElement.insertInto(this._view)},_hideEditModeSlideShowIndicator:function(){this.removeState("showButtons","editMode"),this._editorIndicatorElement.collapse()},_showEditModeSlideShowIndicator:function(){this.setState("showButtons","editMode"),this._editorIndicatorElement.uncollapse()},_onRepeaterItemReady:function(e,t){t.getViewNode().setStyles({position:"relative"})},_onRepeaterReady:function(e){this._galleryItems=e.readyItems},render:function(){for(var e,t=0;this._galleryItems.length>t;t++)e=this._galleryItems[t].getLogic(),e.invalidateSize(),this._setupDisplayer(e),this._currentItemRef=="#"+e.getDataItem().get("id")?this._insertNewDisplayer(e):e.getViewNode().setStyles({visibility:"hidden",opacity:"1.0"});this._skinParts.counter.set("text",this._currentItemIndex+1+""+"/"+(this._numItems+"")),this._prevItemIndex=this._currentItemIndex},_setupDisplayer:function(e){e.setOwner(this),e.setSize(this.getWidth()-this._widthDiff,this.getHeight()-this._heightDiff,this._imageMode)},_insertNewDisplayer:function(e){var t=this._itemHolder,i=this._currentDisplayer,n=e.getViewNode(),o=parseFloat(this.getComponentProperty("transDuration"));this._currentDisplayer=e,i&&i!==e&&t.adopt(i.getViewNode()),t.adopt(e.getViewNode()),n.setStyles({position:"absolute",top:"0px",left:"0px",visibility:"visible"}),e.setSize(this.getWidth()-this._widthDiff,this.getHeight()-this._heightDiff,this._imageMode),"flexibleHeight"==this._imageMode&&this._adjustFlexibleHeight(this._currentDisplayer,o);var s=this._currentDisplayer.getImageRef();s&&-1==this._displayedImages.indexOf(s)&&this._displayedImages.push(s),t.children.length>1&&(e.setState("transIn"),i&&i.setState("transOut"),this._locked=!0,this._transitionUtils.getTransition(this.getComponentProperty("transition")+"")(t.children[0],t.children[1],this._getTransitionDirection(),o,function(){t.children.length>1&&(t.children[1].setStyle("position","static"),t.removeChild(t.children[0])),this._locked=!1,i&&i.setState("normal"),e.setState("noTransition"),this.fireEvent("transitionFinished")}.bind(this)))},_adjustFlexibleHeight:function(e,t){var i=e.getHeight()+this._heightDiff;this._Tween.to(this._view,t,{height:i,onUpdate:function(e){this.setHeight(parseInt(e)),this.fireEvent("autoSized")}.bind(this)})},_getTransitionDirection:function(){var e=this.getComponentProperty("bidirectional")===!0,t=this.getComponentProperty("reverse")===!0,i={next:0,prev:1},n=0;return e&&(n=i[this._lastCommand]||0,t&&(n=1==n?0:1)),n},_onResize:function(){var e;this.parent(),this._currentDisplayer&&(this._currentDisplayer.setSize(this.getWidth()-this._widthDiff,this.getHeight()-this._heightDiff,this._imageMode),"flexibleHeight"==this._imageMode?window.requestAnimFrame(function(){e=this._currentDisplayer.getHeight()+this._heightDiff,this._view.setStyle("height",e+""+"px"),this.setHeight(e),this.fireEvent("autoSized")}.bind(this)):(e=this.getHeight(),this._view.setStyle("height",e+""+"px"),this.setHeight(e)))},gotoPrev:function(){!this._locked&&this._galleryItems.length>0&&(this._lastCommand="prev",this._currentItemIndex=this._getPrevItemIndex(),this._allRepeatersReady=!1,this._renderIfReady()),this.fireEvent("displayerChanged")},gotoNext:function(){!this._locked&&this._galleryItems.length>0&&(this._lastCommand="next",this._currentItemIndex=this._getNextItemIndex(),this._allRepeatersReady=!1,this._renderIfReady()),this.fireEvent("displayerChanged")},onPageVisibilityChange:function(e){e?this.resources.W.Utils.callLater(this._updateAutoplayState,[],this,1e3):null!=this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},_getNextItemIndex:function(){return this._normalizeIndex(this._currentItemIndex+1)},_getPrevItemIndex:function(){return this._normalizeIndex(this._currentItemIndex-1)},_normalizeIndex:function(e){return(e%this._numItems+this._numItems)%this._numItems}})}),define.component("wysiwyg.viewer.components.SliderGallery",function(e){var t=e;t.inherits("core.components.BaseRepeater"),t.resources(["W.Commands","W.Utils"]),t.traits(["core.components.traits.SwipeSupport"]),t.propertiesSchemaType("SliderGalleryProperties"),t.dataTypes(["ImageList"]),t.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"itemsContainer",dataRefField:"items"},itemsContainer:{type:"htmlElement"},swipeLeftHitArea:{type:"htmlElement"},swipeRightHitArea:{type:"htmlElement"}}),t.binds(["gotoNext","gotoPrev","_updateMovementNoLoop","_updateMovementInLoop","_stopMovement"]),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SliderGallery"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SliderGallery"},commandParameterDataRef:"SELF"}},_itemHolder:null,_itemWidth:0,_itemHeight:0,_gap:20,_movementSpeed:0,_shiftOffset:0,_shiftOffsetMax:0,_shiftOffsetMin:0,_maxSpeed:.05,_aspectRatio:0,_movementActive:!1,_debugMode:!1,_imageMode:"",_lastUpdate:0/0,_updateMovementFunc:null,_loop:!1,_itemsHolderSize:0,_contentOverflow:!1,_segment:0,_isZoomed:!1}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.addEvent("resizeEnd",this._onResizeEnd),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onChangeMode,null)},_onChangeMode:function(e){"PREVIEW"!==e&&this._stopMovement()},_onResizeEnd:function(){this._recalcItemSize(),this._allRepeatersReady=!1,this._renderIfReady()},_recalcItemSize:function(){this._skinParts&&(this._itemHeight=Math.floor(this._skinParts.itemsContainer.getHeight()),this._itemWidth=Math.floor(this._itemHeight*this._aspectRatio))},_processDataRefs:function(e){return this._loop===!0?e.concat(e):e},_onDataChange:function(){this._enableMovement(!1),this._aspectRatio=this._parseAspectRatioPreset(this.getComponentProperty("aspectRatioPreset")),this._aspectRatio?this.setComponentProperty("aspectRatio",this._aspectRatio,!0):this._aspectRatio=parseFloat(this.getComponentProperty("aspectRatio")),this._loop=this.getComponentProperty("loop")===!0,this._maxSpeed=parseInt(this.getComponentProperty("maxSpeed")),this._imageMode=this.getComponentProperty("imageMode")+"",this._gap=parseInt(this.getComponentProperty("margin")),this.parent()},_parseAspectRatioPreset:function(e){var t=e.split(":"),i=0;return 2==t.length&&(i=parseFloat(t[0])/parseFloat(t[1])),i},_onAllSkinPartsReady:function(){var e=this.getComponentProperty("galleryImageOnClickAction"),t=this.getComponentProperty("expandEnabled");"unset"===e&&(t===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._itemHolder=this._skinParts.itemsContainer,this._itemHolder.setStyles({position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px","white-space":"nowrap","-webkit-transform":"translateZ(0)"}),this._skinParts.itemsContainer.setStyles({overflow:this._debugMode?"visible":"hidden",border:this._debugMode?"1px solid black":"0"}),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.SetMediaZoomImage",this,this._onMediaZoomClicked,null),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,this._onMediaZoomClosed,null),this._skinParts.swipeLeftHitArea.addEvent(Constants.CoreEvents.MOUSE_MOVE,this.gotoPrev),this._skinParts.swipeRightHitArea.addEvent(Constants.CoreEvents.MOUSE_MOVE,this.gotoNext),this._skinParts.swipeLeftHitArea.addEvent(Constants.CoreEvents.MOUSE_OUT,this._stopMovement),this._skinParts.swipeRightHitArea.addEvent(Constants.CoreEvents.MOUSE_OUT,this._stopMovement)},_onMediaZoomClicked:function(){this._isZoomed=!0,this._stopMovement()},_onMediaZoomClosed:function(){this._isZoomed=!1},render:function(){var e;for(this._recalcItemSize(),this._updateMovementFunc=this._loop===!0?this._updateMovementInLoop:this._updateMovementNoLoop,this._loop===!1&&(this._segment=0),this._shiftOffset=0,this._itemsHolderSize=0,e=0;this._itemHolder.children.length>e;e++)this._setupDisplayer(this._itemHolder.children[e].getLogic(),e),this._itemsHolderSize+=this._itemHolder.children[e].getLogic().getWidth()+this._gap;this._checkItemsVisibility(),this._applyShiftOffset()},_checkItemsVisibility:function(){var e=this._itemHolder.children.length/2,t=this._loop===!0?this._itemsHolderSize/2:this._itemsHolderSize;for(this._contentOverflow=t>this._skinParts.itemsContainer.getWidth(),this._loop===!0&&this._contentOverflow===!1&&(this._segment=0),i=0;this._itemHolder.children.length>i;i++)this._loop===!0&&this._contentOverflow===!1&&i>=e?this._itemHolder.children[i].setStyle("opacity","0.0"):this._itemHolder.children[i].setStyle("opacity","1.0")
},_setupDisplayer:function(e){e.invalidateSize(),e.setSize(this._itemWidth,this._itemHeight,this._imageMode),e.setOwner(this),e.getViewNode().setStyles({position:"static",display:"inline-block","vertical-align":"top","margin-right":this._gap+""+"px","margin-left":"0px",opacity:"1.0"})},_moveToRight:function(){this._contentOverflow&&(this._setMovementSpeed(this._maxSpeed),this._enableMovement(!0))},_moveToLeft:function(){this._contentOverflow&&(this._setMovementSpeed(-this._maxSpeed),this._enableMovement(!0))},gotoNext:function(){this._isZoomed||this._contentOverflow&&(this._setMovementSpeed(this._maxSpeed),this._enableMovement(!0))},gotoPrev:function(){this._contentOverflow&&(this._setMovementSpeed(-this._maxSpeed),this._enableMovement(!0))},_enableMovement:function(e){e===!0&&this._movementActive===!1&&window.requestAnimFrame(this._updateMovementFunc),e===!0?this._movementActive||(this._shiftOffsetMin=this._skinParts.itemsContainer.getWidth()+this._gap-this._itemsHolderSize,this._offsetIsOnGapOnly()&&(this._shiftOffsetMin=0),this._movementActive=!0):(this._movementActive=!1,this._movementSpeed=0)},_stopMovement:function(){var e=this.resources.W.Utils.Tween;e.to(this,1,{_movementSpeed:0,onComplete:function(){this._enableMovement(!1)}.bind(this)})},_setMovementSpeed:function(e){var t=this.resources.W.Utils.Tween;t.to(this,1,{_movementSpeed:e})},_calcMovementCoeficient:function(){var e=1,t=(new Date).getTime();return isNaN(this._lastUpdate)||(e=(t-this._lastUpdate)/16),this._lastUpdate=t,e},_updateMovementNoLoop:function(){var e=this._calcMovementCoeficient();this._movementActive&&(this._shiftOffset+=-this._movementSpeed*e,this._shiftOffset>this._shiftOffsetMax&&(this._shiftOffset=this._shiftOffsetMax,this._enableMovement(!1)),this._shiftOffset<this._shiftOffsetMin&&(this._shiftOffset=this._shiftOffsetMin,this._enableMovement(!1)),this._applyShiftOffset()),this._movementActive&&window.requestAnimFrame(this._updateMovementFunc)},_updateMovementInLoop:function(){var e=this._calcMovementCoeficient();this._movementActive&&(this._shiftOffset+=-this._movementSpeed*e,0>this._movementSpeed&&(this._segment=0,this._shiftOffset>this._shiftOffsetMax&&(this._shiftOffset-=this._itemsHolderSize/2)),this._movementSpeed>0&&(this._segment=1,0>this._shiftOffset&&(this._shiftOffset+=this._itemsHolderSize/2)),this._applyShiftOffset()),this._movementActive&&window.requestAnimFrame(this._updateMovementFunc)},_applyShiftOffset:function(){var e=this._shiftOffset-this._segment*this._itemsHolderSize/2;this._itemHolder.children.length>0&&this._itemHolder.children[0].setStyle("margin-left",Math.floor(e)+""+"px")},_offsetIsOnGapOnly:function(){return Math.abs(this._shiftOffsetMin)<this._gap&&this._shiftOffsetMin>0}})}),define.component("wysiwyg.viewer.components.SocialBaseComponent",function(e){var t=e;t.inherits("wysiwyg.viewer.components.IFrameComponent"),t.resources(["W.Config"]),t.binds(["_createClickOverlay","_getUrl"]),t.methods({initialize:function(e,t,i){if(this.parent(e,t),this._resizableSides=[],i&&i.propObj)for(var n in i.propObj){var o=i.propObj[n];this.setComponentProperty(n,o)}this._iframeCallback=0},_onResize:function(){this._initialized&&this._renderIframe()},render:function(){this._createClickOverlay(),this._renderComponent(),this._initialized=!0},_renderComponent:function(){if(this._renderIframe(!1),this._getSizeAccordingToProperties){var e=this._getSizeAccordingToProperties();this._changeSize(e)}},_getSizeAccordingToProperties:function(){return{w:225,h:55}},_getUrl:function(){var e=this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/",t=this._getUrlParams();return e+this._getPageName()+"?"+Object.toQueryString(t)},_getPageName:function(){},_getUrlParams:function(){return{}}})}),define.component("wysiwyg.viewer.components.SoundCloudWidget",function(e){var t=e;t.inherits("wysiwyg.viewer.components.IFrameComponent"),t.resources(["W.Config","W.Utils","W.Viewer"]),t.binds(["_stopPlayback","_getSoundCloudUrl"]),t.states(["hasContent","noContent"]),t.dataTypes(["SoundCloudWidget"]),t.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),t.methods({initialize:function(e,t,i){i=i||{},this.parent(e,t,i),this._urlExists=!1,this._view.addEvent(Constants.DisplayEvents.COLLAPSED,this._stopPlayback),this.setMinW(250)},_stopPlayback:function(){this._iframe.set("src","about:blank")},_updateIFrameSize:function(){var e;e=this._iframe,e&&e.set({width:this._view.getWidth()-1,height:this._view.getHeight()-1})},_getUrl:function(){var e=this._getSoundCloudUrl();if(void 0!=e&&""!=e){var t=this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/soundcloud.html";e=t+"?src="+encodeURIComponent(e)}return e},_getSoundCloudUrl:function(){var e=this._data.get("url");if(this._urlExists=!1,void 0!=e&&""!=e){3==e.split("?").length&&(e=e.substring(0,e.lastIndexOf("?"))),e=this.resources.W.Utils.setUrlParam(e,"show_artwork",this._isDataTrue("showArtWork"));var t=this._isDataTrue("autoPlay");(this.resources.W.Viewer.getPreviewMode()&&"PREVIEW"!=this._editorMode||!this.getIsDisplayed())&&(t=!1),e=this.resources.W.Utils.setUrlParam(e,"auto_play",t),this._urlExists=!0}return e||""},_isDataTrue:function(e){var t=!1;return(this._data.get(e)===!0||"true"===this._data.get(e))&&(t=!0),t},_setIframeParams:function(){this._iframe["class"]="html5player",this._iframe.setStyles({position:"absolute"}),this._urlExists===!1?this.setState("noContent"):this.setState("hasContent"),this._updateIFrameSize()},_editModeChanged:function(e,t){("PREVIEW"==e||"PREVIEW"==t)&&this._updateIframe(!0)},setHeight:function(e,t,i){e=Math.max(e,50),this._view.setStyle("height",parseInt(e)+"px"),this.parent(e,t,i)},setWidth:function(e,t,i){e=Math.max(e,200),this._view.setStyle("width",parseInt(e)+"px"),this.parent(e,t,i)}})}),define.component("wysiwyg.viewer.components.TableComponent",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),t.skinParts({tableBody:{type:"htmlElement"},tableHeader:{type:"htmlElement",optional:!0},tableFooter:{type:"htmlElement",optional:!0},table:{type:"htmlElement",optional:!0}}),t.propertiesSchemaType("TableComponentProperties"),t.binds(["_createBodyRow","_createHeaderCell","_createFooterCell","_createBodyCell","_addSpacerRow"]),t.dataTypes(["list","Table"]),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._rowsSequencer=new this.imports.ComponentSequencer,this._rowsSequencer.resolveItem=this._createBodyRow,this._rowsSequencer.addEvent("productionFinished",this._addSpacerRow),this._bodyCellSequencingHook=i.SequencingHook,this._headerFooterCellSequencingHook=i.HeaderFooterSequencingHook||i.SequencingHook},_onAllSkinPartsReady:function(e){this.parent(e);var t=this.getComponentProperty("minHeight");t&&this.setMinH(t),this.getDataItem()&&this._populateTable()},_onComponentPropertyChange:function(e,t){"minHeight"===e&&this.setMinH(t)},setMinH:function(e){this._skinParts&&this._skinParts.table.setStyle("height",e+"px"),this.parent(e),this.setHeight(e)},_onDataChange:function(e,t,i){this._skinParts&&("minHeight"==t?this.setMinH(i.minHeight||i):(this._populateTable(),this.fireEvent("autoSized",{ignoreLayout:!1}))),this.parent(e,t,i)},_populateTable:function(){var e=this.getDataItem();if(this._rowsSequencer.createComponents(this._skinParts.tableBody,e.get("items")),e.hasField("header")){var t=this._createRow(e.get("header"),this._createHeaderCell);this._skinParts.tableHeader.empty().adopt(t)}else this._skinParts.tableHeader.removeFromDOM();if(e.hasField("footer")){var i=this._createRow(e.get("footer"),this._createFooterCell);this._skinParts.tableFooter.empty().adopt(i)}else this._skinParts.tableFooter.removeFromDOM()},_createBodyRow:function(e){return this._createRow(e,this._createBodyCell)},_createRow:function(e,t){var i=new Element("tr"),n=new this.imports.ComponentSequencer;return n.resolveItem=t,n.createComponents(i,e),i},_createHeaderCell:function(e,t,i){return this._createCell(e,t,i,"th",this._headerFooterCellSequencingHook)},_createFooterCell:function(e,t,i){return this._createCell(e,t,i,"td",this._headerFooterCellSequencingHook)},_createBodyCell:function(e,t,i){return this._createCell(e,t,i,"td",this._bodyCellSequencingHook)},_createCell:function(e,t,i,n,o){var s=new Element(n),a=o(e,t,i);a&&s.grab(a);var r=e.styleData;if(r)for(var l in r)s.setStyle(l,r[l]);return s},_addSpacerRow:function(){var e=new Element("tr",{"class":"spacer"}),t=new Element("td",{colspan:"100%"});e.adopt(t),this._skinParts.tableBody.adopt(e),this.fireEvent("autoSized",{ignoreLayout:!1})}})}),define.component("wysiwyg.viewer.components.TwitterFeed",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.resources(["W.Skins","W.Config"]),t.propertiesSchemaType("TwitterFeedProperties"),t.dataTypes(["TwitterFollow"]),t.binds(["_applyThemeColors","_onResizeEnd"]),t.fields({MIN_SIZE:220,EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"FPP_DESIGN_LABEL",command:"WEditorCommands.AdvancedDesign"}]}}),t.methods({initialize:function(e,t,i){i=i||{},this.parent(e,t,i),this.iframeCreated=!1,this.addEvent("resizeEnd",this._onResizeEnd),this._minimumTimeBetweenRenders=2e3},render:function(){this._renderFeed()},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors)},_applyThemeColors:function(e){var t=["bg","txt1","bg2","txt2","linkColor"];for(var i in e.properties)if(t.indexOf(i)>-1)return this._renderFeed(),void 0},_renderFeedAndDontReload:function(){this._renderFeed(!0)},_renderFeed:function(e){this.isReady()&&(this.iframeCreated?this._postMessageToIframe(e):(this._createIframe(),this.iframeCreated=!0))},_createIframe:function(e){var t=new IFrame({src:this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/twfeed.html",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameBorder:"0",scrolling:"no",events:{load:function(){this._iframeCreated=!0,this._postMessageToIframe(e)}.bind(this)}});this._iframe=t,this._view.empty(),this._view.grab(t)},_postMessageToIframe:function(e){var t=this.resources.W.Skins,i=this._skin.className,n={userName:this._data.get("accountToFollow")||"wix",height:this._view.getHeight()-90,width:this._view.getWidth(),numOfTweets:this.getComponentProperty("numOfTweets")||1,shellBGColor:t.getSkinParamValue(i,"bg",this._style).getHex(!1),shellColor:t.getSkinParamValue(i,"txt1",this._style).getHex(!1),tweetBGColor:t.getSkinParamValue(i,"bg2",this._style).getHex(!1),tweetColor:t.getSkinParamValue(i,"txt2",this._style).getHex(!1),tweetLinkColor:t.getSkinParamValue(i,"linkColor",this._style).getHex(!1),start:!e};this._iframe.contentWindow.postMessage(JSON.stringify(n),"*")},setHeight:function(e){e=Math.max(220,e),this._view.setStyle("height",parseInt(e)+"px"),this.parent(e,!0,!0)},setWidth:function(e){e=Math.max(220,e),this._view.setStyle("width",parseInt(e)+"px"),this.parent(e,!0,!0)},_onResize:function(){this.parent(),this._renderFeedAndDontReload()},_onResizeEnd:function(){this._renderFeed()}})}),define.component("wysiwyg.viewer.components.VerticalLine",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["render"]),t.fields({_renderTriggers:[Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.injects().Theme.setProperty("WEB_THEME_DIRECTORY","viewer"),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM]},render:function(){this.setWidth(this.getViewNode().getSize().x)},setHeight:function(e,t,i){this._getNumberOfKnobs(),this.height=e,this.parent(e,t,i)},_getNumberOfKnobs:function(){var e=0;return this._skinParts&&(this._skinParts.bottomKnob&&e++,this._skinParts.topKnob&&e++,this._skinParts.middleKnob&&e++),e}})}),define.component("wysiwyg.viewer.components.VerticalMenu",function(e){var t=e;t.inherits("core.components.BaseRepeater"),t.utilize(["core.components.BaseList","core.components.SimpleButton"]),t.skinParts({repeaterButton:{type:"core.components.MenuButton",repeater:!0,dataRefField:"pages",container:"itemsContainer",hookMethod:"_changePagesRefData",argObject:{listSubType:"PAGES"}},moreButton:{type:"core.components.MenuButton"},itemsContainer:{type:"htmlElement"},moreContainer:{type:"htmlElement"}}),t.binds(["_onMoreButtonClick","_onThemeChange","_arrangeButtons","_onButtonClick","_onMoreButtonOver","_onMoreButtonOut","_onMoreContainerOver","_onMoreContainerOut","_closeMoreMenu","_onPageChanged"]),t.dataTypes(["Document"]),t.propertiesSchemaType("HorizontalMenuProperties"),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE]}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.injects().Theme.addEvent("propertyChange",this._onThemeChange),this._arrangeWaitID=-1,this.injects().Viewer.addEvent("pageTransitionEnded",this._onPageChanged),this._usesExternalData=!0},_onPageChanged:function(e){var t,i;if(this._allButtons)for(t=0;this._allButtons.length>t;t++)i=this._allButtons[t],i.getID()==e?i.setState("selected"):i.removeState("selected")},_onThemeChange:function(){this._changeTriggeredBy="themeChange",this._arrangeButtonsDelayed()},_beforeRepeatersCreation:function(){this._allButtons=[]},_onRepeaterItemReady:function(e,t,i,n){n&&t.addEvent("click",function(){this._onButtonClick(i)}.bind(this)),this._allButtons.push(t),this.parent(e,t,i,n)},_onRepeaterReady:function(){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,this._arrangeButtons),this._addPartsListeners(),this._arrangeButtons()},_addPartsListeners:function(){this._skinParts.moreButton.addEvent("over",this._onMoreButtonOver),this._skinParts.moreButton.addEvent("out",this._onMoreButtonOut),this._skinParts.moreButton.addEvent("click",this._onMoreButtonClick),this._skinParts.moreContainer.addEvent("mouseover",this._onMoreContainerOver),this._skinParts.moreContainer.addEvent("mouseout",this._onMoreContainerOut),this._skinParts.moreContainer.addEvent("mouseout",this._onMoreContainerOut);for(var e=0;this._allButtons.length>e;e++)this._allButtons[e].getViewNode().uncollapse(),this._allButtons[e].addEvent("dataChanged",this._arrangeButtons)},render:function(){this.parent(),"styleChange"==this._changeTriggeredBy?this._arrangeButtonsDelayed():this._arrangeButtons(),this._changeTriggeredBy=""},_onDataChange:function(e){this.getComponentProperties().removeField("spacing"),this._changeTriggeredBy="dataChange",this.parent(e)},_skinParamsChange:function(){this._changeTriggeredBy="styleChange",this.parent()},_arrangeButtonsDelayed:function(){-1!=this._arrangeWaitID&&this.injects().Utils.clearCallLater(this._arrangeWaitID),this._arrangeWaitID=this.callLater(this._arrangeButtons,[],50)},_arrangeButtons:function(){if(void 0!=this._skinParts&&this._allButtons&&0!=this._allButtons.length&&this._isDisplayed&&this.isReady()){this._skinParts.moreButton.getViewNode().collapse(),this._skinParts.moreContainer.collapse(),this._skinParts.itemsContainer.setStyle("width","0px"),this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignText")),this._arrangeWaitID=-1;var e=this._getWidestLabelWidth();this.setMinW(e);for(var t=Math.max(e,this.getWidth()),i=Math.max(this._allButtons[0]._skinParts.label.offsetHeight,Math.floor(this.getHeight()/this._allButtons.length)),n=0;this._allButtons.length>n;n++){var o=this._allButtons[n];o.setWidth(t,!0),o.setHeight(i,!0),o._skinParts.label.setStyle("line-height",i+"px")}this._wCheckForSizeChangeAndFireAutoSized(0)}},_getWidestLabelWidth:function(){for(var e=0,t=0;this._allButtons.length>t;t++){var i=this._allButtons[t],n=parseInt(i._skinParts.label.offsetWidth);parseInt(i._view.getStyle("padding-left")),parseInt(i._view.getStyle("padding-right")),e=Math.max(e,n+i.getExtraPixels(!0).width)}return e},_setMinimumWidthAccordingToText:function(){this.setMinW(labelWidth+viewNodePaddingLeft+viewNodePaddingRight)},_onResize:function(){this._arrangeButtons()},_onButtonClick:function(e){this.injects().Viewer.goToPage(e.get("id"))},_openMoreMenu:function(){this._skinParts.moreContainer.setStyle("display","block"),!this._isMoreContainerOpen,this._isMoreContainerOpen=!0,this._toCloseMoreMenu=!1},_closeMoreMenuTimer:function(){this._toCloseMoreMenu||(this._toCloseMoreMenu=!0,this.injects().Utils.callLater(this._closeMoreMenu,[],this,500))},_closeMoreMenu:function(e){(e||this._toCloseMoreMenu)&&(this._skinParts.moreContainer.setStyle("display","none"),this._toCloseMoreMenu=!1,this._isMoreContainerOpen=!1)},_forceCloseMoreMenu:function(){this._closeMoreMenu(!0)},_onMoreButtonOver:function(){this._openMoreMenu()},_onMoreButtonOut:function(){this._closeMoreMenuTimer()},_onMoreContainerOver:function(){this._openMoreMenu()},_onMoreButtonClick:function(){this._isMoreContainerOpen===!1?this._openMoreMenu():this._forceCloseMoreMenu()},_onMoreContainerOut:function(){this._closeMoreMenuTimer()}})}),define.component("wysiwyg.viewer.components.VerticalRepeater",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),t.dataTypes(["","ImageList"]),t.binds(["_sequencingHook"]),t.skinParts({inlineContent:{type:"htmlElement"}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._sequencer=new this.imports.ComponentSequencer,this._sequencer.resolveItem=i&&i.sequencingHook?this._sequencingHookWrapper(i.sequencingHook):this._sequencingHookWrapper(this._sequencingHook)},_sequencingHookWrapper:function(e){return function(t,i,n){return e(t,i,n)}},getSequencer:function(){return this._sequencer},_sequencingHook:function(){return{comp:"wysiwyg.viewer.components.Displayer",skin:this._skin.compParts.imageItem.skin}},setSequencingHook:function(e){this._sequencer.resolveItem=this._sequencingHookWrapper(e)},_onAllSkinPartsReady:function(){this._sequencer.addEvent("productionFinished",function(e){this._markChildren(e.elements)}.bind(this))},render:function(){this._data&&(this._newItems=[],this._sequencer.createComponents(this._skinParts.inlineContent,this._data.get("items")))},_markChildren:function(e){e.each(function(e,t,i){e.set("isfirst",0==t?"true":"false"),e.set("iseven",1==t%2?"true":"false"),e.set("islast",t==i.length-1?"true":"false")})}})}),define.component("wysiwyg.viewer.components.Video",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({videoFrame:{type:"htmlElement"},preview:{type:"htmlElement"}}),t.binds(["_stopVideo","_getYouTubeParams","_getVimeoParams","_onResize","_onResizeEnd","_getYouTubePreview","_getViemoPreviewUrl"]),t.states([]),t.dataTypes(["Video"]),t.propertiesSchemaType("VideoProperties"),t.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],EDITOR_META_DATA:{general:{settings:!0,design:!0}},_defaultPlayerParams:{wmode:"transparent"},_options:{videoType:"",videoId:"",resize:[]}}),t.methods({_getServices:function(){return{YOUTUBE:{url:"http://www.youtube.com/embed/",preview:this._getYouTubePreview,getParams:this._getYouTubeParams,hMinSize:200,wMinSize:200},VIMEO:{url:"http://player.vimeo.com/video/",preview:this._getViemoPreviewUrl,getParams:this._getVimeoParams,hMinSize:100,wMinSize:100}}},initialize:function(e,t,i){i=i||{},this.parent(e,t,i),this._iframe=null,this._inPublicMode=this.injects().Viewer.isPublicMode(),this.addEvent("resizeEnd",this._onResizeEnd),this._view.addEvent(Constants.DisplayEvents.COLLAPSED,this._stopVideo)},_stopVideo:function(){this._iframe.set("src","about:blank")},render:function(){this._renderIframe(),this.setMinW(this._getWMinSize()),this.setMinH(this._getHMinSize())},_onResize:function(){this.parent()},_onResizeEnd:function(){this._renderIframe()},_editModeChanged:function(e,t){if(!this.injects().Viewer.isPublicMode()){var i="PREVIEW";this._inPublicMode=e==i,(t==i||e==i)&&this._renderIframe()}},setHeight:function(e,t,i){e=Math.max(e,this._getHMinSize()),this._view.setStyle("height",parseInt(e,10)+"px"),this.parent(e,!0,i)},setWidth:function(e,t,i){e=Math.max(e,this._getWMinSize()),this._view.setStyle("width",parseInt(e,10)+"px"),this.parent(e,t,i)},_getHMinSize:function(){var e=this._getVideoType(),t=this._getServices()[e].hMinSize,i=this.getComponentProperty("showControls");return"YOUTUBE"==e&&"always_show"==i&&(t+=20),t},_getWMinSize:function(){var e=this._getVideoType();return this._getServices()[e].hMinSize},_renderIframe:function(){if(this._options.videoType=this._getVideoType(),this._options.videoId=this._getVideoId(),this._options.videoId&&this._options.videoType){if(!this._inPublicMode&&(Browser.ie||Browser.firefox&&Browser.Platform.mac))return this._createPreview(),void 0;this._skinParts.videoFrame.uncollapse(),this._skinParts.preview.collapse(),this._iframe&&this._skinParts.videoFrame.hasChildNodes()?this._updateIframe(this._getUrl(),this.getWidth(),this.getHeight()):this._createIframe(this._getUrl(),this.getWidth(),this.getHeight()),this._iframe.setStyles({height:"100%",width:"100%"})}},_getContainerIframe:function(){return this.injects().Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/video.html"},_createIframe:function(e,t,i){var n=this._getContainerIframe()+"?url="+encodeURIComponent(e)+"&width="+t+"&height="+i;this._iframe=new IFrame({src:n,webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameborder:"0"}),this._iframe.insertInto(this._skinParts.videoFrame)},_updateIframe:function(e){var t=this._getContainerIframe()+"?url="+encodeURIComponent(e);this._iframe.set({src:t})},_getPlayerParamsAsQueryString:function(){var e=this._getServices()[this._options.videoType].getParams(),t=[];return Object.forEach(e,function(e,i){t.push(i+"="+e)}),t.join("&")},_getYouTubeParams:function(){var e={},t=this.getComponentProperty("showControls"),i=this.injects().Config.isFacebookSite(),n=this.getComponentProperty("autoplay")&&!i,o=this.getComponentProperty("lightTheme"),s=this.getComponentProperty("loop"),a=this.getComponentProperty("showinfo");switch(e.wmode="transparent",this._inPublicMode&&(e.autoplay=n&&this.getIsDisplayed()?"1":"0"),e.theme=o?"light":"dark",t){case"always_show":e.controls="1",e.autohide="0";break;case"always_hide":e.controls="0";break;case"temp_show":e.autohide="1";break;default:}return s?(e.loop="1",e.playlist=this._options.videoId):e.loop="0",e.showinfo=a?"1":"0",e.rel="0",e},_getVimeoParams:function(){var e={};return this._inPublicMode&&(e.autoplay=this.getIsDisplayed()?this.getComponentProperty("autoplay"):0),e.loop=this.getComponentProperty("loop"),e.byline=this.getComponentProperty("showinfo"),e.portrait=this.getComponentProperty("showinfo"),e.title=this.getComponentProperty("showinfo"),e},_getUrl:function(){return this._getServices()[this._options.videoType].url+this._options.videoId+"?"+this._getPlayerParamsAsQueryString()},_getVideoType:function(){return this._data&&this._data.get("videoType")},_getVideoId:function(){return this._data&&this._data.get("videoId")},_createPreview:function(){var e=this._getServices(),t=this._options.videoType,i=e[t].preview;i()},_renderPreviewImage:function(e){var t=this._view.getWidth(),i=this._view.getHeight();this._image?this._updatePreviewImage(e,i,t):this._createPreviewImage(e,i,t)},_createPreviewImage:function(e,t,i){this._image=new Image,this._image.src=e,this._image.setStyles({height:t,width:i}),this._image.insertInto(this._skinParts.preview),this._options.resize.push(this._image),this._skinParts.videoFrame.collapse(),this._skinParts.preview.uncollapse()},_updatePreviewImage:function(e,t,i){this._image.get("src")!=e&&this._image.set("src",e),this._image.setStyles({height:t,width:i}),this._skinParts.videoFrame.collapse(),this._skinParts.preview.uncollapse()},_getYouTubePreview:function(){var e="http://img.youtube.com/vi/[repLace]/0.jpg",t=e.replace("[repLace]",this._options.videoId);this._renderPreviewImage(t)},_getViemoPreviewUrl:function(){var e="http://vimeo.com/api/v2/video/[repLace].json",t=e.replace("[repLace]",this._options.videoId),i=new Request.JSONP({url:t+"?"+"r="+Math.random(),onComplete:this.onVimeoRetrun.bind(this)});i.send()},onVimeoRetrun:function(e){var t=e&&e[0]&&e[0].thumbnail_large;this._renderPreviewImage(t)}})}),define.component("wysiwyg.viewer.components.WFacebookComment",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.resources(["W.Utils","W.Viewer","W.TPA"]),t.propertiesSchemaType("WFacebookCommentProperties"),t.skinParts({facebook:{type:"htmlElement"}}),t.states({EDITOR:["light","dark"],VIEWER:["scriptLoading","scriptLoaded","loading","idle"]}),t.binds(["_onResizeEnd","_onFacebookComponentRender","_checkIframeSize","_renderComponentOnViewer","_rebuildFacebookComponent"]),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),t.methods({initialize:function(e,t){this.parent(e,t),this.addEvent("resizeEnd",this._onResizeEnd),this._resizableSides=[Constants.BaseComponent.ResizeSides.RIGHT,Constants.BaseComponent.ResizeSides.LEFT],this.resources.W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this._iframeOldHeight=0},render:function(){this._createClickOverlay(),this._renderComponent()},_editModeChanged:function(e,t){("PREVIEW"==e||"PREVIEW"==t)&&this._renderComponent()},_onResizeEnd:function(){this._skinParts&&(this.setComponentProperty("width",this.getWidth()),this._renderComponent())},_renderComponent:function(){this.resources.W.Viewer.isPublicMode()||!Browser.ie?this._renderComponentOnViewer():this._renderComponentOnEditor()},_renderComponentOnEditor:function(){var e=this.getComponentProperty("colorScheme");this.setState(e,"editor")},_renderComponentOnViewer:function(){var e=this.getState("viewer");return e?"loading"==e||"scriptLoading"==e?(this.callRenderLater(),!1):(this.setState("loading","viewer"),this._rebuildFacebookComponent(),void 0):(this.setState("scriptLoading","viewer"),this._loadScript(function(){this.setState("scriptLoaded","viewer")}.bind(this)),this.callRenderLater(),!1)},_rebuildFacebookComponent:function(){var e=this._getFacebookHref();this._skinParts.facebook.empty();var t={"class":"fb-comments","data-href":e,"data-num-posts":this.getComponentProperty("numPosts"),"data-width":this.getComponentProperty("width"),"data-colorscheme":this.getComponentProperty("colorScheme"),mobile:!1};this._fbCommentElement=new Element("DIV",t),this._fbCommentElement.insertInto(this._skinParts.facebook),window.FB&&FB.XFBML&&FB.XFBML.parse&&FB.XFBML.parse(this._skinParts.facebook),this.setState("idle","viewer")},appendPageHash:function(e){var t=this.resources.W.Viewer.getCurrentPageId(),i=this.resources.W.Viewer.getPagesData()[t],n=this.resources.W.TPA.getPageState(t),o=this.resources.W.Utils.hash.getHashPartsString(t,i.get("pageUriSEO"),n);return this.resources.W.Utils.strEndsWith(e,"#!"+o)||(e+=this.resources.W.Utils.strEndsWith(e,"/#")?"!"+o:this.resources.W.Utils.strEndsWith(e,"/")?"#!"+o:"/#!"+o),e},_getFacebookHref:function(){var e=location.href;return this.resources.W.Viewer.isHomePage()&&(e=this.appendPageHash(e)),e},_onFacebookComponentRender:function(){if(this.isReady()){var e=this._skinParts.facebook.getSize(),t=e.y;this.setHeight(t),this._wCheckForSizeChangeAndFireAutoSized(1)}},dispose:function(){this._iframeAuditor&&clearInterval(this._iframeAuditor),window.FB&&(FB.Event.unsubscribe("xfbml.render",this._onFacebookComponentRender),FB.Event.subscribe("comment.create",this._onFacebookComponentRender),FB.Event.subscribe("comment.remove",this._onFacebookComponentRender)),this.parent()},setWidth:function(e,t,i){var n=400;e>=n?this.parent(e,t,i):this.parent(n,t,i)},_checkIframeSize:function(){if(this.isReady()){var e=this._skinParts.facebook.getElement("iframe");if(e){var t=e.getSize().y;this._iframeOldHeight!=t&&(this._iframeOldHeight=t,this._onFacebookComponentRender())}}},_loadScript:function(e){var t="236335823061286";this.resources.W.Viewer.loadExternalScript("//connect.facebook.net/en_US/all.js",function(){FB.Event.subscribe("xfbml.render",this._onFacebookComponentRender),FB.Event.subscribe("comment.create",this._onFacebookComponentRender),FB.Event.subscribe("comment.remove",this._onFacebookComponentRender),this._iframeAuditor=setInterval(function(){this._checkIframeSize()}.bind(this),500),FB.init({appId:t,xfbml:1}),e()}.bind(this))}})}),define.component("wysiwyg.viewer.components.WFacebookLike",function(e){var t=e;t.inherits("wysiwyg.viewer.components.SocialBaseComponent"),t.resources(["W.Utils","W.Viewer"]),t.propertiesSchemaType("WFacebookLikeProperties"),t.skinParts({facebook:{type:"htmlElement"}}),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),t.methods({initialize:function(e,t,i){this.resources.W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this.parent(e,t,i)},render:function(){this._layout=this.getComponentProperty("layout"),this._showFaces=this.getComponentProperty("show_faces"),this._action=this.getComponentProperty("action"),this._colorScheme=this.getComponentProperty("colorScheme"),this._send=this.getComponentProperty("send"),this.parent()},_getPageName:function(){return"fblike.html"},_getUrlParams:function(){return{href:this._getLikeUrl(),layout:this._layout,show_faces:this._showFaces,action:this._action,colorscheme:this._colorScheme,send:this._send,width:this._getSizeAccordingToProperties().x}},_getLikeUrl:function(){if(this.resources.W.Viewer.isPublicMode()){var e=window.publicModel.externalBaseUrl||location.protocol+"//"+location.host+location.pathname;return this.resources.W.Viewer.isHomePage()?e:e+location.hash}return"http://www.wix.com/create/website"},_getSizeAccordingToProperties:function(){var e,t;return"standard"==this._layout?(e=250,"recommend"==this._action&&(e+=40),t=this._showFaces?85:40):"button_count"==this._layout?(e=90,t=20,"recommend"==this._action&&(e+=40)):"box_count"==this._layout&&(e=55,"recommend"==this._action&&(e+=40),t=65),{w:e,h:t}}})}),define.component("wysiwyg.viewer.components.WGooglePlusOne",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.resources(["W.Utils","W.Viewer"]),t.binds(["_renderComponentOnViewer","_renderComponentOnEditor","_rebuildComponent","_getSizeAccordingToState","_setComponentSize"]),t.propertiesSchemaType("WGooglePlusOneProperties"),t.states({LAYOUT:["small_bubble","small_none","small_inline","medium_bubble","medium_none","medium_inline","standard_bubble","standard_none","standard_inline","tall_bubble","tall_none","tall_inline"],VIEWER:["scriptLoading","scriptLoaded","loading","idle"]}),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.resources.W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this._resizableSides=[],this._props=i},render:function(){this._createClickOverlay(),this._size=this.getComponentProperty("size"),this._annotation=this.getComponentProperty("annotation"),this._renderComponent()},_renderComponent:function(){this.setState(this._size+"_"+this._annotation,"LAYOUT"),this.resources.W.Viewer.isPublicMode()||!Browser.ie?this._renderComponentOnViewer():this._renderComponentOnEditor()},_renderComponentOnEditor:function(){this._setComponentSize()},_renderComponentOnViewer:function(){this._view.setStyles({background:"none"});var e=this.getState("viewer");return e&&""!=e?"loading"==e||"scriptLoading"==e?(this.callRenderLater(),!1):(this.setState("loading","VIEWER"),this._rebuildComponent(function(){this.setState("idle","VIEWER")}.bind(this)),void 0):(this.setState("scriptLoading","viewer"),this._loadScript(function(){this.setState("scriptLoaded","VIEWER")}.bind(this)),this.callRenderLater(),!1)},_rebuildComponent:function(e){this._skinParts.googlePlus.empty();var t={"class":"googlePlusOne",href:location.href};
t=this._props?{size:this._props.size||this._size,annotation:this._props.annotation||this._annotation,width:this._props.width||this._view.getWidth()}:{size:this._size,annotation:this._annotation,width:this._view.getWidth()},this._googlePlusOneElement=new Element("g\\:plusone",t),this._skinParts.googlePlus.adopt(this._googlePlusOneElement),window.gapi&&gapi.plusone&&gapi.plusone.go&&gapi.plusone.go(this._skinParts.googlePlus),this.callLater(this._setComponentSize,null,100),e()},_setComponentSize:function(){var e=this._props&&this._props.width?this._props.width:this._getSizeAccordingToState();this.setHeight(e.h),this.setWidth(e.w),this._wCheckForSizeChangeAndFireAutoSized(5)},_loadScript:function(e){this.resources.W.Viewer.loadExternalScript("https://apis.google.com/js/plusone.js",function(){e()}.bind(this))},_getSizeAccordingToState:function(){switch(this.getState("LAYOUT")){case"small_bubble":return{w:70,h:15};case"small_none":return{w:24,h:15};case"small_inline":return{w:250,h:15};case"medium_bubble":return{w:90,h:20};case"medium_none":return{w:32,h:20};case"medium_inline":return{w:250,h:20};case"standard_bubble":return{w:106,h:24};case"standard_none":return{w:38,h:24};case"standard_inline":return{w:250,h:24};case"tall_bubble":return{w:50,h:60};case"tall_none":return{w:50,h:20};case"tall_inline":return{w:250,h:20}}}})}),define.component("wysiwyg.viewer.components.WPhoto",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.traits(["wysiwyg.common.components.traits.LinkableComponent"]),t.utilize(["core.components.image.ImageSettings","core.components.image.ImageDimensionsNew"]),t.skinParts({link:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*",hookMethod:"_setImageArgs"}}),t.dataTypes(["Image"]),t.propertiesSchemaType("WPhotoProperties"),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"photos"}},{label:"PHOTO_EDIT_IMAGE",command:"WEditorCommands.OpenAviaryDialog"},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"photos"}}}}),t.statics({MIN_IMAGE_HEIGHT:1,MIN_IMAGE_WIDTH:1,_autoSizeStates:{none:1,autoSizeNoLayoutUpdate:2,autoSizeUpdateLayout:3}}),t.methods({initialize:function(e,t,i){this._imageDimensions=new this.imports.ImageDimensionsNew,this._SettingsClass=this.imports.ImageSettings,this.parent(e,t,i),i&&i.props&&this.setComponentProperties(i.props),this._contentPadding={x:0,y:0},this._autoSizeState=this._autoSizeStates.none,this._initialDataChange=!0},_setImageArgs:function(e){return e.argObject={requestExactSize:this.injects().Viewer.getPreviewMode()!==!0},e},_onAllSkinPartsReady:function(e){this.parent(e),this._data&&this._setTitle()},_preventRenderOnDataChange:function(e,t){return t&&"displayMode"!=t&&"href"!=t?!0:!1},_onDataChange:function(e,t,i){if(this._skinParts&&"title"==t&&this._setTitle(),"displayMode"==t){var n=this._translateDisplayModeToImageCropMode(i.displayMode);this._getImageSettings().setCropMode(n)}this._initialDataChange||!this._isFitMode()||"displayMode"!=t&&t||(this._autoSizeState=this._autoSizeStates.autoSizeUpdateLayout),this._initialDataChange=!1,this.parent(e,t,i)},setWidth:function(e,t,i,n){if(e&&!isNaN(e)&&(n||"fitHeightStrict"!=this._getDisplayMode())&&(this._getImageSettings().setContainerWidth(e-this._getContentPaddingSize().x),this.parent(e,t,i),!n)){var o=this._getImageDisplayMode();o==this._SettingsClass.CropModes.FIT_HEIGHT&&this._isDisplayed&&this._getImageSettings().setCropMode(this._SettingsClass.CropModes.FIT_WIDTH),(o===this._SettingsClass.CropModes.FIT_WIDTH||o===this._SettingsClass.CropModes.FIT_HEIGHT)&&(this._autoSizeState=this._autoSizeStates.autoSizeNoLayoutUpdate),this._renderImage()}},setHeight:function(e,t,i,n){if(e&&!isNaN(e)&&(n||"fitWidthStrict"!=this._getDisplayMode())&&(this.parent(e,t,i),this._getImageSettings().setContainerHeight(e-this._getContentPaddingSize().y),!n)){var o=this._getImageDisplayMode();o==this._SettingsClass.CropModes.FIT_WIDTH&&this._isDisplayed&&this._getImageSettings().setCropMode(this._SettingsClass.CropModes.FIT_HEIGHT),(o===this._SettingsClass.CropModes.FIT_WIDTH||o===this._SettingsClass.CropModes.FIT_HEIGHT)&&(this._autoSizeState=this._autoSizeStates.autoSizeNoLayoutUpdate),this._renderImage()}},getMinPhysicalHeight:function(){return this._getContentPaddingSize().y},render:function(){this._styleChanged(),this._renderImage(),this.parent()},_renderImage:function(){if(this._layoutInitialized){var e=this._skinParts.img;if(e&&e.getOriginalClassName){var t=this._getImageSettings();e.setSettings(t),t.getCropMode()==t.CropModes.FIT_WIDTH?this.setHeight(e.getSize().y+this._getContentPaddingSize().y,!1,!1,!0):t.getCropMode()==t.CropModes.FIT_HEIGHT&&this.setWidth(e.getSize().x+this._getContentPaddingSize().x,!1,!1,!0),this._fireAutoSize()}}},_fireAutoSize:function(){this._autoSizeState!=this._autoSizeStates.none&&(this.fireEvent("autoSized",{ignoreLayout:this._autoSizeState==this._autoSizeStates.autoSizeNoLayoutUpdate}),this.injects().Layout.notifyPositionChanged(this,"updateSize"),this._autoSizeState=this._autoSizeStates.none)},_styleChanged:function(){var e=this._getContentPaddingSize(!0);this.setMinH(e.y+this.MIN_IMAGE_HEIGHT),this.setMinW(e.x+this.MIN_IMAGE_WIDTH);var t=this._getPhotoInnerSize();this._getImageSettings().setSize(t.x,t.y)},_getContentPaddingSize:function(e){if(!this._contentPadding||e){this._contentPadding={};var t=this.getSkin();this._contentPadding.x=parseInt(t.getParamValue("contentPaddingLeft"),10)+parseInt(t.getParamValue("contentPaddingRight"),10),this._contentPadding.y=parseInt(t.getParamValue("contentPaddingTop"),10)+parseInt(t.getParamValue("contentPaddingBottom"),10),this._contentPadding.x=isNaN(this._contentPadding.x)?0:this._contentPadding.x,this._contentPadding.y=isNaN(this._contentPadding.y)?0:this._contentPadding.y,this.getSizeLimits().minH=this._contentPadding.y,this.getSizeLimits().minW=this._contentPadding.x}return this._contentPadding},_getImageSettings:function(){if(!this._imageSettings){var e=this._getPhotoInnerSize(),t=this._translateDisplayModeToImageCropMode(this._getDisplayMode());this._imageSettings=new this.imports.ImageSettings(t,e.x,e.y)}return this._imageSettings},_getPhotoInnerSize:function(){var e=this._getContentPaddingSize(),t=this.getWidth()-e.x,i=this.getHeight()-e.y;return{x:t,y:i}},_setTitle:function(){var e=this._data.get("title");e&&this._skinParts.view.set("title",e)},_getDisplayMode:function(){return this.getComponentProperty("displayMode")},_getImageDisplayMode:function(){return this._getImageSettings()&&this._getImageSettings().getCropMode()},_translateDisplayModeToImageCropMode:function(e){var t=e;return"fitWidthStrict"==e&&(t=this._SettingsClass.CropModes.FIT_WIDTH),"fitHeightStrict"==e&&(t=this._SettingsClass.CropModes.FIT_HEIGHT),t},allowHeightLock:function(){return!this._isFitMode()},_isFitMode:function(){var e=["fitWidth","fitWidthStrict","fitHeightStrict"];return e.indexOf(this._getDisplayMode())>=0}})}),define.component("wysiwyg.viewer.components.WRichText",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({richTextContainer:{type:"htmlElement"}}),t.binds(["_modeChanged","_updateText"]),t.dataTypes(["RichText","Text"]),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED],EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"EDIT_RICH_TEXT",command:"EditorUI.StartEditRichText"}]}}),t.methods({initialize:function(e,t,i){this.injects().Commands&&this.injects().Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._modeChanged),this.parent(e,t,i),this.setMaxH(5e3)},_onAllSkinPartsReady:function(){var e=this._data.get("text");this.getRichTextContainer().set("html",e),this._modeChanged("VIEW"),this._data.addEvent(Constants.DataEvents.DATA_CHANGED,this._updateText);var t=this._data.getMeta("isPreset");this._data.set("text",this.getRichTextContainer().innerHTML),this._data.setMeta("isPreset",t)},_updateText:function(){var e=this._data.get("text");this.getRichTextContainer().set("html",e)},_modeChanged:function(e){var t;if(("PREVIEW"==e||"VIEW"==e)&&this._skinParts)for(var i=$(this.getRichTextContainer()).getElements("a"),n=0;i.length>n;n++){var o=i[n],s=o.getAttribute("dataquery"),a=this;if(s){var r=this.injects().Data.getDataByQuery(s);if(r=r||this.injects().Data.getDataByQuery("#"+s),!r)return LOG.reportError(wixErrors.LINK_DATA_ITEM_DOESNT_EXIST,"WRichText","_modeChanged",s),void 0;var l=r.get("href");o.set("href",l);var d=r.get("linkType");"PREVIEW"==e&&"PAGE"!=d?o.set("target","_blank"):(t=r.get("target"),t&&o.set("target",t)),a._sanitizeLink(o)}}},getRichTextContainer:function(){return this._skinParts?this._skinParts.richTextContainer:null},isEditableInPlace:function(){return!0}})}),define.component("wysiwyg.viewer.components.WSiteStructure",function(e){var t=e;t.inherits("core.components.Container"),t.binds(["_onThemePropertyChange","_updateSiteBgPosition","_updateSiteBgSize","_validateBg","_delayedInvalidateBg","_invalidateBg","_setBgAsImageViewMode"]),t.resources(["W.Utils","W.Viewer","W.Theme","W.Components","W.Data"]),t.statics({MAX_SITE_HEIGHT:1e5}),t.methods({initialize:function(e,t,i){this._bgNode=new Element("div",{id:"bgNode"}),this._bgNode.setStyles({position:"absolute",width:"100%"}),this._bgNode.inject(document.body,"top"),this._bgStyle={},this._lastBgStyle={},this.parent(e,t,i),window.onorientationchange&&window.addEvent("orientationchange",this._invalidateBg),window.addEvent("scroll",this._delayedInvalidateBg),window.addEvent("resize",this._delayedInvalidateBg),this.resources.W.Theme.addEvent("propertyChange",this._onThemePropertyChange),this._updateBgProperty(),this._validateBg(),this.setMaxH(this.MAX_SITE_HEIGHT),this.resources.W.Viewer.getPreviewMode()&&this._view.setStyle("padding-bottom",100)},render:function(){var e=this.resources.W.Viewer.getDocWidth();this.setWidth(e),this.parent()},_getReformattedBgColor:function(){return this.parent()},_onThemePropertyChange:function(e){e&&"propertyChange"==e.type&&"siteBg"!=e.name||(this._updateBgProperty(),this._invalidateBg())},_updateBgProperty:function(){this._siteBgDef=this.resources.W.Theme.getProperty("siteBg"),this._bgFixed="fixed"==this._siteBgDef.getAttachment(),this._bgStyle["background-image"]=this._siteBgDef.getUrl(),this._bgStyle["background-size"]=this._siteBgDef.getCssSizeValue(),this._bgStyle["background-position"]=this._siteBgDef.getPosition(),this._bgStyle["background-repeat"]=this._siteBgDef.getRepeatUnified(),this._bgStyle["background-color"]=this._siteBgDef.getColor()},_updateSiteBgSize:function(){this._bgStyle.height=this._bgFixed?$(document.body).getSize().y+"px":Math.max(this._siteHeight||50,$(document.body).getSize().y)+"px"},_updateSiteBgPosition:function(){Modernizr.positionfixed?this._bgStyle.position=this._bgFixed?"fixed":"absolute":this._bgStyle.top=this._bgFixed?document.body.scrollTop+"px":0},_delayedInvalidateBg:function(){this._delayedInvalidateBgTimeout&&clearTimeout(this._delayedInvalidateBgTimeout),this._delayedInvalidateBgTimeout=this.resources.W.Utils.callLater(this._invalidateBg,null,this,150)},_invalidateBg:function(){this._bgRenderCall||(this._bgRenderCall=this.resources.W.Utils.callOnNextRender(this._validateBg,10))},_validateBg:function(){delete this._bgRenderCall,this._updateSiteBgSize(),this._updateSiteBgPosition(),this._isBgStyleChanged()&&(this._lastBgStyle=Object.clone(this._bgStyle),this._bgNode.setStyles(this._bgStyle),Modernizr.backgroundsize||("none"===this._bgStyle["background-image"]||"contain"!==this._bgStyle["background-size"]&&"cover"!==this._bgStyle["background-size"]?this._bgAsImage&&this._bgAsImage.collapse():(this._bgNode.setStyle("background-image","none"),this._setBgAsImage(this._bgNode))))},_setBgAsImage:function(){this._bgAsImage?(this._setBgAsImageDataItemValues(this._siteBgDef.getImageId(),this._siteBgDef.getImageSize()),this._setBgAsImageViewMode(this._bgAsImage.getLogic())):(this._bgAsImageDataItem=this.resources.W.Data.createDataItem({type:"Image",uri:this._siteBgDef.getImageId(),width:this._siteBgDef.getImageSize()[0],height:this._siteBgDef.getImageSize()[1],borderSize:0,title:"",description:"",alt:""}),this._bgAsImage=this.resources.W.Components.createComponent("core.components.Image","mobile.core.skins.ImageSkin",this._bgAsImageDataItem,{width:"100",height:"100",unit:"%"},null,this._setBgAsImageViewMode),this._bgAsImage.insertInto(this._bgNode))},_setBgAsImageDataItemValues:function(e,t){this._bgAsImageDataItem&&this._bgAsImageDataItem.setFields({uri:e,width:t[0],height:t[1]})},_setBgAsImageViewMode:function(e){var t="contain"===this._bgStyle["background-size"]?"full":"fill",i=this._bgStyle["background-position"].split(" ");e.setCropMode(t),e.setAlign(i[0],i[1]),e.uncollapse()},_isBgStyleChanged:function(){for(var e in this._bgStyle)if(this._bgStyle[e]!=this._lastBgStyle[e])return!0;return!1},setHeight:function(e){this._siteHeight!=e&&(this._siteHeight=e,this._delayedInvalidateBg(),this.parent(e),this.resources.W.Viewer.siteHeightChanged(!0))},_getBestFit:function(e,t){return this.parent(e,t)},_getWantedBgSize:function(){return this.parent()},getChildComponents:function(){return this.getViewNode().getChildren("[comp]")},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS,distance:0},from:{allow:!1,lock:Constants.BaseComponent.AnchorLock.NEVER}}},layoutMinHeight:function(){return 0}})}),define.component("wysiwyg.viewer.components.WTwitterFollow",function(e){var t=e;t.inherits("wysiwyg.viewer.components.SocialBaseComponent"),t.skinParts({twitter:{type:"htmlElement"}}),t.dataTypes(["TwitterFollow"]),t.propertiesSchemaType("WTwitterFollowProperties"),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),t.methods({render:function(){this._showCount=this.getComponentProperty("showCount"),this._showScreenName=this.getComponentProperty("showScreenName");var e=this._data.get("accountToFollow").replace("@","");e||(e="wix"),this._screenName=e,this.parent()},_getPageName:function(){return"twfollow.html"},_getUrlParams:function(){return{screen_name:this._screenName,href:"https://twitter.com/"+this._screenName,show_count:this._showCount,show_screen_name:this._showScreenName,lang:this.getComponentProperty("dataLang"),align:"left"}},_getSizeAccordingToProperties:function(){var e=80,t=20;return this._showCount&&(e+=85),this._showScreenName&&(e+=6*this._screenName.length),{w:e,h:t}}})}),define.component("wysiwyg.viewer.components.WTwitterTweet",function(e){var t=e;t.inherits("wysiwyg.viewer.components.SocialBaseComponent"),t.resources(["W.Utils"]),t.skinParts({twitter:{type:"htmlElement"}}),t.dataTypes(["TwitterTweet"]),t.propertiesSchemaType("WTwitterTweetProperties"),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),t.methods({initialize:function(e,t,i){this.resources.W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this.parent(e,t,i)},_getPageName:function(){return"twtweet.html"},_getUrlParams:function(){return{href:"https://twitter.com/share",count:this.getComponentProperty("dataCount"),lang:this.getComponentProperty("dataLang"),url:location.href,text:this._data.get("defaultText"),related:this._data.get("accountToFollow"),counturl:location.href}},_getSizeAccordingToProperties:function(){var e,t,i=this.getComponentProperty("dataCount");switch(t=20,i){case"none":e=60;break;case"horizontal":e=100;break;case"vertical":e=60,t=62}return{w:e,h:t}}})}),define.component("wysiwyg.viewer.components.WixAds",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({footerLabel:{type:"htmlElement",optional:!1},topRectLabel:{type:"htmlElement",optional:!1},topRectContent:{type:"htmlElement",optional:!1}}),t.binds(["_getAdHeight"]),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED]}),t.methods({initialize:function(e,t,i){this.parent(e,t,i);var n=this.injects().Commands;n.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange),n.registerCommandListenerByName("WViewerCommands.OpenZoom",this,function(){this._showHideAds(!1)}),n.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,function(){this._showHideAds(!this._isPremium())}),this.injects().Viewer.addHeightChangeCallback(this._getAdHeight)},_onAllSkinPartsReady:function(){this.setCollapsed(this.injects().Viewer.getPreviewMode()||this._isPremium()),this._view.addClass("Z-WIX-ADS"),this._skinParts.view.addEvent("click",function(){var e=!this.injects().Viewer.getPreviewMode(),t=e?adData.adUrl.replace("[site_id]",window.siteId):adData.adUrl,i=!e||this._isFacebook();i?window.open(t,"_blank"):window.location.assign(t)}.bind(this)),this.injects().Viewer.getPreviewMode()&&this._addBiEvent()},_addBiEvent:function(){var e=wixEvents.WIXADS_CLICKED_IN_PREVIEW;this._skinParts.topRectLabel.addEvent("click",function(){LOG.reportEvent(e,{c1:"top-right"})}),this._skinParts.footerLabel.addEvent("click",function(){LOG.reportEvent(e,{c1:"footer"})})},render:function(){this.parent();var e=this.injects().Viewer.getAdData();this._skinParts.topRectLabel.set("html",e.topLabel),this._skinParts.topRectContent.set("html",e.topContent),this._skinParts.footerLabel.set("html",e.footerLabel)},_onModeChange:function(e){this._showHideAds(this._shouldShowAds(e))},_showHideAds:function(e){this.setCollapsed(!e),this.injects().Viewer.siteHeightChanged(!1)},_shouldShowAds:function(e){return this._isInPreviewMode(e)&&!this._isPremium()},_isInPreviewMode:function(e){return e.toLowerCase()===Constants.ViewManager.VIEW_MODE_PREVIEW.toLowerCase()},_isPremium:function(){var e=window.rendererModel||window.editorModel&&window.editorModel.metaSiteData||window.top&&window.top.editorModel&&window.top.editorModel.metaSiteData;if(!e||!e.premiumFeatures)return!1;var t=e.premiumFeatures;return this._isFacebook()?t.contains("NoAdsInSocialSites"):t.contains("AdsFree")||t.contains("ShowWixWhileLoading")},_isFacebook:function(){var e=window.siteHeader.applicationType||window.rendererModel.applicationType;return"HtmlFacebook"===e},_getAdHeight:function(){return this._view.isCollapsed()?0:this._skinParts.footerLabel.getHeight()},_getAdTopHeight:function(){return this._view.isCollapsed()?0:this._skinParts.topRect.getHeight()},getAdHeight:function(){return{footer:this._getAdHeight(),top:this._getAdTopHeight()}}})}),define.component("wysiwyg.viewer.components.inputs.CheckBoxInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),t.skinParts({checkBox:{type:Constants.ComponentPartTypes.HTML_ELEMENT},label:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),t.binds([]),t.states({validation:["valid","invalid"]}),t.dataTypes(["Boolean"]),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(e){this.setState(e?"valid":"invalid","validation")}.bind(this)),this._label=i.label||""},_onAllSkinPartsReady:function(e){var t=e.checkBox;t.addEvent(Constants.CoreEvents.CHANGE,function(){this.getDataItem().set("value",t.get("checked")),t.get("checked")&&this.fireEvent("itemSelected",this)}.bind(this)),1==this.getDataItem().get("value")&&t.setAttribute("checked","checked");var i=e.label.parentNode.id+"-check";e.label.setAttribute("for",i),e.checkBox.setAttribute("id",i),e.label.set("text",this._label)},setError:function(e){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",e)},setDisabled:function(){var e=this._skinParts.checkBox;e.set("disabled","disabled")},setSelected:function(e){var t=this._skinParts.checkBox;t.set("checked",e)}})}),define.component("wysiwyg.viewer.components.inputs.ColorOption",function(e){var t=e;t.skinParts({tooltip:{type:"wysiwyg.common.components.InfoTip"}}),t.inherits("wysiwyg.viewer.components.inputs.TextOption"),t.methods({_onAllSkinPartsReady:function(){this.getViewNode().setStyle("background-color",this.getDataItem().get("text")),this._initializeTooTip(this.getViewNode())}})}),define.component("wysiwyg.viewer.components.inputs.ComboBoxInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.statics({PROMPT_OPTION_VALUE:-1}),t.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),t.skinParts({collection:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),t.binds(["_selectedIndexChanged","_getPromptOptionDataItem"]),t.states({validity:["valid","invalid"]}),t.dataTypes(["SelectableList"]),t.propertiesSchemaType("ComboBoxInputProperties"),t.fields({_optionsData:[]}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(e){this.setState(e?"valid":"invalid","validity")}.bind(this))},_preventRenderOnDataChange:function(e,t){return"selected"==t},_prepareForRender:function(){return this._createDropDownList(),!0},_onAllSkinPartsReady:function(){this._createDropDownList(),this._skinParts.collection.addEvent(Constants.CoreEvents.CHANGE,this._selectedIndexChanged)},_createDropDownList:function(){var e=function(e){this._optionsData=Object.values(e),this._bindDdlToData(this._skinParts.collection)}.bind(this),t=this.getDataItem().get("items").filter(function(e){return e.get("enabled")});t.length>0&&"string"==typeof t[0]?this.injects().Data.getDataByQueryList(t,e):e(t)},_bindDdlToData:function(e){e.empty();for(var t=0;this._optionsData.length>t;t++){var i=this._optionsData[t];e.options[t]=new Option(i.get("text"),i.get("value"))}var n=this.getDataItem().get("selected");n?this._setSelectedFromData(e,n):this.getComponentProperty("hasPrompt")&&this._addPrompt(e)},_setSelectedFromData:function(e,t){var i=this;"string"==typeof t?this.injects().Data.getDataByQuery(t,function(t){i._setSelected(e,t)}):this._setSelected(e,t)},_setSelected:function(e,t){var i=this._optionsData.indexOf(t);i>-1&&e.length>i&&(e.getSelected()[0].erase("selected"),e[i].set("selected","selected"))},_selectedIndexChanged:function(){this._hasPrompt&&this._removePrompt();var e=this._getSelectedIndex();this.setValidationState(!0),this.getDataItem().set("selected",this._optionsData[e]),this.fireEvent("selectionChanged",this._optionsData[e])},_getSelectedIndex:function(){return this._skinParts.collection.selectedIndex},setError:function(e){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",e)},_addPrompt:function(e){var t=this.getComponentProperty("promptText");e.options.add(new Option(t,this.PROMPT_OPTION_VALUE,!0,!0),0),this._optionsData.splice(0,0,this._getPromptOptionDataItem(t)),this._hasPrompt=!0},_removePrompt:function(){var e=this._skinParts.collection;e.getFirst().value==this.PROMPT_OPTION_VALUE&&(e.options.remove(0),this._optionsData.splice(0,1),this._hasPrompt=!1)},_getPromptOptionDataItem:function(e){var t={type:"SelectOption",value:this.getComponentProperty("promptValue"),text:e,enabled:!0,description:""},i=W.Data.createDataItem(t);return i.setMeta("isPersistent",!1),i}})}),define.component("wysiwyg.viewer.components.inputs.DateInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({year:{type:Constants.ComponentPartTypes.HTML_ELEMENT},month:{type:Constants.ComponentPartTypes.HTML_ELEMENT},day:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),t.binds(["_userChange"]),t.states({validation:["valid","invalid"]}),t.dataTypes(["Text"]),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(e){this.setState(e?"valid":"invalid","validation")}.bind(this))},_onAllSkinPartsReady:function(){this._skinParts.year.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.month.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.day.addEvent(Constants.CoreEvents.CHANGE,this._userChange);var e=(new Date).getUTCFullYear();for(i=1979;e+6>i;i++)this._skinParts.year.options.add(new Option(i,i));for(i=1;13>i;i++)this._skinParts.month.options.add(new Option(i,i))},render:function(){var e,t=this._data.get("text"),i=new Date(t),n=i.getUTCFullYear(),o=i.getUTCMonth(),s=i.getUTCDate();for(this._skinParts.year[n-1979].selected=!0,this._skinParts.month[o].selected=!0;this._skinParts.day.options.length;)this._skinParts.day.options.remove(this._skinParts.day.options[0]);for(e=1;this._getDaysForMonth(n,o)+1>e;e++)this._skinParts.day.options.add(new Option(e,e));this._skinParts.day[s-1].selected=!0},_userChange:function(){var e=new Date(0);e.setUTCFullYear(this._skinParts.year.getSelected()[0].value),e.setUTCMonth(this._skinParts.month.getSelected()[0].value-1),e.setUTCDate(this._skinParts.day.getSelected()[0].value),this.getDataItem().set("text",e.toISOString()),this.fireEvent("selectionChanged",e.toISOString())},_getDaysForMonth:function(e,t){return t--,new Date(e,t,0).getDate()}})}),define.component("wysiwyg.viewer.components.inputs.NumberInput",function(e){var t=e;t.propertiesSchemaType("NumberInputProperties"),t.inherits("wysiwyg.viewer.components.inputs.TextInput"),t.fields({_origValue:null,_prevValue:null,_valueChanged:!0}),t.methods({_onAllSkinPartsReady:function(){this.parent(),this._origValue=this._getValue(),this._prevValue=this._origValue,this._skinParts.input.setAttribute("min",this.getComponentProperty("minValue")),this._skinParts.input.setAttribute("max",this.getComponentProperty("maxValue"))},_changeEventHandler:function(e){if(!e.code||W.Utils.isInputKey(e.code)){var t=this._getValue(),i=this._getValidValue();if(t&&t!=i&&this._valueChanged&&(this._valueChanged=!1,this.fireEvent("validationFailed",{evt:e,value:t,validValue:i})),i!=this._prevValue){this._prevValue=i,i=this.injects().Utils.convertToHtmlText(i);var n={value:i,origEvent:e,compLogic:this};this.fireEvent("inputChanged",n)}}},_fireBlur:function(e){this._setValidValue(),this.parent(e)},_fireKeyUp:function(e){"13"==e.code&&this._setValidValue(),this.parent(e)},_getValidValue:function(){var e=this._getValue();return e?this.getComponentProperty("minValue")>e?e=this.getComponentProperty("minValue"):e>this.getComponentProperty("maxValue")&&(e=this.getComponentProperty("maxValue")):e=this._origValue,e},_setValidValue:function(){var e=this._skinParts.input;e.set("value",this._getValidValue()),this._valueChanged=!0}})}),define.component("wysiwyg.viewer.components.inputs.RadioGroupInput",function(e){var t=e;t.inherits("wysiwyg.viewer.components.inputs.ComboBoxInput"),t.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),t.skinParts({collection:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._radioGroupName=i.radioGroupName||"radioGroup",this._selectedValue=i.selectedValue},_prepareForRender:function(){return this._createRadioGroup(),!0},_onAllSkinPartsReady:function(){this._createRadioGroup(),this._skinParts.collection.addEvent(Constants.CoreEvents.CHANGE,this._selectedIndexChanged)},_createRadioGroup:function(){var e=function(e){this._optionsData=Object.values(e),this._bindRadioGroupToData(this._skinParts.collection)}.bind(this),t=this.getDataItem().get("items").filter(function(e){return e.get("enabled")});t.length>0&&"string"==typeof t[0]?this.injects().Data.getDataByQueryList(t,e):e(t)},_bindRadioGroupToData:function(e){e.empty();for(var t=0;this._optionsData.length>t;t++){var i=this._optionsData[t],n=i.get("value"),o=new Element("Input",{type:"radio",name:this._radioGroupName,value:n});n==this._selectedValue&&o.setAttribute("checked","checked"),e.grab(o,"bottom"),e.innerHTML+=i.get("text")+"<BR/>"}this._setSelected(e)},_getSelectedIndex:function(){for(var e=document.getElementsByName(this._radioGroupName),t=0;e.length>t;t++)if(e[t].checked)return t},_setSelected:function(e){var t=this.getDataItem().get("selected");t&&this.injects().Data.getDataByQuery(t,function(t){var i=this._optionsData.indexOf(t);i>-1&&e.length>i&&e[i].set("checked","checked")}.bind(this))}})}),define.component("wysiwyg.viewer.components.inputs.TextAreaInput",function(e){var t=e;t.inherits("wysiwyg.viewer.components.inputs.TextInput"),t.skinParts({textarea:{type:"htmlElement"},errorMessage:{type:"htmlElement",optional:!0}}),t.binds(["_checkMaxLength"]),t.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),t.methods({initialize:function(e,t,i){this.parent(e,t,i),i=i||{},this._maxLength=i.maxLength||""},_onAllSkinPartsReady:function(){var e=this._skinParts.textarea;e.set("value",this.getDataItem().get("text")),this.addEvent("inputChanged",function(e){this.getDataItem().set("text",e.value)}.bind(this)),this._maxLength&&(e.setProperty("maxlength",this._maxLength),Browser.ie&&e.addEvent(Constants.CoreEvents.KEY_UP,this._checkMaxLength)),this._listenToInput()},_checkMaxLength:function(){var e=this._skinParts.textarea.get("value"),t=e.length;if(e.length>this._maxLength){var i=this._maxLength-t;e=e.slice(0,i),this._skinParts.textarea.set("value",e)}},_changeEventHandler:function(e){return 13==e.code?!1:(this.parent(e),void 0)},_listenToInput:function(){this._skinParts.textarea.addEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.textarea.addEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_stopListeningToInput:function(){this._skinParts.textarea.removeEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.textarea.removeEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_getValue:function(){var e=this._skinParts.textarea;return e.get("value")}})}),define.oldComponent({name:"wysiwyg.viewer.components.inputs.TextInput",skinParts:{input:{type:"htmlElement"},errorMessage:{type:"htmlElement"}},traits:["wysiwyg.viewer.components.traits.ValidationSettings"],Class:{Extends:"mobile.core.components.base.BaseComponent",_states:{validation:["valid","invalid"]},Binds:["_changeEventHandler","_fireBlur","_fireKeyUp"],initialize:function(e,t,i){this.parent(e,t,i),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(e){this.setState(e?"valid":"invalid","validation")}.bind(this)),i=i||{},this._placeholder=i.placeholder||null,this._isPasswordField=i.passwordField||!1,this._label=i.label||""},_onAllSkinPartsReady:function(){var e=this._skinParts.input;e.set("value",this.getDataItem().get("text")),this.addEvent("inputChanged",function(e){this.getDataItem().set("text",e.value)}.bind(this)),this._listenToInput(),this._placeholder&&this._setPlaceholder(this._placeholder),this._isPasswordField&&e.set("type","password"),this.setLabel(this._label)},setError:function(e){this.setValidationState(!1),this._skinParts.errorMessage.set("text",e)
},setLabel:function(e){this._skinParts.label&&this._skinParts.label.appendText(e,"top")},_setPlaceholder:function(e){this._skinParts.input.set("placeholder",e),window.Modernizr&&!window.Modernizr.input.placeholder&&this._placeholderPolyFill()},_placeholderPolyFill:function(){function e(e){var t=e.target;""==t.get("value")&&t.get("placeholder")&&(t.addClass("isPlaceholder"),t.set("value",t.get("placeholder")))}function t(e){var t=e.target;t.hasClass("isPlaceholder")&&(t.removeClass("isPlaceholder"),t.set("value",""))}this.hasPlaceholder||(this.hasPlaceholder=!0,this._skinParts.input.addEvent("focus",t),this._skinParts.input.addEvent("blur",e)),e({target:this._skinParts.input})},_changeEventHandler:function(e){if(!e.code||W.Utils.isInputKey(e.code)){var t=this._getValue();t=this.injects().Utils.convertToHtmlText(t);var i={value:t,origEvent:e,compLogic:this};this.fireEvent("inputChanged",i)}},_fireBlur:function(e){this.fireEvent(Constants.CoreEvents.BLUR,e)},_fireKeyUp:function(e){this.fireEvent(Constants.CoreEvents.KEY_UP,e)},_listenToInput:function(){this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.input.addEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_stopListeningToInput:function(){this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.input.removeEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_getValue:function(){var e=this._skinParts.input,t="";return e.hasClass("isPlaceholder")||(t=e.get("value")),t},dispose:function(){this._stopListeningToInput(),this.parent()},getAcceptableDataTypes:function(){return["Text"]}}}),define.component("wysiwyg.viewer.components.inputs.TextOption",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({size:{type:"htmlElement"},tooltip:{type:"wysiwyg.common.components.InfoTip"}}),t.traits(["wysiwyg.common.components.traits.SelectableOption"]),t.states({selectState:["selected","unselected"],enabledState:["enabled","disabled"]}),t.dataTypes(["SelectOption"]),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.setSelected(!1)},_onAllSkinPartsReady:function(){var e=this._skinParts.size;e.set("text",this.getDataItem().get("text")),this._initializeTooTip(this.getViewNode())},_initializeTooTip:function(e){var t=this._skinParts.tooltip,i=this.getDataItem().get("description");i&&i.trim().length>0&&(e.addEvent("mouseenter",function(){t._showToolTipCmd({id:1,content:i},{source:e})}),e.addEvent("mouseleave",function(){t._closeToolTipCmd()}))},_onDataChange:function(){this.setEnabled(this.getDataItem().get("enabled"))},setSelected:function(e){this.setState(e?"selected":"unselected","selectState")},setEnabled:function(e){this.setState(e?"enabled":"disabled","enabledState")}})}),define.Class("wysiwyg.viewer.components.menus.DropDownController",function(e){e.fields({_menu:null,_dropButtons:[],_dropContainer:null,_dropWrapper:null,_dropOwnerButton:null,_dropDownNeedsClosing:!1,_closeTimerID:null}),e.inherits(["bootstrap.utils.Events"]),e.binds(["_onItemsContainerOver","_onItemsContainerOut","closeDropDown","_onMoreContainerOver","_onMoreContainerOut"]),e.methods({initialize:function(e){this._menu=e,this._init()},_init:function(){var e=this._menu.getItemsContainer();e.addEvent("mouseover",this._onItemsContainerOver),e.addEvent("mouseout",this._onItemsContainerOut),this._dropContainer=this._menu.getMoreContainer(),this._dropWrapper=this._menu.getDropWrapper(),null==this._dropWrapper&&(this._dropWrapper=this._dropContainer),this.closeDropDown(!0),this._dropContainer.addEvent("mouseover",this._onMoreContainerOver),this._dropContainer.addEvent("mouseout",this._onMoreContainerOut)},openDropDown:function(e,t){if(e==this._dropOwnerButton)return this._dropDownNeedsClosing=!1,void 0;for(;this._dropContainer.children.length;)this._dropContainer.children[0].dispose();var i,n=[];for(i=0;t.length>i;i++)0==t[i].isHidden()&&n.push(t[i]);if(n.length>0){for(this._dropWrapper.setStyle("width","auto"),i=0;n.length>i;i++)n[i].getViewNode().inject(this._dropContainer,"bottom");this._setDropListPositions(n),this._menu.arrangeDropButtons(n),this._dropDownNeedsClosing=!1,this._releasePreviousOwner(),this._dropOwnerButton=e,this._dropButtons=n,this._dropOwnerButton.setDropdownOpen(!0),this._dropWrapper.setStyle("display","block"),this._dropWrapper.setStyle("opacity","1"),this._arrangeDropDown(),this._dropWrapper.setStyle("z-index","99999")}},_setDropListPositions:function(e){var t,i,n,o=1==e.length;for(t=0;e.length>t;t++)i=e[t],n=0==t?o?"dropLonely":"top":o||t!=e.length-1?"dropCenter":"bottom",i.getViewNode().setProperty("listposition",n),i.getViewNode().setProperty("container","drop")},closeDropDown:function(e){(e||this._dropDownNeedsClosing)&&(this._releasePreviousOwner(),this._dropWrapper.setStyle("display","none"),this._dropWrapper.setStyle("opacity","0"),this._dropDownNeedsClosing=!1)},_releasePreviousOwner:function(){this._dropOwnerButton&&(this._dropOwnerButton.setDropdownOpen(!1),this.injects().Utils.forceBrowserRepaint(this._dropOwnerButton.getViewNode()),this._dropOwnerButton=null)},_closeDropDownTimer:function(){this.injects().Utils.clearCallLater(this._closeTimerID),this._closeTimerID=this.injects().Utils.callLater(this.closeDropDown,[],this,500)},_arrangeDropDown:function(){var e=this._dropOwnerButton.getViewNode().getProperty("listPosition");this._dropWrapper.setProperty("dropHPosition",e),this._setDropDownWidth(),this._setDropDownPosition()},_setDropDownWidth:function(){var e,t,i=this._dropOwnerButton.getMinimalDropdownWidth(),n=i;for(e=0;this._dropButtons.length>e;e++)t=this._dropButtons[e],n=Math.max(n,t.getMinimalWidth());if(n==i){var o=this._menu.getMenuExtraPixels(!0);this._dropWrapper.setStyle("width",o.left+o.right+n+"px")}else this._dropWrapper.setStyle("width","auto")},_setDropDownPosition:function(){this._dropWrapper.setStyle("text-align",this._menu.getComponentProperty("alignText"));for(var e=0;this._dropButtons.length>e;e++){var t=this._dropButtons[e];t.setPadding(0),t.alignText()}this._setHorizontalPosition(),this._setVerticalPosition()},_setHorizontalPosition:function(){var e=this._dropOwnerButton.getOffsetLeft(),t=this._menu.getComponentProperty("alignButtons");this._dropWrapper.setProperty("dropAlign",t);var i="0px",n="auto",o=this._menu.getMenuExtraPixels(!0),s=this._dropOwnerButton.getViewNode().getProperty("listPosition");"left"==t?i="left"==s?0:e+o.left+"px":"right"==t?(n="right"==s?0:this._menu.getWidth()-e-this._dropOwnerButton.getOffsetWidth()-o.right+"px",i="auto"):"left"==s?i=e+(this._dropOwnerButton.getOffsetWidth()+o.left-this._dropWrapper.offsetWidth)/2+"px":"right"==s?(i="auto",n=(this._dropOwnerButton.getOffsetWidth()+o.right-parseInt(this._dropWrapper.getStyle("width"),10))/2+"px"):i=o.left+e+(this._dropOwnerButton.getOffsetWidth()-this._dropWrapper.offsetWidth)/2+"px",this._dropWrapper.setStyle("left",i),this._dropWrapper.setStyle("right",n)},_setVerticalPosition:function(){var e="dropDown";this._needsToOpenUp()?(e="dropUp",this._dropWrapper.setStyle("bottom",this._menu.getHeight()+"px")):this._dropWrapper.setStyle("bottom","auto"),this._dropWrapper.setProperty("dropMode",e)},_needsToOpenUp:function(){if(navigator.userAgent.match(/MSIE 8.0/))return!1;var e=!0,t=window.innerHeight,i=this._menu.getViewNode(),n=0;do n+=i.offsetTop,i=i.offsetParent;while(null!=i);var o=n-document.body.getScroll().y;return t/2>=o&&(e=!1),e},_onItemsContainerOver:function(e){var t=this._findLogicParent(e.target);this._isValidButtonForDropDown(t)&&t.children.length>0&&this.openDropDown(t,t.children)},_onItemsContainerOut:function(e){var t=this._findLogicParent(e.target);t&&t==this._dropOwnerButton&&(this._dropDownNeedsClosing=!0,this._closeDropDownTimer())},_onMoreContainerOver:function(){this._dropDownNeedsClosing=!1},_onMoreContainerOut:function(){this._dropDownNeedsClosing=!0,this._closeDropDownTimer()},_findLogicParent:function(e){for(var t=!1;0==t;){var i;t=!0;try{navigator.userAgent.match(/MSIE 8.0/)?i=e.getLogic():e.hasOwnProperty("getLogic")&&e.getLogic()?i=e.getLogic():t=!1}catch(n){t=!1}0==t?(e=e.getParent(),e||(t=!0)):e=i}return e},_isValidButtonForDropDown:function(e){return e&&"core.components.MenuButton"==e.className?!0:!1}})}),define.component("wysiwyg.viewer.components.menus.DropDownMenu",function(e){var t=e;t.inherits("core.components.BaseRepeater"),t.utilize(["core.components.BaseList","core.components.SimpleButton","wysiwyg.viewer.components.menus.DropDownController"]),t.skinParts({repeaterButton:{type:"core.components.MenuButton",repeater:!0,inlineDataField:"items",repeaterDataQueryField:"refId",container:"itemsContainer",argObject:{listSubType:"PAGES"}},moreButton:{type:"core.components.MenuButton"},itemsContainer:{type:"htmlElement"},moreContainer:{type:"htmlElement"},dropWrapper:{type:"htmlElement"}}),t.binds(["_onButtonDataChange","_onThemeChange","_arrangeButtons","_onButtonClick","_onPageChanged"]),t.dataTypes(["Menu"]),t.propertiesSchemaType("HorizontalMenuProperties"),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages",commandParameter:{galleryConfigID:"pagesPanel"}}],dblClick:{command:"WEditorCommands.Pages"}},_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this.injects().Theme.addEvent("propertyChange",this._onThemeChange),this._arrangeWaitID=-1,this.injects().Viewer.addEvent("pageTransitionStarted",this._onPageChanged),this._usesExternalData=!0,this._staticWidth=0,this._aspectRatio=-1,this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._hiddenButtonsContainer=new Element("div",{id:"hiddenButtonsContainer",style:"visibility:hidden"}),this._hiddenButtonsContainer.inject(this.getViewNode()),this._flatButtons=[],this._arrangeDone=!1,this._treeConstructionDone=!1,this.getViewNode().setStyle("opacity","0")},setWidth:function(e,t,i,n){if(void 0==n&&(n=!0),n&&-1!=this._aspectRatio){var o=e/this._aspectRatio;this.getSizeLimits().minH>o&&(o=this.getSizeLimits().minH,e=o*this._aspectRatio),this.setHeight(o,!0,!1,!1)}this.parent(e,t,i)},setHeight:function(e,t,i,n){if(void 0==n&&(n=!0),n&&-1!=this._aspectRatio){var o=e*this._aspectRatio;this.getSizeLimits().minW>o&&(o=this.getSizeLimits().minW,e=o/this._aspectRatio),this.setWidth(o,!0,!1,!1)}this.parent(e,t,i)},_onAllSkinPartsReady:function(){this.parent(),this._dropDown=new this.imports.DropDownController(this),this._registerButton(this._skinParts.moreButton)},_registerButton:function(e){e.setMenu(this),e.addEvent("dataChanged",this._onButtonDataChange),e.dropdownMode=!0},getItemsContainer:function(){var e=null;return this._skinParts&&(e=this._skinParts.itemsContainer),e},getMoreContainer:function(){var e=null;return this._skinParts&&(e=this._skinParts.moreContainer),e},getDropWrapper:function(){var e=null;return this._skinParts&&(e=this._skinParts.dropWrapper),e},getMenuExtraPixels:function(){return this.getDivExtraPixels(this._skinParts.itemsContainer,!0)},arrangeDone:function(){return this._arrangeDone},_testOverFlow:function(){var e=this._getButtonsWidth();this.injects().Utils.clearCallLater(this._overflowID),0==this._prevButtonsWidth&&(this._prevButtonsWidth=e),e!=this._prevButtonsWidth?this._arrangeButtons():(this._testOverFlowCount--,this._testOverFlowCount>0&&(this._overflowID=this.callLater(this._testOverFlow,[],100)))},_onPageChanged:function(e){null!=this._skinParts&&this._selectActiveButton(e)},_selectActiveButton:function(e){if(this._flatButtons)for(i=0;this._flatButtons.length>i;i++)button=this._flatButtons[i],button.getID()==e?button.setSelected(!0):button.setSelected(!1),this.injects().Utils.forceBrowserRepaint(button.getViewNode())},_onThemeChange:function(){this._changeTriggeredBy="themeChange",this._arrangeButtonsDelayed()},_beforeRepeatersCreation:function(){this._rootButtons=[],this._flatButtons=[],this._flatButtons.push(this._skinParts.moreButton)},_onRepeaterItemReady:function(e,t,i,n){n&&t.addEvent("click",function(){this._onButtonClick(i)}.bind(this)),this._rootButtons.push(t),this._flatButtons.push(t),t.getViewNode().setStyle("visibility","hidden"),this._registerButton(t),this.parent(e,t,i,n)},_onRepeaterReady:function(){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,this._arrangeButtons),this._treeConstructionDone=!1,this._arrangeButtonAccordingToData(),this._constructButtonsTree()},_constructButtonsTree:function(){var e,t,i,n,o,s=this._data.get("items"),a=this,r=[];for(e=0;s.length>e;e++){for(i=null,t=0;this._rootButtons.length>t;t++)if(this._rootButtons[t].compareRefID(s[e].get("refId"))){i=this._rootButtons[t];break}if(i)for(i.children=[],n=this._data.getSubItems(s[e]),t=0;n.length>t;t++)o=Object.clone(this._repeaterDefinitions[0]),o.dataQuery=n[t].get("refId"),r.push({owner:i,def:o})}var l=r.length;if(0==l)this._constructionDone();else for(e=0;r.length>e;e++){var d=r[e].def;r[e].owner.createSubButton(this._createComponentbyDefinition.bind(this),d,function(e){a._registerButton(e),a._flatButtons.push(e),e.addEvent("click",function(){a._onButtonClick(e._data)}.bind(a)),l--,0==l&&a._constructionDone()})}},_arrangeButtonAccordingToData:function(){for(var e=this._data.get("items"),t=[],i=0;e.length>i;i++){var n=e[i].get("refId").substr(1);t.push(this._rootButtons.filter(function(e){return e.getDataItem().get("id")==n})[0])}this._rootButtons=t},_constructionDone:function(){this._treeConstructionDone=!0,this._arrangeButtons()},render:function(){this.parent(),"styleChange"==this._changeTriggeredBy?this._arrangeButtonsDelayed():this._arrangeButtons()},setSkin:function(e){this._staticWidth=e.staticWidth||0,this._aspectRatio=parseFloat(e.aspectRatio,10)||-1,this.parent(e)},_onButtonDataChange:function(){this._changeTriggeredBy="dataChange",this.render()},_onDataChange:function(){var e=this.getComponentProperties();e&&e.removeField("spacing"),this._changeTriggeredBy="dataChange",this.parent()},_applySettings:function(){this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._staticWidth>0?this._preWidthModifier=this._staticWidthModifier:(this.getComponentProperty("sameWidthButtons")&&(this._preWidthModifier=this._sameWidthModifier),this.getComponentProperty("stretchButtonsToMenuWidth")&&(this._postWidthModifier=this._stretchToFillModifier))},_skinSizeChange:function(){this._changeTriggeredBy="styleChange",this.parent()},_skinParamsChange:function(e){this._changeTriggeredBy="styleChange",this.parent(e)},_arrangeButtonsDelayed:function(){this._arrangeDone=!1,-1!=this._arrangeWaitID&&this.injects().Utils.clearCallLater(this._arrangeWaitID),this._arrangeWaitID=this.callLater(this._arrangeButtonsCapture,[],100),this._changeTriggeredBy="",this._skinParts.itemsContainer.setStyle("overflow","hidden")},_arrangeButtonsCapture:function(){this._arrangeButtons(),-1!=this._arrangeWaitID&&this._arrangeButtonsDelayed()},_arrangeButtons:function(){if(this._arrangeDone=!1,this._treeConstructionDone&&void 0!=this._skinParts&&this._rootButtons&&0!=this._rootButtons.length&&this._isDisplayed&&this.isReady()&&""!=this._skinParts.moreButton.className){var e=this._hideButtonsOfHiddenPages();if(e){this.getViewNode().setStyle("opacity","1"),this.injects().Utils.clearCallLater(this._overflowID),this._prevButtonsWidth=0,this._arrangeWaitID=-1,this._applySettings(),this._initItemsContainer(),this._initMoreButton();var t=this._getDisplayedButtons();if(t.length){t.push(this._skinParts.moreButton),this._preArrangeButtons(this._flatButtons);var i=this._getSampleButton();this._sampleButtonBorder(i),this._setMinimumDimensions(i);for(var n=0;t.length>n;n++)t[n].getViewNode().inject(this._skinParts.itemsContainer),t[n].getViewNode().setProperty("container","menu");this._preWidthModifier(t),this._calculateButtonsAmount(t),this.setMinW(t[0].getViewNode().offsetWidth),this._postWidthModifier(t),t=this._getDisplayedButtons(),t.push(this._skinParts.moreButton),this._alignButtonsText(t),this._restoreTransition(this._flatButtons),this._skinParts.itemsContainer.setStyle("overflow","visible"),this._skinParts.itemsContainer.setStyle("display","inherit"),this._skinParts.itemsContainer.setStyle("white-space","nowrap"),this._testOverFlow(),this._arrangeDone=!0,this._selectActiveButton(this.injects().Viewer.getCurrentPageId()),this.fireEvent("ready")}}}},arrangeDropButtons:function(e){var t;for(t=0;e.length>t;t++){var i=e[t];i.getViewNode().setStyle("visibility","inherit");var n=this._skin.more_vPadding||15;this._setButtonHeight(i,this._getButtonMinimalHeight(i)+n)}},_calculateButtonsAmount:function(e){e=this._arrangementAlgorithm(e),this._skinParts.moreButton.skipMe&&(this._skinParts.moreButton.getViewNode().setStyle("visibility","hidden"),this._skinParts.moreButton.getViewNode().inject(this._hiddenButtonsContainer),e[e.length-1]===this._skinParts.moreButton&&e.pop())},_getButtonsWidth:function(){var e=0;for(i=0;this._skinParts.itemsContainer.children.length>i;i++)e+=this._skinParts.itemsContainer.children[i].getLogic().getWidthOnLayout();return e},_hideButtonsOfHiddenPages:function(){for(var e=!0,t=0;this._flatButtons.length>t;t++)if(this._flatButtons[t]!=this._skinParts.moreButton){if(!this._flatButtons[t].getDataItem()){e=!1;break}this._flatButtons[t].isHidden()&&(this._flatButtons[t].getViewNode().setStyle("visibility","inherit"),this._flatButtons[t].getViewNode().inject(this._hiddenButtonsContainer))}return e},_getDisplayedButtons:function(){for(var e=[],t=0;this._rootButtons.length>t;t++)this._rootButtons[t].getDataItem()._data.hidePage||e.push(this._rootButtons[t]);return e},_setMenuListPositions:function(e){var t,i,n;if(1==e.length)i=e[0],i.getViewNode().setProperty("listposition","lonely"),i.getViewNode().setProperty("container","menu");else for(t=0;e.length>t;t++)i=e[t],n=0==t&&this._setPositionForFirst()?"left":t==e.length-1&&this._setPositionForLast()?"right":"center",i.getViewNode().setProperty("listposition",n),i.getViewNode().setProperty("container","menu")},_setPositionForFirst:function(){var e=!1;return this._postWidthModifier==this._stretchToFillModifier?e=!0:"left"==this.getComponentProperty("alignButtons")&&(e=!0),e},_setPositionForLast:function(){var e=!1;return this._postWidthModifier==this._stretchToFillModifier?e=!0:"right"==this.getComponentProperty("alignButtons")&&(e=!0),e},_getSampleButton:function(){return"visible"==this._rootButtons[0].getViewNode().getStyle("visibility")?this._rootButtons[0]:this._skinParts.moreButton},_sampleButtonBorder:function(e){this._buttonsBorder=e._skinParts.borderWrapper?this._getBorder(e._skinParts.borderWrapper):this._getBorder(e.getViewNode())},_setMinimumDimensions:function(e){this.setMinH(this._getButtonMinimalHeight(e))},_getButtonMinimalHeight:function(e){e._skinParts.label.setStyle("line-height","100%");var t=0;e.getSkin()&&!isNaN(e.getSkin().addToMinH)&&(t=e.getSkin().addToMinH);var i=this._getBorder(this._skinParts.itemsContainer).y+this._buttonsBorder.y;return t+i+parseInt(e._skinParts.label.getComputedStyle("line-height"))},_initItemsContainer:function(){this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignButtons"));var e=this.getHeight()-this._getBorder(this._skinParts.itemsContainer).y-this._getMargin(this._skinParts.itemsContainer).y,t=this.getWidth()-this._getBorder(this._skinParts.itemsContainer).x-this._getMargin(this._skinParts.itemsContainer).x;this._skinParts.itemsContainer.setStyle("height",e+"px"),this._skinParts.itemsContainer.setStyle("width",t+"px"),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.itemsContainer.setStyle("white-space","normal")},_initMoreButton:function(){this._skinParts.moreButton.setLabel(this.getComponentProperty("moreButtonLabel")),this._skinParts.moreButton.skipMe=!0,this._skinParts.moreButton.children=[],this._skinParts.moreButton.getViewNode().inject(this._skinParts.itemsContainer)},_preArrangeButtons:function(e){for(var t=0;e.length>t;t++){var i=e[t];e[t].getViewNode().setStyle("position","relative"),i.getViewNode().setStyle("visibility","inherit"),i.disableTransition(),i._skinParts.bg.setStyle("padding","0px 0px")}},_restoreTransition:function(e){for(var t=0;e.length>t;t++){var i=e[t];i.enableTransition()}},_alignButtonsText:function(e){for(var t=0;e.length>t;t++){var i=e[t].getViewNode(),n=parseInt(i.getLogic()._skinParts.bg.getComputedStyle("padding-left"))+parseInt(i.getLogic()._skinParts.bg.getComputedStyle("padding-right"));e[t].setPadding(n)}},_arrangementAlgorithm:function(e){for(var t=!1;!t;)if(t=this._arrangementIteration(e),!t)if(1==e.length)t=!0;else{this._skinParts.moreButton.skipMe=!1;var i=e.splice(e.length-2,1)[0];i.getViewNode().setStyle("visibility","inherit"),i.getViewNode().dispose(),this._skinParts.moreButton.children.unshift(i)}return e},_stretchToFillModifier:function(e,t){function i(e,t){if(d>0){var i=Math.ceil(r/d);r-=i;var o=parseInt(e._skinParts.bg.getStyle(t));n&&(l._buttonsPadding[e]||(l._buttonsPadding[e]={}),l._buttonsPadding[e][t]=o),e._skinParts.bg.setStyle(t,o+i+"px"),d--}}t=t||0;var n=!1;0==t&&(n=!0,this._buttonsPadding={});var o,s=this._getButtonsWidth(),a=parseInt(this._skinParts.itemsContainer.getStyle("width")),r=a-s-t;Browser.ie&&(r-=1),r=Math.max(r,0);var l=this;if(e.length>0){var d=2*e.length;for(o=0;e.length/2>o;o++){var c=e[o],h=e[e.length-o-1];i(c,"padding-left"),i(h,"padding-right"),i(c,"padding-right"),i(h,"padding-left")}}if(this._skinParts.itemsContainer.scrollHeight-e[0].getViewNode().offsetHeight>=e[0].getViewNode().offsetHeight){for(o=0;e.length>o;o++){var p=e[o];p._skinParts.bg.setStyle("padding-left",this._buttonsPadding[p]["padding-left"]),p._skinParts.bg.setStyle("padding-right",this._buttonsPadding[p]["padding-left"])}20>t&&this._stretchToFillModifier(e,t+1)}for(o=0;e.length>o;o++){var p=e[o];p.alignText()}},_sameWidthModifier:function(e){var t,i,n=0;for(t=0;e.length>t;t++){i=e[t];var o=parseInt(i.getViewNode().offsetWidth-this._buttonsBorder.x);isNaN(o)||(n=Math.max(n,o))}if(n>0)for(t=0;e.length>t;t++)i=e[t],i.fillWidthByPadding(n)},_staticWidthModifier:function(e){var t,i;for(t=0;e.length>t;t++)i=e[t],i.offsetWidth<this._staticWidth?i.fillWidthByPadding(this._staticWidth):i.getViewNode().setStyle("width",this._staticWidth+"px")},_nullModifier:function(){},_arrangementIteration:function(e){var t,i,n,o=[];for(n=0;e.length>n;n++)i=e[n],i.skipMe?i.collapse():o.push(i);for(this._setMenuListPositions(o),n=0;o.length>n;n++)i=o[n],i.uncollapse(),i.getViewNode().setStyle("visibility","visible"),i.getViewNode().inject(this._skinParts.itemsContainer),t=parseInt(this._skinParts.itemsContainer.getStyle("height"))-this._buttonsBorder.y,this._setButtonHeight(i,t),i._skinParts.label.setStyle("width","auto");return this._skinParts.itemsContainer.scrollHeight-e[0].getViewNode().offsetHeight<e[0].getViewNode().offsetHeight},_setButtonHeight:function(e,t){void 0!=e._skinParts.labelPad&&(t-=e._skinParts.labelPad.offsetHeight),e._skinParts.label.setStyle("line-height",t+"px")},_getBorder:function(e){var t=0,i=0;return e&&(t=parseInt(e.getStyle("border-left-width"))+parseInt(e.getStyle("border-right-width")),i=parseInt(e.getStyle("border-top-width"))+parseInt(e.getStyle("border-bottom-width"))),{x:t,y:i}},_getMargin:function(e){var t=0,i=0;return e&&(t=parseInt(e.getStyle("margin-left"))+parseInt(e.getStyle("margin-right")),i=parseInt(e.getStyle("margin-top"))+parseInt(e.getStyle("margin-bottom"))),{x:t,y:i}},_onResize:function(){this._arrangeButtons()},_onButtonClick:function(e){this.injects().Viewer.goToPage(e.get("id")),this.callLater(function(){navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&this._dropDown.closeDropDown(!0)}.bind(this),[],100)},dispose:function(){this.injects().Viewer.removeEvent("pageTransitionStarted",this._onPageChanged),this.injects().Theme.removeEvent("propertyChange",this._onThemeChange),this.parent()}})}),define.component("wysiwyg.viewer.components.sm.SMApplyForMembership",function(e){var t=e;t.inherits("wysiwyg.viewer.components.sm.SMRegister"),t.resources(["W.SiteMembers"]),t.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},re_password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindRePasswordField"}}),t.methods({onSubmit:function(){var e=this._emailField._data.get("text"),t=this._passwordField._data.get("text"),i=this._rePasswordField._data.get("text");this._validateFields(e,t,i)&&this.resources.W.SiteMembers.applyForMembership(e,t,this._onFormSuccess,this._onFormError)},_onFormSuccess:function(){var e=this._emailField._data.get("text");this._container.showConfirmation("Success! Your member login request has been sent and is awaiting approval. The site administrator will notify you via email ("+e+") once your request has been approved")}})}),define.component("wysiwyg.viewer.components.sm.SMContainer",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.resources(["W.Config","W.Utils","W.Viewer","W.Commands","W.SiteMembers"]),t.binds(["_handleSubmit","onFormError","onFormSuccess","_getCurrentForm","_handleCancel","_handleConfirmationOk"]),t.states(["normal","confirm"]),t.skinParts({blockingLayer:{type:"htmlElement"},submitButton:{type:"htmlElement"},okButton:{type:"htmlElement"},content:{type:"htmlElement"},contentInner:{hookMethod:"_createInnerDialog"},confirmationText:{type:"htmlElement"},errMsg:{type:"htmlElement"},title:{type:"htmlElement"},infoTitle:{type:"htmlElement"},note:{type:"htmlElement"},cancel:{type:"htmlElement"},xButton:{type:"htmlElement"}}),t.statics({INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"}}),t.methods({initialize:function(e,t,i){this.isVolatile=!0,this.parent(e,t,i),this._intent=i&&i.intent,this._authCallback=i&&i.authCallback,this._hashRedirectTo=i&&i.hashRedirectTo,this._openedByPageSecurity=i&&i.openedByPageSecurity,this._disableCancel=i&&i.disableCancel},_onAllSkinPartsReady:function(e){this.setState("normal"),e.submitButton.addEvent("click",this._handleSubmit),this._disableCancel?(e.xButton.hide(),e.cancel.setStyle("visibility","hidden")):(e.cancel.addEvent("click",this._handleCancel),e.xButton.addEvent("click",this._handleCancel),e.blockingLayer.addEvent("click",function(t){t.target==e.blockingLayer&&this._handleCancel()}.bind(this))),e.okButton.addEvent("click",this._handleConfirmationOk),this._initializeForm(e.contentInner),this.callLater(this.centerDialog)},_getFormType:function(e){var t=this.resources.W.SiteMembers;switch(e||(e=t.isNotAuthenticatedWithCookie()?this.INTENTS.LOGIN:this.INTENTS.REGISTER),e){case"REGISTER":var i=t.getCollectionType();switch(i){case"Open":return"register";case"ApplyForMembership":return"applyForMembership"}break;case"LOGIN":return"login"}},_createInnerDialog:function(e){var t=this._getFormType(this._intent);return e.type="wysiwyg.viewer.components.sm.SM"+t.capitalize(),e.skin="wysiwyg.viewer.skins.sm.SM"+t.capitalize()+"Skin",e.argObject={container:this},e},_initializeForm:function(e){this._currentForm=e;var t=this._skinParts.title;t.set("html",this._currentForm.getDisplayName());var i=this._skinParts.submitButton;i.set("value",this._currentForm.getButtonLabel());var n=this._skinParts.note,o=this._currentForm.getSubHeaderElement();if(o){var s=o.el,a=o.intent;s.getElements("a").addEvent("click",function(){this.resources.W.SiteMembers.openSiteMembersPopup({intent:a,disableCancel:this._disableCancel,openedByPageSecurity:this._openedByPageSecurity,hashRedirectTo:this._hashRedirectTo})}.bind(this)),n.adopt(s.childNodes)}this._addCurrentFormEvents(),this._openedByPageSecurity&&(this.resources.W.Viewer.isPublicMode()||this.resources.W.Config.isInDebugMode()?(this._skinParts.infoTitle.set("text","To view this page, you need to be logged in."),this._skinParts.note.setStyle("float","right"),this._skinParts.infoTitle.setStyle("display","block")):this.showConfirmation("This page is protected with a member login. Your users will be able to see this page once they are logged in. To manage your site's members, go to your site in My Account and click Site Members",function(){this.reportAuthStatusChange(!0),this._closeSMContainer()}.bind(this)))},setActiveForm:function(){},centerDialog:function(){var e=this._skinParts.dialog;e.setStyles({"margin-left":-(e.getSize().x/2),"margin-top":-(e.getSize().y/2)})},_removeCurrentFormEvents:function(){var e=this._getCurrentForm();e.removeEvent("error",this._onFormError),e.removeEvent("success",this._onFormSuccess)},_addCurrentFormEvents:function(){var e=this._getCurrentForm();e.addEvent("error",this._onFormError),e.addEvent("success",this._onFormSuccess)},onFormError:function(e){this._skinParts.errMsg.set("html",e)},onFormSuccess:function(){this._closeSMContainer()},closeAndRedirect:function(){if(this._closeSMContainer(),this._hashRedirectTo){var e=this.resources.W.Utils.hash.getHashParts(this._hashRedirectTo);this.resources.W.Utils.hash.setHash(e.id,e.title,e.extData,!0),window.location.hash=this._hashRedirectTo}location.reload()},reportAuthStatusChange:function(e,t){this._authCallback&&this.resources.W.SiteMembers.reportAuthStatusChange(this._authCallback,e,t)},showConfirmation:function(e,t){this.setState("confirm"),this._skinParts.confirmationText.set("text",e),this._confirmCallback=t},_handleConfirmationOk:function(){this._confirmCallback&&this._confirmCallback(),this._closeSMContainer()},_handleCancel:function(){this._getCurrentForm().onCancel(),this.reportAuthStatusChange(!1,{cancel:!0}),this._closeSMContainer()},_onKeyPress:function(e){13==e.code&&this._handleSubmit()},_handleSubmit:function(){return this.resources.W.Viewer.isPublicMode()||this.resources.W.Config.isInDebugMode()?(this._skinParts.errMsg.set("html",""),this._getCurrentForm().onSubmit(),void 0):(this.resources.W.Commands.executeCommand("adminLogin.submitAttempt",{component:this._skinParts.submitButton},this),void 0)},_editModeChanged:function(){this._closeSMContainer()},_closeSMContainer:function(){this.resources.W.Commands.executeCommand("WViewerCommands.SiteMembers.Close",null,null)},_getCurrentForm:function(){return this._currentForm}})}),define.component("wysiwyg.viewer.components.sm.SMForm",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.resources(["W.Data"]),t.binds(["_onFormError","_onFormSuccess"]),t.statics({PASS_MIN_LEN:4,PASS_MAX_LEN:15,ERR_MAP:{GENERAL_ERR:"Server error. try again later.",VAL_ERR_PASSWORD_BLANK:"Password cannot be blank",VAL_ERR_PASSWORD_RETYPE:"Passwords are not the same",VAL_ERR_PASSWORD_LENGTH:"Password length must be between {0} and {1}",VAL_ERR_EMAIL_BLANK:"Email cannot be blank",VAL_ERR_EMAIL_INVALID:"Email is invalid","-19999":"Unknown user","-19995":"Email is already taken","-19972":"Invalid token","-19988":"Validation Error","-19984":"Invalid Session","-19976":"Wrong email or password","-19958":"Your member request is waiting approval from the site owner"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},LABELS:{EMAIL:"Email",PASSWORD:"Password",RE_PASSWORD:"Retype password",REMEMBER_ME:"Remember Me"}}),t.methods({initialize:function(e,t,i){this.isVolatile=!0,i=i||{},this.parent(e,t,i),this._container=i.container
},onSubmit:function(){LOG.reportError(wixErrors.MISSING_METHOD,this.className,"performSubmit")},getDisplayName:function(){LOG.reportError(wixErrors.MISSING_METHOD,this.className,"getDisplayName")},getSubHeaderElement:function(){LOG.reportError(wixErrors.MISSING_METHOD,this.className,"getSubHeaderElement")},reportAuthStatusChange:function(e,t){this._container.reportAuthStatusChange(e,t)},closeAndRedirect:function(){this._container.closeAndRedirect()},onCancel:function(){},_onFormError:function(e,t){var i=this._getErrorMessage(e);t?t.setError(i):this._container.onFormError(i)},_onFormSuccess:function(e){this._container.onFormSuccess(e)},_getErrorMessage:function(e){var t=this.ERR_MAP.GENERAL_ERR;if(e){var i=e.errorCode;if(i&&this.ERR_MAP[i]){t=this.ERR_MAP[i];var n=e.errorParams;if(n)for(var o=n.length||0,s=0;o>s;s++)t=t.replace("{"+s+"}",n[s])}else t=this.ERR_MAP.GENERAL_ERR+" ("+i+")";LOG.reportError("Site Members error - "+e.errorDescription+"("+e.errorCode+")")}return t},_bindRePasswordField:function(e){return e.argObject={label:this.LABELS.RE_PASSWORD,passwordField:!0},this._bindTextDataItem(e)},_bindPasswordField:function(e){return e.argObject={label:this.LABELS.PASSWORD,passwordField:!0},this._bindTextDataItem(e)},_bindEmailField:function(e){return e.argObject={label:this.LABELS.EMAIL},this._bindTextDataItem(e)},_bindTextDataItem:function(e){return e.dataItem=this.resources.W.Data.createDataItem({text:"",type:"Text"},"Text"),e}})}),define.component("wysiwyg.viewer.components.sm.SMLogin",function(e){var t=e;t.inherits("wysiwyg.viewer.components.sm.SMForm"),t.resources(["W.Data","W.SiteMembers","W.Utils"]),t.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},rememberMe:{type:"wysiwyg.viewer.components.inputs.CheckBoxInput",hookMethod:"_bindCheckBoxDataItem"}}),t.methods({_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._passwordField=this._skinParts.password,this._rememberMeField=this._skinParts.rememberMe},onSubmit:function(){var e=this._emailField._data.get("text"),t=this._passwordField._data.get("text"),i=this._rememberMeField._data.get("value");this._validateFields(e,t)&&this.resources.W.SiteMembers.login(e,t,i,this._onFormSuccess,this._onFormError)},_validateFields:function(e,t){return this._passwordField.setValidationState(!0),this._emailField.setValidationState(!0),e?this.resources.W.Utils.isValidEmail(e)?t?t.length<this.PASS_MIN_LEN||t.length>this.PASS_MAX_LEN?(this._passwordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_LENGTH",errorParams:[this.PASS_MIN_LEN,this.PASS_MAX_LEN]},this._passwordField),!1):!0:(this._passwordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_BLANK"},this._passwordField),!1):(this._emailField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_INVALID"},this._emailField),!1):(this._emailField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_BLANK"},this._emailField),!1)},_onFormSuccess:function(){this.closeAndRedirect()},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return"Login"},getButtonLabel:function(){return"GO"},getSubHeaderElement:function(){var e=new Element("DIV");return e.set("html","Or <a>Sign up</a>"),{el:e,intent:this.INTENTS.REGISTER}},_bindCheckBoxDataItem:function(e){return e.dataItem=this.resources.W.Data.createDataItem({value:"false",type:"Boolean"},"Boolean"),e.dataItem.setMeta("isPersistent",!1),e.argObject={label:this.LABELS.REMEMBER_ME},e}})}),define.component("wysiwyg.viewer.components.sm.SMProfile",function(e){var t=e;t.inherits("wysiwyg.viewer.components.sm.SMForm"),t.resources(["W.SiteMembers"]),t.skinParts({name:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindTextDataItem"}}),t.methods({_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._nameField=this._skinParts.name},onSubmit:function(){var e=this._nameField._data.get("text");this._validateFields(e)&&this.resources.W.SiteMembers.updateMemberDetails({name:e},this._onFormSuccess,this._onFormError)},_validateFields:function(){return!0},onCancel:function(){this.fireEvent("cancel")},getDisplayName:function(){return"Update your details"},getButtonLabel:function(){return"Update"},getSubHeaderElement:function(){var e=new Element("DIV");return{el:e}}})}),define.component("wysiwyg.viewer.components.sm.SMRegister",function(e){var t=e;t.inherits("wysiwyg.viewer.components.sm.SMForm"),t.resources(["W.SiteMembers","W.Utils"]),t.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},re_password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindRePasswordField"}}),t.methods({_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._passwordField=this._skinParts.password,this._rePasswordField=this._skinParts.re_password},onSubmit:function(){var e=this._emailField._data.get("text"),t=this._passwordField._data.get("text"),i=this._rePasswordField._data.get("text");this._validateFields(e,t,i)&&this.resources.W.SiteMembers.register(e,t,this._onFormSuccess,this._onFormError)},_validateFields:function(e,t,i){return this._passwordField.setValidationState(!0),this._rePasswordField.setValidationState(!0),this._emailField.setValidationState(!0),e?this.resources.W.Utils.isValidEmail(e)?t?t.length<this.PASS_MIN_LEN||t.length>this.PASS_MAX_LEN?(this._passwordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_LENGTH",errorParams:[this.PASS_MIN_LEN,this.PASS_MAX_LEN]},this._passwordField),!1):t!=i?(this._rePasswordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_RETYPE"},this._rePasswordField),!1):!0:(this._passwordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_BLANK"},this._passwordField),!1):(this._emailField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_INVALID"},this._emailField),!1):(this._emailField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_BLANK"},this._emailField),!1)},_onFormSuccess:function(){this.closeAndRedirect()},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return"Sign up"},getButtonLabel:function(){return"GO"},getSubHeaderElement:function(){var e=new Element("DIV");return e.set("html","I already have a user, <a>Login</a>"),{el:e,intent:this.INTENTS.LOGIN}}})}),define.component("wysiwyg.viewer.components.tpapps.TPABase",function(e){var t=e;t.inherits("wysiwyg.viewer.components.IFrameComponent"),t.resources(["scriptLoader","W.Config","W.Viewer"]),t.traits(["wysiwyg.viewer.components.traits.TPAHandlers"]),t.skinParts({iframe:{type:"htmlElement"}}),t.binds(["_handlePageNavigationChange","_onIframeLoad"]),t.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],MIN_SIZE:{w:10,h:10},EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}],dblClick:{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}},_Events:{EDIT_MODE_CHANGE:"WPreviewCommands.WEditModeChanged",PAGE_NAVIGATION_CHANGE:"pageTransitionEnded",SITE_PUBLISHED:"WEditorCommands.Publish",COMPONENT_DELETED:"COMPONENT_DELETED",APP_MESSAGE:"SETTINGS_UPDATED",WINDOW_PLACEMENT_CHANGED:"WINDOW_PLACEMENT_CHANGED"},isTpa:!0}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._initialized=!1,this._appIsAlive=!1,this.setMinW(this.MIN_SIZE.w),this.setMinH(this.MIN_SIZE.h),this.addEvent("resizeEnd",this._onResizeEnd),this._startTime=new Date},isPremiumApp:function(){return!!this._appData&&!!this._appData.vendorProductId},isDemoMode:function(){return!!this._appData&&!!this._appData.demoMode},_onAllSkinPartsReady:function(){this._skinParts.iframe.addEvent("load",this._onIframeLoad),this.addEventListeners()},_onIframeLoad:function(){this._loadTime=(new Date).getMilliseconds()-this._startTime.getMilliseconds(),this.injects().TPA.reportLoadStart(this)},setIFrameSrc:function(e){e?(this._startTime=new Date,this.parent(e)):this.onError()},setUrl:function(e){this._iframe.src=e},onError:function(){this.isRendered()&&this.showErrorPage(),LOG.reportError(wixErrors.APPS_OPEN_TIMEOUT,this.$className,"showAppNotAvailable",this._appData.appDefinitionName)},showErrorPage:function(){this._skinParts.iframe.removeEvent("load",this._onIframeLoad),this.setUrl(this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/appNotResponding.html")},render:function(){this.parent()},onDataInitialized:function(){},onPageVisibilityChange:function(e,t){e&&this.fireEvent(this._Events.PAGE_NAVIGATION_CHANGE,t._compId)},addEventListeners:function(){this.injects().Commands.registerCommandListenerByName(this._Events.EDIT_MODE_CHANGE,this,function(){this.handleAddEventListener.apply(this,[this._Events.EDIT_MODE_CHANGE])}),this.injects().Viewer.addEvent(this._Events.PAGE_NAVIGATION_CHANGE,this._handlePageNavigationChange),"site"!==this.resources.W.Viewer.getViewMode()&&window.parent.W.Commands.registerCommandListenerByName(this._Events.SITE_PUBLISHED,this,function(){this.handleAddEventListener.apply(this,[this._Events.SITE_PUBLISHED])})},passAppMessage:function(e){this.handleAddEventListener(this._Events.APP_MESSAGE,e)},passWindowPlacement:function(e){this.handleAddEventListener(this._Events.WINDOW_PLACEMENT_CHANGED,e)},handleAddEventListener:function(e,t){var i,n={intent:"addEventListener",eventType:"",params:{}};switch(e){case"WPreviewCommands.WEditModeChanged":i="EDIT_MODE_CHANGE",n.params={editMode:this._getCurrentEditMode()};break;case"pageTransitionEnded":i="PAGE_NAVIGATION_CHANGE",n.params=this._getPageParameters(t);break;case"WEditorCommands.Publish":i="SITE_PUBLISHED";break;case this._Events.COMPONENT_DELETED:i=e;break;case this._Events.APP_MESSAGE:i=e,n.params=t;break;case this._Events.WINDOW_PLACEMENT_CHANGED:i=e,n.params=t}if(n.eventType=i,this._skinParts.iframe){msgStr="";try{msgStr=JSON.stringify(n)}catch(o){return}this._skinParts.iframe.contentWindow.postMessage(msgStr,"*")}},setQueryParams:function(e){this._queryParams=e},isAppAlive:function(){return this._appIsAlive},getAppDefinitionId:function(){return this._appDefinitionId},getApplicationId:function(){return this._data&&this._data.get("applicationId")},getAppData:function(){return this._appData},getSectionURL:function(){return this.injects().TPA.getSectionURL(this._applicationId)},forceRender:function(){this.getIsDisplayed()&&this._renderIframe(!0)},dispose:function(e){e?this.parent():(this.handleAddEventListener.apply(this,[this._Events.COMPONENT_DELETED]),this.injects().Viewer.removeEvent(this._Events.PAGE_NAVIGATION_CHANGE,this._handlePageNavigationChange),this.injects().TPA.getComponentRegistrar().unregister(this),this._view.setStyle("display","none"),this._isSelectable=!1,setTimeout(function(){this.dispose(!0)}.bind(this),500))},refreshAppData:function(){this._extractAppData()},getPanelInfo:function(e){this._appData.panelInfo?e(this._appData.panelInfo):this.resources.scriptLoader.getWithJSONP({url:this.injects().TPA.APP_MARKET_URL+"/api/market/app/"+this._appData.appDefinitionId,usePlugin:"json"},{onLoad:function(t){this._setPanelInfo(t),e(this._appData.panelInfo)}.bind(this),onFailed:function(){e(null)}.bind(this)},"callback")},_setPanelInfo:function(e){this._appData.panelInfo={},this._appData.panelInfo.title=e.title,this._appData.panelInfo.price=e.price,this._appData.panelInfo.features=e.features,this._appData.panelInfo.benefits=e.benefits},_handlePageNavigationChange:function(e){var t=$$("#"+e)[0].getLogic(),i=t.getPageComponents().map(function(e){return e._compId}).indexOf(this._compId)>-1;(this.getIsDisplayed()||i)&&this.handleAddEventListener(this._Events.PAGE_NAVIGATION_CHANGE,t)},_getPageParameters:function(e){var t={pageName:e._data._data.title,pageId:e._compId,pageUrl:""},i=this._getSiteBaseUrl();return t.pageUrl=""!=i?i+"#!"+t.pageName+"/"+t.pageId:"",t},_getCurrentEditMode:function(){return"PREVIEW"==window.top.W.Editor.getEditMode()?"preview":"editor"},_addCustomQueryString:function(e){if(this._queryParams){var t="";return Object.each(this._queryParams,function(e,i){t+="&"+i+"="+encodeURIComponent(e)}),delete this._queryParams,e+t}return e},_onDataChange:function(){this._initializeWithData()},_extractAppData:function(){if(this._applicationId=this._data.get("applicationId"),this._appData=this.injects().Viewer.getAppDataHandler().getAppData(this._applicationId),this._appData||"site"===W.Viewer.getViewMode())this._appDefinitionId=this._appData.appDefinitionId;else if(this._appDefinitionId=this._data.get("appDefinitionId"),this._appDefinitionId){var e=this.isWidget?W.AppStoreManager.TPA_WIDGET:W.AppStoreManager.TPA_SECTION,t=this._data.get("widgetId");window.parent.W.AppStoreManager.provisionApp(e,this._appDefinitionId,t,function(e){this.injects().Preview.getPreviewManagers().Viewer.getAppDataHandler().registerAppData(e),this.forceRender()}.bind(this))}},_initializeWithData:function(){this._initialized||(this._extractAppData(),this.injects().Viewer.isPublicMode()&&LOG.reportEvent(wixEvents.APPS_FLOW_APP_LOADED_ON_VIEWER,{g1:this._appDefinitionId+" "+window.location.href,i1:this._applicationId}),this.injects().TPA.getComponentRegistrar().register(this),this._initialized=!0,this.onDataInitialized(this._appData))},_editModeChanged:function(e){this._editMode=e},_onResize:function(){this.isRendered()&&this._initialized&&this.parent()},_onResizeEnd:function(){this._appIsAlive&&this._skinParts&&this._renderIfReady(),this._wCheckForSizeChangeAndFireAutoSized(3)},_createIframe:function(){this._iframe=this._skinParts.iframe,this._setBasicIframeParams(),this._setIframeParams()}})}),define.component("wysiwyg.viewer.components.tpapps.TPAFixedWidget",function(e){var t=e;t.inherits("wysiwyg.viewer.components.tpapps.TPAWidget"),t.resources(["W.Utils"]),t.statics({DEFAULT_COORDINATES:{top:"auto",left:"auto",bottom:"auto",right:"auto"}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._$top="auto",this._$left="auto",this._$bottom="auto",this._$right="auto"},initComponentLayout:function(){this._view.setStyle("visibility","visible"),this.removeEvent(Constants.ComponentEvents.READY_FOR_RENDER,this.initComponentLayout);var e=["x","y","width","height"],t=0;for(t;e.length>t;t++){var i=e[t],n=this._view.get(i);if(null!=n&&""!=n){var o="set"+i.capitalize();this[o](n,!0)}}this._view.setStyle("position","fixed"),this.saveCurrentDimensions(),this.saveCurrentCoordinates()},getLayoutMode:function(){return"FIXED"},_setCssPosition:function(e,t){var i="auto"==e||!e&&isNaN(e),n=["top","left","bottom","right"],o="px";if(!n.contains(t))return this.resources.W.Utils.debugTrace("fixedPositionComponent","_setCssPostion",t+" passed as "+e),void 0;if(e&&e.split&&(o=e.split(parseInt(e,10)).join(""),"%"!==o&&(o="px")),e=i?"auto":parseInt(e,10),this["_$"+t]!=e){if(!i&&isNaN(e))return this.resources.W.Utils.debugTrace("fixedPositionComponent","set"+t,"NaN passed as value"),void 0;this["_$"+t]=e+o,this._view.setStyle(t,e+o),"left"==t&&(this._$x=i||"%"==o?this._view.getPosition().x:e),"top"==t&&(this._$y=i||"%"==o?this._view.getPosition().y:e),this.onMovement()}},setX:function(e){this.setLeft(e),this.setRight("auto")},setY:function(e){this.setTop(e),this.setBottom("auto")},getRight:function(){return this._$right},setRight:function(e){this._setCssPosition(e,"right")},getBottom:function(){return this._$bottom},setBottom:function(e){this._setCssPosition(e,"bottom")},getLeft:function(){return this._$left},setLeft:function(e){if(this._setCssPosition(e,"left"),"50%"===e){var t=this.getWidth()/2;this._view.setStyle("margin-left",-t)}},setTop:function(e){if(this._setCssPosition(e,"top"),"50%"===e){var t=this.getHeight()/2;this._view.setStyle("margin-top",-t)}},getTop:function(){return this._$top},setWidth:function(e,t,i){var n,o,s=e;this._isPercent(e)&&(n=parseFloat(e)/100,o=window.getSize().x,s=Math.round(o*n)),this.parent(s,t,i)},setHeight:function(e,t,i){var n,o,s=e;this._isPercent(e)&&(n=parseFloat(e)/100,o=window.getSize().y,s=Math.round(o*n)),this.parent(s,t,i)},setPosition:function(e,t,i,n){this.setTop(e),this.setLeft(t),this.setBottom(i),this.setRight(n)},setCoordinates:function(e){return e=Object.merge(this.DEFAULT_COORDINATES,e||{}),this._changeSize({width:e.x,height:e.y},!0),this.setPosition(e.top,e.left,e.bottom,e.right),e},_onAutoSized:function(){this.fireEvent("autoSizeChange")},_isPercent:function(e){return"string"==typeof e&&"%"==e.split(parseFloat(e)).join("")}})}),define.component("wysiwyg.viewer.components.tpapps.TPAModal",function(e){e.binds(["_onDispose"]),e.inherits("wysiwyg.viewer.components.tpapps.TPAWidget"),e.statics({DEFAULT_URL:"http://sslstatic.wix.com/services/js-sdk/1.16.0/html/modal.html"}),e.skinParts({blockingLayer:{type:"htmlElement"},dialog:{type:"htmlElement"},x:{type:"htmlElement"}}),e.methods({initialize:function(e,t,i){this.parent(e,t,i),i=i||{},this._rawUrl=i.url||this.DEFAULT_URL,this._url=null,this._width=i.width,this._height=i.height,this.isVolatile=!0},getAcceptableDataTypes:function(){return["TPAWidget","TPA"]},_onAllSkinPartsReady:function(){this._skinParts.x.addEvent("click",this._onDispose),this._skinParts.blockingLayer.addEvent("click",this._onDispose)},render:function(){if(this._width>0){var e=this._width/2;this._skinParts.dialog.setStyles({width:this._width,"margin-left":-e})}if(this._height>0){var t=this._height/2;this._skinParts.dialog.setStyles({height:this._height,"margin-top":-t})}this.parent()},_getUrl:function(){var e=this._url;return e||(e=W.TPA.getURLBuilder().buildStateLessUrl(this._rawUrl,["instance","section-url","target","viewMode","locale","cacheKiller"],this,this._appData)),e},_onDispose:function(){this._view.dispose()},_onEditModeChanged:function(){this._onDispose()},handleCloseWindow:function(){this.dispose()}})}),define.component("wysiwyg.viewer.components.tpapps.TPAPlaceholder",function(e){var t=e;t.inherits("wysiwyg.viewer.components.WPhoto"),t.skinParts({img:{type:"core.components.image.ImageNew",dataRefField:"*"}}),t.fields({propertiesSchemaName:"WPhotoProperties",EDITOR_META_DATA:{general:{title:"App Placeholder",settings:!0,design:!1},custom:[{label:"SIDE_BTN_MARKET",command:"WEditorCommands.Market",commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.Market",commandParameterDataRef:"SELF"}}})}),define.component("wysiwyg.viewer.components.tpapps.TPAPopup",function(e){e.inherits("wysiwyg.viewer.components.tpapps.TPAFixedWidget"),e.resources([]),e.binds(["_onResize","_onDispose"]),e.statics({FIXED_OFFSET:2,MIN_EDGE_SIZE:50}),e.methods({initialize:function(e,t,i){this.parent(e,t,i),i=i||{},this._rawUrl=i.url,this._url=null,this._popupSize=i.popupSize?i.popupSize:{x:i.width,y:i.height},this._origin=i.origin||"",this._placement=i.placement||"CENTER",this._openPosition=i.openPosition||{top:0,left:0},this._openSize=i.openSize,this.isVolatile=!0,this._origPopupSize=this._popupSize},getAcceptableDataTypes:function(){return["TPAWidget","TPA"]},_onAllSkinPartsReady:function(){this._skinParts.x&&this._skinParts.x.addEvent("click",this._onDispose)},render:function(){this.parent();var e=this.calcCoordinates();this.setCoordinates(e)},calcCoordinates:function(){var e={};switch(this._origin){case"RELATIVE":e=Object.merge(this._getRelativeCoords(),this._popupSize),e=this._applyRelativeOffsets(e),e=this._validateRelativeCoordinates(e);break;case"FIXED":default:e=Object.merge(this._getFixedCoords(),this._popupSize),e=this._applyFixedOffsets(e),e=this._validateFixedCoordinates(e)}return e.x||(e.x=200),e.y||(e.y=200),e=this._validateMinSize(e),e=this._validateNegtaivePosition(e)},_validateMinSize:function(e){return(e.x<=this.MIN_EDGE_SIZE||e.y<=this.MIN_EDGE_SIZE)&&(e=this._fallbackToCenterMin(e)),e},_validateNegtaivePosition:function(e){return("number"==typeof e.top&&0>e.top||"number"==typeof e.left&&0>e.left||"number"==typeof e.bottom&&0>e.bottom||"number"==typeof e.right&&0>e.right)&&(e=this._fallbackToCenterMin(e)),e},_validateFixedCoordinates:function(e){var t=window.getWidth(),i=window.getHeight();return e.x>=t&&(e.y=t-2*this.FIXED_OFFSET),e.y>=i&&(e.y=i-2*this.FIXED_OFFSET),e},_validateRelativeCoordinates:function(e){return e=this._validateMaxSizeLimit(e),this._isTop()||this._isBottom()?e=this._getVerticalCroppedCoords(e):this._isCenter()&&(e=this._getHorizontalCroppedCoords(e)),this._getFixedWidthHeightCoords(e)},_getFixedWidthHeightCoords:function(e){for(var t in e)0>e[t]&&"x"!=t&&"y"!=t&&(("top"===t||"botom"===t)&&(e.y=e.y+e[t]),("right"===t||"left"===t)&&(e.x=e.x+e[t]),e[t]=0);return e},_fallbackToCenterMin:function(e){return e.top="50%",e.left="50%",e.x=this._origPopupSize.x,e.y=this._origPopupSize.y,this._validateMaxSizeLimit(e)},_getVerticalCroppedCoords:function(e){var t=window.getWidth(),i=window.getHeight();if(this._isTop()){var n=this._openPosition.y>this._popupSize.y;n||(e.y=this._openPosition.y-2*this.FIXED_OFFSET,e.top=this.FIXED_OFFSET)}else if(this._isBottom()){var n=i-(this._openPosition.y+this._openSize.y)>this._popupSize.y;n||(e.y=i-(this._openPosition.y+this._openSize.y)-2*this.FIXED_OFFSET)}if(this._isRight()){var o=t-(this._openPosition.x+this._openSize.x)>this._popupSize.x;o||(e.x=t-(this._openPosition.x+this._openSize.x)-10)}else if(this._isLeft()){var o=t-(this._openPosition.x-this._popupSize.x)>this._popupSize.x;o||(e.x=t-this._openPosition.x,e.left=this._openPosition.x-e.x)}else if(this._isCenter()){var o=t-this._openPosition.x>this._popupSize.x;o||(e.x=t-this._openPosition.x),e.left=e.left=this._openPosition.x-e.x/2+this._openSize.x/2}return e},_applyRelativeOffsets:function(e){return this._isTop()&&(e.top-=this.FIXED_OFFSET),this._isBottom()&&(e.top+=this.FIXED_OFFSET),this._isLeft()&&(e.left-=this.FIXED_OFFSET),this._isRight()&&(e.left+=this.FIXED_OFFSET),e},_applyFixedOffsets:function(e){return this._isTop()&&(e.top+=this.FIXED_OFFSET),this._isBottom()&&(e.top+=this.FIXED_OFFSET),this._isLeft()&&(e.left+=this.FIXED_OFFSET),this._isRight()&&(e.left+=this.FIXED_OFFSET),e},_getHorizontalCroppedCoords:function(e){var t=window.getWidth();if(this._isRight()){var i=t-(this._openPosition.x+this._openSize.x)>this._popupSize.x;i||(e.x=t-(this._openPosition.x+this._openSize.x)-10)}else if(this._isLeft()){var i=t-(this._openPosition.x-this._popupSize.x)>this._popupSize.x;i||(e.x=t-this._openPosition.x,e.left=this._openPosition.x-e.x)}return e},_validateMaxSizeLimit:function(e){var t=window.getWidth()/2,i=window.getHeight()/2;return e.x=e.x%t==e.x?e.x:t,e.y=e.y%i==e.y?e.y:i,e},_onDispose:function(){this._view.dispose()},_onEditModeChanged:function(){this._onDispose()},_getFixedCoords:function(){var e={};switch(this._placement){case"TOP_LEFT":e={left:0,top:0};break;case"TOP_RIGHT":e={right:0,top:0};break;case"BOTTOM_RIGHT":e={right:0,bottom:0};break;case"BOTTOM_LEFT":e={left:0,bottom:0};break;case"TOP_CENTER":e={top:0,left:"50%"};break;case"CENTER_RIGHT":e={top:"50%",right:0};break;case"BOTTOM_CENTER":e={bottom:0,left:"50%"};break;case"CENTER_LEFT":e={left:0,top:"50%"};break;default:e={top:"50%",left:"50%"}}return e},_getRelativeCoords:function(){var e={},t=this._openPosition,i=this._openSize,n=this._popupSize,o=t.x,s=t.y,a=i.x,r=i.y,l=n.x,d=n.y;switch(this._placement){case"TOP_LEFT":e={top:s-d,left:o-l};break;case"TOP_RIGHT":e={top:s-d,left:o+a};break;case"BOTTOM_RIGHT":e={top:s+r,left:o+a};break;case"BOTTOM_LEFT":e={top:s+r,left:o-l};break;case"TOP_CENTER":e={top:s-d,left:this._getRelativeCenterLeft(o,a,l)};break;case"CENTER_RIGHT":e={top:this._getRelativeCenterTop(s,r,d),left:o+a};break;case"BOTTOM_CENTER":e={top:s+r,left:this._getRelativeCenterLeft(o,a,l)};break;case"CENTER_LEFT":e={top:this._getRelativeCenterTop(s,r,d),left:o-l};break;default:e={top:this._getRelativeCenterTop(s,r,d),left:this._getRelativeCenterLeft(o,a,l)}}return e},_getRelativeCenterTop:function(e,t,i){return e+t/2-i/2},_getRelativeCenterLeft:function(e,t,i){return e+t/2-i/2},_getUrl:function(){var e=this._url;return e||(e=W.TPA.getURLBuilder().buildStateLessUrl(this._rawUrl,["instance","section-url","target","viewMode","locale","cacheKiller"],this,this._appData)),e},_onResize:function(){this.parent(),this._renderIfReady()},handleCloseWindow:function(){this.dispose()},_isTop:function(){return this._placement.indexOf("TOP")>=0},_isBottom:function(){return this._placement.indexOf("BOTTOM")>=0},_isLeft:function(){return this._placement.indexOf("LEFT")>=0},_isRight:function(){return this._placement.indexOf("RIGHT")>=0},_isCenter:function(){return this._placement.indexOf("CENTER")>=0}})}),define.component("wysiwyg.viewer.components.tpapps.TPASection",function(e){var t=e;t.inherits("wysiwyg.viewer.components.tpapps.TPABase"),t.dataTypes(["TPA"]),t.methods({isPage:!0,initialize:function(e,t,i){this.parent(e,t,i),this._resizableSides=[]},render:function(){this.parent()},onDataInitialized:function(e){var t=e.sectionRefreshOnWidthChange;t||this.removeEvent("resizeEnd",this._onResizeEnd)},_getUrl:function(e){if(e||!this._url){if(!this._initialized)return"";var t=this._appData.sectionUrl,i=this.injects().TPA.getURLBuilder().buildStateFullUrl(t,["instance","section-url","target","width","viewMode","locale","cacheKiller"],this,this._appData);this._url=this._addCustomQueryString(i)}return this._url},handleAppStateChanged:function(e){this.injects().Utils.hash.setHashExtData(e)},isDeleteable:function(){return!1},isDeleteableRecurse:function(){return!1},isDuplicatable:function(){return!1},canMoveToOtherScope:function(){return!1},isContainable:function(){return!1}})}),define.component("wysiwyg.viewer.components.tpapps.TPAWidget",function(e){var t=e;t.inherits("wysiwyg.viewer.components.tpapps.TPABase"),t.dataTypes(["TPAWidget"]),t.methods({isWidget:!0,initialize:function(e,t,i){this.parent(e,t,i),this._isSelectable=!0},getWidgetId:function(){return this._data.get("widgetId")},onDataInitialized:function(){var e=this.getWidgetId(),t=this.injects().Viewer.getAppDataHandler(),i=t.getWidgetProperty(this._applicationId,e,"refreshOnWidthChange");i||this.removeEvent("resizeEnd",this._onResizeEnd)},_changeSize:function(e,t){var i=this.getWidth(),n=this.getHeight(),o=e.x||e.w||e.width,s=e.y||e.h||e.height;o&&o!=i&&this.setWidth(o,!1,!s&&t),s&&s!=n&&this.setHeight(s,!1,t),this._wCheckForSizeChangeAndFireAutoSized(1)},_getUrl:function(e){if(e||!this._url){var t=this.getWidgetId(),i=this.injects().Viewer.getAppDataHandler().getWidgetData(this._applicationId,t),n=i.widgetUrl,o=this.injects().TPA.getURLBuilder().buildStateLessUrl(n,["instance","section-url","target","width","viewMode","locale","cacheKiller"],this,this._appData);this._url=this._addCustomQueryString(o)}return this._url},handleAppStateChanged:function(){},handleClosePopup:function(){},setIFrameSrc:function(e){this._iframe.src=e,this._url=this._iframe.src},isSelectable:function(){return this._isSelectable},isDeleteableRecurse:function(){return!0}})}),define.Class("wysiwyg.viewer.components.traits.GalleryAutoplay",function(e){var t=e;t.binds(["_onComponentReady","_onMouseDown","_autoplayCallback","_onPropertyChanged","_onTransitionFinished","_onModeChange","_onMediaZoomClosed","_onMediaZoomOpened","_getDirection"]),t.fields({_autoplayOn:!1,_timeoutID:null,_suppressAutoplay:!1}),t.resources(["W.Viewer","W.Commands"]),t.methods({initialize:function(){this.addEvent(Constants.ComponentEvents.RENDER,this._onComponentRender),this.addEvent(Constants.ComponentEvents.READY,this._onComponentReady),this.resources.W.Viewer.getPreviewMode()===!0&&(this._suppressAutoplay=!0,this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange)),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,this._onMediaZoomClosed),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.OpenZoom",this,this._onMediaZoomOpened)},_onComponentReady:function(){this._autoplayOn=this.getComponentProperty("autoplay")===!0,this._updateAutoplayState()},_onComponentRender:function(){this._properties.addEvent(Constants.DataEvents.DATA_CHANGED,this._onPropertyChanged),this.addEvent("transitionFinished",this._onTransitionFinished),this._skinParts.autoplay&&(this._skinParts.autoplay.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),this._skinParts.autoplay.setStyle("cursor","pointer"),this._checkAutoPlaySkinPartsVisibility())},_onModeChange:function(e){this._autoplayOn=this.getComponentProperty("autoplay")===!0,this._suppressAutoplay=!("PREVIEW"==e),this._updateAutoplayState()},_onMediaZoomOpened:function(){this._lastAutoplayState=this._autoplayOn,this._suppressAutoplay=!0,this._updateAutoplayState()},_onMediaZoomClosed:function(){this._suppressAutoplay=!1,this._autoplayOn=this._lastAutoplayState===!0,this._updateAutoplayState()},_validateHostComponent:function(){var e=this.getComponentProperties().getSchema();this._skinPartsSchema.hasOwnProperty("autoplay")||this._validationErr("Must require 'autoplay' skinPart."),e.hasOwnProperty("autoplay")||this._validationErr("Must contain 'autoplay' among the component properties."),e.hasOwnProperty("autoplayInterval")||this._validationErr("Must contain 'autoplayInterval' among the component properties."),"function"!=typeOf(this.gotoNext)&&this._validationErr("Host component must implement gotoNext() method.")},_validationErr:function(e){throw Error("GalleryAutoplay trait's host component validation failed. "+e)},_onMouseDown:function(){this._toggleAutoplay()},_toggleAutoplay:function(){this._autoplayOn=!this._autoplayOn,this._updateAutoplayState()},_updateAutoplayState:function(){this._suppressAutoplay&&(this._autoplayOn=!1),this.setState(this._autoplayOn?"autoplayOn":"autoplayOff","slideshow"),this._startAutoplayTimer()},_getAutoplayInterval:function(){var e=parseFloat(this.getComponentProperty("autoplayInterval"));parseFloat(this.getComponentProperty("transDuration"));var t=Math.floor(1e3*e);return t},_startAutoplayTimer:function(){null!=this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null),this._autoplayOn&&(this._timeoutID=setTimeout(this._autoplayCallback,this._getAutoplayInterval()))},_autoplayCallback:function(){"LTR"==this._getDirection()?this.gotoPrev():this.gotoNext()},_onPropertyChanged:function(){this._autoplayOn=this.getComponentProperty("autoplay")===!0,this._updateAutoplayState(),this._checkAutoPlaySkinPartsVisibility()},_checkAutoPlaySkinPartsVisibility:function(){this._skinParts&&this._skinParts.autoplay&&this._skinParts.autoplay.setStyle("visibility",this.getComponentProperty("showAutoplay")?"visible":"hidden")},_onTransitionFinished:function(){this._startAutoplayTimer()},_getDirection:function(){return this.getComponentProperties().getData().autoPlayDirection}})}),define.oldTrait({name:"wysiwyg.viewer.components.traits.ListIterator",trait:{_currentItemIndex:0,_oldItem:null,_currentItem:null,_numItems:-1,_locked:!1,_lastCommand:"",lock:function(){this._locked=!0},unlock:function(){this._locked=!1},isLocked:function(){return this._locked},setListAndCurrentIndex:function(e,t){this._numItems=e.get("items").length,this._currentItemIndex=t,this._onCurrentItemChanged()},resetIterator:function(){this._currentItemIndex=0,this._numItems=-1,this._locked=!1,this._lastCommand="",this._currentItem=null},_onCurrentItemChanged:function(){this._oldItem=this._currentItem,this._currentItem=this.getDataItem().getData().items[this._currentItemIndex],this.fireEvent("currentItemChanged")},gotoPrev:function(){this._locked||(this._lastCommand="prev",this._currentItemIndex=this._getPrevItemIndex(),this._onCurrentItemChanged())},gotoNext:function(){this._locked||(this._lastCommand="next",this._currentItemIndex=this._getNextItemIndex(),this._onCurrentItemChanged())},_getNextItemIndex:function(){var e=this._currentItemIndex;
return e++,e>=this._numItems&&(e=0),e},_getPrevItemIndex:function(){var e=this._currentItemIndex;return e--,-1==e&&(e=this._numItems-1),e}}}),define.Class("wysiwyg.viewer.components.traits.TPAHandlers",function(e){var t=e;t.inherits("wysiwyg.viewer.components.traits.TPAHandlersBase"),t.statics({DEFAULTS:{POPUP_COORDINATES:{NORMAL:{top:"auto",left:"auto",bottom:"auto",right:"auto",width:500,height:500},MODAL:{top:"50%",left:"50%",bottom:"auto",right:"auto",width:500,height:500}}}}),t.resources(["W.Components","W.Data"]),t.binds(["handleSiteInfo"]),t.methods({initialize:function(){this._datam=this.resources.W.Data},handleHeightChanged:function(e){var t="number"==typeof e?e:e.msgData.height;this.handleChangeAppSize({height:t})},handleChangeAppSize:function(e){(this.injects().Viewer.isPublicMode()||"PREVIEW"===this.injects().Viewer.getEditorMode())&&(e.width=null,e.w=null,e.x=null),this._changeSize(e)},handleAppSettingsClose:function(e){this.handleCloseWindow(e)},_getMetadataParameter:function(e,t){var i=$$("meta["+(t||"name")+"='"+e+"']"),n="";if(i&&i.length>0){var o=i.get("content");o.length>0&&(n=o[0])}return n},handleOpenPopup:function(e){var t,i,n,o,s,a=this.injects().Viewer.getSiteNode();i="wysiwyg.viewer.components.tpapps.TPAPopup",n="wysiwyg.viewer.skins.TPAPopupSkin",s=this._data,o=this._getPopupArgs(e.msgData||e),t=this.resources.W.Components.createComponent(i,n,s,o,null,null),t.insertInto(a)},_getPopupArgs:function(e){return this.isPage?"FIXED":e.position.origin,{dataItem:this._data,url:e.url,origin:e.position.origin,placement:e.position.placement,openPosition:this._view.getPosition(),openSize:this._view.getSize(),popupSize:{x:e.width||200,y:e.height||200}}},_getModalCoords:function(e,t){return Object.merge(this.DEFAULTS.POPUP_COORDINATES.MODAL,{width:e,height:t}||{})},handleOpenModal:function(e){var t=this.injects().Viewer.getSiteNode();this._clearModals(t);var i,n,o,s,a;n="wysiwyg.viewer.components.tpapps.TPAModal",o="wysiwyg.viewer.skins.TPAModalSkin",a=this._data,s={url:e.url,width:e.width,height:e.height},i=this.resources.W.Components.createComponent(n,o,a,s,null,null),i.insertInto(t)},handleGetSitePages:function(e){var t=this.resources.W.Data.getDataByQuery("#MAIN_MENU"),i=t.getItems()||[],n=this._getSitePages(i);e.callback(n)},handleNavigateToPage:function(e){e.msgData.pageId&&"editor"!==this.resources.W.Viewer.getViewMode()&&this.resources.W.Viewer.goToPage(e.msgData.pageId)},_handleOpenPopup:function(e,t,i){var n=this.injects().Viewer.getSiteNode();this._clearModals(n);var o,s,a,r,l;s="wysiwyg.viewer.components.tpapps.TPAPopup",a="wysiwyg.viewer.skins.TPAPopupSkin",l=this._data,r={url:e,width:i.width,height:i.height},o=this.resources.W.Components.createComponent(s,a,l,r,null,null),o.insertInto(n)},handleSmRequestLogin:function(e){var t=this.injects().SiteMembers;t.isServiceProvisioned()&&(t.isApiReady()?this.injects().Commands.executeCommand("WViewerCommands.SiteMembers.Open",{form:"login",authCallback:e.callback}):this.callLater(this.handleSmRequestLogin,e))},handleSmCurrentMember:function(e){var t=this.injects().SiteMembers;t.getMemberDetails(function(t){e.callback(t)},function(){e.callback(null)})},_clearModals:function(e){var t=e.getChildren("[comp=wysiwyg.viewer.components.tpapps.TPAModal]");t.dispose()}})}),define.Class("wysiwyg.viewer.components.traits.TPAHandlersBase",function(e){var t=e;t.resources(["W.Config","W.Commands","W.Viewer","W.Utils","W.Data"]),t.methods({_appIsAlive:!1,initialize:function(){return this._changeSize?(this._isAliveTime=0,this._isAliveCounter=0,void 0):Error("Must... Implement... _changeSize...")},handleAppIsAlive:function(){this._appIsAlive=!0,this._isAliveTime=new Date,this._isAliveCounter++},handleSiteInfo:function(e){var t=this._getSiteSEOParams();t.pageTitle=this._getCurrentPageName(),t.referer=document.referrer,t.url=location.href,t.baseUrl=this._getSiteBaseUrl(),e.callback(t)},_getSitePages:function(e){for(var t=[],i=0,n=e.length;n>i;i++){for(var o=this._getPageInfo(e[i]),s=e[i].get("items"),a=0,r=s.length;r>a;a++){var l=this._getPageInfo(s[a]);o.subPages=o.subPages||[],o.subPages.push(l)}t.push(o)}return t},_getPageInfo:function(e){var t={},i=e.get("refId"),n=this._datam.getDataByQuery(i);return t.title=n.get("title")||"",t.id=0===i.indexOf("#")?i.substr(1):i,t.hide=n.get("hidePage")||!1,t},_getSiteSEOParams:function(){var e=W.Viewer.getViewMode();switch(e){case"editor":return this._getSiteSEOParamsInEditMode();case"preview":return this._getSiteSEOParamsInPreviewMode();case"site":return this._getSiteSEOParamsInViewMode()}return{}},_getSiteBaseUrl:function(){var e=location.protocol+"//"+location.host+location.pathname;return"editor"==W.Viewer.getViewMode()?e=window.parent.W.Config.siteNeverSavedBefore()?"":this.resources.W.Config.getUserPublicUrl():"preview"==W.Viewer.getViewMode()&&(e=window.parent.W.Config.siteNeverSavedBefore()?"":window.parent.W.Config.getUserPublicUrl()||""),e},_getMetadataParameter:function(e,t){var i=$$("meta["+(t||"name")+"='"+e+"']"),n="";if(i&&i.length>0){var o=i.get("content");o.length>0&&(n=o[0])}return n},_getSiteSEOParamsInViewMode:function(){var e=$$("title");return e=e&&e[0]&&e[0].text,{siteTitle:e||"",siteDescription:this._getMetadataParameter("description")||"",siteKeywords:this._getMetadataParameter("keywords")||""}},_getSiteSEOParamsInPreviewMode:function(){var e=window.parent.W.Data.getDataByQuery("#SITE_SETTINGS"),t=e.getData()||{};return{siteTitle:t.siteTitleSEO||"",siteDescription:t.siteDescriptionSEO||"",siteKeywords:t.keywordsSEO||""}},_getSiteSEOParamsInEditMode:function(){var e=this.resources.W.Data.getDataByQuery("#SITE_SETTINGS"),t=e.getData()||{};return{siteTitle:t.siteTitleSEO||"",siteDescription:t.siteDescriptionSEO||"",siteKeywords:t.keywordsSEO||""}},_getCurrentPageName:function(){var e=null;try{var t=window.rendererModel?this.resources.W.Viewer:this.resources.W.Preview.getPreviewManagers().Viewer,i=t.getCurrentPageNode().getLogic().getDataItem();e=i.getData()}catch(n){return""}return e&&e.title||""}})}),define.oldTrait({name:"wysiwyg.viewer.components.traits.ValidationSettings",trait:{Static:{VALID_STATE_CHANGED_EVENT:"validStateChanged"},_isValid:!0,_validationFunction:function(){return!0},initialize:function(e,t,i){this.parent(e,t,i),i.validationFunction&&this.setValidationFunction(i.validationFunction)},setValidationState:function(e){var t=this._isValid!=e;this._isValid=e,t&&this.fireEvent(this.VALID_STATE_CHANGED_EVENT,e)},setValidationFunction:function(e){this._validationFunction=e}}}),define.oldTrait({name:"wysiwyg.viewer.components.traits.VideoUtils",trait:{_videoUrl:{YOUTUBE:"http://youtu.be/",VIMEO:"http://vimeo.com/"},_getServices:function(){var e={YOUTUBE:{url:"http://www.youtube.com/embed/",getPreviewUrl:this._getYouTubePreviewUrl},VIMEO:{url:"http://player.vimeo.com/video/",getPreviewUrl:this._getVimeoPreviewUrl}};return e},_getYouTubePreviewUrl:function(e,t){var i="http://img.youtube.com/vi/[repLace]/0.jpg",n=i.replace("[repLace]",e);return t(n),n},_getVimeoPreviewUrl:function(e,t){var i="http://vimeo.com/api/v2/video/[repLace].json",n=i.replace("[repLace]",e),o=new Request.JSONP({url:n+"?"+"r="+Math.random(),onComplete:function(e){t(e[0].thumbnail_large)}});o.send()},_getYoutubeId:function(e){var t="",i=/(?:youtube\.com\/watch[^\s]*[\?&]v=)([\w-]+)/g,n=/(?:youtu\.be\/)([\w-]+)/g,o=i.exec(e)||n.exec(e);return o&&o.length&&o[1]&&(t=o[1]),t},_getVimeoId:function(e){var t="",i=/vimeo\.com\/(\d+)$/gi,n=i.exec(e);return n&&n.length&&n[1]&&(t=n[1]),t},_getVideoDataFromVideoUrl:function(e){var t=null,i=this._getYoutubeId(e);return i?t="YOUTUBE":(i=this._getVimeoId(e),i&&(t="VIMEO")),i&&t?{videoId:i,videoType:t}:{}},_getVideoUrlFromVideoData:function(e){var t=e.videoId,i=e.videoType;return t&&i?this._videoUrl[i]+t:""}}}),define.oldComponent({name:"wysiwyg.viewer.components.wixhomepage.HomePageLogin",skinParts:{actionTitle:{type:"htmlElement"},memberTitle:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_onStyleChange","_doLogout","_doLogin"],_states:["auth","no_auth"],Translations:{en:{SIGN_IN:"Login/Sign up",SIGN_OUT:"Log out",HELLO:"Hello"},de:{SIGN_IN:"Anmelden/Registrieren",SIGN_OUT:"Abmelden",HELLO:"Hallo"},es:{SIGN_IN:"Login/ Regístrate",SIGN_OUT:"Cerrar Sesión",HELLO:"Hola"},fr:{SIGN_IN:"Connexion/ Inscription",SIGN_OUT:"Déconnexion",HELLO:"Bonjour"},it:{SIGN_IN:"Accedi/Registrati",SIGN_OUT:"Esci",HELLO:"Ciao"},pl:{SIGN_IN:"Zaloguj się/Zarejestruj się",SIGN_OUT:"Wyloguj się",HELLO:"Witaj"},pt:{SIGN_IN:"Login/Registre-se",SIGN_OUT:"Sair",HELLO:"Olá"},ko:{SIGN_IN:"로그인/등록",SIGN_OUT:"로그아웃",HELLO:"안녕하세요?"},ja:{SIGN_IN:"ログイン/サインアップ",SIGN_OUT:"ログアウト",HELLO:"こんにちは"},ru:{SIGN_IN:"Логин/Вход",SIGN_OUT:"Выйти",HELLO:"Здравствуйте"}},initialize:function(e,t,i){this.parent(e,t,i),window.userApi&&(this._userApi=window.userApi)},_translate:function(e){var t="en";return this._userApi&&(t=this._userApi.getLanguage()),this.Translations[t][e]},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChange)},_onStyleChange:function(){this._wCheckForSizeChangeAndFireAutoSized(10)},_onAllSkinPartsReady:function(){this._updateTextsAndEvents()},_doLogout:function(){var e=this._skinParts.actionTitle;e.removeEvent("click",arguments.callee),this.injects().Viewer.isPublicMode()?(this._userApi.logout(),window.location.href="http://www.wix.com"):this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this.getViewNode()},this)},_doLogin:function(){var e=this._skinParts.actionTitle;e.removeEvent("click",arguments.callee),this.injects().Viewer.isPublicMode()?this._openLoginDialog():this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this.getViewNode()},this)},_updateView:function(e,t,i){var n=this._skinParts.actionTitle,o=this._skinParts.memberTitle;n.set("text",e),o.set("text",t),n.addEvent("click",i)},_updateTextsAndEvents:function(){var e=this._userApi;e&&e.isSessionValid()?(this._updateView(this._translate("SIGN_OUT"),this._translate("HELLO")+" "+e.getUserName(),this._doLogout),this.setState("auth")):(this._updateView(this._translate("SIGN_IN"),"",this._doLogin),this.setState("no_auth"))},_openLoginDialog:function(){var e=this._data.get("postLoginUrl"),t=this._data.get("postSignUpUrl"),i=this._data.get("startWith");e||(e=location.href),t||(t=location.href),window.animateForm.callForm([t,e,i,"HTML"])},getAcceptableDataTypes:function(){return["HomePageLogin"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.wixhomepage.LanguagesDropDown",skinParts:{select:{type:"htmlElement"},options:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_initMenu","_populateDropDown","_updateSelection","_changeLanguage","_onFocus","_onBlur","_onOptionClick","_onKeyPress","_changeLanguageSuccess","_changeLanguageFailed"],Static:{CLASS_NAME_SELECTED:"selected",CLASS_NAME_OPTION_CONTAINER:"optionContainer"},_states:{mouse:["selected"]},initialize:function(e,t,i){this.parent(e,t,i),this._selectedOption=null,this._menuData=window.wixhomepage&&window.wixhomepage.languagesDropDownData?window.wixhomepage.languagesDropDownData:[{languageCode:"en",languageSubdomain:"www",iconURL:"",languageLabel:"English"},{languageCode:"de",languageSubdomain:"de",iconURL:"",languageLabel:"Deutsch"},{languageCode:"es",languageSubdomain:"es",iconURL:"",languageLabel:"Español"},{languageCode:"fr",languageSubdomain:"fr",iconURL:"",languageLabel:"Français"},{languageCode:"it",languageSubdomain:"it",iconURL:"",languageLabel:"Italiano"},{languageCode:"pl",languageSubdomain:"pl",iconURL:"",languageLabel:"Polski"},{languageCode:"pt",languageSubdomain:"pt",iconURL:"",languageLabel:"Português"},{languageCode:"ru",languageSubdomain:"ru",iconURL:"",languageLabel:"Pусский"}]},_onAllSkinPartsReady:function(){this._initMenu()},_initMenu:function(){this._populateDropDown(),this._skinParts.select.addEvent(Constants.CoreEvents.CHANGE,this._changeLanguage),this._skinParts.select.addEvent(Constants.CoreEvents.CLICK,this._onFocus),this._skinParts.options.addEvent(Constants.CoreEvents.CLICK,this._onOptionClick)},_onFocus:function(e){return e.stopPropagation(),"selected"==this.getState("mouse")?(this._onBlur(e),void 0):(this.setState("selected","mouse"),document.body.addEvent(Constants.CoreEvents.CLICK,this._onBlur),document.body.addEvent(Constants.CoreEvents.KEY_DOWN,this._onKeyPress),void 0)},_onBlur:function(e){e.stopPropagation(),this.removeState("selected","mouse"),document.body.removeEvent(Constants.CoreEvents.CLICK,this._onBlur),document.body.removeEvent(Constants.CoreEvents.KEY_DOWN,this._onKeyPress)},_onOptionClick:function(e){e=e||{};for(var t=e.target;t!==this._skinParts.options&&0==t.hasClass(this.CLASS_NAME_OPTION_CONTAINER);)t=t.parentNode;var i=t.getAttribute("data-subdomain"),n=t.getAttribute("data-languagecode"),o=this._getLanguage();this._setSelected(t),"site"==window.viewMode&&i&&n&&n!=o&&this._skinParts.select.fireEvent(Constants.CoreEvents.CHANGE,{value:i}),this._onBlur(e)},_onKeyPress:function(e){switch(e.stopPropagation(),e.key){case"up":var t=this._selectedOption.getPrevious();t||(t=this._skinParts.options.getLast()),this._setSelected(t),e.preventDefault();break;case"down":this._setSelected(this._selectedOption.getNext()),e.preventDefault();break;case"enter":case"space":e.target=this._selectedOption,this._onOptionClick(e);break;case"esc":case"tab":this._onBlur(e)}},_setSelected:function(e){var t=this._skinParts.select,i=this._skinParts.options,n=this._skinParts.options.getElement("."+this.CLASS_NAME_SELECTED);n&&n.removeClass(this.CLASS_NAME_SELECTED),e=e||this._skinParts.options.getFirst(),e.addClass(this.CLASS_NAME_SELECTED),t.setAttribute("data-subdomain",e.getAttribute("data-subdomain")),t.setAttribute("data-languagecode",e.getAttribute("data-languagecode")),t.set("html",e.get("html"));var o=e.getPosition(i).y,s=i.getScroll().y;(o>i.getSize().y+s||0>o)&&i.scrollTo(0,o),this._selectedOption=e},_populateDropDown:function(){var e,t;for(this._skinParts.select.empty(),this._skinParts.options.empty(),e=0,t=this._menuData.length;t>e;e++)this._insertOption(this._menuData[e]);this._updateSelection()},_insertOption:function(e){var t=new Element("li",{html:e.languageLabel}),i=new Element("image");t.addClass(this.CLASS_NAME_OPTION_CONTAINER),e.iconURL&&(i.setAttribute("src",e.iconURL),i.inject(t)),t.insertInto(this._skinParts.options),t.setAttribute("data-subdomain",e.languageSubdomain),t.setAttribute("data-languagecode",e.languageCode),t.addEvent(Constants.CoreEvents.CLICK,this._onOptionClick)},_getOptionBySubDomain:function(e){return this._skinParts.options.getElement('[data-subdomain="'+e+'"]')},_changeLanguageSuccess:function(){var e=this._skinParts.select.getAttribute("data-subdomain"),t=location.hostname.substring(location.hostname.indexOf(".")),i=location.protocol+"//"+e+t+location.pathname+location.search+location.hash;location.href.toLowerCase()==i.toLowerCase()?location.reload():location.href=i},_changeLanguageFailed:function(){},_changeLanguage:function(){var e=this._skinParts.select.getAttribute("data-languagecode");window.userApi?window.userApi.setLanguage(e,this._changeLanguageFailed,this._changeLanguageSuccess):LOG.reportError(wixErrors.USER_MANAGER_NOT_FOUND,"LanguagesDropDown","_changeLanguage")()},_getLanguage:function(){return window.userApi?window.userApi.getLanguage():(LOG.reportError(wixErrors.USER_MANAGER_NOT_FOUND,"LanguagesDropDown","_getLanguage")(),"en")},_updateSelection:function(){var e;e=window.userApi?window.userApi.getLanguage():"www";var t=this._getOptionBySubDomain(e);this._setSelected(t)},_removeAllDomEvents:function(){document.body.removeEvent(Constants.CoreEvents.CLICK,this._onBlur),document.body.removeEvent(Constants.CoreEvents.KEY_DOWN,this._onKeyPress)},dispose:function(){this._removeAllDomEvents(),this.parent()}}}),define.oldComponent({name:"wysiwyg.viewer.components.wixhomepage.WixHomepageMenu",skinParts:{buttonsContainer:{type:"htmlElement"},buttonTemplate:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_populateMenu","_getData"],_states:["topMenu","bottomMenu"],render:function(){this._getData(),this._populateMenu(),this._setMenuType()},_setMenuType:function(){var e=this._data.get("menuDataSource");this.setState(e)},_getData:function(){var e=this._data.get("menuDataSource"),t=this._getLanguage();this._menuData=window.wixhomepage&&window.wixhomepage[e]&&window.wixhomepage[e][t]?window.wixhomepage[e][t]:[{label:"Create",link:"/create/website"},{label:"Explore",link:"/sample/website"},{label:"Features",link:"/about/features"},{label:"My Account",link:"/create/my-account"},{label:"Premium",link:"/upgrade/website"},{label:"Support",link:"/support/"}]},_getLanguage:function(){return window.userApi?window.userApi.getLanguage():(LOG.reportError(wixErrors.USER_MANAGER_NOT_FOUND,"WixHomepageMenu","_getLanguage"),"en")},_insertButton:function(e){var t=this._skinParts.buttonTemplate.cloneNode(!0);t.setAttribute("isTemplate","false");var i=t.getElements(".buttonLink")[0];i.setAttribute("href",e.link),i.innerHTML=e.label,t.insertInto(this._skinParts.buttonsContainer)},_populateMenu:function(){var e;for(this._skinParts.buttonsContainer.empty(),e=0,l=this._menuData.length;l>e;e++)this._insertButton(this._menuData[e])},getAcceptableDataTypes:function(){return["WixHomepageMenu"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.wixhomepage.WixOfTheDay",imports:["core.components.image.ImageSettings"],skinParts:{img:{type:"core.components.image.ImageNew",dataRefField:"*"},introContainer:{type:"htmlElement"},descriptionContainer:{type:"htmlElement"},introPreTitle:{type:"htmlElement"},introTitle:{type:"htmlElement"},introText:{type:"htmlElement"},shortDescriptionText:{type:"htmlElement"},descriptionText:{type:"htmlElement"},readOn:{type:"htmlElement"},closeDescription:{type:"htmlElement"}},traits:["wysiwyg.common.components.traits.LinkableComponent"],Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_onCloseDescriptionClicked","_onReadOnClicked","_renderTexts","_updateContainers"],Static:{},_states:["opened","closed"],Translations:{en:{INTRO_PRE_TITLE:"GET INSPIRED WITH",INTRO_TITLE:"OF THE DAY",INTRO_TEXT:"Everyday we feature an amazing new website built with Wix.<br>Want your website featured?<br>Submit your URL to wixofday@wix.com",READ_ON_BUTTON_LABEL:"Read on",CLOSE_DESCRIPTION_BUTTON_LABEL:"Close"},es:{INTRO_PRE_TITLE:"Inspírate con el",INTRO_TITLE:"del día!",INTRO_TEXT:"Todos los días te presentamos un increíble sitio creado con Wix.<br>¿Quieres que tu sitio aparezca aquí?<br>Envíanos tu URL a wixofday@wix.com",READ_ON_BUTTON_LABEL:"Leer Más",CLOSE_DESCRIPTION_BUTTON_LABEL:"Cerrar"},fr:{INTRO_PRE_TITLE:"Inspirez-vous du",INTRO_TITLE:"du Jour!",INTRO_TEXT:"Nous exposons chaque jour le meilleur site créé avec Wix.<br>Vous voulez que votre site soit exposé?<br>Envoyez votre URL à wixofday@wix.com",READ_ON_BUTTON_LABEL:"En lire plus",CLOSE_DESCRIPTION_BUTTON_LABEL:"Fermer"},it:{INTRO_PRE_TITLE:"Lasciati ispirare dal",INTRO_TITLE:"del giorno!",INTRO_TEXT:"Ogni giorno presentiamo un sito spettacolare creato con Wix.<br>Vuoi che anche il tuo sito venga preso in considerazione?<br>Inviaci il tuo URL a wixofday@wix.com",READ_ON_BUTTON_LABEL:"Continua a leggere",CLOSE_DESCRIPTION_BUTTON_LABEL:"Chiudi"},pl:{INTRO_PRE_TITLE:"Zainspiruj sie",INTRO_TITLE:"EM DNIA!",INTRO_TEXT:"Kazdego dnia prezentujemy nowa, niesamowita witryne zbudowana z Wix.<br>Chcesz, aby twoja witryna zostala wyrózniona?<br>Przeslij jej adres URL na wixofday@wix.com",READ_ON_BUTTON_LABEL:"Czytaj wiecej",CLOSE_DESCRIPTION_BUTTON_LABEL:"Zamknij"},pt:{INTRO_PRE_TITLE:"INSPIRE-SE COM O",INTRO_TITLE:"DO DIA!",INTRO_TEXT:"Todos os dias nós exibimos um site incrível construído com o Wix.<br>Quer ver o seu site aqui?<br>Envie o seu endereço URL para wixofday@wix.com",READ_ON_BUTTON_LABEL:"Leia mais",CLOSE_DESCRIPTION_BUTTON_LABEL:"Fechar"},ko:{INTRO_PRE_TITLE:"영감 얻기",INTRO_TITLE:"오늘의 WIX",INTRO_TEXT:"당사는 날마다 Wix에 새롭고 멋진 웹사이트를 구축합니다.<br>귀하의 웹사이트에 특징을 추가하시겠습니까?<br>wixofday@wix.com으로 귀하의 URL을 보내주십시오.",READ_ON_BUTTON_LABEL:"읽기",CLOSE_DESCRIPTION_BUTTON_LABEL:"닫기"},ja:{INTRO_PRE_TITLE:"インスパイアされよう！\r\n\r\n",INTRO_TITLE:"WIX おすすめサイト！",INTRO_TEXT:"Wixで作成された素晴らしいウェブサイトを毎日ご紹介します。あなたのウェブサイトも紹介したいですか？\nあなたのURLをwixofday@wix.com宛てにお送りください。",READ_ON_BUTTON_LABEL:"続きを読む",CLOSE_DESCRIPTION_BUTTON_LABEL:"閉じる"},ru:{INTRO_PRE_TITLE:"Вдохновитесь сайтом",INTRO_TITLE:"ДНЯ",INTRO_TEXT:"Каждый день мы демонстрируем вам новые, уникальные сайты, созданные с помощью Wix!<br>Хотите, чтобы и ваш сайт стал Сайтом Дня?<br>Пришлите нам адрес URL на wixofday@wix.com",READ_ON_BUTTON_LABEL:"читать далее",CLOSE_DESCRIPTION_BUTTON_LABEL:"закрыть"}},initialize:function(e,t,i){this.parent(e,t,i),this._SettingsClass=this.imports.ImageSettings,window.userApi&&(this._userApi=window.userApi),this.setState("closed")},_translate:function(e){var t="en";return this._userApi&&(t=this._userApi.getLanguage()),this.Translations[t][e]},render:function(){this._renderImage(),this._renderTexts(),this.parent()},_updateContainers:function(){"closed"==this.getState()?(this._skinParts.introContainer.setStyle("display","block"),this._skinParts.descriptionContainer.setStyle("display","none")):(this._skinParts.introContainer.setStyle("display","none"),this._skinParts.descriptionContainer.setStyle("display","block"))},_renderTexts:function(){this._updateContainers(),this._skinParts.introPreTitle.innerHTML=this._translate("INTRO_PRE_TITLE"),this._skinParts.introTitle.innerHTML=this._translate("INTRO_TITLE"),this._skinParts.introText.innerHTML=this._translate("INTRO_TEXT"),this._skinParts.descriptionText.innerHTML=this._data.get("description"),this._skinParts.shortDescriptionText.innerHTML=this._data.get("description"),this._skinParts.readOn.innerHTML=this._translate("READ_ON_BUTTON_LABEL"),this._skinParts.closeDescription.innerHTML=this._translate("CLOSE_DESCRIPTION_BUTTON_LABEL")},_renderImage:function(){if(this._layoutInitialized){var e=this._skinParts.img;if(e&&e.getOriginalClassName){var t=this._getImageSettings();e.setSettings(t),e.setHeight(274,!1,!1),e.setWidth(344,!1,!1)}}},_getImageSettings:function(){return this._imageSettings||(this._imageSettings=new this.imports.ImageSettings(this._SettingsClass.CropModes.FIT_WIDTH,344,274)),this._imageSettings},_onReadOnClicked:function(e){e.stopPropagation(),this.setState("opened"),W.Utils.Tween.to(this._skinParts.introContainer,.3,{opacity:0,onComplete:this._updateContainers}),W.Utils.Tween.to(this._skinParts.descriptionContainer,.3,{delay:.3,opacity:1})},_onCloseDescriptionClicked:function(e){e.stopPropagation(),this.setState("closed"),W.Utils.Tween.to(this._skinParts.descriptionContainer,.3,{opacity:0,onComplete:this._updateContainers}),W.Utils.Tween.to(this._skinParts.introContainer,.3,{delay:.3,opacity:1})},_onAllSkinPartsReady:function(){this._skinParts.readOn.addEvent(Constants.CoreEvents.CLICK,this._onReadOnClicked),this._skinParts.closeDescription.addEvent(Constants.CoreEvents.CLICK,this._onCloseDescriptionClicked)},_removeAllDomEvents:function(){this._skinParts.readOn.removeEvent(Constants.CoreEvents.CLICK,this._onReadOnClicked),this._skinParts.closeDescription.removeEvent(Constants.CoreEvents.CLICK,this._onCloseDescriptionClicked)},getAcceptableDataTypes:function(){return["Image"]},dispose:function(){this._removeAllDomEvents(),this.parent()}}});