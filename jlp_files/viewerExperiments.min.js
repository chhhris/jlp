define.experiment.component("wysiwyg.viewer.components.AdminLoginButton.NBC_SiteButton.New",function(e){var t=e;t.dataTypes(["SiteButton"]),t.states({button:["up","pressed"],alignment:["center","left","right"]})}),define.experiment.newComponent("wysiwyg.viewer.components.FacebookShare.FacebookShare.New",function(e){var t=e;t.inherits("core.components.base.BaseComp"),t.dataTypes(["FacebookShareDataSchema"]),t.resources(["W.Utils","W.Viewer"]),t.skinParts({facebookShareButton:{type:"htmlElement"}}),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._resizableSides=[]},_onRender:function(e){var t=e.data.invalidations;if(t.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE])){var i=this.getDataItem(),n=(i.get("label"),"Site Url"===i.get("urlChoice")?this.getSiteUrl():this.getCurrentPageUrl()),o=this._skinParts.facebookShareButton;this._setLabelAccordingToData(),o.setAttribute("data-href","http://www.facebook.com/sharer.php?u="+n),o.addEvent("click",function(){this.resources.W.Utils.openPopupWindow(o.getAttribute("data-href"),"wix-share-to-facebook","width=635,height=346,scrollbars=no,status=no,toolbar=no,menubar=no,location=no")}.bind(this))}},getSiteUrl:function(){var e;return e=this.resources.W.Viewer.isPublicMode()?window.publicModel.externalBaseUrl:"http://www.wix.com"},getCurrentPageUrl:function(){return window.location.href},_setLabelAccordingToData:function(){var e=this.getDataItem().get("label");this._skinParts.label.set("html",e)}})}),define.experiment.component("wysiwyg.viewer.components.FiveGridLine.NBC_HorizontalLine.New",function(e,t){var i=e;i.inherits("core.components.base.BaseComp"),i.skinParts({line:{type:"htmlElement"}}),i.methods({initialize:function(e,t,i){this.parent(e,t,i),this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]},isRenderNeeded:function(e){var t=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE];return e.isInvalidated(t)},_onRender:function(){var e=this._skinParts.line.$measure.height;this.setHeight(e)}})}),define.experiment.component("wysiwyg.viewer.components.FiveGridLine.NewBaseCompFiveGridLine.New",function(e){var t=e;t.inherits("core.components.base.BaseComp")}),define.experiment.component("wysiwyg.viewer.components.FooterContainer.ErrorLogOnFooterFucks.New",function(e,t){var i=e;i.methods({initialize:function(e,t,i){this.parent(e,t,i),this.injects().Commands.registerCommandListenerByName("EditorCommands.SiteLoaded",this,this._onSiteLoaded.bind(this))},_onSiteLoaded:function(){this._view.addEventListener&&this._view.addEventListener("DOMNodeRemoved",this._onDOMNodeRemoved.bind(this))},_onDOMNodeRemoved:function(){var e=Error().stack;LOG.reportError(wixErrors.FOOTER_DELETED,this.$className,"DOMNodeRemoved",e)},setY:function(e){if(this.parent(e),!this._footerAlreadyReportedError)try{var t=$("SITE_HEADER").$logic;if(t){var i=t.getY(),n=this.getY();if(i>n){var o=Error().stack;LOG.reportError(wixErrors.FOOTER_HIGHER_THAN_HEADER,this.$className,"setY",o),this._footerAlreadyReportedError=!0}}}catch(s){LOG.reportError(wixErrors.GENERAL_FOOTER_ERROR,this.$className,"setY",s.stack)}}})}),define.experiment.component("wysiwyg.viewer.components.HorizontalMenu.PartialComponentPreview.New",function(e,t){var i=e;i.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],test:"dooooooode",EDITOR_META_DATA:{general:{settings:!0,design:!0,previewable:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages"}],dblClick:{command:"WEditorCommands.Pages"},partialView:!0},_moreButtonClicked:!1,_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}})}),define.experiment.component("wysiwyg.viewer.components.HtmlComponent.RefreshFrameOnTransition.New",function(e,t){var i=e,n=t;i.resources(["W.Viewer","W.Commands"]),i.binds(["_onPageTransitionStarted","_onPageTransitionEnded"]),i.methods({render:n.before(function(){this.resources.W.Viewer.removeEvent("pageTransitionStarted",this._onPageTransitionStarted),this.resources.W.Viewer.removeEvent("pageTransitionEnded",this._onPageTransitionEnded),this.resources.W.Viewer.addEvent("pageTransitionStarted",this._onPageTransitionStarted),this.resources.W.Viewer.addEvent("pageTransitionEnded",this._onPageTransitionEnded),this.resources.W.Viewer.getPreviewMode()&&this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onViewModeChanged)}),_onPageTransitionStarted:function(){this._iframe.set("src","about:blank")},_onPageTransitionEnded:function(){this._setFrameWithSrc(this._iframe)},getIFrameSrc:function(){var e=this._data.get("url"),t=/^(ftps|ftp|http|https).*$/;return t.test(e)||(e="http://"+e),e=e.split("static.wix.com").join("static.parastorage.com")}})}),define.experiment.component("wysiwyg.viewer.components.HtmlComponent.htmlParastorage.New",function(e,t){var i=e;i.methods({getIFrameSrc:function(){var e=this._data.get("url"),t=/^(ftps|ftp|http|https).*$/;return t.test(e)||(e="http://"+e),e=e.split("static.wix.com").join("static.parastorage.com")}})}),define.experiment.component("wysiwyg.viewer.components.MediaZoomDisplayer.LazyShare.New",function(e,t){var i=e,n=t;i.skinParts(n.merge({lazyShare:{type:"wysiwyg.viewer.components.LazySocialPanel",optional:!1}}))}),define.experiment.newComponent("wysiwyg.viewer.components.MobileMediaZoom.MobileZoom.New",function(e){var t=e;t.resources(["W.Viewer"]),t.states({showButtons:["doShowButtons","dontShowButtons"],orientation:["portrait","landscape"]}),t.binds(["_onOrientationChange","_preventScroll","_changeButtonsVisibility"]),t.inherits("wysiwyg.viewer.components.MediaZoom"),t.skinParts({blockingLayer:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Close"},dialogBox:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Close"},virtualContainer:{type:"htmlElement"},itemsContainer:{type:"htmlElement"},counter:{type:"htmlElement"},buttonPrev:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Prev"},buttonNext:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Next"}}),t.fields({transitionTime:"short",_inTransition:!1,_lastCurrentItem:null}),t.methods({initialize:function(e,t,i){this._landscapePortraitRatio=screen.height/screen.width,this._fontSizeCorrectionWhenOpenZoomInPortrait=1.1,this.isVolatile=!0,this.parent(e,t,i);var n=this.injects().Commands;n.registerCommandAndListener("WViewerCommands.MediaZoom.Close",this,this._closeZoom,null,!0),n.registerCommandAndListener("WViewerCommands.MediaZoom.Next",this,this.gotoNext,null,!0),n.registerCommandAndListener("WViewerCommands.MediaZoom.Prev",this,this.gotoPrev,null,!0),n.registerCommandAndListener("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",this,this._changeButtonsVisibility,null,!0),n.registerCommandAndListener("WPreviewCommands.WEditModeChanged",this,this._editModeChanged,null,!0),this.addEvent("currentItemChanged",this._handleCurrentItemChange),this.collapse(),this._mobileConfig=this.injects().Config.mobileConfig,this._setOrientation()},_setOrientation:function(){var e=parseFloat(this._view.getStyle("font-size"));0===window.orientation?(this.setState("portrait","orientation"),e*=this._landscapePortraitRatio):(this.setState("landscape","orientation"),e/=this._landscapePortraitRatio),this._view.setStyle("font-size",e+"px")},_onAllSkinPartsReady:function(){this.parent(),this._mobileConfig.isMobileOrTablet()&&(Hammer(this._view).on("swipeleft",this.gotoNext.bind(this)),Hammer(this._view).on("swiperight",this.gotoPrev.bind(this)))},_onOrientationChange:function(){this._currentDisplayer.hideContent(),this.showZoomImage(!0),this._setOrientation()},_changeButtonsVisibility:function(e){e?this.setState("doShowButtons","showButtons"):this.setState("dontShowButtons","showButtons")},_closeZoom:function(){this.collapse(),this.injects().Viewer.exitFullScreenMode(),this.setDataItem(null),this.resetIterator(),this._skinParts.virtualContainer.empty(),this._skinParts.itemsContainer.empty(),this._opened=!1,this.unlock(),this._lastCurrentItem=null,this._enableScroll(),window.removeEvent("orientationchange",this._onOrientationChange),this._enableZoomAndMagnifier(),this._refreshQuickActions()},showZoomImage:function(e){if(this._mobileConfig.isMobileOrTablet()&&window.addEvent("orientationchange",this._onOrientationChange),this._disableScroll(),e||this._currentItem&&this._currentItem!=this._lastCurrentItem){var t=this.injects().Utils.getWindowSize(),i=this.getSkin().getParams().first(function(e){return"$marginIncludingArrow"===e.id});this._imageMaxWidth=t.width-2*i.defaultValue,this._imageMaxHeight=t.height-60,this._lastCurrentItem=this._currentItem,this._renderCurrentDisplayer(this._transitionToCurrentDisplayer),this._skinParts.counter.set("text",this._currentItemIndex+1+""+"/"+(this._numItems+"")),this.injects().Viewer.enterFullScreenMode(),this.uncollapse()}},_renderCurrentDisplayer:function(){for(var e=this._skinParts.virtualContainer,t=0;e.childNodes.length>t;t++)e.childNodes[t].destroy();var i=this;this._getDisplayerDivFunction(this._currentItem,{container:i._skinParts.virtualContainer,x:this._imageMaxWidth,y:this._imageMaxHeight},function(e){e.getParent('[skinpart="virtualContainer"]')||e.insertInto(i._skinParts.virtualContainer),i._changeImageNoTransition(e),i._currentDisplayer=e.getLogic()})},_changeImageNoTransition:function(e){for(var t=this._skinParts.itemsContainer,i=this,n=0;t.childNodes.length>n;n++)t.childNodes[n].destroy();t.empty();var o=e.getStyles("width","height"),s=i._getTopGap(o.height.replace("px",""));t.adopt(e),i._skinParts.virtualContainer.empty(),i._skinParts.dialogBox.setStyles({"min-height":o.height,"margin-top":s+"px"}),i.unlock()},setGallery:function(e,t,i,n,o){this.parent(e,t,i,n,o),this._disableZoomAndMagnifier(),this._setZoomModeFontSize()},_setZoomModeFontSize:function(){var e=WQuickActions.initZoom,t=WQuickActions.getZoom(),i=e/t,n=8*i;0===window.orientation&&(n*=this._fontSizeCorrectionWhenOpenZoomInPortrait),this._view.setStyle("font-size",n+"px")},_disableZoomAndMagnifier:function(){this.resources.W.Viewer.setViewportAttribute("user-scalable","no")},_enableZoomAndMagnifier:function(){this.resources.W.Viewer.setViewportAttribute("user-scalable","yes")},_refreshQuickActions:function(){window.WQuickActions&&window.WQuickActions.startZooming()},_disableScroll:function(){document.addEvent("touchmove",this._preventScroll)},_preventScroll:function(e){e.preventDefault()},_enableScroll:function(){document.removeEvent("touchmove",this._preventScroll)}})}),define.experiment.component("wysiwyg.viewer.components.MobileMediaZoom.NewMobileOrientation.New",function(e,t){var i=e,n=t;i.resources(n.merge(["W.Config"])),i.methods({_setOrientation:function(){function e(e){e?t.setState("vertical"):t.setState("horizontal")}var t=this;this.resources.W.Config.mobileConfig.isPortrait(e.bind(this))}})}),define.experiment.newComponent("wysiwyg.viewer.components.MobileMediaZoomDisplayer.MobileZoom.New",function(e){var t=e;t.inherits("wysiwyg.viewer.components.MediaZoomDisplayer"),t.resources(["W.Commands"]),t.skinParts({notAllDescriptionPresentedIndicator:{type:"htmlElement",optional:!1},title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},link:{type:"htmlElement",optional:!0},imageWrapper:{type:"htmlElement"},image:{type:"core.components.Image",dataRefField:"*",optional:!1,hookMethod:"_addImageArgs"}}),t.states({link:["showLink","hideLink"],descriptionPresentationMode:["showLimitedDescription","showAllDescription"],showPanelText:["doShowPanelText","dontShowPanelText"],orientation:["portrait","landscape"]}),t.methods({initialize:function(e,t,i){this._fontSizeCorrectionWhenOpenZoomInPortrait=1.1,this.parent(e,t,i);var n=this._getDeviceSize();this._maxWidth=n.width,this._maxHeight=n.height,this.setState("doShowPanelText","showPanelText")},_onAllSkinPartsReady:function(){this.parent(),this.setState("showLimitedDescription","descriptionPresentationMode"),this._skinParts.description.addEvent("click",this._onDescriptionClick.bind(this)),this._skinParts.imageWrapper.addEvent("click",this._onImageWrapperClick.bind(this)),this._changeFontSizes(),this._setZoomModeFontSize()},_setZoomModeFontSize:function(){var e=WQuickActions.initZoom,t=WQuickActions.getZoom(),i=e/t,n=8*i;0===window.orientation&&(n*=this._fontSizeCorrectionWhenOpenZoomInPortrait),this._view.setStyle("font-size",n+"px")},render:function(){this.parent(),this._limitedDescriptionHeight=2*1.14*parseInt(this._skinParts.description.getStyle("font-size"))+"px",this._fullDescriptionHeight=this._skinParts.description.getStyle("height"),this._skinParts.description.setStyle("height",this._limitedDescriptionHeight),this._canDescriptionExpand()||this._skinParts.notAllDescriptionPresentedIndicator.setStyle("visibility","hidden"),this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",!0)},_onDescriptionClick:function(){if(this._canDescriptionExpand()){var e="showLimitedDescription"==this.getState("descriptionPresentationMode")?"showAllDescription":"showLimitedDescription";this.setState(e,"descriptionPresentationMode"),this._animateDescriptionHeightTransition(e),this._animateImageWrapperOpacityTransition(e)}},_onImageWrapperClick:function(){var e="doShowPanelText"==this.getState("showPanelText")?"dontShowPanelText":"doShowPanelText";this.setState(e,"showPanelText");var t="doShowPanelText"==this.getState("showPanelText")?!0:!1;this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",t)},_canDescriptionExpand:function(){return parseInt(this._fullDescriptionHeight)>parseInt(this._limitedDescriptionHeight)},_animateDescriptionHeightTransition:function(e){var t=new Fx.Tween(this._skinParts.description,{duration:"short",link:"chain",property:"height"}),i="showLimitedDescription"===e?this._limitedDescriptionHeight:this._fullDescriptionHeight;t.addEvent("complete",function(){"showLimitedDescription"===this.getState("descriptionPresentationMode")?this._skinParts.notAllDescriptionPresentedIndicator.setStyle("visibility","visible"):this._skinParts.notAllDescriptionPresentedIndicator.setStyle("visibility","hidden")}.bind(this)),t.start(i)},_animateImageWrapperOpacityTransition:function(e){var t=new Fx.Tween(this._skinParts.imageWrapper,{duration:"short",link:"chain",property:"opacity"}),i="showLimitedDescription"===e?"1":"0.65";t.start(i)},_getDeviceSize:function(){return{width:window.innerWidth,height:window.innerHeight}},_setCorrectImageSize:function(e){var t=e.y;this._getDisplayerWidth(e.x),this._skinParts.imageWrapper.setStyles({width:"100%",height:t+"px"}),this._skinParts.title.setStyles({"word-wrap":"break-word"}),this._skinParts.description.setStyles({"word-wrap":"break-word"})},hideContent:function(){this._skinParts.image.collapse(),this._skinParts.panel.collapse()},_changeFontSizes:function(){90==window.orientation||-90==window.orientation?this.setState("landscape","orientation"):this.setState("portrait","orientation")}})}),define.experiment.component("wysiwyg.viewer.components.MobileMediaZoomDisplayer.NewMobileOrientation.New",function(e,t){var i=e,n=t;i.resources(n.merge(["W.Config"])),i.methods({_changeFontSizes:function(){function e(e){e?(t._skinParts.title.setStyles({"font-size":"64px"}),t._skinParts.description.setStyles({"font-size":"42px"})):(t._skinParts.title.setStyles({"font-size":"38px"}),t._skinParts.description.setStyles({"font-size":"24px"}))}var t=this;this.resources.W.Config.mobileConfig.isPortrait(e.bind(this))}})}),define.experiment.component("wysiwyg.viewer.components.PageGroup.GridLines.New",function(e,t){var i=e;i.skinParts({}),i.binds(["onCurrentPageResize","_resizePage","_onTransitionFinished"]),i.methods({toggleGrid:function(){},refreshGrid:function(){},_setHorizontalGrid:function(){},_setVerticalGrid:function(){},_resizePage:function(e){e||(e=this._currentPage.getLogic().getHeight()),this.setHeight(e),W.Layout.enforceAnchors([this])}})}),define.experiment.component("wysiwyg.viewer.components.PaginatedGridGallery.MobilePaginatedGrid.New",function(e,t){var i=e,n=t;i.binds(n.merge(["_onPrevious","_onNext"])),i.states(n.merge({mobile:["notMobile","mobile"]})),i.methods({initialize:n.after(function(){W.Config.mobileConfig.isMobileOrTablet()?this.setState("mobile","mobile"):this.setState("notMobile","mobile")}),_onAllSkinPartsReady:function(){var e=this.getComponentProperty("galleryImageOnClickAction"),t=this.getComponentProperty("expandEnabled");"unset"===e&&(t===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0),this._updateGalleryImageOnClickAction()),this.parent(),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.itemsContainer.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder&&(this._skinParts.rolloverHolder.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder.setStyles({overflow:"hidden"}));var i=this.injects().Utils.getCSSBrowserFeature("user-select"),n={cursor:"pointer"};i&&(n[i]="none"),this._skinParts.buttonPrev.setStyles(n),this._skinParts.buttonNext.setStyles(n),this._addEventListeners(),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._transitionUtils.setupTransitionMap(this._calcItemPosition.bind(this),this._skinParts.itemsContainer),this._checkSkinPartsVisibility()},_addEventListeners:function(){this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.CLICK,this._onPrevious),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.CLICK,this._onNext),"mobile"===this.getState("mobile")&&(Hammer(this._view).on("swiperight",this._onPrevious),Hammer(this._view).on("swipeleft",this._onNext))},_onPrevious:function(e){e.stopPropagation(),this.prev()},_onNext:function(e){e.stopPropagation(),this.next()}})}),define.experiment.newComponent("wysiwyg.viewer.components.PinterestPin.PinterestPinComponent.New",function(e){var t=e;t.inherits("core.components.base.BaseComp"),t.utilize(["core.components.image.ImageUrlNew"]),t.resources(["W.Config","topology"]),t.dataTypes(["Image"]),t.propertiesSchemaType("PinterestPinProperties"),t.skinParts({pinButton:{type:"htmlElement"}}),t.statics({_pinButtonMargins:16,_pinButtonWidth:40,_pinButtonHeight:20,_pinCountBesideWidth:35,_pinCountAboveHeight:29}),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._resizableSides=[],this._imgUtils=new this.imports.ImageUrlNew},_onRender:function(){this._calculateDimensions(),this._createIframe()},_getImageUrl:function(){var e=this.getDataItem(),t=e?e.get("uri"):"";return t?this._imgUtils.getImageAbsoluteUrlFromRelativeUrl(t):""},_getImageDesciption:function(){var e=this.getDataItem();return e?e.get("description"):""},_getDataPinConfig:function(){var e=this.getComponentProperties();return e?e.get("data-pin-config"):"none"},_getIframeUrl:function(){var e=this.resources.W.Config.getUserPublicUrl(),t=this.resources.topology.wysiwyg+"/html/external/pinterestpin.html";return t+"?media="+this._getImageUrl()+"&url="+e+"&description="+this._getImageDesciption()+"&data-pin-config="+this._getDataPinConfig()},_calculateDimensions:function(){var e=this._getDataPinConfig(),t={};switch(e){case"beside":t.width=this._pinButtonWidth+this._pinCountBesideWidth,t.height=this._pinButtonHeight;break;case"above":t.width=this._pinButtonWidth,t.height=this._pinButtonHeight+this._pinCountAboveHeight;break;default:t.width=this._pinButtonWidth,t.height=this._pinButtonHeight}return t.width+=this._pinButtonMargins,t.height+=this._pinButtonMargins,{width:t.width+"px",height:t.height+"px"}},_createIframe:function(){var e=this._calculateDimensions();this._iframe=new IFrame({src:this._getIframeUrl(),webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameborder:"0",width:e.width,height:e.height}),this._skinParts.pinButton.empty(),this._iframe.insertInto(this._skinParts.pinButton)}})}),define.experiment.component("wysiwyg.viewer.components.ScreenWidthContainer.GridLines.New",function(e,t){var i=e;i.methods({_onResize:function(){this.parent()}})}),define.experiment.component("wysiwyg.viewer.components.SiteButton.NBC_SiteButton.New",function(e){var t=e;t.inherits("core.components.base.BaseComp"),t.dataTypes(["SiteButton"]),t.states({button:["up","pressed"],alignment:["center","left","right"]}),t.binds(["hasInvalidations","_setLabelAccordingToData","_setVerticalAlignment","_setHorizontalAlignment","_addEventOn","_onClick","_onMouseDown","_onMouseUp"]),t.fields({isRenderNeeded:function(e){var t=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE,this.INVALIDATIONS.WIDTH_REQUEST,this.INVALIDATIONS.HEIGHT_REQUEST,this.INVALIDATIONS.PART_SIZE,this.INVALIDATIONS.SIZE];return e.isInvalidated(t)},_onRender:function(e){if(this.hasInvalidations(e,["SKIN_CHANGE"])){var t=this.getViewNode();this._addEventOn(t,Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),this._addEventOn(t,Constants.CoreEvents.MOUSE_UP,this._onMouseUp),this._addEventOn(t,Constants.CoreEvents.CLICK,this._onClick)}this.hasInvalidations(e,["SKIN_CHANGE","DATA_CHANGE","WIDTH_REQUEST"])&&(this.getDataItem()&&this._setLabelAccordingToData(),this._setHorizontalAlignment()),this.hasInvalidations(e,["SKIN_CHANGE","SIZE","PART_SIZE"])&&this._setVerticalAlignment()},hasInvalidations:function(e,t){for(var i=e.data.invalidations,n=0;t.length>n;++n){var o=t[n],s=this.INVALIDATIONS[o];if(i.getInvalidationByType(s))return!0}return!1},_setLabelAccordingToData:function(){var e=this.getDataItem().get("label");this._skinParts.label.set("html",e)},_setVerticalAlignment:function(){var e=this._skinParts.label;if(e.$measure){var t=e.$measure.height;e.setStyle("position","relative");var i=this.$view.$measure.height/2-t/2;e.setStyle("top",i)}},_setHorizontalAlignment:function(){var e=this._skinParts.label,t=this.getComponentProperty("margin"),i=Math.max(this.getRequestDimensions().width,this.getPhysicalWidth());t=Math.min(t,i-e.$measure.width);var n=this.getComponentProperty("align"),o=""+t+"px";e.setStyle("margin-left","left"==n?o:void 0),e.setStyle("margin-right","right"==n?o:void 0),this.setState(n,"alignment")},_onClick:function(e){this.fireEvent(Constants.CoreEvents.CLICK,e)},_onMouseDown:function(e){this.setState("pressed"),this.fireEvent(Constants.CoreEvents.MOUSE_DOWN,e)},_onMouseUp:function(){this.setState("up")},getHeight:function(){return this.getPhysicalHeight()},getWidth:function(){return this.getPhysicalWidth()},setHeight:function(e){this.parent(e)},setWidth:function(e){this.parent(e)},_eventList:[],_addEventOn:function(e,t,i){e.addEvent(t,i),this._eventList.push({name:t,target:e,handler:i})},exterminate:function(){for(var e=0;this._eventList.length>e;++e){var t=this._eventList.splice(0,1);t.target.removeEvent(t.name,t.handler)}this.parent()}})}),define.experiment.component("wysiwyg.viewer.components.SlideShowGallery.MobileSlideShow.New",function(e,t){var i=e,n=t;i.states(n.merge({mobile:["notMobile","mobile"],mobileShowTextPanel:["showTextPanel","notShow"]})),i.binds(n.merge(["_onNext","_onPrev"])),i.methods({initialize:n.after(function(){W.Config.mobileConfig.isMobileOrTablet()?this.setState("mobile","mobile"):this.setState("notMobile","mobile")}),_onAllSkinPartsReady:function(){var e=this.getComponentProperty("galleryImageOnClickAction"),t=this.getComponentProperty("expandEnabled");"unset"===e&&(t===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._view.setStyle("overflow","hidden"),this._itemHolder=new Element("div"),this._itemHolder.setStyles({position:"absolute",width:"100%",height:"100%"}),this._skinParts.itemsContainer.appendChild(this._itemHolder),this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onPrev),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onNext),"mobile"===this.getState("mobile")&&(Hammer(this._view).on("swiperight",this._onPrev),Hammer(this._view).on("swipeleft",this._onNext)),this._transitionUtils=new this.imports.TransitionUtils,this._skinParts.virtualContainer||(this._skinParts.virtualContainer=new Element("div"),this._view.grab(this._skinParts.virtualContainer,"top"),this._skinParts.virtualContainer.setStyles({visibility:"hidden",display:"block",width:"1px",height:"1px",overflow:"hidden"})),this._widthDiff=this._skin.widthDiff||0,this._heightDiff=this._skin.heightDiff||0;var i={cursor:"pointer"},n=this.injects().Utils.getCSSBrowserFeature("user-select");n&&(i[n]="none"),this._skinParts.buttonPrev.setStyles(i),this._skinParts.buttonNext.setStyles(i),this._checkSkinPartsVisibility(),this._editModeChanged(this._editorMode)},_mobileShowTextPanel:function(){this.setState("notShow","mobileShowTextPanel"),this._mobileShowTextPanelTimeout&&clearTimeout(this._mobileShowTextPanelTimeout),"mobile"===this.getState("mobile")&&(this.setState("showTextPanel","mobileShowTextPanel"),this._mobileShowTextPanelTimeout=setTimeout(function(){this.setState("notShow","mobileShowTextPanel")}.bind(this),2e3))},_onPrev:function(){this._mobileShowTextPanel(),this.gotoPrev()},_onNext:function(){this._mobileShowTextPanel(),this.gotoNext()},_checkSkinPartsVisibility:function(){if(this._skinParts){var e=this.getComponentProperty("showNavigation"),t="mobile"===this.getState("mobile"),i=e||t?"visible":"hidden";this._skinParts.buttonPrev.setStyle("visibility",i),this._skinParts.buttonNext.setStyle("visibility",i),this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden")}}})}),define.experiment.component("wysiwyg.viewer.components.SlideShowGallery.NBC_SlideShowGallery.New",function(e,t){var i=e;i.inherits("core.components.base.BaseComp"),i.utilize(["wysiwyg.common.utils.AutoPlay","wysiwyg.viewer.utils.TransitionHandler"]),i.skinParts({itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement"},autoplay:{type:"htmlElement"},imageItem:{type:"wysiwyg.viewer.components.Displayer",autoCreate:!1,argObject:{unit:"px"}}}),i.dataTypes(["ImageList"]),i.binds(["_onPrev","_onNext","_zoomOnSelectedDisplayer","gotoNext","_handleAutoPlayEvent","_toggleAutoPlay","_onAnimationDone"]),i.propertiesSchemaType("SlideShowGalleryProperties"),i.states({autoPlay:["autoplayOn","autoplayOff"]}),i.statics({INDEX_INVALIDATIONS:"indexChange",HEIGHT_REQUEST:"heightRequest",WIDTH_REQUEST:"widthRequest",DISPLAYER_POS:{PREVIOUS:0,CURRENT:1,NEXT:2},IMAGE_CLICK_ACTIONS:{ZOOM:"zoomMode",LINK:"goToLink",DISABLED:"disabled"},IMAGE_MODE:{CLIPPED:"clipImage",FLEXIBLE:"flexibleHeight"},ANIMATION_DIRECTION:{FORWARDS:0,BACKWARDS:1},IMAGE_ONCLICK_ACTION_PROPERTY:"galleryImageOnClickAction",IMAGE_MODE_PROPERTY:"imageMode",TRANSITION_PROPERTY:"transition",TRANSITION_DURATION_PROPERTY:"transDuration"}),i.methods({initialize:function(e,t,i){this.parent(e,t,i),this._displayers=[],this._index=0,this._requestedIndex=this._index,this._numberOfDisplayerMoves=0,this._autoPlay=new this.imports.AutoPlay,this._suppressAutoplay=W.Viewer.getPreviewMode()===!0,this._animator=new this.imports.TransitionHandler,this._currentTransition=null,this._isBeingAnimated=!1,this._displayerAnimationDiv=document.createElement("div"),this._displayerAnimationDiv.setStyles({position:"absolute"})},isRenderNeeded:function(e){if(this._isBeingAnimated!==!0){var t=[this.INVALIDATIONS.PART_SIZE,this.INDEX_INVALIDATIONS];return e.isInvalidated(t)||this.parent(e)}},_onRender:function(e){var t=e.data.invalidations;t.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE])&&(this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.view.setStyle("overflow","visible"),this._handleRenderingIfSkinChanged()),t.isInvalidated([this.HEIGHT_REQUEST,this.WIDTH_REQUEST])&&this._handleRenderIfResized(t),t.isInvalidated([this.INVALIDATIONS.DATA_CHANGE,this.INDEX_INVALIDATIONS])&&this._handleRenderIfDataOrIndexChanged(t),t.isInvalidated([this.INVALIDATIONS.SIZE])&&this._orderDisplayers(),this._isImageModeFlexible()&&this._resizeGalleryToFitCurrentDisplayer(),this.getComponentProperty("showAutoplay")===!0?this._skinParts.autoplay.show():this._skinParts.autoplay.hide()},_orderDisplayers:function(){var e=this._skinParts.itemsContainer.$measure.width;this._displayers[0].$view.style.left=-e+"px",this._displayers[1].$view.style.left="0px",this._displayers[2].$view.style.left=e+"px"},_onModeChange:function(e){this._suppressAutoplay="PREVIEW"!==e,this._setAutoPlay()},_setAutoPlay:function(){this._autoPlay.setDelay(this.getComponentProperty("autoplayInterval")),this.getComponentProperty("autoplay")!==!0||this._suppressAutoplay?this._autoPlay.pause():this._autoPlay.play()},_isImageModeFlexible:function(){return this.getComponentProperty(this.IMAGE_MODE_PROPERTY)===this.IMAGE_MODE.FLEXIBLE},_resizeGalleryToFitCurrentDisplayer:function(){var e=this._displayers[1],t=e.getWidth(),i=e.getHeight();this.setWidth(t),this.setHeight(i)},_handleRenderIfDataOrIndexChanged:function(e){if(e.isInvalidated([this.INDEX_INVALIDATIONS])){var t=e.getLastInvalidationByType(this.INDEX_INVALIDATIONS);this._requestedIndex=t.index}e.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&(this._setOnDisplayerClickAction(),this._setNavigationPartsVisibility(),this._currentTransition!==this.getComponentProperty(this.TRANSITION_PROPERTY)&&(this._resetDisplayersStyle(),this._currentTransition=this.getComponentProperty(this.TRANSITION_PROPERTY)),this._updateDisplayersData(),this._updateItemsCounter()),this._renderDisplayers()},_resetDisplayersStyle:function(){for(var e=0;this._displayers.length>e;e++){var t=this._displayers[e];t.$view.setStyles({position:"absolute",opacity:"1.0"})}},_setOnDisplayerClickAction:function(){var e=this.getComponentProperty(this.IMAGE_ONCLICK_ACTION_PROPERTY),t=this._skinParts.itemsContainer;t.removeEvents(Constants.CoreEvents.CLICK),e===this.IMAGE_CLICK_ACTIONS.ZOOM?t.on(Constants.CoreEvents.CLICK,this,this._zoomOnSelectedDisplayer):e===this.IMAGE_CLICK_ACTIONS.LINK?t.on(Constants.CoreEvents.CLICK,this,this._goToLinkOnSelectedDisplayer):e===this.IMAGE_CLICK_ACTIONS.DISABLED},_handleRenderingIfSkinChanged:function(){this._exterminateDisplayers(),this._initDisplayers(),this._orderDisplayers(),this._forceDisplayersRender(),this._updateItemsCounter(),this._bindEventHandlers(),this._setNavigationPartsVisibility(),this._resizeDisplayers()},_bindEventHandlers:function(){this._skinParts.buttonPrev.on(Constants.CoreEvents.CLICK,this,this._onPrev),this._skinParts.buttonNext.on(Constants.CoreEvents.CLICK,this,this._onNext),this._skinParts.autoplay.on(Constants.CoreEvents.CLICK,this,this._toggleAutoPlay),this._autoPlay.on(this._autoPlay.AUTOPLAY_EVENT,this,this._handleAutoPlayEvent),W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange)},_forceDisplayersRender:function(){this._skinParts.itemsContainer.show(),this._displayers.each(function(e){e.render()})},_handleRenderIfResized:function(e){var t=this.getComponentProperty(this.IMAGE_MODE_PROPERTY);if(t===this.IMAGE_MODE.CLIPPED)this._resizeDisplayers();else if(t===this.IMAGE_MODE.FLEXIBLE){var i=e.getLastInvalidationByType(this.WIDTH_REQUEST);null!==i&&this._resizeDisplayersWithAspectRatio(i.width)}},_resizeDisplayersWithAspectRatio:function(e){for(var t=0;this._displayers.length>t;++t)this._displayers[t].setSize(e,-1,this.IMAGE_MODE.FLEXIBLE)},_resizeDisplayers:function(){for(var e=this._skinParts.itemsContainer.$measure,t=e.width,i=e.height,n=0;this._displayers.length>n;++n)null!==t&&this._displayers[n].setWidth(t),null!==i&&this._displayers[n].setHeight(i)},_getDirection:function(e,t){var i=this._getTotalAvailableItems()-1,n=0;return n=0===e&&t===i?-1:e===i&&0===t?1:this._signum(t-e)
},getIndex:function(){var e=this.getLastInvalidationByType(this.INDEX_INVALIDATIONS);return e?e.index:this._index},setIndex:function(e){e=this._normalizeIndex(e);var t=this.getIndex();t!==e&&(this._requestedIndex=e,this._numberOfDisplayerMoves+=this._getDirection(t,e),this.invalidate(this.INDEX_INVALIDATIONS,{index:e,oldIndex:t}))},_initDisplayers:function(){for(var e=0;3>e;++e){var t=this.getSkinPartDefinition("imageItem");t.dataQuery=this._getDisplayerDataRef(e);var i=this._createInnerComponent(t);i.setOwner(this),this._displayerAnimationDiv.appendChild(i.$view),this._displayers.push(i)}this._resetDisplayersStyle(),this._skinParts.itemsContainer.appendChild(this._displayerAnimationDiv)},_renderDisplayers:function(){if(0!==e&&0!==this._numberOfDisplayerMoves){var e=this._signum(this._numberOfDisplayerMoves);this._renderDisplayersWithAnimation(e)}},_renderDisplayersWithAnimation:function(e){if(this._isBeingAnimated=!0,Math.abs(this._requestedIndex-this._index)>1){var t=this._getDataItems(),i=t[this._normalizeIndex(this._requestedIndex)];this._displayers[1+e].setDataByQuery(i)}var n=this._displayers[1].$view,o=this._displayers[1+e].$view,s=this.getComponentProperty(this.TRANSITION_DURATION_PROPERTY),a=1===e?this.ANIMATION_DIRECTION.FORWARDS:this.ANIMATION_DIRECTION.BACKWARDS,r=this._animator.getTransition(this.getComponentProperty(this.TRANSITION_PROPERTY));r(n,o,a,s,this._onAnimationDone)},_onAnimationDone:function(){var e=this._signum(this._numberOfDisplayerMoves);this._numberOfDisplayerMoves-=e,this._shiftDisplayers(e),this._index=this._normalizeIndex(this._index+e),this._updateItemsCounter(),this._updateDisplayersData(),this._orderDisplayers(),0!==this._numberOfDisplayerMoves?(this._numberOfDisplayerMoves=e,this._renderDisplayersWithAnimation(e)):this._isBeingAnimated=!1},_shiftDisplayers:function(e){0!==e&&(1===e?this._displayers.push(this._displayers.shift()):-1===e&&this._displayers.unshift(this._displayers.pop()))},_updateDisplayersData:function(){for(var e=0;3>e;++e){var t=this._getDisplayerDataRef(e),i=this._displayers[e];i.setDataByQuery(t)}},_updateItemsCounter:function(){var e=this._index+1,t=this._getTotalAvailableItems(),i=this._getCounterText(e,t);this._skinParts.counter.set("text",i)},_getCounterText:function(e,t){return e+"/"+t},_getDisplayerDataRef:function(e){var t,i=this._getDataItems();switch(e){case this.DISPLAYER_POS.PREVIOUS:t=this._normalizeIndex(this._index-1);break;case this.DISPLAYER_POS.CURRENT:t=this._normalizeIndex(this._index);break;case this.DISPLAYER_POS.NEXT:t=this._normalizeIndex(this._index+1)}return i[t]},_setNavigationPartsVisibility:function(){var e=this.getComponentProperty("showNavigation");e===!0?(this._skinParts.buttonPrev.show(),this._skinParts.buttonNext.show()):(this._skinParts.buttonPrev.hide(),this._skinParts.buttonNext.hide()),this._updateAutoPlayState()},_toggleAutoPlay:function(){var e=this.getComponentProperty("autoplay");e?this._autoPlay.pause():this._autoPlay.play(),this.setComponentProperty("autoplay",!e),this._updateAutoPlayState()},_handleAutoPlayEvent:function(){this._updateAutoPlayState(),this._autoPlay.isPlaying()?(this._autoPlay.setDelay(this.getComponentProperty("autoplayInterval")),this._autoPlay.play()):this._autoPlay.pause(),this.getComponentProperty("reverse")===!0?this._onPrev():this._onNext()},_updateAutoPlayState:function(){this._autoPlay.isPlaying()?this.setState("autoplayOn","autoPlay"):this.setState("autoplayOff","autoPlay")},_onPrev:function(){var e=this._normalizeIndex(this.getIndex()-1);this.setIndex(e)},_onNext:function(){var e=this._normalizeIndex(this.getIndex()+1);this.setIndex(e)},_zoomOnSelectedDisplayer:function(){this._displayers[this._displayers.length-1].zoom()},_goToLinkOnSelectedDisplayer:function(){this._displayers[this._displayers.length-1].goToLink()},_normalizeIndex:function(e){var t=this._getTotalAvailableItems();return this._modulu(e,t)},_modulu:function(e,t){return(e%t+t)%t},_getTotalAvailableItems:function(){var e=this._getDataItems(),t=e.length;return t},_getDataItems:function(){return this._data.get("items")},_signum:function(e){return e>0?1:0>e?-1:0},_exterminateDisplayers:function(){this._displayerAnimationDiv.childNodes=[];for(var e=0;this._displayers.length>e;e+=1)this._displayers[e].dispose();this._displayers=[]},_onAllSkinPartsReady:t.remove()})}),define.experiment.component("wysiwyg.viewer.components.SliderGallery.MobileSliderGallery.New",function(e,t){var i=e,n=t;i.states({mobile:["notMobile","mobile"]}),i.traits([]),i.methods({initialize:n.after(function(){W.Config.mobileConfig.isMobileOrTablet()?this.setState("mobile","mobile"):this.setState("notMobile","mobile")}),_onAllSkinPartsReady:n.after(function(){"mobile"===this.getState("mobile")&&(Hammer(this._view).on("swiperight",this.gotoPrev),Hammer(this._view).on("swipeleft",this.gotoNext))}),gotoPrev:n.after(function(){clearTimeout(this._prevStopTimeout),this._prevStopTimeout=setTimeout(function(){this._stopMovement()}.bind(this),2e3)}),gotoNext:n.after(function(){clearTimeout(this._nextStopTimeout),this._nextStopTimeout=setTimeout(function(){this._stopMovement()}.bind(this),2e3)})})}),define.experiment.component("wysiwyg.viewer.components.TwitterFeed.SyncWixify.New",function(e,t){var i=e;i.methods({initialize:function(e,t,i){i=i||{},this.parent(e,t,i),this._iframeLoaded=!1,this.addEvent("resizeEnd",this._onResizeEnd),this._minimumTimeBetweenRenders=2e3},_renderFeed:function(e){this.isReady()&&(this._iframe?this._iframeLoaded&&this._postMessageToIframe(e):this._createIframe())},_createIframe:function(e){var t=new IFrame({src:this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/twfeed.html",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameBorder:"0",scrolling:"no",events:{load:function(){this._iframeLoaded=!0,this._postMessageToIframe(e)}.bind(this)}});this._iframe=t,this._view.empty(),this._view.grab(t)}})}),define.experiment.component("wysiwyg.viewer.components.TwitterFeed.TwitterAPIpatch.New",function(e,t){var i=e;i.skinParts({label:{type:"htmlElement"},link:{type:"htmlElement"}}),i.methods({_renderFeed:function(){if(this.isReady()){this._iframeLoaded=!0;var e=this._data.get("accountToFollow")||"wix";this._skinParts.label.set("html",e),this._skinParts.link.set("href","https://twitter.com/intent/user?screen_name="+e)}}})}),define.experiment.newComponent("wysiwyg.viewer.components.VKShare.VKShare.New",function(e){var t=e;t.inherits("core.components.base.BaseComp"),t.resources(["W.Config","W.Utils","W.Viewer","W.Commands","topology"]),t.propertiesSchemaType("VKShareProperties"),t.skinParts({iframe:{type:"htmlElement"}}),t.binds(["_onPostMessageChangeWidth"]),t.statics({LayoutSize:{Button:{w:100,h:21},ButtonWithoutCounter:{w:64,h:21},Link:{w:50,h:16},LinkWithoutIcon:{w:30,h:16},Icon:{w:36,h:36}}}),t.methods({initialize:function(e,t,i){this._resizableSides=[],window.addEventListener("message",this._onPostMessageChangeWidth,!1),this.parent(e,t,i)},_onRender:function(){this._createClickOverlay();var e=this.LayoutSize[this.getComponentProperty("style")]||this.LayoutSize.Button;this._changeSize(e.w,e.h),this._skinParts.iframe.setAttribute("src",this._getIframeUrl()),this.parent()},isRenderNeeded:function(e){var t=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE];return e.isInvalidated(t)},_onPostMessageChangeWidth:function(e){if(this.getID()==e.data.id){var t=e.data.width,i=this.getHeight();this._changeSize(t,i)}},_getIframeUrl:function(){var e=this.resources.topology.wysiwyg+"/html/external/VKShare.html";return e+"?"+Object.toQueryString(this._getUrlParams())},_getUrlParams:function(){return{id:this.getID(),url:this._getPageUrl()||"",style:this.getComponentProperty("style"),text:this.getComponentProperty("text"),rightAngles:this.getComponentProperty("rightAngles")}},_getPageUrl:function(){var e="",t=this.resources.W.Viewer;if(t.isPublicMode()){e=window.publicModel.externalBaseUrl;var i=t.getCurrentPageId();if(i&&!t.isHomePage()){var n=t.getPageData(i).get("pageUriSEO");e+="#!"+n+"/"+i}}return e},_changeSize:function(e,t){e==this.getWidth()&&this.isRendered()||(this.setWidth(e),this._skinParts.iframe.setStyle("width",e+"px")),t==this.getHeight()&&this.isRendered()||(this.setHeight(t),this._skinParts.iframe.setStyle("height",t+"px"))},_createClickOverlay:function(){if(!this.resources.W.Viewer.isPublicMode()&&!this._socialOverlayElement){this._socialOverlayElement=new Element("A",{});var e=this.resources.W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/transparent.gif";this._socialOverlayElement.setStyles({position:"absolute",top:"0",left:"0",height:"100%",width:"100%",background:"transparent url("+e+") repeat top left;"}),this._socialOverlayElement.addEvent("click",function(e){e.stopPropagation(),this.resources.W.Commands.executeCommand("socialWidget.interact",{component:this},this)}.bind(this)),this.getViewNode().adopt(this._socialOverlayElement)}}})}),define.experiment.component("wysiwyg.viewer.components.VerticalLine.NBC_VerticalLine.New",function(e,t){var i=e;i.inherits("core.components.base.BaseComp"),i.skinParts({line:{type:"htmlElement"}}),i.methods({initialize:function(e,t,i){this.parent(e,t,i),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM]},isRenderNeeded:function(e){var t=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE];return e.isInvalidated(t)},_onRender:function(){var e=this._skinParts.line.$measure.width;this.setWidth(e)}})}),define.experiment.Class("wysiwyg.viewer.components.WFacebookLike.GetLikeUrl.New",function(e,t){var i=e;i.methods({_getLikeUrl:function(){if(this.resources.W.Viewer.isPublicMode()){var e=window.publicModel?window.publicModel.externalBaseUrl:void 0;return e=e||location.protocol+"//"+location.host+location.pathname,this.resources.W.Viewer.isHomePage()?e:e+location.hash}return"http://www.wix.com/create/website"}})}),define.experiment.component("wysiwyg.viewer.components.WPhoto.MediaGalleryFrame.New",function(e){var t=e;t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{imageType:"single",galleryConfigID:"photos"}},{label:"PHOTO_EDIT_IMAGE",command:"WEditorCommands.OpenAviaryDialog"},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{imageType:"single",galleryConfigID:"photos"}}}})}),define.experiment.component("wysiwyg.viewer.components.WPhoto.NBC_WPhoto.New",function(e){var t=e;t.inherits("core.components.base.BaseComp"),t.fields({initialize:function(e,t,i){this.parent(e,t,i),this._imageSettings=new this.imports.ImageSettings,this._imageDimensions=new this.imports.ImageDimensionsNew,i&&i.props&&this.setComponentProperties(i.props),this._contentPadding={x:0,y:0}},isRenderNeeded:function(e){return this.isDisplayed()&&(e.isInvalidated([this.INVALIDATIONS.PART_SIZE])||this.parent(e))},_onRender:function(e){var t=e.data.invalidations;t.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE])&&(this._updateFramePadding(),this._updateImageSize(this.getWidth(),this.getHeight())),this._updateImageSettings(),t.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&(this._setTitle(),this._checkResizeInFitMode())},setWidth:function(e,t){this.parent(e),this._updateImageSize(e,null),t||(this._changeCropModeInFit(!0),this._skinParts.img.setSettings(this._imageSettings),this._checkResizeInFitMode())},setHeight:function(e,t){this.parent(e),this._updateImageSize(null,e),t||(this._changeCropModeInFit(!1),this._skinParts.img.setSettings(this._imageSettings),this._checkResizeInFitMode())},_changeCropModeInFit:function(e){this.isDisplayed()&&"fitWidth"===this._getDisplayMode()&&(e?this._imageSettings.setCropMode(this._imageSettings.CropModes.FIT_WIDTH):this._imageSettings.setCropMode(this._imageSettings.CropModes.FIT_HEIGHT))},_updateImageSize:function(e,t){if(e){var i=e-this._framePadding.x;this._imageSettings.setWidth(i)}if(t){var n=t-this._framePadding.y;this._imageSettings.setHeight(n)}},_setTitle:function(){var e=this._data.get("title");e&&this._skinParts.view.set("title",e)},_checkResizeInFitMode:function(){var e=this._framePadding;if(this._imageSettings.getCropMode()==this._imageSettings.CropModes.FIT_WIDTH){var t=this._skinParts.img.getSize().y;this.setHeight(t+e.y,!0)}else if(this._imageSettings.getCropMode()==this._imageSettings.CropModes.FIT_HEIGHT){var i=this._skinParts.img.getSize().x;this.setWidth(i+e.x,!0)}},_updateImageSettings:function(){var e=this._getImageCropMode();this._imageSettings.setCropMode(e),this._skinParts.img.setSettings(this._imageSettings)},_updateFramePadding:function(){var e=this.getSkin();this._framePadding={x:parseInt(e.getParamValue("contentPaddingLeft"),10)+parseInt(e.getParamValue("contentPaddingRight"),10),y:parseInt(e.getParamValue("contentPaddingTop"),10)+parseInt(e.getParamValue("contentPaddingBottom"),10)}},_getImageCropMode:function(){var e=this.getComponentProperty("displayMode");return"fitWidthStrict"==e&&(e=this._imageSettings.CropModes.FIT_WIDTH),"fitHeightStrict"==e&&(e=this._imageSettings.CropModes.FIT_HEIGHT),e},_setImageArgs:function(e){return e.argObject={requestExactSize:this.resources.W.Viewer.getPreviewMode()!==!0},e},_getDisplayMode:function(){return this.getComponentProperty("displayMode")},_isFitMode:function(){var e=["fitWidth","fitWidthStrict","fitHeightStrict"];return e.indexOf(this._getDisplayMode())>=0}})}),define.experiment.component("wysiwyg.viewer.components.WRichText.NBC_WRichText.New",function(e,t){var i=e;i.inherits("core.components.base.BaseComp"),i.methods({isRenderNeeded:function(e){var t=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE];return e.isInvalidated(t)},_onRender:function(){this._updateText(),this._setLinksDataToElements("VIEW")},_sanitizeLink:function(e){var t=e.get("href");t&&0!==t.indexOf("http://")&&0!==t.indexOf("https://")&&0!==t.indexOf("telnet://")&&0!==t.indexOf("ftp://")&&0!==t.indexOf("mailto:")&&(t.indexOf("@")>0?e.set("href","mailto:"+t):(0===t.indexOf("www")||0!==t.indexOf("www")&&0!==t.indexOf("#"))&&e.set("href","http://"+t))},_onAllSkinPartsReady:t.remove(),_onDataChange:t.remove()})}),define.experiment.component("wysiwyg.viewer.components.WRichText.RichTextViewer.New",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.dataTypes(["RichText","Text","StyledText"]),t.resources(["W.Data","W.Commands","W.Viewer","W.Css"]),t.skinParts({richTextContainer:{type:"htmlElement",optional:!0}}),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED],EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"EDIT_RICH_TEXT",command:"EditorUI.StartEditRichText"}]}}),t.methods({initialize:function(e,t,i){this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._setLinksDataToElements),this.parent(e,t,i),this.setMaxH(5e3)},_onAllSkinPartsReady:function(){this._updateText(),this.resources.W.Viewer.getPreviewMode()||this._setLinksDataToElements("VIEW")},_onDataChange:function(){this._skinParts&&this._updateText()},_updateText:function(){this._loadFontsToViewer();var e=this.getDataItem().get("text");this.getRichTextContainer().set("html",e)},getRichTextContainer:function(){return this._skinParts?this._skinParts.richTextContainer||this.getViewNode():null},_setLinksDataToElements:function(e){if(this._skinParts&&("PREVIEW"===e||"VIEW"===e))for(var t=$(this.getRichTextContainer()).getElements("a"),i=0;t.length>i;i++){var n=t[i],o=n.getAttribute("dataquery");o?this._setLinkAttributes(o,n):!this.resources.W.Viewer.getPreviewMode()||n.getAttribute("target")&&"_blank"==n.getAttribute("target")||n.setAttribute("target","_blank")}},_setLinkAttributes:function(e,t){var i=this._getLinkData(e);if(i){var n=this._getLinkHref(i);t.set("href",n);var o=this._getLinkTarget(i);o&&t.set("target",o),this._sanitizeLink(t)}},_getLinkData:function(e){var t=e,i=this.resources.W.Data;return i.isDataAvailable(t)||(t="#"+e,i.isDataAvailable(t))?i.getDataByQuery(t):(LOG.reportError(wixErrors.LINK_DATA_ITEM_DOESNT_EXIST,"WRichText","_setLinksDataToElements",e),null)},_getLinkHref:function(e){var t=e.get("href"),i=e.get("linkType");if("PAGE"!=i)return t;try{var n=t.split("/")[1],o=this.resources.W.Data.getDataByQuery("#"+n);t="#!"+o.get("pageUriSEO")+"/"+n}catch(s){}return t},_getLinkTarget:function(e){var t,i=e.get("linkType");return t=this.resources.W.Viewer.getPreviewMode()&&"PAGE"!=i?"_blank":e.get("target")},isEditableInPlace:function(){return!0},_loadFontsToViewer:function(){var e=this._getUsedFontsInComp();Object.forEach(e,function(e,t){this.resources.W.Css.loadFont(this._getFontNameInCamelCase(t))},this)},_getUsedFontsInComp:function(){var e=this.getDataItem().get("text"),t=new Element("div");t.innerHTML=e;var i=t.getElements("span[style]"),n=t.getElements("font[face]"),o={};return i.forEach(function(e){var t=e.style["font-family"]||e.style.fontFamily;t&&(t=this._cleanUpFontName(t),o[t]=!0)},this),n.forEach(function(e){var t=e.getAttribute("face");t=this._cleanUpFontName(t),o[t]=!0},this),o},_cleanUpFontName:function(e){return e.replace(/['"]/gi,"")},_getFontNameInCamelCase:function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}})}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.MobileBackground.New",function(e,t){var i=e;i.methods({_handleMobile:function(){this._mobileConfig.isMobileOrTablet()&&(window.addEvent("orientationchange",this._delayedInvalidateBg),this._view.setStyle("overflow","hidden"),this._mobileConfig.isAndroidMobileDevice()&&this._view.setStyle("max-height","10000000000px"),this._bgFixed?this._fixBackgroundForFixedBg():this._fixBackgroundForMobile(),this._view.setStyle("-webkit-text-size-adjust","none"),this._view.setStyle("-moz-text-size-adjust","none"),this._view.setStyle("-ms-text-size-adjust","none"))},_fixBackgroundForFixedBg:function(){for(var e=document.body,t=document.createDocumentFragment();e.firstChild;)e.firstChild===this._bgNode?e.removeChild(this._bgNode):t.appendChild(e.firstChild);this._bgNode.appendChild(t),e.appendChild(this._bgNode),this._fixBgHeight(),window.addEvent("orientationchange",this._fixBgHeight),window.addEvent("resize",this._fixBgHeight)},_fixBgHeight:function(){this._bgNode.style.height=window.innerHeight+"px",this._bgNode.style.overflowY="scroll"},_fixBackgroundForMobile:function(){var e=document.body;e.style["background-image"]=this._bgStyle["background-image"],e.style["background-size"]=this._bgStyle["background-size"],e.style["background-position"]=this._bgStyle["background-position"],e.style["background-repeat"]=this._bgStyle["background-repeat"],e.style["background-color"]=this._bgStyle["background-color"],this._bgFixed&&(e.style["background-attachment"]="fixed"),e.removeChild(this._bgNode)}})}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.MobileFixes.New",function(e,t){var i=e,n=t;i.resources(n.merge(["W.Theme","W.Viewer","W.Config"])),i.methods({initialize:function(e,t,i){this._mobileConfig=this.resources.W.Config.mobileConfig,this._bgNode=new Element("div",{id:"bgNode"}),this._bgNode.setStyles({position:"absolute",width:"100%"}),this._bgNode.inject(document.body,"top"),this._bgStyle={},this._lastBgStyle={},this.parent(e,t,i),window.addEvent("scroll",this._delayedInvalidateBg),window.addEvent("resize",this._delayedInvalidateBg),this.resources.W.Theme.addEvent("propertyChange",this._onThemePropertyChange),this._updateBgProperty(),this._validateBg(),this.setMaxH(this.MAX_SITE_HEIGHT),this.resources.W.Viewer.getPreviewMode()&&this._view.setStyle("padding-bottom",100),this._handleMobile()},_handleMobile:function(){this._mobileConfig.isMobileOrTablet()&&(window.addEvent("orientationchange",this._delayedInvalidateBg),this._view.setStyle("overflow","hidden"),this._mobileConfig.isAndroidMobileDevice()&&this._view.setStyle("max-height","10000000000px"))},_updateSiteBgSize:function(){this._bgStyle.height=this._mobileConfig.isMobileOrTablet()?this._bgFixed?"100%":Math.max(this._siteHeight,document.getHeight())+"px":this._bgFixed?$(document.body).getSize().y+"px":Math.max(this._siteHeight||50,$(document.body).getSize().y)+"px"},_updateSiteBgPosition:function(){Modernizr.positionfixed&&!this._mobileConfig.isMobileOrTablet()?this._bgStyle.position=this._bgFixed?"fixed":"absolute":this._bgStyle.top=this._bgFixed?document.body.scrollTop+"px":0}})}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.MobileFixes2.New",function(e,t){var i=e;i.methods({_handleMobile:function(){this._mobileConfig.isMobileOrTablet()&&(window.addEvent("orientationchange",this._delayedInvalidateBg),this._view.setStyle("overflow","hidden"),this._mobileConfig.isAndroidMobileDevice()&&this._view.setStyle("max-height","10000000000px"),this._view.setStyle("-webkit-text-size-adjust","none"),this._view.setStyle("-moz-text-size-adjust","none"),this._view.setStyle("-ms-text-size-adjust","none"))},_updateSiteBgSize:function(){this._bgStyle.height=this._mobileConfig.isMobileOrTablet()?this._bgFixed?window.innerHeight:Math.max(this._siteHeight,document.getHeight())+"px":this._bgFixed?$(document.body).getSize().y+"px":Math.max(this._siteHeight||50,$(document.body).getSize().y)+"px"}})}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.MobileFontsPOC.New",function(e,t){var i=e;i.methods({_handleMobile:function(){this._mobileConfig.isMobileOrTablet()&&(window.addEvent("orientationchange",this._delayedInvalidateBg),this._view.setStyle("overflow","hidden"))}})}),define.experiment.component("wysiwyg.viewer.components.WixAds.MobileWixAds.New",function(e,t){var i=e;i.resources(["W.Config"]),i.methods({render:function(){this.parent();var e=this.injects().Viewer.getAdData();this._skinParts.topRectLabel.set("html",e.topLabel),this._skinParts.topRectContent.set("html",e.topContent),this.resources.W.Config.mobileConfig.isMobile()?this._skinParts.footerLabel.collapse():this._skinParts.footerLabel.set("html",e.footerLabel)}})}),define.experiment.Class("wysiwyg.viewer.components.menus.DropDownController.FixMoreButton.New",function(e,t){var i=e;i.methods({_setDropDownWidth:function(){var e,t,i=this._dropOwnerButton.getMinimalDropdownWidth();for(e=0;this._dropButtons.length>e;e++)t=this._dropButtons[e],i=Math.max(i,t.getMinimalWidth());var n=this._menu.getMenuExtraPixels(!0);this._dropWrapper.setStyle("width",n.left+n.right+i+"px")}})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.LimitRecursiveDDM.New",function(e,t){var i=e,n=t;i.binds(["_onButtonDataChange","_onThemeChange","_arrangeButtons","_onButtonClick","_onPageChanged","_resetTestOverFlowCount"]),i.methods({_resetTestOverFlowCount:function(){this._testOverFlowCount=5},initialize:n.after(function(){this._resetTestOverFlowCount()}),_testOverFlow:function(){var e=this._getButtonsWidth();this.injects().Utils.clearCallLater(this._overflowID),0==this._prevButtonsWidth&&(this._prevButtonsWidth=e),e!=this._prevButtonsWidth?this._arrangeButtons():this._testOverFlowCount>0&&(this._testOverFlowCount--,this._overflowID=this.callLater(this._testOverFlow,[],100))},_onThemeChange:n.before(function(){this._resetTestOverFlowCount()}),_onResize:n.before(function(){this._resetTestOverFlowCount()}),_onRepeaterReady:function(){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,function(){this._resetTestOverFlowCount(),this._arrangeButtons()}.bind(this)),this._treeConstructionDone=!1,this._arrangeButtonAccordingToData(),this._constructButtonsTree()}})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.PartialComponentPreview.New",function(e,t){var i=e;i.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0,previewable:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages",commandParameter:{galleryConfigID:"pagesPanel"}}],dblClick:{command:"WEditorCommands.Pages"}},_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.RenamePages.New",function(e,t){var i=e;i.fields({EDITOR_META_DATA:t.merge({custom:[{label:"FPP_RENAME_PAGES_LABEL",command:"WEditorCommands.Pages",commandParameter:{galleryConfigID:"pagesPanel"}}]})})}),define.experiment.component("wysiwyg.viewer.components.sm.SMApplyForMembership.SMForgot_Password.New",function(e,t){var i=e;i.methods({_onFormSuccess:function(){var e=this._emailField._data.get("text"),t="Success! Your member login request has been sent and is awaiting approval. The site administrator will notify you via email ("+e+") once your request has been approved";this._container.showConfirmation({message:t})}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMContainer.SMForgot_Password.New",function(e,t){var i=e,n=t;i.statics({INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",EMAIL_RESET_PASSWORD:"EMAILRESETPASSWORD",RESET_PASSWORD:"RESETPASSWORD"}}),i.methods({initialize:n.after(function(e,t,i){this._shouldCloseContainer=!0,this._formData=i&&i.formData}),_initializeForm:function(e){this._currentForm=e;var t=this._skinParts.title;t.set("html",this._currentForm.getDisplayName());var i=this._skinParts.submitButton;i.set("value",this._currentForm.getButtonLabel());var n=this._skinParts.note,o=this._currentForm.getSubHeaderElement();if(o){var s=o.el,a=o.intent;s.getElements("a").addEvent("click",function(){this.resources.W.SiteMembers.openSiteMembersPopup({intent:a,disableCancel:this._disableCancel,openedByPageSecurity:this._openedByPageSecurity,hashRedirectTo:this._hashRedirectTo,formData:this._formData})}.bind(this)),n.adopt(s.childNodes)}this._addCurrentFormEvents(),this._openedByPageSecurity&&(this.resources.W.Viewer.isPublicMode()||this.resources.W.Config.isInDebugMode()?(this._skinParts.infoTitle.set("text","To view this page, you need to be logged in."),this._skinParts.note.setStyle("float","right"),this._skinParts.infoTitle.setStyle("display","block")):this.showConfirmation("This page is protected with a member login. Your users will be able to see this page once they are logged in. To manage your site's members, go to your site in My Account and click Site Members",function(){this.reportAuthStatusChange(!0),this._closeSMContainer()}.bind(this)))},_createInnerDialog:function(e){return this._assureIntentExists(),this._enrichDefinitionByType(e),e},_assureIntentExists:function(){var e=this.resources.W.SiteMembers;this._intent||(this._intent=e.isNotAuthenticatedWithCookie()?this.INTENTS.LOGIN:this.INTENTS.REGISTER)},_enrichDefinitionByType:function(e){var t=null;switch(this._intent){case this.INTENTS.REGISTER:var i=this.resources.W.SiteMembers.getCollectionType();switch(i){case"Open":t="register";break;case"ApplyForMembership":t="applyForMembership";break;default:t="register"}break;case this.INTENTS.LOGIN:t="login";break;case this.INTENTS.EMAIL_RESET_PASSWORD:t="ResetPasswordEmail";break;case this.INTENTS.RESET_PASSWORD:t="ResetPassword"}return null!==t&&this._enrichDefinitionType(e,t),e},_enrichDefinitionType:function(e,t){e.type="wysiwyg.viewer.components.sm.SM"+t.capitalize(),e.skin="wysiwyg.viewer.skins.sm.SM"+t.capitalize()+"Skin",e.argObject={container:this,formData:this._formData}},_setConfirmationOkCaption:function(e){this._skinParts.okButton.value=e},showConfirmation:function(e,t,i){this.setState("confirm"),this._updateConfirmationDialogTexts(e),this._confirmCallback=t,this._shouldCloseContainer=i,void 0===i&&(this._shouldCloseContainer=!0)},_updateConfirmationDialogTexts:function(e){this._skinParts.confirmationText.set("text",e.message),this._skinParts.confirmationTitleText.set("text",e.title)},_handleConfirmationOk:function(){this._confirmCallback&&this._confirmCallback(),this._shouldCloseContainer&&this._closeSMContainer(),this._shouldCloseContainer=!0},closeAndRedirectTo:function(e){if(this._closeSMContainer(),this._hashRedirectTo){var t=this.resources.W.Utils.hash.getHashParts(this._hashRedirectTo);this.resources.W.Utils.hash.setHash(t.id,t.title,t.extData,!0),window.location.hash=this._hashRedirectTo}e?this._directToUrl(e):this._reload()},_directToUrl:function(e){location.href=e},_reload:function(){location.reload()}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMForm.SMForgot_Password.New",function(e,t){var i=e;i.statics({PASS_MIN_LEN:4,PASS_MAX_LEN:15,ERR_MAP:{GENERAL_ERR:"Server error. try again later.",VAL_ERR_PASSWORD_BLANK:"Password cannot be blank",VAL_ERR_PASSWORD_RETYPE:"Passwords are not the same",VAL_ERR_PASSWORD_LENGTH:"Password length must be between {0} and {1}",VAL_ERR_EMAIL_BLANK:"Email cannot be blank",VAL_ERR_EMAIL_INVALID:"Email is invalid","-19999":"Unknown user","-19995":"Email is already taken","-19972":"Invalid token","-19988":"Validation Error","-19984":"Invalid Session","-19976":"Wrong email or password","-19958":"Your member request is waiting approval from the site owner"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE",EMAIL_RESET_PASSWORD:"EMAILRESETPASSWORD",RESET_PASSWORD:"RESETPASSWORD"},LABELS:{EMAIL:"Email",PASSWORD:"Password",RE_PASSWORD:"Retype password",REMEMBER_ME:"Remember Me"}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMLogin.SMForgot_Password.New",function(e,t){var i=e;i.inherits("wysiwyg.viewer.components.sm.SMForm"),i.resources(["W.Data","W.SiteMembers","W.Utils"]),i.statics({CAPTIONS:{FORGOT_PASSWORD:"Forgot your password?",LOGIN:"Login",GO:"GO",SIGN_UP:"Or {0}Sign up{1}"}}),i.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},rememberMe:{type:"wysiwyg.viewer.components.inputs.CheckBoxInput",hookMethod:"_bindCheckBoxDataItem"},forgotPass:{type:"htmlElement"}}),i.methods({initialize:function(e,t,i){this.parent(e,t,i),this._formData=i&&i.formData,this._initEnteredEmail()},_initEnteredEmail:function(){this._enteredEmail=this._formData&&this._formData.enteredEmail||""},_onAllSkinPartsReady:function(){this._email=this._skinParts.email,this._password=this._skinParts.password,this._rememberMe=this._skinParts.rememberMe,this._forgotPassword=this._skinParts.forgotPass,this._forgotPassword.innerHTML=this.CAPTIONS.FORGOT_PASSWORD,this._forgotPassword.addEvent("click",function(){this._closeAndRedirectToEmailReset()}.bind(this)),this._updateEmailWithUserInput()},_updateEmailWithUserInput:function(){var e=this._email.getDataItem();e._data.text=this._enteredEmail,this._email.setDataItem(e),this._email._skinParts.input.value=this._enteredEmail},_closeAndRedirectToEmailReset:function(){this.resources.W.SiteMembers.openSiteMembersPopup({intent:this.INTENTS.EMAIL_RESET_PASSWORD,formData:{enteredEmail:this._email._data.get("text")}})},onSubmit:function(){var e=this._email._data.get("text"),t=this._password._data.get("text"),i=this._rememberMe._data.get("value");this._validateFields(e,t)&&this.resources.W.SiteMembers.login(e,t,i,this._onFormSuccess,this._onFormError)},_validateFields:function(e,t){return this._password.setValidationState(!0),this._email.setValidationState(!0),e?this.resources.W.Utils.isValidEmail(e)?t?t.length<this.PASS_MIN_LEN||t.length>this.PASS_MAX_LEN?(this._password.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_LENGTH",errorParams:[this.PASS_MIN_LEN,this.PASS_MAX_LEN]},this._password),!1):!0:(this._password.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_BLANK"},this._password),!1):(this._email.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_INVALID"},this._email),!1):(this._email.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_BLANK"},this._email),!1)
},_onFormSuccess:function(){var e=this._removeResetForgotPasswordParameterIfExists();this._container.closeAndRedirectTo(e)},_removeResetForgotPasswordParameterIfExists:function(){var e=window.location.href;return e.indexOf(this.resources.W.SiteMembers.RESET_PASSWORD_KEY_PARAMETER)>=0?this._removeParameterFromUrl(e,this.resources.W.SiteMembers.RESET_PASSWORD_KEY_PARAMETER):e},_removeParameterFromUrl:function(e,t){if(e&&t){var i=e.indexOf(t);if(i>=0){var n=e.substr(i).indexOf("&");return 0>n&&(n=e.length),e.slice(0,i)+e.slice(i+n+"&".length)}}return e},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this.CAPTIONS.LOGIN},getButtonLabel:function(){return this.CAPTIONS.GO},getSubHeaderElement:function(){var e=new Element("DIV"),t=this.CAPTIONS.SIGN_UP;return t=this._formatString(t,["<a>","</a>"]),e.set("html",t),{el:e,intent:this.INTENTS.REGISTER}},_formatString:function(e,t){var i=0;return t.map(function(t){var n="{"+i+"}";e=e.replace(n,t),i++}),e},_bindCheckBoxDataItem:function(e){return e.dataItem=this.resources.W.Data.createDataItem({value:"false",type:"Boolean"},"Boolean"),e.dataItem.setMeta("isPersistent",!1),e.argObject={label:this.LABELS.REMEMBER_ME},e}})}),define.experiment.newComponent("wysiwyg.viewer.components.sm.SMResetPassword.SMForgot_Password.New",function(e,t){var i=e;i.inherits("wysiwyg.viewer.components.sm.SMForm"),i.binds(["_onSuccessfulReset","_onFailedReset"]),i.resources(["W.SiteMembers"]),i.skinParts({formMessage:{type:"htmlElement"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindNewPasswordField"},passwordRetype:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordRetypeField"}}),i.statics({CAPTIONS:{RESET_PASSWORD_MESSAGE:"To set your new password, please enter it in both fields below. ",ENTER_NEW_PASSWORD:"Enter a new password:",RETYPE_PASSWORD:"Type again:",FORM_TITLE:"Reset Password",SUBMIT_BUTTON_LABEL:"GO",CONFIRMATION_BUTTON_CAPTION:"Continue"},MESSAGES:{RESET_SUCCESS:"You’ve successfully reset your password.",RESET_FAILED:"Password could not have been changed. Try again later."}}),i.methods({_onAllSkinPartsReady:function(){this._formMessage=this._skinParts.formMessage,this._password=this._skinParts.password,this._passwordRetype=this._skinParts.passwordRetype,this._formMessage.innerText=this.CAPTIONS.RESET_PASSWORD_MESSAGE},onSubmit:function(){this._isPasswordValid()&&this._doPasswordsMatch()&&this._resetPassword()},_resetPassword:function(){var e=this._getTextInputFromField(this._password),t=this.resources.W.SiteMembers;t.resetPassword(e,this._onSuccessfulReset,this._onFailedReset)},_getCurrentSearchURL:function(){return window.location.search},_onSuccessfulReset:function(){this._container._setConfirmationOkCaption(this.CAPTIONS.CONFIRMATION_BUTTON_CAPTION),this._container.showConfirmation({message:this.MESSAGES.RESET_SUCCESS},this._closeAndRedirectToLogin(),!1)},_closeAndRedirectToLogin:function(){var e=this;return function(){e.resources.W.SiteMembers.openSiteMembersPopup({intent:e.INTENTS.LOGIN})}},_onFailedReset:function(){this._container.showConfirmation(this.MESSAGES.RESET_FAILED,this._closeSMContainer)},_isPasswordValid:function(){this._password.setValidationState(!0),this._passwordRetype.setValidationState(!0);var e=this._password._data.get("text");return e?e.length<this.PASS_MIN_LEN||e.length>this.PASS_MAX_LEN?(this._password.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_LENGTH",errorParams:[this.PASS_MIN_LEN,this.PASS_MAX_LEN]},this._password),!1):!0:(this._password.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_BLANK"},this._password),!1)},_doPasswordsMatch:function(){var e=this._getTextInputFromField(this._password),t=this._getTextInputFromField(this._passwordRetype);return this._passwordRetype.setValidationState(!0),e!==t?(this._passwordRetype.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_RETYPE"},this._passwordRetype),!1):!0},_getTextInputFromField:function(e){var t=e._data.get("text");return t},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this.CAPTIONS.FORM_TITLE},getButtonLabel:function(){return this.CAPTIONS.SUBMIT_BUTTON_LABEL},getSubHeaderElement:function(){return null},_bindNewPasswordField:function(e){return this._bindPasswordField(e,this.CAPTIONS.ENTER_NEW_PASSWORD)},_bindPasswordRetypeField:function(e){return this._bindPasswordField(e,this.CAPTIONS.RETYPE_PASSWORD)},_bindPasswordField:function(e,t){return e.argObject={label:t,passwordField:!0},this._bindTextDataItem(e)}})}),define.experiment.newComponent("wysiwyg.viewer.components.sm.SMResetPasswordEmail.SMForgot_Password.New",function(e,t){var i=e;i.inherits("wysiwyg.viewer.components.sm.SMForm"),i.resources(["W.Data","W.SiteMembers","W.Utils"]),i.statics({CAPTIONS:{FORM_TITLE:"Reset Password",SUBMIT_BUTTON_LABEL:"GO",BACK_TO_LOGIN:"Back to Login",EMAIL_TITLE:"Please enter your email address",CONFIRMATION_TITLE:"Please check your email",CONFIRMATION_MSG:"We’ve sent you an email with a link that will allow you to reset your password"}}),i.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"}}),i.methods({initialize:function(e,t,i){this.parent(e,t,i),this._enteredEmail=i&&i.formData&&i.formData.enteredEmail||""},_onAllSkinPartsReady:function(){this._email=this._skinParts.email,this._updateEmailWithUserInput()},_updateEmailWithUserInput:function(){var e=this._email.getDataItem();e._data.text=this._enteredEmail,this._email.setDataItem(e),this._email._skinParts.input.value=this._enteredEmail},_getEmailInput:function(){return this._email._data.get("text")},onSubmit:function(){var e=this._getEmailInput();if(this._isEmailFieldValid(e)){var t=this.resources.W.SiteMembers;t.sendUserPasswordResetEmail(e,this._onFormSuccess,this._onFormError)}},_isEmailFieldValid:function(e){return this._email.setValidationState(!0),e?this.resources.W.Utils.isValidEmail(e)?!0:(this._email.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_INVALID"},this._email),!1):(this._email.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_BLANK"},this._email),!1)},_bindEmailField:function(e){return e.argObject={label:this.CAPTIONS.EMAIL_TITLE},this._bindTextDataItem(e)},_onFormSuccess:function(){this._closeAndRedirectToConfirmationDialog()},_closeAndRedirectToConfirmationDialog:function(){this._container.showConfirmation({title:this.CAPTIONS.CONFIRMATION_TITLE,message:this.CAPTIONS.CONFIRMATION_MSG},this._closeSMContainer)},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this.CAPTIONS.FORM_TITLE},getButtonLabel:function(){return this.CAPTIONS.SUBMIT_BUTTON_LABEL},getSubHeaderElement:function(){var e=new Element("DIV"),t=this.CAPTIONS.BACK_TO_LOGIN;return e.set("html","<a>"+t+"</a>"),{el:e,intent:this.INTENTS.LOGIN,formData:{enteredEmail:function(){this._email._data.get("text")}.bind(this)}}}})}),define.experiment.component("wysiwyg.viewer.components.tpapps.TPAFixedWidget.TPAGlued.New",function(e,t){var i=e;i.methods({isFixedPositioned:function(){return!0},_setCssPosition:function(e,t){var i="auto"==e||!e&&isNaN(e),n=["top","left","bottom","right"],o="number"==typeof e?"px":"";if(!n.contains(t))return W.Utils.debugTrace("fixedPositionComponent","_setCssPostion",t+" passed as "+e),void 0;if(!i&&e&&e.split&&(o=e.split(parseInt(e,10)).join(""),"%"!==o&&(o="px")),e=i?"auto":parseInt(e,10),this["_$"+t]!=e){if(!i&&isNaN(e))return W.Utils.debugTrace("fixedPositionComponent","set"+t,"NaN passed as value"),void 0;this["_$"+t]=e+o,this._view.setStyle(t,e+o),"left"==t&&(this._$x=i||"%"==o?this._view.getPosition().x:e),"top"==t&&(this._$y=i||"%"==o?this._view.getPosition().y:e),this.onMovement()}},_isLeftPositioned:function(){return"auto"!==this.getLeft()},_isHorizCentred:function(){return"50%"===this.getLeft()},_isVertCentred:function(){return"50%"===this.getTop()},_isRightPositioned:function(){return"auto"!==this.getRight()},_isTopPositioned:function(){return"auto"!==this.getTop()},_isSideCentered:function(){return this._isVertCentred()&&(this._isLeftPositioned()||this._isRightPositioned())},_isBottomPositioned:function(){return"auto"!==this.getBottom()}})}),define.experiment.newComponent("wysiwyg.viewer.components.tpapps.TPAGluedWidget.TPAGlued.New",function(e){var t=e;t.inherits("wysiwyg.viewer.components.tpapps.TPAFixedWidget"),t.statics({DEF_POSITION:"BOTTOM_RIGHT",DEF_WIDTH:200,DEF_HEIGHT:200,MAX_MAGRIN_VALUE:100,MIN_MAGRIN_VALUE:0,CENTER_MAGRIN_VALUE:50}),t.propertiesSchemaType("TPAGluedProperties"),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1,disableMoveForward:!0,disableMoveBackward:!0},custom:[{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}],dblClick:{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}}}),t.methods({initialize:function(e,t,i){this.parent(e,t,i),this._resizableSides=[];var n=this;resource.getResourceValue("W.Viewer",function(e){e.isSiteReady()?n._makeRoomForAd():e.addEvent("SiteReady",function(){n._makeRoomForAd()})})},render:function(){this.setCoordinates(this._coordinates),this.parent()},initComponentLayout:function(){this.parent(),this._view.addClass("Z-FIXED-COMPS"),this._addTransitionClass()},_addTransitionClass:function(){this._view.addClass("TransitionSize"),this._skinParts.iframe.addClass("TransitionSize")},_removeTransitionClass:function(){this._view.removeClass("TransitionSize"),this._skinParts.iframe.removeClass("TransitionSize")},setPlacment:function(e,t,i){var n=this.getComponentProperties(),o=e||this._position||this.DEF_POSITION;this._position!==o?(this._position=e||this._position||this.DEF_POSITION,n.set("horizontalMargin",this.CENTER_MAGRIN_VALUE),n.set("verticalMargin",this.CENTER_MAGRIN_VALUE)):(n.set("verticalMargin",+t||0),n.set("horizontalMargin",+i||0)),n.set("placement",this._position),this._coordinates=this._getGluedWidgetCoordinates(),this.setCoordinates(this._coordinates)},setCoordinates:function(e){this.parent(this._coordinates||e),this._setMarginOffset()},handleResizeWindow:function(e){var t={width:e.msgData.width,height:e.msgData.height};this._changeSize(t,!0),this._setMarginOffset(t)},_setMarginOffset:function(e){var t=this.getWidgetId(),i=this._appData.widgets[t],n=i.defaultHeight,o=i.defaultWidth,s=e?e.width:this.getWidth(),a=e?e.height:this.getHeight(),r=this.getComponentProperties(),l=2*(r.get("verticalMargin")/this.MAX_MAGRIN_VALUE-.5),d=2*(r.get("horizontalMargin")/this.MAX_MAGRIN_VALUE-.5),h=window.getSize();l*=h.y/2-n/2,d*=h.x/2-o/2,this._isHorizCentred()?this._handleHorizontalCentredPlacement(d,h,n,s):this._isVertCentred()?this._handleVerticalCenteredPlacement(l,h,o,a):this._view.setStyle("margin","0px")},_handleHorizontalCentredPlacement:function(e,t,i,n){var o=this._view.style;0>e?(o.right="auto",o.left=t.x/2-i/2+e+"px",o.margin="0px"):e>0?(o.left="auto",o.right=t.x/2-i/2-e+"px",o.margin="0px"):0===e&&(o.right="auto",o.left="50%",o.margin="0 0 0 "+(0-n/2)+"px")},_handleVerticalCenteredPlacement:function(e,t,i,n){var o=this._view.style;0>e?(o.top="auto",o.bottom=t.y/2+(0-i/2)+e+"px",o.margin="0px"):e>0?(o.bottom="auto",o.top=t.y/2+(0-i/2)-e+"px",o.margin="0px"):0===e&&(o.bottom="auto",o.top="50%",o.margin=0-n/2+"px 0 0 0")},onDataInitialized:function(){var e=this.getComponentProperties();this._position=this.DEF_POSITION;try{this._position=e.get("placement")||this._appData.widgets[this.getWidgetId()].defaultPosition||this.DEF_POSITION}catch(t){this._position=this.DEF_POSITION}this._coordinates=this._getGluedWidgetCoordinates()},_getGluedWidgetCoordinates:function(){var e=this.getWidgetId(),t=this._appData.widgets[e],i=t.defaultWidth||this.DEF_WIDTH,n=t.defaultHeight||this.DEF_HEIGHT,o="auto",s="auto",a="auto",r="auto";switch(this._position){case"TOP_LEFT":s=0,o=0;break;case"TOP_RIGHT":r=0,o=0;break;case"BOTTOM_RIGHT":r=0,a=0;break;case"BOTTOM_LEFT":s=0,a=0;break;case"TOP_CENTER":o=0,s="50%";break;case"CENTER_RIGHT":o="50%",r=0;break;case"BOTTOM_CENTER":a=0,s="50%";break;case"CENTER_LEFT":s=0,o="50%";break;default:o=0,s="50%"}return{x:i,y:n,top:o,left:s,bottom:a,right:r}},_needToMakeRoomForAd:function(){return!(this._isSideCentered()||this._isHorizCentred()&&this._isTopPositioned())},_makeRoomForAd:function(){if(this._needToMakeRoomForAd()){var e=document.getElementById("wixFooter"),t=e?e.$logic.getAdHeight():{footer:46,top:26};this._isTopPositioned()?this.setY(t.top):this._setCssPosition(t.footer,"bottom")}},_resetAdRePosition:function(){this._needToMakeRoomForAd()&&(this._isTopPositioned()?this.setY(0):this._setCssPosition(0,"bottom"))},_editModeChanged:function(e){"PREVIEW"===e?this._makeRoomForAd():this._resetAdRePosition(),"PREVIEW"===e?this._addTransitionClass():this._removeTransitionClass()},canMoveBack:function(){return!1},canMoveForward:function(){return!1},isMultiSelectable:function(){return!1},canMoveToOtherScope:function(){return!1},isDraggable:function(){return!1},isDuplicatable:function(){return!1},getShowOnAllPagesChangeability:function(){return!0},getX:function(){var e=0;return this._isLeftPositioned()?this._isHorizCentred()&&(e=this._view.getPosition().x):this._isRightPositioned()&&(e=this._view.getPosition().x),e},getY:function(){var e=0;return this._isTopPositioned()?this._isVertCentred()&&(e=this._view.getPosition().y):this._isBottomPositioned()&&(e=this._view.getPosition().y),e},getSelectableX:function(){return this.getX()},getSelectableY:function(){return this.getY()},_getPageMargin:function(){var e=this.injects().Viewer.getSiteNode(),t=e.getSize();return(window.innerWidth-t.x)/2},_getPageSize:function(){var e=this.injects().Viewer.getSiteNode();return e.getSize()}})}),define.experiment.component("wysiwyg.viewer.components.tpapps.TPAPlaceholder.Staff.Wix",function(e){e.fields({propertiesSchemaName:"WPhotoProperties",EDITOR_META_DATA:{general:{title:"App Placeholder",settings:!0,design:!1},custom:[{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"photos"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.Market",commandParameterDataRef:"SELF"}}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.BetterPrefetch.New",function(e,t){var i=e,n=t;i.resources(["W.Viewer","W.Utils"]),i.methods({initialize:n.after(function(){this._lazilyLoadedPage=0}),_loadAllPagesLazily:function(){var e=this._getNextUnloadedPage();e&&5>this._lazilyLoadedPage&&(this._lazilyLoadedPage++,this.loadPageById(e.pageId),W.Utils.callLater(this._loadAllPagesLazily,[],this,1e4))},_loadSiteNewVersion:function(){this._loadAllPages(this._getPagesToLoad()),this.getMasterPageData(this._createMasterPage),this.resources.W.Viewer.addEvent("SiteReady",this.resources.W.Utils.callLater.bind(this.resources.W.Utils,this._loadAllPagesLazily,[],this,15e3))}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.JITPageLoader.New",function(e,t){var i=e,n=t;i.methods({initialize:n.after(function(){this._loadedPages=[],this._loadingPages=[],this._loadingPagesTrialCounter={},this._getPagesList()&&this._getPagesList().pages.each(function(e){this._loadingPagesTrialCounter[e.pageId]=0}.bind(this)),this._callBacksForPageCreation={}}),getPageData:function(e,t){if(!e||!e.urls)throw"page is not listed in the pages list or it does not have url";if("function"!=typeof t)throw"callback ["+t+"] supplied is not a function";this._requestPageJson(e.urls,t,e)},_requestPageJson:function(e,t,i){this._restClient.get(e[0],void 0,{onSuccess:t,onError:this._getErrorCallbackForUrl(e,t,i)})},_getErrorCallbackForUrl:function(e,t,i){if(1==e.length)return function(){i&&this._loadingPages.splice(this._loadingPages.indexOf(i.pageId),1),LOG.reportError(wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED,"PageManager","_requestPageJson")}.bind(this);var n=e.clone();return n.splice(0,1),function(){LOG.reportError(wixErrors.SINGLE_PAGE_RETRIEVAL_ATTEMPT_FAILED,"PageManager","_requestPageJson",n[0]),this._requestPageJson(n,t,i)}.bind(this)},createPage:function(e){var t=this._getJsonForString(e),i=t.data||t.payload.data;this._setInitDataForPage(i);var n=t.structure||t.payload.structure,o=this._createPageElements(n);this._attachPageWhenReady(o,n.id)},_setInitDataForPage:function(e){var t=this.dataFixer.fix(e);W.Data.addDataItemsForPage(t.document_data),W.ComponentData.addDataItemsForPage(t.component_properties),W.Theme.addDataItemsForPage(t.theme_data)},_attachPageWhenReady:function(e,t){$(t)?(this._attachPage(e,t),this._loadedPages.push(t),W.Utils.callLater(this._callBacksForPageCreation[t].method,[],this._callBacksForPageCreation[t].scope,10),this.fireEvent("PAGE_LOADED",t)):W.Utils.callLater(this._attachPageWhenReady,[e,t],this,10)},_attachPage:function(e,t){var i=$(t);i.getLogic?this._attachPageContentToWixifiedPage(i,e):e.replaces(i)},_attachPageContentToWixifiedPage:function(e,t){var i=e.getLogic();e.empty(),t.getChildren().each(function(t){e.grab(t,"bottom")}),t.get("styleId")!=e.get("styleId")?(e.set("styleId",t.get("styleId")),W.Theme.getStyle(t.get("styleId"),function(e){i.setStyle(e)})):e.get("skin")!==t.get("skin")&&(e.set("skin",t.get("skin")),W.Skins.getSkin(t.get("skin"),function(e){var t=new e;i.setSkin(t)})),t.get("dataQuery")!=e.get("dataQuery")&&(e.set("dataQuery",t.get("dataQuery")),i.setDataByQuery(t.get("dataQuery"),function(){})),t.get("propertyQuery")!=e.get("propertyQuery")&&(e.set("propertyQuery",t.get("propertyQuery")),W.Data.getDataByQuery(t.get("propertyQuery"),i.setComponentProperties))},_attachMasterPage:function(e){$$("body")[0].grab(e,"top")},_createMasterPage:n.after(function(){this._addPagesStubs()}),_addPagesStubs:function(){Object.each(this._getPagesList().pages,function(e){$("SITE_PAGES").grab(this._createStubPage(e))}.bind(this))},_createStubPage:function(e){var t=new Element("div");return t.set({id:e.pageId,comp:"mobile.core.components.Page",skin:"mobile.core.skins.InlineSkin",dataQuery:"#"+e.pageId}),t},isPageLoaded:function(e){return this._isOldPageVersion()||this._loadedPages.contains(e)||this._loadingPages.contains(e)},loadPageById:function(e,t,i){var n=this._getPageDataById(e);this._loadedPages.contains(e)||this._loadingPages.contains(e)||(this._loadingPagesTrialCounter[e]++,this._loadingPages.push(e),this._callBacksForPageCreation[e]={method:t,scope:i},this._loadSinglePage(n))},_getPageDataById:function(e){return this._getPagesList().pages.first(function(t){return t.pageId===e})},_loadAllPages:function(e){this.addEvent("PAGE_LOADED",function(t){e.erase(t),0===e.length&&(this._allPagesAreLoaded=!0)}.bind(this)),e.each(function(e){this.loadPageById(e)}.bind(this))},_loadAllPagesLazily:function(){var e=this._getNextUnloadedPage();e&&(this.loadPageById(e.pageId),W.Utils.callLater(this._loadAllPagesLazily,[],this,3e3))},_getNextUnloadedPage:function(){return this._getPagesList().pages.first(function(e){return!this.isPageLoaded(e.pageId)&&3>=this._loadingPagesTrialCounter[e.pageId]}.bind(this))},_getPagesToLoad:function(){var e=this.getMainPage();this._isPageReal(e)||(e=this._getPagesList().pages[0].pageId);var t=[e],i=W.Utils.hash.getHashParts(),n="zoom"===i.id?i.extData.match("([^/]+)/([^/]+)")[1]:i.id;return n&&n!==this.getMainPage()&&this._isPageReal(n)&&t.push(n),t},_isPageReal:function(e){return this._getPagesList().pages.some(function(t){return t.pageId===e})},_loadSiteNewVersion:function(){this._loadAllPages(this._getPagesToLoad()),this.getMasterPageData(this._createMasterPage),W.Utils.callLater(this._loadAllPagesLazily,[],this,15e3)}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.MobileViewerQuickActions.New",function(e,t){var i=e,n=t;i.resources(["W.Config"]),i.utilize(n.merge(["wysiwyg.viewer.managers.utils.MobileQuickActionsHandler"])),i.methods({_createMasterPage:n.after(function(){if(this.resources.W.Config.mobileConfig.isMobile()){var e=new this.imports.MobileQuickActionsHandler;e.handleMobileQuickActions()}})})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.PageLoadReport.New",function(e,t){var i=e;i.methods({_loadSiteNewVersion:function(){try{this._loadAllPages(this._getPagesToLoad()),this.getMasterPageData(this._createMasterPage),W.Utils.callLater(this._loadAllPagesLazily,[],this,15e3)}catch(e){LOG.reportError(wixErrors.PAGE_FETCHING_ERROR,"PageManager","_loadSiteNewVersion")}this._startReportTimer()},_startReportTimer:function(){setTimeout(function(){for(var e=-1!==document.referrer.indexOf("editor.wix.com/html/editor"),t=deployStatus.logs.pageLoad||[],i=deployStatus.logs.pageDataLoad||[],n=deployStatus.logs.viewerRender||[],o=deployStatus.logs.phases||[],s={},a=0;t.length>a;++a){var r=t[a],l=r.pageId,d=s[l]=s[l]||{};d.steps=d.steps||[];var h={time:r.time,host:r.host,step:r.type};r.errorDesc&&(h.error=r.errorDesc.substr(0,50)),void 0!==r.httpsStatus&&(h.status=r.httpsStatus),d.steps.push(h),d.time=r.time,d.step=r.type}var c=-1,p=-1,m=-1,_=-1,u=-1,g=-1;i.length>0&&(p=i[0].time),i.length>1&&(m=i[1].time),n.length>2&&"site ready"===n[2].step&&(_=n[2].time,g=n[2].time),n.length>0&&(u=n[0].time),o.length>0&&(c=o[o.length-1].time);var y={isFromEditor:e,isMobile:W.Config.mobileConfig.isMobileOrTablet(),isLoaded:W.Viewer.isSiteReady(),siteReadyTime:_,deployment:{start:0,done:c},pages:{start:p,done:m,pages:s},render:{start:u,done:g}};LOG.reportEvent(wixEvents.LOAD_PAGE_DATA,{c1:JSON.stringify(y)})},1e4)},_requestPageJson:function(e,t,i){var n=e[0];i?i.lastTriedUrl=n:this._sorryNadavToldMeToSaveThePageUrlHere=n;var o=t;t.wrapper||(new Date,o=function(){var e=i?i.lastTriedUrl:this._sorryNadavToldMeToSaveThePageUrlHere;this._logPageError("page loaded",e,i,o.initTime,200),t.apply(this,arguments)}.bind(this),o.wrapper=!0,o.initTime=new Date),this._logPageError("try page load",n,i,o.initTime),this._restClient.get(n,void 0,{onSuccess:o,onError:this._getErrorCallbackForUrl(e,o,i)})},_getErrorCallbackForUrl:function(e,t,i){var n=e[0];if(1==e.length)return function(e,o){i&&this._loadingPages.splice(this._loadingPages.indexOf(i.pageId),1),LOG.reportError(wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED,"PageManager","_requestPageJson"),this._logPageError("total fail",n,i,t.initTime,o,e)}.bind(this);var o=e.clone();return o.splice(0,1),function(e,s){LOG.reportError(wixErrors.SINGLE_PAGE_RETRIEVAL_ATTEMPT_FAILED,"PageManager","_requestPageJson",o[0]),this._logPageError("attempt fail",n,i,t.initTime,s,e),this._requestPageJson(o,t,i)}.bind(this)},_logPageError:function(e,t,i,n,o,s){var a=new Date,r=t.substr(7).substr(0,t.substr(7).indexOf("/")),a=n?a-n:"",l=i?i.pageId:"masterPage";deployStatus("pageLoad",{type:e,host:r,time:a,pageId:l,httpsStatus:o,errorDesc:s,sessionTime:LOG.getSessionTime()})}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.WixAppsPage.New",function(e,t){var i=e;i.methods({_addPagesStubs:function(){Object.each(this._getPagesList().pages,function(e){this._createStubPageAsync(e,function(e){$("SITE_PAGES").grab(e)})}.bind(this))},_createStubPageAsync:function(e,t){W.Data.getDataByQuery("#"+e.pageId,function(i){var n=i.getData().type,o=this._createStubPage(e,n);t(o)}.bind(this))},_createStubPage:function(e,t){var i=new Element("div");return i.set({id:e.pageId,comp:this._getPageFullQualifier(t),skin:"mobile.core.skins.InlineSkin",dataQuery:"#"+e.pageId}),i},_getPageFullQualifier:function(e){return pageQ={Page:"mobile.core.components.Page",AppPage:"wixapps.integration.components.AppPage"},pageQ[e]}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.NewFetchPolicy.New",function(e,t){"use strict";var i=e,n=t;i.methods({initialize:n.after(function(){this._loadedPages=[],this._loadingPages=[],this._loadingPagesTrialCounter={},this._getPagesList()&&this._getPagesList().pages.each(function(e){this._loadingPagesTrialCounter[e.pageId]=0}.bind(this)),this._callBacksForPageCreation={}}),_cratePageRequesters:function(){var e=this._getPagesList().pages;e.forEach(function(e){var t=e.urls.map(function(e){return resource.url(e,this._getRequestMethod(e),this._shouldLoadOnce(e))},this);define.resource(this._getResourceIdFromPageID(e.pageId)).withUrls(t).withTrials(3).withTimeBetween(3e3)},this);var t=this._getPagesList().masterPage.map(function(e){return resource.url(e,this._getRequestMethod(e),this._shouldLoadOnce(e))},this);define.resource(this._getResourceIdFromPageID("master")).withUrls(t).withTrials(3).withTimeBetween(3e3)},_getResourceIdFromPageID:function(e){return"pages."+e},_isStaticPage:function(e){return~e.indexOf("static.")},_getRequestMethod:function(e){return this._isStaticPage(e)?"cors":"jsonp"},_shouldLoadOnce:function(e){return!!this._isStaticPage(e)},_loadSiteNewVersion:n.before(function(){this._cratePageRequesters()}),_reportTotalFailure:function(){LOG.reportError(wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED,"PageManager","loadPageById")},loadPageById:function(e,t,i){this._callBacksForPageCreation[e]={method:t,scope:i};var n=function(e){e.startContentCreation||(e.startContentCreation=!0,this.createPage(e))}.bind(this);resource.getResourceValue(this._getResourceIdFromPageID(e),n,this._reportTotalFailure)},getMasterPageData:function(e){resource.getResourceValue(this._getResourceIdFromPageID("master"),e,this._reportTotalFailure)},_attachPageWhenReady:function(e,t){$(t)?(this._attachPage(e,t),this._loadedPages.push(t),W.Utils.callLater(this._callBacksForPageCreation[t].method,[],this._callBacksForPageCreation[t].scope,10),this.fireEvent("PAGE_LOADED",t)):W.Utils.callLater(this._attachPageWhenReady,[e,t],this,10)}})}),define.experiment.Class("wysiwyg.viewer.managers.SiteMembersManager.SMForgot_Password.New",function(e,t){var i=e,n=t;i.statics({AUTH_STATES:{AUTH:"auth token and cookie exist",NO_AUTH_WITH_COOKIE:"no auth token, cookie exist",NO_AUTH_WITHOUT_COOKIE:"no auth token, cookie doesnt exist"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},API_ERRORS:{API_NOT_LOADED:"Site Members API was not loaded",TOKEN_IS_INVALID:"Authentication Token is invalid"},RESET_PASSWORD_KEY_PARAMETER:"forgotPasswordToken"}),i.methods({initialize:n.after(function(){var e=this;this.resources.W.Viewer.addEvent("SiteReady",function(){e._showPasswordResetIfNeeded()})}),_showPasswordResetIfNeeded:function(){var e=this._getCurrentSearchURL();if(this._isResetPasswordRequested(e)&&this._isViewerMode()){var t=this;this.resource.getResourceValue("W.SiteMembers",function(i){var n=t._getResetPasswordIdFromURL(e);i.openSiteMembersPopup({intent:"RESETPASSWORD",disableCancel:!0,resetPassKey:n})})}},_getCurrentSearchURL:function(){return window.location.search},sendUserPasswordResetEmail:function(e,t,i){var n=this._getReturnUrl();this._api.sendForgotPasswordMail(e,n,t,i)},_getReturnUrl:function(){var e=this._getLocationUrl();return e=encodeURIComponent(e)},_getLocationUrl:function(){return window.location.href},resetPassword:function(e,t,i){var n=this._getCurrentSearchURL(),o=this._getResetPasswordIdFromURL(n);this._api.resetMemberPassword(o,e,t,i)},_isResetPasswordRequested:function(e){return e.indexOf(this.RESET_PASSWORD_KEY_PARAMETER)>=0},_getResetPasswordIdFromURL:function(e){return W.Utils.getQueryParam(this.RESET_PASSWORD_KEY_PARAMETER,e)},_isViewerMode:function(){return"site"===window.viewMode}})}),define.experiment.Class("wysiwyg.viewer.managers.SiteMembersManager.SMMemberAccessLimit.New",function(e,t){var i=e;i.statics({AUTH_STATES:{AUTH:"auth token and cookie exist",NO_AUTH_WITH_COOKIE:"no auth token, cookie exist",NO_AUTH_WITHOUT_COOKIE:"no auth token, cookie doesnt exist"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},API_ERRORS:{API_NOT_LOADED:"Site Members API was not loaded",TOKEN_IS_INVALID:"Authentication Token is invalid"},USER_STATUS:{ACTIVE:"ACTIVE"}}),i.methods({getMemberDetails:function(e,t){var i=this._isMemberActiveAndCall(e);t||(t=i),this._memberDetails?i(this._memberDetails):this._apiReady?this._token?this._api.getMemberDetails(this._token,i,t):t&&t({code:"TOKEN_IS_INVALID",description:this.API_ERRORS.TOKEN_IS_INVALID}):t&&t({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},_isMemberActiveAndCall:function(e){var t=this;return function(i){i&&t._isInvalidUserAccess(i)?t._handleInvalidUserAccess(i):i&&i.status?i.status!==t.USER_STATUS.ACTIVE?t._logoutAndRefresh():e&&e(i):t.logout()}},_isInvalidUserAccess:function(e){var t=["-19980","-19984","-19999"],i=e.errorCode+"";return t.indexOf(i)>=0},_handleInvalidUserAccess:function(e){var t=e.errorCode+"";"-19980"===t?this._refreshPage():"-19984"===t?this._logoutAndRefresh():"-19999"===t&&this._logoutAndRefresh()},_logoutAndRefresh:function(){this.logout(),this._refreshPage()},_refreshPage:function(){location.reload()}})}),define.experiment.Class("wysiwyg.viewer.managers.TPAManager.TPAScript.New",function(e,t){var i=e,n=t;i.resources(n.merge(["W.Classes"])),i.fields({worksStack:[]}),i.methods({runScript:function(e,t){this.resources.W.Classes.getClass("wysiwyg.viewer.managers.tpa.TPAWorkerWrapper",function(i){var n=new i(t);this.worksStack[n.getCompId()]=n,n.run(e)}.bind(this))},handlePostMessage:function(e,t){if("string"==typeof e.data){var i="";try{i=JSON.parse(e.data)}catch(n){return}var o=i.type;i&&i.intent&&(i.intent===this.TPA_MESSAGE&&o?this._handleTPAMessage(i,o,t):i.intent===this.APP_MARKET_MESSAGE?this._handleAppMarketMessage(i):i.intent===this.TPA_MESSAGE2&&o&&this._handleTPAMessage2(i,this.getCallerContext(this)))}},getCallerContext:function(e){var t={getCaller:function(e){var t=$(e);return t&&t.getLogic()},sendToCaller:function(t,i){var n=JSON.stringify({intent:e.TPA_RESPONSE,compId:t.compId,callId:t.callId,type:t.type,res:i,status:!0});this.getIFrame().contentWindow.postMessage(n,"*")}};return t},_handleTPAMessage2:function(e,t){var i=t.getCaller(e.compId);if(i)if(Object.contains(this.MessageTypes,e.type)){var n=this._getHandlerFunctionName(e.type),o=i[n];"function"==typeof o?o.call(i,{msgData:e.data,callback:t.sendToCaller.bind(i,e)}):LOG.reportError("Handler function not found - "+e.type,"wysiwyg.viewer.managers.TPA","handlePostMessage2")}else LOG.reportError("Unknown post message type - "+e.type,"wysiwyg.viewer.managers.TPA","handlePostMessage")}})}),define.experiment.newClass("wysiwyg.viewer.managers.tpa.TPAWorkerWrapper.TPAScript.New",function(e){var t=e;t.traits(["wysiwyg.viewer.components.traits.TPAHandlers"]),t.resources(["W.TPA","topology"]),t.statics({TPA_SCRIPT_WORKER:"TPA_Script_Worker",API_URL:"http://wysiwyg.pita.wixpress.com/js-sdk/1.17.0/js/Wix.js"}),t.methods({initialize:function(e){this.forceIframe=e,this.compId=this._createCompId(),this.iframePolyfill()},getCompId:function(){return this.compId},iframePolyfill:function(){(!window.Worker||this.forceIframe)&&(window.Worker=function(e){var t=function(t,i){var n=this,o=function(){s(),r()},s=function(){window.addEventListener?window.addEventListener("message",d,!1):window.attachEvent("onmessage",d)},a=function(){window.removeEventListener?window.removeEventListener("message",d,!1):window.detachEvent("onmessage",d)},r=function(){n.iframeEl=document.createElement("iframe"),n.iframeEl.style.visibility="hidden",n.iframeEl.style.display="none",n.iframeEl.style.width="1px",n.iframeEl.style.height="1px",n.iframeEl.id=i,n.iframeEl.src=[e,"/html/external/worker-iframe.html?compId=",i].join(""),document.body.appendChild(n.iframeEl)},l=function(){n.postMessage(JSON.stringify({compId:i,blob:t}))},d=function(e){var t;try{t=JSON.parse(e.data)}catch(o){return}t.compId===i&&(t.ready?l():t.terminate?n.terminate():t.error&&n.onerror?n.onerror.call(this,t.error):n.onmessage&&n.onmessage.call(this,e))};this.postMessage=function(e){n.iframeEl.contentWindow.postMessage(e,"*")},this.terminate=function(){document.body.removeChild(n.iframeEl),a()},o()};return t}(this.resources.topology.wysiwyg))},run:function(e){var t=this._createBlob(e);this.worker=new Worker(t,this.compId),this.worker.onmessage=this._handlePostMessage.bind(this),this.worker.onerror=this._handlePostMessageError.bind(this)},terminate:function(){this.worker.terminate()
},_createBlob:function(e){var t=['wix_sdk_globals ={ compId:"{compId}", workerMode:true };','importScripts("{api}");',"{script}"].join("");return e=this._isUrl(e)?['importScripts("',e,'");'].join(""):["(",""+e,")();"].join(""),t=t.substitute({compId:this.compId,api:this.API_URL,script:e}),window.Blob&&!this.forceIframe?window.URL.createObjectURL(new Blob([t])):t},_handlePostMessage:function(e){var t=JSON.parse(e.data);switch(t.intent){case this.resources.W.TPA.TPA_MESSAGE2:this._handleTPAScript(t);break;case this.TPA_SCRIPT_WORKER:this._handleWorkerNativeFunctions(t)}},_handlePostMessageError:function(e){alert("Error: Line "+e.lineno+" in "+e.filename+": "+e.message)},_handleTPAScript:function(e){this.resources.W.TPA._handleTPAMessage2(e,this.getCallerContext())},getCallerContext:function(){var e=this,t={getCaller:function(){return e},sendToCaller:function(t,i){e.worker.postMessage(JSON.stringify({intent:e.resources.W.TPA.TPA_RESPONSE,compId:e.compId,callId:t.callId,type:t.type,res:i,status:!0}))}};return t},_getHandlerFunctionName:function(e){return"handle"+e.capitalize()},_handleWorkerNativeFunctions:function(e){switch(e.func){case"console":console[e.method](e.message);break;case"alert":alert(e.message)}},_isUrl:function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return t.test(e)},_createCompId:function(){return"TPAScript-xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),i="x"==e?t:8|3&t;return i.toString(16)})}})}),define.experiment.newClass("wysiwyg.viewer.managers.utils.MobileQuickActionsHandler.MobileViewerQuickActions.New",function(e){var t=e;t.resources(["W.Data","W.Resources","W.Viewer","W.Commands"]),t.binds(["_navigateToPage","_createNavItemsFromDataItems","_createSingleNavItem"]),t.methods({handleMobileQuickActions:function(){this._removePreloader(),this._addNavigation()},_removePreloader:function(){var e=document.getElementById("viewer_preloader");null!=e&&(e.style.visibility="hidden")},_addNavigation:function(){var e=document.getElementById("quick-actions");if(e){var t=document.getElementById("quick-actions-site-nav");this._navigation=document.getElementById("quick-actions-pages"),null!=t&&(this.resources.W.Commands.registerCommandAndListener("WViewerCommands.SelectedPageChanged",this,this._onSelectedPageChanged),this.resources.W.Data.getDataByQuery("#MAIN_MENU",function(e){var t="Pages";this._navigation.onchange=this._navigateToPage;var i=new Element("optgroup");i.set("label",t),this._navigation.appendChild(i);var n=e.getItems();this._createNavItemsFromDataItems(i,n,0)}.bind(this)),t.className=t.className.replace("disabled",""))}},_createNavItemsFromDataItems:function(e,t,i){for(var n=0;t.length>n;n++){var o=t[n];this._createSingleNavItem(e,o,i);var s=o.get("items");s&&s.length>0&&this._createNavItemsFromDataItems(e,s,i+1)}},_createSingleNavItem:function(e,t,i){for(var n=">",o="",s=0;i>s;s++)o+=n;var a=t.get("refId"),r=new Element("option");r.setAttribute("value",a),e.appendChild(r),this.resources.W.Data.getDataByQuery(a,function(t){var i=t.get("hidePage");if(i)e.removeChild(r);else{var n=t.get("title");r.innerHTML=o+n}}.bind(this))},_onSelectedPageChanged:function(e){this._selectedPageId=this.resources.W.Viewer.getCurrentPageId(),this._navigation.value="#"+e},_navigateToPage:function(){var e=this._navigation.options[this._navigation.selectedIndex].value;0===e.indexOf("#")&&(e=e.substr(1)),this.resources.W.Viewer.goToPage(e)}})}),define.experiment.Class("wysiwyg.viewer.utils.TransitionUtils.MobileFixes.New",function(e,t){var i=e;i.resources(["W.Config"]),i.methods({getTransition:function(e){if(this.resources.W.Config.mobileConfig.isMobileOrTablet())return this._noTransition;switch(e){case Constants.TransitionTypes.SWIPE_HORIZONTAL:return this._swipeHorizontalTransition;case Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN:return this._swipeHorizontalTransitionFullScreen;case Constants.TransitionTypes.SWIPE_VERTICAL:return this._swipeVerticalTransition;case Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN:return this._swipeVerticalTransitionFullScreen;case Constants.TransitionTypes.CROSS_FADE:return this._crossFadeTransition;case Constants.TransitionTypes.SHRINK_FADE:return this._shrinkFadeTransition;case Constants.TransitionTypes.OUT_IN:return this._inOutTransition;case Constants.TransitionTypes.NONE:default:return this._noTransition}}})});